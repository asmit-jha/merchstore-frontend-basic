!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="9c52336f-2cb9-4397-881d-85a463bdf11b",e._sentryDebugIdIdentifier="sentry-dbid-9c52336f-2cb9-4397-881d-85a463bdf11b")}catch(e){}}();"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8394],{81383:function(e,t,r){t.J=void 0;var i=r(22970),n=r(53282),o=r(47632),s=r(20432),a=r(57665),l=r(17997),d=r(11601),u=r(54459),c=r(61054),h=r(7822),_=r(8069),p=r(84770),f=r(29251),v=r(29368),g=r(92271),m=r(72413),S=r(59082),y=r(82541),E=r(74557),T=r(20149),C=r(94306),k=r(88309),P=r(70847),R=r(28521),b=r(24526),w=r(34855),W=r(14802),U=r(65533),L=r(75855),A=r(27574),x=r(82270),O=r(2906),D=r(88269),I=r(15302),M=r(19734),V=r(69052),N=r(39077),B=r(49450),F=r(74436),q=function(){function e(e,t,r){var i=this;void 0===r&&(r={}),this.relativeBuffer={start:x.PlayerConstants.DEFAULT_RELATIVE_BUFFER_START,end:x.PlayerConstants.DEFAULT_RELATIVE_BUFFER_END},this.relativeAppend={start:x.PlayerConstants.DEFAULT_RELATIVE_APPEND_START,end:x.PlayerConstants.DEFAULT_RELATIVE_APPEND_END},this.onStateChanged=new o.Emitter,this.onTextCueChange=new o.Emitter,this.onTextCueGroupChange=new o.Emitter,this.onPeriodLoaded=new o.Emitter,this.onReceiveTimedEvent=new o.Emitter,this.onError=new o.Emitter,this.onWarning=new o.Emitter,this._workerUtil=new U.SegmentPipelineWorkerUtil,this._onReceiveTimedEvents=new k.Set,this._textSets=new C.HashMap,this._textEnabled=!1,this._currentText=[],this._bufferForPlaybackSeconds=x.PlayerConstants.DEFAULT_BUFFER_FOR_PLAYBACK_SECONDS,this._bufferUpdateSeconds=x.PlayerConstants.BUFFER_UPDATE_SECONDS,this._reloadOnSegmentRetryError=!1,this._vttUtil=new g.VttUtil,this._timeRangeUtil=new v.TimeRangeUtil,this._playerUtil=new A.PlayerUtil,this._languageUtil=new D.LanguageUtil,this._seekSeq=0,this._textUpdateSeconds=x.PlayerConstants.TEXT_UPDATE_SECONDS,this._seekPastEndRestart=x.PlayerConstants.DEFAULT_SEEK_PAST_END_RESTART_SECONDS,this._stallErrorThresholdSeconds=x.PlayerConstants.DEFAULT_STALL_TIME_ERROR_THRESHOLD_SECONDS,this._stallMitigationThresholdSeconds=x.PlayerConstants.DEFAULT_STALL_TIME_MITIGATION_THRESHOLD_SECONDS,this._system=e,this._videoElement=t,this._system.supportsExactSeeks()||(this._seekSnapping="CLOSEST_VIDEO_SEGMENT_START"),this._playerTimer=new n.Timer(this._system,function(){return i._onPlayerTimerUpdate()}),this._sizeTimer=new n.Timer(this._system,function(){return i._onPlayerSizeUpdate()}),this._textTimer=new n.Timer(this._system,function(){return i._onTextCueUpdate()}),this._onReceiveTimedEventTimer=new n.Timer(this._system,function(){return i._onTimedEventUpdate()}),this._applyPlayerOptions(r),this._playerStateTracker=new s.PlayerStateTracker,this._system.requiresStallSkippingWorkaround()&&(this._stallSkippingController=new m.StallSkippingController(this._system,{getCurrentPeriodRange:function(){return i._regionController.getCurrentPeriodRange()},getPlayerState:function(){return i._playerStateTracker.getCurrent()}})),this._stallTrackingController=new V.StallTrackingController(e,{getPlayerState:function(){return i.getPlayerState()},onPlayerStateChange:this.onStateChanged},this._stallErrorThresholdSeconds,this._stallMitigationThresholdSeconds),this._loadController=new p.PlayerLoadController(e,{playbackSession:function(){return i.getSession()},playerState:function(){return i.getPlayerState()},reload:function(e){return i._reload(e)},attach:function(e){return i._attach(e)},detach:function(){return i._detach()},seek:function(e){return i._setPositionWhenReady(e.position)}}),this._retryController=new y.RetryController,this._regionController=new S.RegionController(this._playerStateTracker.onStateChanged,{getState:function(){return i._playerStateTracker.getCurrent()},isLive:function(){return i._isLiveSession()},getPeriods:function(){return i._getLoadedPeriods()}}),this._endOfStreamController=new E.EndOfStreamController(this._system,{getCurrentPeriodRange:function(){return i._regionController.getCurrentPeriodRange()},getState:function(){return i._playerStateTracker.getCurrent()},playbackSession:function(){return i.getSession()},isLive:function(){return i._isLiveSession()}}),this._liveWindowUpdateController=new f.LiveWindowUpdateController(this.onStateChanged,this._system,{getLiveContentRange:function(){if(i._isLiveSession())return i.getContentRange()},getOriginalStartTime:function(){if(i._isLiveSession())return i._originalStartTime},getLiveStart:function(){var e;if(i._isLiveSession())return null===(e=i._session)||void 0===e?void 0:e.getLiveStart()},getLiveEdge:function(){var e;if(i._isLiveSession())return null===(e=i._session)||void 0===e?void 0:e.getLiveEdge()}})}return Object.defineProperty(e.prototype,"playerVitals",{get:function(){return this._playerVitals},enumerable:!1,configurable:!0}),e.prototype.setPlayerVitals=function(e){if(void 0!==this._playerVitals)throw new I.InvalidOperationError("PlayerVitals is already set.");if(void 0!==this._session)throw new I.InvalidOperationError("PlayerVitals must be set before a session is attached.");this._playerVitals=e},e.prototype._hasEncrypted=function(e){var t,r=null===(t=this._session)||void 0===t?void 0:t.getLoadedBuffer();if(void 0===r)return!1;var i=r.mediaSourceController.getPipeline(e);if(void 0===i)return!1;for(var n=0,o=i.active.getAllRanges();n<o.length;n++){var s=o[n];if(void 0!==s.segment.keyId&&this._workerUtil.isAppended(s))return!0}return!1},e.prototype._shouldAppendMediaKeys=function(e){return this._system.requiresMediaKeysAttachedForUnencrypted()||!1!==e},e.prototype.attach=function(e,t,r){return void 0===r&&(r={}),this._loadController.attach({session:e,manifest:t,sessionInit:r})},e.prototype._attach=function(e){var t,r,n,o,s,d,u;return i.__awaiter(this,void 0,void 0,function(){var c,p,f,v,g,m,S,y,E,T,C,k,P,U,A=this;return i.__generator(this,function(i){switch(i.label){case 0:if(void 0!==this._session)throw new I.InvalidOperationError("Consecutive call to Player.attach without intervening call to Player.detach");if(this._playerStateTracker.onStateChanged.off(this),this._playerStateTracker.onStateChanged.on(this,function(t){var r;null===(r=e.session.cmcd)||void 0===r||r.setRebuffering("STALLED"===t.playbackState&&t.stallReason===F.StallReason.WAITING_NETWORK),A._loadController.isReloading()||A.onStateChanged.emit(t)}),this._setStateChangeHandlers(),this._session=e.session,this._session.onError.on(this,function(e){return A._onError(e)}),this._session.onWarning.on(this,function(e){return A.onWarning.emit(e)}),this._session.setTextEnabled(this._textEnabled),void 0!==this._playerVitals&&this._session.setPlayerVitals(this._playerVitals),this._videoElement.onWarning.on(this,function(e){var t;if((null===(t=A._session)||void 0===t?void 0:t.isRestrictedToAAC())===!1&&a.WrappedError.causedBy(e,W.SafariKeyWarningError.NAME)&&A._hasEncrypted("audio")&&A._hasEncrypted("video")){w.PromiseUtil.catchRejection(function(){return A._loadController.reload({sequence:A._seekSeq,audioCodecGroups:["aac","heaac"]})},function(e){A.onError.emit(a.WrappedError.wrap(e))});return}A.onWarning.emit(e)}),this._videoElement.onError.on(this,function(e){return A._onError(e)}),this._videoElement.onLoadedData.on(this,function(){var e;null===(e=A._playerVitals)||void 0===e||e.add("FIRST_FRAME_RENDERED")}),c=this._system.makeMediaSource(),p=this._system.clearMediaKeys(this._videoElement),!(c instanceof Promise||p instanceof Promise))return[3,2];return[4,Promise.all([c,p])];case 1:c=i.sent()[0],i.label=2;case 2:return this._mediaSource=c,this._playerStateTracker.reset(this._session),[4,Promise.all([this._session.load(e.manifest,e.sessionInit),this._videoElement.setMediaSource(this._mediaSource)])];case 3:if(f=i.sent()[0],!((v=this._videoElement.getState())instanceof Promise))return[3,5];return[4,v];case 4:v=i.sent(),i.label=5;case 5:if(void 0!==e.sessionInit.position&&void 0!==e.sessionInit.sequence&&e.sessionInit.sequence!==this._seekSeq?(this._system.logInfo("ignoring attach position of ".concat(e.sessionInit.position," because more recent seek request came in (currentTime=").concat(v.currentTime," lastSeekPos=").concat(this._lastSeekPos,")")),g=this._lastSeekPos):g=e.sessionInit.position,void 0===e.sessionInit.position&&e.session.isLive&&void 0!==(m=!1===e.sessionInit.startAtLivePoint?e.session.getLiveStart():e.session.getLiveEdge())&&(g=m),void 0===g&&(g=v.currentTime),this._seekPastEndRestart>=0&&!e.session.isLive&&void 0!==(S=this._playerUtil.getRangeOfPeriods(null!==(t=this._getLoadedPeriods())&&void 0!==t?t:[]))&&g>S.end-this._seekPastEndRestart&&(this._system.logWarn("Attempted to seek past end of period: ".concat(g," is not in range [").concat(S.start,"-").concat(S.end,"], seeking to start")),g=S.start),this._originalStartTime=e.session.getLiveStart(),!(g!==v.currentTime))return[3,9];if(!((y=this._videoElement.setPositionWhenReady(g))instanceof Promise))return[3,7];return[4,y];case 6:i.sent(),i.label=7;case 7:if(!((v=this._videoElement.getState())instanceof Promise))return[3,9];return[4,v];case 8:v=i.sent(),i.label=9;case 9:if(this._playerStateTracker.setVideoState(v),void 0===(E=this._regionController.getPeriodForTime(g)))throw new L.PlayerNotLoadedError("Failed to find period for given time ".concat(g," with period info ").concat(this._getPeriodDebugInfo(null!==(r=this._getLoadedPeriods())&&void 0!==r?r:[])));if(this._session.setAppendPeriod(E),void 0!==this._playerVitals&&f.buffer.setPlayerVitals(this._playerVitals),void 0!==this._seekSnapping&&(this._seekSnapper=new b.SeekSnapper(this._seekSnapping,function(){return f.buffer.selectAllVariants()})),void 0===(T=this._playerUtil.isPeriodEncrypted(E))&&this.onWarning.emit(new R.WarningError("Could not determine if period is encrypted after loading at time ".concat(g))),k=null==(C=f.buffer.drm)?void 0:C.getMediaKeys(),!(void 0!==C&&void 0!==k&&this._shouldAppendMediaKeys(T)))return[3,11];return[4,this._system.setMediaKeys(this._videoElement,k)];case 10:i.sent(),this._system.requiresReattachOnKeyStatusesChange()&&C.onUpdated.on(this,function(){w.PromiseUtil.catchRejection(function(){if(!A._loadController.isReloading())return A._system.logInfo("reattaching media keys"),Promise.resolve(A._system.clearMediaKeys(A._videoElement)).then(function(){return A._system.setMediaKeys(A._videoElement,k)})},function(e){A.onError.emit(a.WrappedError.wrap(e))})}),i.label=11;case 11:return f.buffer.onTextChange.on(this,function(e){A._textSets.set(e.source,e)}),[4,f.buffer.attach(this._mediaSource)];case 12:if(i.sent(),void 0===this._gapSkipMaxSeconds&&void 0!==this._gapSkippingController&&(this._gapSkippingController.skipMaxSeconds=e.session.isLive?h.GapSkippingController.GAP_SKIP_MAX_SECONDS_LIVE:h.GapSkippingController.GAP_SKIP_MAX_SECONDS),null===(n=this._gapSkippingController)||void 0===n||n.onGapSeek.on(this,function(e){A.onWarning.emit(new R.WarningError("Skipping gap in buffered content from current position '".concat(e.currentTime,"' to buffered time '").concat(e.nextBufferedTime,"'"))),w.PromiseUtil.catchRejection(function(){return A._videoElement.setPositionWhenReady(e.nextBufferedTime)},function(e){A.onError.emit(a.WrappedError.wrap(e))})}),null===(o=this._gapSkippingController)||void 0===o||o.start(),null===(s=this._stallSkippingController)||void 0===s||s.onStallSkip.on(this,function(e){var t=e.currentTime+x.PlayerConstants.STALL_SEEK_EPSILON;A.onWarning.emit(new R.WarningError("Attempting stall mitigation: setting current position (which is '".concat(e.currentTime,"') to '").concat(t,"'"))),w.PromiseUtil.catchRejection(function(){return A._system.requiresSafeSeek()?A.setPositionWhenReady(t):A._videoElement.setPositionWhenReady(t)},function(e){A.onError.emit(a.WrappedError.wrap(e))})}),null===(d=this._stallSkippingController)||void 0===d||d.onWarning.on(this,function(e){return A.onWarning.emit(e)}),null===(u=this._stallSkippingController)||void 0===u||u.start(),this._stallTrackingController.onStallErrorTimeExceeded.on(this,function(e){var t;if(A._system.onLine){var r="\nStall reason: ".concat(e.stallReason,"\nBuffered: ").concat(JSON.stringify(null===(t=A.getPlayerState().videoState)||void 0===t?void 0:t.buffered),"\nFirst observed at: ").concat(e.timeFirstObserved,"\nCurrent time: ").concat(e.currentTime);A.onError.emit(new N.VideoStalledError("Stalled for more than ".concat(e.stallThreshold," seconds at ").concat(e.videoCurrentTime,".")+r))}else A._system.logWarn("StallTrackingController's onStallErrorTimeExceeded error was ignored because client is offline."),A._stallTrackingController.restart()}),this._stallTrackingController.onStallMitigationTimeExceeded.on(this,function(e){var t,r="\nStall reason: ".concat(e.stallReason,"\nBuffered: ").concat(JSON.stringify(null===(t=A.getPlayerState().videoState)||void 0===t?void 0:t.buffered),"\nFirst observed at: ").concat(e.timeFirstObserved,"\nCurrent time: ").concat(e.currentTime);e.stallReason===F.StallReason.VIDEO_NOT_PROGRESSING?(A.onWarning.emit(new N.VideoStalledError("Attempting clear buffer mitigation for stall more than ".concat(e.stallThreshold," seconds at ").concat(e.videoCurrentTime,".")+r)),w.PromiseUtil.catchRejection(function(){var e;return null===(e=A._getLoadedBuffer())||void 0===e?void 0:e.clearAsync()},function(e){A._onError(a.WrappedError.wrap(e))})):A.onWarning.emit(new N.VideoStalledError("Unable to attempt clear buffer mitigation for stall more than ".concat(e.stallThreshold," seconds at ").concat(e.videoCurrentTime,".")+r))}),this._stallTrackingController.start(),this._loadController.onError.on(this,function(e){A.onError.emit(new l.PlayerLoadError("Unexpected load controller failure",e))}),this._loadController.onWarning.on(this,function(e){return A.onWarning.emit(e)}),this._regionController.onWarning.on(this,function(e){return A.onWarning.emit(e)}),this._system.requiresSeekOnTrackChangeWorkaround()&&(this._seekOnTrackChangeWorkaround=new _.SeekOnTrackChangeWorkaround(this._system,f.buffer.onBufferItemPhaseChange,{getCurrentTime:function(){var e;return null===(e=A._playerStateTracker.getCurrent().videoState)||void 0===e?void 0:e.currentTime},setPositionWhenReady:function(e){return A._videoElement.setPositionWhenReady(e)}}),this._seekOnTrackChangeWorkaround.onError.on(this,function(e){return A.onError.emit(e)}),this._seekOnTrackChangeWorkaround.start()),!(void 0!==this._seekSnapper))return[3,16];return[4,this._seekSnapper.snapToSegmentBoundary(g)];case 13:if(void 0!==(P=i.sent()))return[3,14];return this.onWarning.emit(new R.WarningError("unable to snap playhead from ".concat(g," to segment boundary (").concat(this._seekSnapping,")"))),[3,16];case 14:if(!(P!==g)||(this._system.logInfo("snapping playhead position from ".concat(g," to ").concat(P," (").concat(this._seekSnapping,")")),!((U=this._videoElement.setPositionWhenReady(P))instanceof Promise)))return[3,16];return[4,U];case 15:i.sent(),i.label=16;case 16:return this.onPeriodLoaded.emit(E),this._regionController.onPeriodChange.on(this,function(e){A._retryController.retryCounts.clear(),A._onPeriodChange(e.oldPeriodRange,e.newPeriodRange,e.position)}),this._regionController.start(E),this._endOfStreamController.start(),this._endOfStreamController.endOfStream.on(this,function(){w.PromiseUtil.catchRejection(function(){var e;return null===(e=A._mediaSource)||void 0===e?void 0:e.endOfStream()},function(e){A.onError.emit(a.WrappedError.wrap(e))})}),this._liveWindowUpdateController.start(),this._liveWindowUpdateController.onLiveWindowUpdate.on(this,function(e){w.PromiseUtil.catchRejection(function(){return A.setPositionWhenReady(e)},function(e){A.onError.emit(a.WrappedError.wrap(e))})}),this._setStateChangeHandlers(),[4,this._startTimers()];case 17:return i.sent(),[2]}})})},e.prototype.detach=function(){return this._loadController.detach()},e.prototype._detach=function(){var e,t,r,n,o,s,a,l,d;return i.__awaiter(this,void 0,void 0,function(){var u,c,h,_;return i.__generator(this,function(i){switch(i.label){case 0:if(u=this._session,this._session=void 0,this._lastVideoSize=void 0,this._stopTimers(),this._onReceiveTimedEvents.clear(),null===(e=this._gapSkippingController)||void 0===e||e.onGapSeek.off(this),null===(t=this._gapSkippingController)||void 0===t||t.stop(),null===(r=this._stallSkippingController)||void 0===r||r.onStallSkip.off(this),null===(n=this._stallSkippingController)||void 0===n||n.onWarning.off(this),null===(o=this._stallSkippingController)||void 0===o||o.stop(),this._stallTrackingController.onStallErrorTimeExceeded.off(this),this._stallTrackingController.onStallMitigationTimeExceeded.off(this),this._stallTrackingController.stop(),this._regionController.onPeriodChange.off(this),this._regionController.onWarning.off(this),this._regionController.stop(),this._loadController.onError.off(this),this._loadController.onWarning.off(this),null===(s=this._seekOnTrackChangeWorkaround)||void 0===s||s.onError.off(this),null===(a=this._seekOnTrackChangeWorkaround)||void 0===a||a.stop(),this._endOfStreamController.endOfStream.off(this),this._endOfStreamController.stop(),this._liveWindowUpdateController.onLiveWindowUpdate.off(this),this._liveWindowUpdateController.stop(),this._videoElement.onEnded.off(this),this._videoElement.onError.off(this),this._videoElement.onWarning.off(this),this._videoElement.onLoadedData.off(this),null==u||u.onError.off(this),null==u||u.onWarning.off(this),this._playerStateTracker.reset(void 0),this._playerStateTracker.onStateChanged.off(this),null==(c=null==u?void 0:u.getLoadedBuffer())||c.onTextChange.off(this),null===(l=null==c?void 0:c.drm)||void 0===l||l.onUpdated.off(this),null==c||c.detach(),h=this._videoElement.clearMediaSource(),_=this._system.clearMediaKeys(this._videoElement),!(h instanceof Promise||_ instanceof Promise))return[3,2];return[4,Promise.all([h,_])];case 1:i.sent(),i.label=2;case 2:return null===(d=this._mediaSource)||void 0===d||d.destroy(),this._mediaSource=void 0,this._seekSnapper=void 0,this._resetPlayerVitals(),[2,u]}})})},e.prototype.reload=function(e){return void 0===e&&(e={sequence:this._seekSeq}),this._loadController.reload(e)},e.prototype._reload=function(e){var t;return i.__awaiter(this,void 0,void 0,function(){var r,n;return i.__generator(this,function(i){switch(i.label){case 0:if(void 0===(r=this._session))throw new I.InvalidOperationError("Call to Player.reload without being attached");return[4,this._detach()];case 1:return i.sent(),n=null===(t=r.getLoadedData())||void 0===t?void 0:t.manifest,[4,r.unload()];case 2:if(i.sent(),!(void 0!==n))return[3,4];return[4,this._attach({session:r,manifest:n,sessionInit:{drm:e.drm,position:e.position,sequence:e.sequence,hydrateBuffer:e.hydrateBuffer,audioGroupOrder:e.audioCodecGroups,videoGroupOrder:e.videoCodecGroups,startAtLivePoint:!1}})];case 3:i.sent(),i.label=4;case 4:return[2]}})})},e.getPlayerVersion=function(){return T.GLUON_VERSION},e.prototype.getVideoElement=function(){return this._videoElement},e.prototype.getSession=function(){return this._session},e.prototype.getPlayerState=function(){return this._playerStateTracker.getCurrent()},e.prototype.getContentRange=function(){var e;return null===(e=this._session)||void 0===e?void 0:e.getContentRange()},e.prototype.setTextEnabled=function(e){var t;void 0===e&&(e=!0),e!==this._textEnabled&&(this._textEnabled=e,null===(t=this._session)||void 0===t||t.setTextEnabled(this._textEnabled),this._textEnabled&&this._textTimer.tickEvery(this._textUpdateSeconds))},e.prototype.setVolumeWhenReady=function(e){return i.__awaiter(this,void 0,void 0,function(){return i.__generator(this,function(t){switch(t.label){case 0:return this._playerStateTracker.setVolume(e),[4,this._videoElement.setVolumeWhenReady(e)];case 1:return t.sent(),[2]}})})},e.prototype.setPositionWhenReady=function(e){return this._system.requiresSafeSeek()?this._loadController.seek({position:e}):this._setPositionWhenReady(e)},e.prototype._setPositionWhenReady=function(e){return i.__awaiter(this,void 0,void 0,function(){var t,r,n,o,s,a,l=this;return i.__generator(this,function(i){switch(i.label){case 0:if(void 0!==this._safeSeeker)return this.onWarning.emit(new R.WarningError("ignoring request to seek to ".concat(e," because another seek is in progress"))),[2];if(++this._seekSeq,this._lastSeekPos=e,t=this._getLoadedBuffer(),void 0!==this._session&&this._session.isLive&&void 0!==t&&void 0!==(r=this.getContentRange())&&(n=this._session.getLiveEdge(),o={start:r.start,end:null!=n?n:r.end},void 0!==(s=this._liveWindowUpdateController.correctLivePosition(e,o))&&(e=s,this._system.logWarn("Attempted to seek out of live window. Corrected position to ".concat(e,".")))),!(void 0!==this._seekSnapper))return[3,2];return[4,this._seekSnapper.snapToSegmentBoundary(e)];case 1:void 0===(a=i.sent())?this.onWarning.emit(new R.WarningError("unable to snap seek from ".concat(e," to segment boundary (").concat(this._seekSnapping,")"))):a!==e&&(this._system.logInfo("snapping seek position from ".concat(e," to ").concat(a," (").concat(this._seekSnapping,")")),e=a),i.label=2;case 2:if(!(void 0!==t&&this._system.requiresSafeSeek()))return[3,7];this._safeSeeker=new P.SafeSeeker(this._system,t,this._videoElement,this._playerStateTracker,function(){return l._onBufferTimerUpdate()}),i.label=3;case 3:return i.trys.push([3,,5,6]),[4,this._safeSeeker.seek(e)];case 4:return i.sent(),[3,6];case 5:return this._safeSeeker=void 0,[7];case 6:return[3,9];case 7:return this._playerStateTracker.setPosition(e),[4,this._videoElement.setPositionWhenReady(e)];case 8:i.sent(),this._runBufferTimerUpdate(),i.label=9;case 9:return[2]}})})},e.prototype.setRateWhenReady=function(e){return i.__awaiter(this,void 0,void 0,function(){return i.__generator(this,function(t){return void 0!==this._safeSeeker?(this.onWarning.emit(new R.WarningError("ignoring request to set playback rate to ".concat(e," because a seek is in progress"))),[2]):(this._playerStateTracker.setRate(e),[2,this._videoElement.setRateWhenReady(e)])})})},e.prototype._applyPlayerOptions=function(e){var t,r,i,n,o,s,a,l,d,u;this.relativeBuffer=null!==(t=e.relativeBuffer)&&void 0!==t?t:this.relativeBuffer,this.relativeAppend=null!==(r=e.relativeAppend)&&void 0!==r?r:this.relativeAppend,this._bufferUpdateSeconds=null!==(i=e.bufferUpdateSeconds)&&void 0!==i?i:this._bufferUpdateSeconds,this._bufferForPlaybackSeconds=null!==(n=e.bufferForPlaybackSeconds)&&void 0!==n?n:this._bufferForPlaybackSeconds,this._textUpdateSeconds=null!==(o=e.textUpdateSeconds)&&void 0!==o?o:this._textUpdateSeconds,this._adjustBufferForPlayback(),this._seekSnapping=null!==(s=e.seekSnapping)&&void 0!==s?s:this._seekSnapping,this._reloadOnSegmentRetryError=null!==(a=e.reloadOnSegmentRetryError)&&void 0!==a?a:this._reloadOnSegmentRetryError,this._gapSkipMaxSeconds=e.gapSkipMaxSeconds,(void 0===e.gapSkipMaxSeconds||e.gapSkipMaxSeconds>0)&&this._createNewGapSkipController(e.gapSkipMaxSeconds,e.gapSkipMinBufferSeconds),this._seekPastEndRestart=null!==(l=e.seekPastEndRestartThreshold)&&void 0!==l?l:this._seekPastEndRestart,this._stallErrorThresholdSeconds=null!==(d=e.stallErrorThresholdSeconds)&&void 0!==d?d:this._stallErrorThresholdSeconds,this._stallMitigationThresholdSeconds=null!==(u=e.stallMitigationThresholdSeconds)&&void 0!==u?u:this._stallMitigationThresholdSeconds},e.prototype._createNewGapSkipController=function(e,t){var r=this;void 0===e&&(e=h.GapSkippingController.GAP_SKIP_MAX_SECONDS),void 0===t&&(t=h.GapSkippingController.GAP_SKIP_MIN_BUFFER_SECONDS),void 0!==this._gapSkippingController&&(this._gapSkippingController=void 0),this._gapSkippingController=new h.GapSkippingController({getCurrentPeriodRange:function(){return r._regionController.getCurrentPeriodRange()},stateChange:this.onStateChanged}),this._gapSkippingController.skipMaxSeconds=e,this._gapSkippingController.skipMinBufferSeconds=t},e.prototype._adjustBufferForPlayback=function(){this._bufferForPlaybackSeconds>this.relativeAppend.end-2&&(this._bufferForPlaybackSeconds=Math.max(0,this.relativeAppend.end-2),this._system.logWarn("clamping bufferForPlaybackSeconds to ".concat(this._bufferForPlaybackSeconds)))},e.prototype._attemptPeriodTransition=function(){var e;if(!this._loadController.isReloading()){var t=this._playerStateTracker.getCurrent();this._system.logVerbose("Attempting period transition at ".concat(null===(e=t.videoState)||void 0===e?void 0:e.currentTime)),this._regionController.tryUpdatePeriod(t)}},e.prototype._setStateChangeHandlers=function(){var e=this;this._videoElement.onEnded.off(this),this._videoElement.onEnded.on(this,function(t){e._playerStateTracker.setVideoState(t),e._system.logVerbose("Ended event fired at ".concat(t.currentTime,".")),e._attemptPeriodTransition()})},e.prototype._resetPlayerVitals=function(){var e;null===(e=this._playerVitals)||void 0===e||e.reset()},e.prototype._onError=function(e){var t,r,i,n,o=this;if(a.WrappedError.causedBy(e,d.OutputRestrictedError.NAME)||a.WrappedError.causedBy(e,M.CopyProtectionError.NAME)){var s=this._reloadForOutputRestrictedError(e);if(void 0!==s){this.onWarning.emit(new R.WarningError("Reloading due to output being restricted",e)),w.PromiseUtil.catchRejection(function(){return o._loadController.reload(s)},function(e){o.onError.emit(a.WrappedError.wrap(e))});return}}if(a.WrappedError.causedBy(e,u.FormatChangedError.NAME)||a.WrappedError.causedBy(e,c.SegmentRetryFailedError.NAME)&&this._reloadOnSegmentRetryError){this.onWarning.emit(new R.WarningError("Expected player reload caused by error: ".concat(e.toString()))),w.PromiseUtil.catchRejection(function(){return o._loadController.reload({useExistingDrm:o._shouldUseExistingDrmOnReload(),sequence:o._seekSeq})},function(e){o.onError.emit(a.WrappedError.wrap(e))});return}if(this._retryController.canRetry(e)){var l=this._retryController.getRetryRestrictions(e);this.onWarning.emit(new R.WarningError("Retrying for retry controller with restrictions audio=".concat((null!==(t=null==l?void 0:l.audio)&&void 0!==t?t:[]).toString()," video=").concat((null!==(r=null==l?void 0:l.video)&&void 0!==r?r:[]).toString()),e)),null===(i=this._session)||void 0===i||i.onError.off(this),null===(n=this._session)||void 0===n||n.onError.on(this,function(e){o.onWarning.emit(new R.WarningError("ignoring session error while reloading "+String(e),e))}),this._retryController.markRetry(e),w.PromiseUtil.catchRejection(function(){var e;return o._loadController.reload({position:null===(e=o.getPlayerState().videoState)||void 0===e?void 0:e.currentTime,sequence:o._seekSeq,useExistingDrm:!1,audioCodecGroups:null==l?void 0:l.audio,videoCodecGroups:null==l?void 0:l.video})},function(e){o.onError.emit(a.WrappedError.wrap(e))});return}var h=a.WrappedError.findFirst(e,O.VideoElementError);if(void 0!==h){var _=this.getPlayerState(),p={bufferForPlaybackSeconds:this._bufferForPlaybackSeconds,variantData:_.variant,videoState:_.videoState};h.updateData(p)}this.onError.emit(new B.PlayerError("Playback error occurred and unable to fallback or retry.\n".concat(this._getRetryControllerInfo()),e))},e.prototype._getRetryControllerInfo=function(){var e=Array("Retry controller error data at t=".concat(Date.now(),"."));return this._retryController.retryCounts.forEach(function(t,r){e.push("".concat(t,": ").concat(r.attemptedRetries," retries (").concat(r.retryCount," remaining) most recent retry at t=").concat(r.lastTimestamp,"."))}),e.join("\n")},e.prototype._reloadForOutputRestrictedError=function(e){var t,r,i,n,o,s,l,u=a.WrappedError.causedBy(e,d.OutputRestrictedError.NAME)?d.OutputRestrictedError.NAME:a.WrappedError.causedBy(e,M.CopyProtectionError.NAME)?M.CopyProtectionError.NAME:void 0;if(void 0!==u){var c=null===(t=this._session)||void 0===t?void 0:t.getAppendPeriod(),h=null===(i=null===(r=this._getLoadedBuffer())||void 0===r?void 0:r.drm)||void 0===i?void 0:i.getChosenMediaKeyOptions();if(void 0===c||void 0===h||void 0===this._system.keyTypeResolver)return u===M.CopyProtectionError.NAME?void 0:{useExistingDrm:this._shouldUseExistingDrmOnReload(),sequence:this._seekSeq};var _=this._playerUtil.groupKeyTypesByCodec(c.video,this._system.keyTypeResolver);if(null!==(o=null===(n=_.tryGet(h.video))||void 0===n?void 0:n.has("video-sd"))&&void 0!==o&&o)return u===M.CopyProtectionError.NAME?void 0:{useExistingDrm:this._shouldUseExistingDrmOnReload(),sequence:this._seekSeq};for(var p=[],f=0,v=["hevc","avc"];f<v.length;f++){var g=v[f];null!==(l=null===(s=_.tryGet(g))||void 0===s?void 0:s.has("video-sd"))&&void 0!==l&&l&&p.push(g)}if(p.length>0)return{useExistingDrm:!1,sequence:this._seekSeq,videoCodecGroups:p}}},e.prototype._onPeriodChange=function(e,t,r){var i=this;if(void 0===this._session){this.onWarning.emit(new R.WarningError("Got period change information without session"));return}if(void 0===e)this._system.logInfo("Adding initial period restriction with range=(".concat(t.start,"-").concat(t.end,")"));else{var n="from old range=(".concat(e.start,"-").concat(e.end,") to new range=(").concat(t.start,"-").concat(t.end,")");this._system.logInfo("Reloading due to changed period at t='".concat(r,"', ").concat(n)),w.PromiseUtil.catchRejection(function(){return i._loadController.reload({position:r,sequence:i._seekSeq,useExistingDrm:i._shouldUseExistingDrmOnReload(),reuseDownloadedSegments:!0})},function(e){i.onError.emit(a.WrappedError.wrap(e))})}},e.prototype._shouldUseExistingDrmOnReload=function(){return"single_period_new_drm"!==this._system.requiredMultiPeriodWorkaround()},e.prototype._getPeriodDebugInfo=function(e){var t=this;return e.map(function(e){var r=t._playerUtil.getRangeOfPeriod(e);return"".concat(e.id,": ").concat(null==r?void 0:r.start,"-").concat(null==r?void 0:r.end)}).join(", ")},e.prototype._startTimers=function(){var e;return i.__awaiter(this,void 0,void 0,function(){var t=this;return i.__generator(this,function(r){switch(r.label){case 0:if(this._stopTimers(),(null===(e=this._session)||void 0===e?void 0:e.capVariantsToSize)!==!0)return[3,2];return this._sizeTimer.stop(),this._sizeTimer.onError.on(this,function(e){return t.onError.emit(e)}),[4,this._sizeTimer.tickNow()];case 1:r.sent(),this._sizeTimer.tickEvery(x.PlayerConstants.SIZE_UPDATE_SECONDS),r.label=2;case 2:return this._playerTimer.stop(),this._playerTimer.onError.on(this,function(e){return t.onError.emit(e)}),[4,this._playerTimer.tickNow()];case 3:return r.sent(),this._playerTimer.tickEvery(x.PlayerConstants.PLAYER_UPDATE_SECONDS),this._onReceiveTimedEventTimer.stop(),this._onReceiveTimedEventTimer.onError.on(this,function(e){return t.onError.emit(e)}),[4,this._onReceiveTimedEventTimer.tickNow()];case 4:return r.sent(),this._onReceiveTimedEventTimer.tickEvery(x.PlayerConstants.PLAYER_TIMEDEVENTS_DISPATCH_SECONDS),this._bufferTimer=new n.Timer(this._system,function(){return t._onBufferTimerUpdate()}),this._bufferTimer.onError.on(this,function(e){return t.onError.emit(e)}),[4,this._bufferTimer.tickNow()];case 5:return r.sent(),[2]}})})},e.prototype._stopTimers=function(){var e,t;this._sizeTimer.onError.off(this),this._sizeTimer.stop(),this._onReceiveTimedEventTimer.onError.off(this),this._onReceiveTimedEventTimer.stop(),this._playerTimer.onError.off(this),this._playerTimer.stop(),null===(e=this._bufferTimer)||void 0===e||e.onError.off(this),null===(t=this._bufferTimer)||void 0===t||t.stop(),this._bufferTimer=void 0},e.prototype._getLoadedPeriods=function(){var e,t,r;return null===(r=null===(t=null===(e=this._session)||void 0===e?void 0:e.getLoadedData())||void 0===t?void 0:t.manifest.getManifest())||void 0===r?void 0:r.periods},e.prototype._getLoadedBuffer=function(){var e;return null===(e=this._session)||void 0===e?void 0:e.getLoadedBuffer()},e.prototype._isLiveSession=function(){return void 0!==this._session&&this._session.isLive},e.prototype._onPlayerSizeUpdate=function(){return i.__awaiter(this,void 0,void 0,function(){var e;return i.__generator(this,function(t){switch(t.label){case 0:if(!((e=this._videoElement.getSize())instanceof Promise))return[3,2];return[4,e];case 1:e=t.sent(),t.label=2;case 2:if(void 0===this._session)return[2];return(void 0===this._lastVideoSize||e.width!==this._lastVideoSize.width||e.height!==this._lastVideoSize.height)&&(this._lastVideoSize=e,this._session.setVideoSize(e)),[2]}})})},e.prototype._updateVideoBufferForPlaybackSeconds=function(e){var t,r=null===(t=this._regionController.getCurrentPeriodRange())||void 0===t?void 0:t.end,i=this._bufferForPlaybackSeconds;return void 0!==r&&(i=Math.min(Math.floor(r-e),i)),this._videoElement.setBufferForPlaybackSeconds(i)},e.prototype._onTimedEventUpdate=function(){var e,t=null===(e=this._session)||void 0===e?void 0:e.getAppendPeriod();if(void 0!==t)for(var r=0,i=t.events;r<i.length;r++){var n=i[r];this._onReceiveTimedEvents.has(n.id)||(this._onReceiveTimedEvents.add(n.id),this.onReceiveTimedEvent.emit(n))}},e.prototype._onPlayerTimerUpdate=function(){var e;return i.__awaiter(this,void 0,void 0,function(){var t,r,n,o,s;return i.__generator(this,function(i){switch(i.label){case 0:if(!((t=this._videoElement.getState())instanceof Promise))return[3,2];return[4,t];case 1:t=i.sent(),i.label=2;case 2:if(this._playerStateTracker.setVideoState(t),!((r=this._updateVideoBufferForPlaybackSeconds(t.currentTime))instanceof Promise))return[3,4];return[4,r];case 3:i.sent(),i.label=4;case 4:return(null===(e=this._session)||void 0===e?void 0:e.cmcd)!==void 0&&(n=this._session.getLoadedData(),this._session.cmcd.setIsLive(void 0!==n?void 0!==n.manifest.getManifest().dynamicInfo:void 0)),o=this.getPlayerState(),void 0!==(s=this._regionController.getCurrentPeriodRange())&&this._timeRangeUtil.contains([s],t.currentTime)||this._regionController.tryUpdatePeriod(o),[2]}})})},e.prototype._runBufferTimerUpdate=function(){var e=this;w.PromiseUtil.catchRejection(function(){return e._onBufferTimerUpdate()},function(t){e.onError.emit(a.WrappedError.wrap(t))})},e.prototype._onBufferTimerUpdate=function(){var e,t;return i.__awaiter(this,void 0,void 0,function(){var r;return i.__generator(this,function(i){switch(i.label){case 0:null===(e=this._bufferTimer)||void 0===e||e.stop(),i.label=1;case 1:if(i.trys.push([1,,4,5]),!(void 0!==(r=this.getPlayerState()).videoState&&void 0!==this._session))return[3,3];return this._session.emitCurrentBandwidthEstimate(),[4,this._regionController.applyBufferRegions(this._session,r.videoState.currentTime,this.relativeBuffer,this.relativeAppend)];case 2:i.sent(),i.label=3;case 3:return[3,5];case 4:return null===(t=this._bufferTimer)||void 0===t||t.tickAfter(this._bufferUpdateSeconds),[7];case 5:return[2]}})})},e.prototype._onTextCueUpdate=function(){return i.__awaiter(this,void 0,void 0,function(){var e,t,r,n=this;return i.__generator(this,function(i){switch(i.label){case 0:if(!this._textEnabled)return this._currentText=[],this._emitTextCueChange(this._currentText),this._textTimer.stop(),[2];if(!((e=this._videoElement.getState())instanceof Promise))return[3,2];return[4,e];case 1:e=i.sent(),i.label=2;case 2:return t=[],void 0!==(r=this._textSets.tryGet(this._getTextSource()))&&t.push.apply(t,r.text.find(e.currentTime)),(t.length!==this._currentText.length||t.some(function(e,r){return!n._vttUtil.isCueEqual(t[r],n._currentText[r])}))&&(this._currentText=t,this._emitTextCueChange(this._currentText)),[2]}})})},e.prototype._emitTextCueChange=function(e){this.onTextCueChange.emit(this._getTextCueChangePayload(e)),this.onTextCueGroupChange.emit({groups:e})},e.prototype._getTextCueChangePayload=function(e){for(var t=[],r=0;r<e.length;r++){var n=e[r];if(void 0!==n.individualCues)for(var o=0,s=n.individualCues;o<s.length;o++){var a=s[o];t.push(i.__assign(i.__assign({},a),{start:n.start,end:n.end}))}else for(var l=0,d=n.text;l<d.length;l++){var u=d[l];t.push({start:n.start,end:n.end,text:u,position:n.position})}}return t},e.prototype._getTextSource=function(){var e,t,r,i,n,o=null===(e=this._playerStateTracker.getCurrent().variant)||void 0===e?void 0:e.video;if(void 0===o)return"VTT";for(var s=null!==(t=o.embeddedCaptions)&&void 0!==t?t:[],a=s.map(function(e){return e.language}),l=0,d=null!==(i=null===(r=this._session)||void 0===r?void 0:r.getTrackPreferences())&&void 0!==i?i:[];l<d.length;l++){var u=d[l];if("text"===u.streamType){if(((null!==(n=u.attributes)&&void 0!==n?n:0)&16)==0)return"VTT";for(var c=0;c<s.length;c++){var h=s[c];if(void 0!==u.language&&this._languageUtil.fuzzyLanguageMatch(u.language,h.language,a))return h.service}this.onWarning.emit(new R.WarningError("Unable to find embedded caption service for selected language: ".concat(u.language))),this.setTextEnabled(!1)}}return s.length>0?s[0].service:"VTT"},e}();t.J=q}}]);
//# sourceMappingURL=lib-1959da22-831bfa955f5674c0.js.map