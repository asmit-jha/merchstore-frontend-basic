/*! permutive-javascript-sdk v20.4.1 (web) (built 2024-06-27T06:12:33.334Z) */(()=>{"use strict";var __webpack_modules__={2688:(e,t,n)=>{function r(e){return e instanceof Error?e:new Error("string"==typeof e?e:JSON.stringify(e))}n.d(t,{w:()=>r})},787:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(3735),i=n(2884);function o(e){return(0,r.zG)((0,i.Y3)((()=>JSON.parse(e))),(0,i.fS)(r.gn))}},3992:(e,t,n)=>{n.d(t,{GL:()=>a,HJ:()=>u,N1:()=>l,NC:()=>r,RP:()=>i,SF:()=>f,UM:()=>c,ho:()=>p,iE:()=>d});const r=performance.now(),i=(new Date).getTime();let o=[],s=!1;const a=e=>function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return u((()=>e(...n)))},u=(e,t)=>{if(!s){const n=self.setTimeout(e,t);return()=>self.clearTimeout(n)}let n;const r=()=>{void 0!==n&&s&&o.length<1e4&&o.push([n,performance.now()]),n=void 0},i=[self.setTimeout((()=>{n=performance.now(),self.requestAnimationFrame(r),e()}),t),self.setTimeout(r,t)];return()=>{void 0===n&&i.forEach((e=>self.clearTimeout(e)))}},c=(e,t)=>{if(!s){const n=self.setInterval(e,t);return()=>self.clearInterval(n)}let n=!1,r=()=>{};const i=self.setInterval((()=>{r=u((()=>{n||e()}))}),t);return()=>{n=!0,r(),self.clearInterval(i)}},l=e=>()=>{return t=e(),new Promise(((e,n)=>t.then(a(e),a(n))));var t},f=e=>{const t=l(e);return()=>new Promise((e=>u((()=>e(t())))))},d=()=>{const e=o;return o=[],e},p=e=>{s=e}},2851:(e,t,n)=>{n.d(t,{ap:()=>b,a9:()=>v,Ue:()=>_,gS:()=>m,D8:()=>D,VS:()=>w,xH:()=>E,En:()=>g,p4:()=>P,UI:()=>y,Rp:()=>I,vP:()=>k,bw:()=>U,YP:()=>h});var r=n(2688),i=n(365),o=n(3735),s=n(2884),a=n(3328),u=n(2652);function c(e){let t=e,n=[],r=!1;return{addListener(e){if(r)return()=>{};let i=t;const o=()=>{Object.is(t,i)||(i=t,e(t))};n=[...n,o];return()=>{n=n.filter((e=>e!==o))}},notify(e){if(r)throw new Error("Ref bug: Attempted to notify a terminated notifier");Object.is(e,t)||(t=e,n.forEach((e=>e())))},terminate(){r=!0,n=[]}}}function l(e,t){let n=0;return function(){try{if(n++>0)throw new Error(e);return t(...arguments)}finally{n--}}}function f(e,t){let n=[...new Set(e)].filter((e=>"final"!==e.state));if(0===n.length)return{state:"final",onStateChange:()=>()=>{}};const r=()=>0===n.length?"final":n.some((e=>"might_change"===e.state))?"might_change":"nominal",[i,o]=d(r(),(e=>"might_change"!==e&&t())),s=()=>o(r());return n.forEach((t=>{t.onStateChange((t=>{switch(t){case"final":n=e.filter((e=>"final"!==e.state)),s();break;case"might_change":o("might_change");break;case"nominal":s();break;default:throw new Error(`Ref bug: Invalid state ${t}`)}}))})),i}function d(e,t){if("final"===e)return[{state:"final",onStateChange:()=>()=>{}},()=>{}];const{terminate:n,notify:r,addListener:i}=c(e),o={state:e,onStateChange:i},s=l("Disallowed recursion in Branch.",(e=>{if("final"===o.state){if("final"===e)return;throw new Error(`Attempted to change state of final branch to ${e}.`)}try{null==t||t(e),o.state=e,r(e)}finally{"final"===e&&n()}}));return[o,s]}var p=n(6392);function _(e){const[t,n,r]=function(){const[e,t]=d("nominal"),n=l("Disallowed recursion in Branch.",(n=>{if("final"===e.state)throw new Error("Attempted to mutate a finalized Ref.");const r=e.state;try{t("might_change"),n()}finally{t(r)}}));return[e,n,()=>t("final")]}(),[i,o]=G(t,e);return[i,e=>n((()=>o(e))),r]}function m(e){let t=e.empty;const n=()=>()=>{const n=t;return t=e.empty,n},[r,i,o]=_(n());return[r,r=>{t=e.concat(t,r),i(n())},o]}function g(e,t){return n=>{let r=new Array(e).fill(t.empty);return new Array(e).fill(null).map(((e,i)=>(0,o.zG)(n,y(p.UI((e=>{const n=t.concat(r[i],e);return r=r.map(((n,r)=>r===i?t.empty:t.concat(n,e))),n}))))))}}function v(e){return{get current(){return e},onChange:()=>()=>{},branch:{state:"final",onStateChange:()=>()=>{}}}}function h(e){return t=>{const n=t.onChange(e);return e(t.current),n}}function y(e,t){if(t){const[n,r]=G(t.branch,e(t.current));return t.onChange((t=>r(e(t)))),n}return t=>y(e,t)}const b=e=>w((t=>y(t)(e)));function w(e,t){return t?E(y(e,t)):t=>E(y(e,t))}function E(e){if("final"===e.branch.state)return e.current;const[t,n]=function(e,t){let n=t;const r=[e.state,n.state].includes("might_change")?"might_change":"nominal",[i,o]=d(r),s=e=>t=>{switch(t){case"final":o(e().state);break;case"might_change":o("might_change");break;case"nominal":"might_change"===e().state?o("might_change"):o("nominal");break;default:throw new Error(`Ref bug: Unexpected upstream state ${t}`)}};e.onStateChange(s((()=>n)));const a=s((()=>e));let u=n.onStateChange(a);return[i,e=>{n=e,u(),u=e.onStateChange(a),a(n.state)}]}(e.branch,e.current.branch),[r,i]=G(t,e.current.current);let o=e.current.onChange(i);return e.onChange((e=>{o(),o=e.onChange(i),n(e.branch),i(e.current)})),r}function I(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return e=>{if(2===t.length){let n=t[0];return y((e=>(n=t[1](n,e),n)),e)}let n=s.bM();return y((e=>{const r=t[0](n,e);return n=s.G(r),r}),e)}}function k(){if(0===arguments.length||z(arguments.length<=0?void 0:arguments[0]))return S(...arguments);const e=arguments.length<=0?void 0:arguments[0],t=Object.keys(e);return(0,o.zG)(Object.values(e),(e=>S(...e)),y((0,o.ls)(a.Su(((e,n)=>[t[e],n])),Object.fromEntries)))}function S(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(0===t.length)return v([]);if(1===t.length)return y((e=>[e]))(t[0]);let r=!1;t.forEach((e=>e.onChange((()=>{if("might_change"!==e.branch.state)throw new Error("Ref bug: Received a change notification without a `might_change` state.");r=!0}))));const i=t.map((0,u.vg)("branch")),o=()=>{r&&(r=!1,c(t.map((e=>e.current))))},s=f(i,o),[a,c]=G(s,t.map((e=>e.current)));return a}function P(e){const[t,n,a]=_(s.YP);return e.then(i.F2).catch((0,o.ls)(r.w,i.t$)).then((0,o.ls)(s.G,n,a)),t}function D(e){const t=e.hasOwnProperty("equals")?e.equals:e;return function(e){return t=>{if("final"===t.branch.state)return t;let n=s.YP;return y((t=>{if(s.Wi(n))return n=s.G(t),t;const r=e(n.value,t);return n=s.G(r),r}),t)}}(((e,n)=>t(e,n)?e:n))}function U(e){return t=>(h(e)(t),t)}function G(e,t){if("final"===e.state)return[v(t),()=>{}];const n=c(t);e.onStateChange((e=>{"final"===e&&n.terminate()}));let r=t;return[{get current(){return r},onChange:n.addListener,branch:e},l("Disallowed recursion in Ref.",(e=>{r=e,n.notify(r)}))]}function z(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)&&"function"==typeof e.onChange}},2116:(e,t,n)=>{n.d(t,{K4:()=>u,KD:()=>m,UI:()=>f,ak:()=>_,bw:()=>d,dQ:()=>c,of:()=>l,vP:()=>p});var r=n(2851),i=n(3735),o=n(2652),s=n(4923),a=n(2884);const u=e=>(0,i.ls)((t=>{let{previousState:n,...r}=t;return e(r)}),(e=>({value:e,state:r.a9(void 0)}))),c=i.yR,l=(0,i.ls)(i.a9,u),f=e=>t=>(0,i.ls)(t,(0,o.rO)({value:e})),d=e=>t=>(0,i.ls)(t,(0,o.rO)({value:(0,o.bw)(e)}));function p(e){return t=>{let{previousState:n,...o}=t;const a=h(n)?n:{},u=(0,i.zG)(e,s.Su(((e,t)=>t({previousState:a[e],...o}))));return{value:(0,i.zG)(u,s.UI((e=>e.value))),state:(0,i.zG)(u,s.UI((e=>e.state)),(e=>r.vP(e)))}}}function _(e,t){return n=>(0,i.ls)((0,o.rO)({previousState:v}),(o=>{const s=n(o),a=t(s.value)({...o,previousState:o.previousState[e]});return{value:(0,i.zG)([s.value,a.value],(t=>{let[n,r]=t;if(!h(n))throw new Error("Service.bind() was passed an upstream Service with a non-record value.");return{...n,[e]:r}})),state:(0,i.zG)(r.vP(s.state,a.state),r.UI((t=>{let[n,r]=t;if(void 0===n)return{[e]:r};if(!h(n))throw new Error("Service.bind() was passed an upstream Service with a non-record state.");return{...n,[e]:r}})))}}))}const m=e=>{const t=e.slice(0,-1),n=e.slice(-1)[0],s=[...t.map((e=>{let[t,n]=e;return[t,(0,i.a9)(n)]})),(0,i.a9)(n)];return a=(0,o.lo)(s),(0,i.ls)(r.UI(a),g);var a};function g(e){const t=(0,i.zG)(e,r.Rp(0,(e=>e+1)));return n=>{let{previousState:o,stopped:s,...u}=n;return(0,i.zG)(r.vP(e,t),r.Rp(((e,n)=>{let[c,l]=n;return(0,i.zG)(e,a.UI((e=>e.state.current)),a.fS((()=>o)),(e=>c({previousState:e,stopped:(0,i.zG)(r.vP(s,t),r.UI((e=>{let[t,n]=e;return t||n!==l}))),...u})))})),(e=>({value:r.UI((e=>e.value),e),state:r.VS((e=>e.state),e)})))}}function v(e){return h(e)?e:{}}function h(e){return"object"==typeof e&&null!==e}},6967:(e,t,n)=>{n(2497)},8612:(e,t,n)=>{n.d(t,{lg:()=>_,Bt:()=>g});var r=n(5851),i=n(3735),o=n(2884),s=n(2751),a=n(2652);class u{userId;network;api;logger;constructor(e,t,n,r){this.userId=e,this.network=t,this.api=n,this.logger=r}tag="appnexus";ttlInSeconds=86400;usedForThirdPartyData=!0;url="https://ib.adnxs.com/getuidj";invalidAliases=["","0","-1"];getId(){return this.logger.debug("identities[appnexus]: start HTTP request"),(0,a.G6)(navigator.userAgent)?Promise.resolve({type:"skipped"}):this.api.appnexus(this.url).then((e=>(this.logger.debug("identities[appnexus]: end HTTP request"),{type:"attempted",result:(0,i.zG)((0,o.DT)((e=>this.isValidAlias(e.uid)))(e),(0,o.UI)((e=>e.uid)))})),(e=>({type:"attempted",result:o.YP})))}reset(){return Promise.resolve()}isValidAlias(e){return!!e&&-1===this.invalidAliases.indexOf(e)}}var c=n(2851),l=n(4923),f=n(2197),d=n(365);const p=f.ff((e=>void 0===e));class _{metrics;trace;permutiveData;identityProviderEnv;logger;ref;setReady;thirdParty;rawRef;identityMapRef;setIdentityMap;providers={};static emailSHA256Regex=/^[a-f0-9]{64}$/;constructor(e,t,n,r,u){this.metrics=e,this.trace=t,this.permutiveData=n,this.identityProviderEnv=r,this.logger=u;const f=this.getCachedIdentitiesAndMigrateIfRequired(),[d,_]=c.Ue(f);this.identityMapRef=d,this.setIdentityMap=_,d.onChange((0,i.ls)(l.z7((e=>!m.has(e))),(0,a.bw)((e=>{this.logger.debug("[identities] Persisting",e),this.permutiveData.setData("identities",e)})))),this.rawRef=(0,i.zG)(d,c.UI((0,i.ls)(l.UI((e=>e.value)),l.hX(p))),c.D8(l.Eh(s.Eq)));const[g,v]=c.Ue(!1);this.ref=(0,i.zG)(c.vP(g,this.rawRef),c.UI((e=>{let[t,n]=e;return(0,i.zG)(n,(0,o.DT)((()=>t)))}))),this.setReady=()=>{e.trackTimeSinceInit("sdk_lifecycle_timestamps",{timestamp_name:"identity_ready",time_origin:"sdk_init"}),v(!0)},this.thirdParty=this.prepareThirdPartyIdentities()}get identities(){return this.identityMapRef.current}prepareThirdPartyIdentities(){this.logger.debug("[Identities]","loading 3rd party identities");const e=this.metrics.startTimer("sdk_get_third_party_identities_task_duration_seconds",{}),t=this.trace.startSpan("load_tpd_ids"),n=[{load:e=>(e.config,e.network,e.api,e.userId,e.logger,o.YP)},{load:e=>{return t=e.userId,n=e.network,r=e.api,i=e.logger,(0,o.G)(new u(t,n,r,i));var t,n,r,i}},{load:e=>(e.cookies,e.messages,o.YP)},{load:e=>(e.cookies,o.YP)},{load:e=>(e.metrics,e.permutiveData,e.permutive,e.messages,o.YP)}],s=(0,r.oA)(n.map((e=>e.load(this.identityProviderEnv)))).map((e=>this.shouldAskForNewIdentity(e)?this.retrieveIdentity(e):Promise.resolve((0,i.bc)(e,this.getCachedTPDIdentity(e.tag)))));return Promise.all(s).then((e=>e.map((e=>{let[t,n]=e;return this.providers[t.tag]=t,this.mapTPDIdentityIfPresent(t.tag,n,t.ttlInSeconds)})))).then((e=>this.setIdentities(e))).then((0,a.bw)((()=>{this.metrics.stopTimer("sdk_get_third_party_identities_task_duration_seconds",e),t.finish()})))}getPrioritizedIdentities(e){const t={default:0,appnexus:1},n=Object.entries(e).map((e=>{let[t,{id:n,expiry:r,priority:i}]=e;return{tag:t,...n?{id:n}:{},...r?{expiry:r}:{},...void 0!==i?{priority:i}:{}}})),i=n.filter((e=>((e,t)=>!!e.id&&!(0,r.t9)(s.Eq)(e.tag,t))(e,Object.values(this.providers).map((e=>e.tag))))),a=n.filter((e=>((e,t)=>!!e.id&&!!(0,r.t9)(s.Eq)(e.tag,t))(e,Object.values(this.providers).map((e=>e.tag))))),u=(0,r.DZ)((e=>(0,o.ij)(e.priority)))(i),c=u.length>0?Math.max(...u):0,l=i.map((e=>void 0!==e.priority?{...e,priority:e.priority}:{...e,priority:c+1})),f=a.map((e=>void 0===t[e.tag]?{tag:e.tag,id:e.id,priority:c+v}:{tag:e.tag,id:e.id,priority:c+h}));return l.concat(f)}getIdentitiesMap(){return this.getFilteredIdentities(((e,t)=>!!t.value))}parseCustomerDefinedIdentities(e){const t=`Identify must be passed a non-empty string or list of { tag, id, priority? } tuples, value passed was '${JSON.stringify(e)}'`,n=e=>"string"==typeof e.id&&"string"==typeof e.tag,o=e=>"email_sha256"!==e.tag||_.emailSHA256Regex.test(e.id);return"string"==typeof e?(a=e).length>0?{left:[],right:[{id:a,tag:"default"}]}:{left:[t],right:[]}:Array.isArray(e)?(s=e,(0,i.zG)(s,r.tV((0,i.ls)(d.DT(n,(()=>t)),d.Y$(o,(()=>"Identify called with unsupported format of email_sha256 ID. The support format is hex-encoded 64 character long lowercase string.")))))):{left:[t],right:[]};var s,a}extractIdentifyFromQueue(e){let{global:t}=e;const n=()=>t.q.findIndex((e=>"identify"===e.functionName)),r=(e,i)=>{if(e<0)return i;const o=t.q.splice(e,1)[0],s=this.parseCustomerDefinedIdentities(o.arguments[0]);return r(n(),{left:i.left.concat(s.left),right:i.right.concat(s.right)})},{left:i,right:o}=r(n(),{left:[],right:[]});return i.forEach((e=>this.logger.warn("Invalid identity provided during init",e))),o}setIdentities(e){const t=e.reduce(((e,t)=>{let{tag:n,id:r,expiry:i,priority:o}=t;return void 0===this.identities[n]&&this.logger.debug(`identities[${n}]: added`),e[n]={...r?{value:r}:{},...i?{expiry:i}:{},...void 0!==o?{priority:o}:{}},e}),{}),n=this.rawRef.current;this.setIdentityMap({...this.identities,...t});const r=this.rawRef.current;return{identifyRequestRequired:()=>!l.xb(r)&&!l.Eh(s.Eq).equals(n,r)}}async reset(){this.setIdentityMap({}),await Promise.all(Object.values(this.providers).map((e=>e.reset())))}getFilteredIdentities(e){return(0,a.m8)(...Object.entries(this.identities).filter((t=>{let[n,r]=t;return e(n,r)})).map((e=>{let[t,{value:n,expiry:r,priority:o}]=e;return(0,i.bc)(t,{id:n,...r?{expiry:r}:{},...void 0!==o?{priority:o}:{}})})))}shouldAskForNewIdentity(e){var t;const n=(0,o.ij)(null===(t=this.identities)||void 0===t?void 0:t[e.tag]);return(0,o.g_)((()=>!0),this.isIdentityExpired)(n)}getCachedTPDIdentity(e){return this.identities[e]?(0,o.ij)(this.identities[e].value):o.YP}mapTPDIdentityIfPresent(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:86400;const r=()=>Date.now()+Math.floor(1e3*n);return(0,o.g_)((()=>({tag:e,expiry:r()})),(t=>({tag:e,id:t,expiry:r()})))(t)}retrieveIdentity(e){return e.getId().then((t=>"skipped"===t.type?(0,i.bc)(e,o.YP):(0,i.zG)(t.result,(t=>this.metrics.track({name:(0,o.pC)(t)?"sdk_third_party_identity_present_count":"sdk_third_party_identity_missing_count",value:1,labels:{identity_tag:e.tag}})),(n=>(0,i.bc)(e,t.result)))))}isIdentityExpired(e){return"number"==typeof e.expiry&&Date.now()>=e.expiry}getCachedIdentitiesAndMigrateIfRequired(){return(e=>(0,a.m8)(...Object.entries(e).filter((e=>{let[t,n]=e;return!this.isIdentityExpired(n)&&!m.has(t)}))))(this.permutiveData.getData("identities")||{})}}const m=new Set(["public","email","email_md5","email_sha256","ip_address"]),g=(e,t,n,i,o)=>{const a=(e,t)=>{const n=["(null)"];return n.indexOf(e)>-1||!!b[e]||(0,r.jV)(s.Eq)(t,n).length>0},u=e=>"721d6d85-35f0-4e35-bb38-13eb0d465158"===e,c={"be668577-07f5-444d-98e0-222b990951b1":a,"e43c8a90-d17b-4790-bfda-81b069b3b8c2":(e,t,n)=>["thestudentroom.co.uk"].some((e=>n.indexOf(e)>-1))&&(0,r.jV)(s.Eq)(t,["tsr-"]).length>0,"5d79bce7-5d2b-427e-a6c4-b89b6c7bf048":a,"366ab8da-5efa-4355-ab00-84db3b68ded2":e=>"96539955-4d7e-40df-882b-7e2fbacedb1c"===e||"345600e7-fb5f-48b1-9aa6-cde5396419b0"===e,"f3a06674-ebb9-4b9d-ba8f-0052018c0687":u,"38dadd0d-257a-4641-b332-b8b0fd20a6cb":u,"10453011-272d-49cd-9043-1964fdb36fd8":e=>"936ba6ac-9a8b-454d-ba98-facebd7553fe"===e},l={"fe68d1f7-c9f4-45b3-8905-7cda73d3fd74":e=>!!y[e]},f=c[e]||l[t];return!!f&&f(o,n,i)},v=2,h=3,y={},b={}},7658:(e,t,n)=>{n.d(t,{z:()=>r});class r{ingestIfEligible(e){return Promise.resolve()}}},922:(e,t,n)=>{n.d(t,{CL:()=>u,EW:()=>c,PH:()=>a,Uy:()=>o,eV:()=>i,jH:()=>l,t2:()=>s});var r=n(9853);const i=(0,r.MU)("track_form_submission",!0),o=(0,r.MU)("track_pageview_complete",!0),s=(0,r.MU)("track_pageview_engagement",!0),a=((0,r.$S)("sync_segments_cookie",!1),(0,r.$S)("track_slot_clicked",!0)),u=(0,r.$S)("track_slot_rendered",!0),c=(0,r.$S)("track_slot_viewable",!1),l=(0,r.$S)("track_targeting_keys",!1)},8975:(e,t,n)=>{n.d(t,{v:()=>s,U:()=>o});class r{logger;permutive;id;segmentCode;triggerType;config;workspaceLevelConfig;prefix="[Activation]";constructor(e,t,n,r,i,o,s){this.logger=e,this.permutive=t,this.id=n,this.segmentCode=r,this.triggerType=i,this.config=o,this.workspaceLevelConfig=s}getSegmentCode(){return this.segmentCode}getTriggerType(){return this.triggerType}getConfig(){return this.config}getWorkspaceLevelConfig(){return this.workspaceLevelConfig}trackImpression(e){return this.trackActivation("impression",e)}trackConversion(e){return this.trackActivation("conversion",e)}trackActivation(e,t){const n={reaction_id:this.id,type:e};this.permutive.track("Reaction",n,t),this.logger.log(this.prefix,n.type,n)}}var i=n(9853);const o={dfp:{dfp:[184515,184559,184848,186781,189328,189327,189326,189325,189324,188549,188648,188548,188547,188540,188539,188538,188537,188536,188140,188534,188158,188143,188110,88584,183818,183817,183823,183825,183824,183822,183821,183819,189291,190608,188758,188755,188751,188750,188748,188747,188745,188744,188743,188741,188740,188738,189225,188737,190635,190626,190612,190496,190494,189228,189227,189223,189222,189220,189219,189218,189215,189168,189162,189158,189157,189147,189145,189217,189200,189164],dfp_legacy:{}},eyeota_pixel:[],dbm:{omitted:0},appnexus:{},appnexus_adserver:[],nativo:[],rubicon_ssp:[],smart:[],freewheel:[88584,183819,183818,183817,183822,183825,183824,183823,183821,188755,190608,188758,188751,188750,188748,188747,188745,188744,188743,188741,188740,188738,188737,189220,189218,189215,189164,189157,190635,190626,190612,190496,190494,189228,189227,189225,189223,189222,189219,189200,189217,189168,189147,189162,189158,189145,184848,188537,189328,189327,189326,189325,189324,188549,188648,188548,188547,188540,188539,188538,188536,188534,188143,188158,188140,188110,184559]};class s{logger;permutive;clientContext;constructor(e,t,n){this.logger=e,this.permutive=t,this.clientContext=n}getSpecializedActivations(e){return o[e]}getActivations(e){return(0,i.Hn)(e)("activationConfigs",[]).filter((e=>this.areContextCriteriaSatisfied(e))).map((e=>new r(this.logger,this.permutive,e.id,e.sc,e.tt,e.c,e.wc)))}areContextCriteriaSatisfied(e){const t=e.cc,n=e=>{const t=this.clientContext.getContext()[e.key];switch(e.comparison){case"EQUALS":return t===e.value;case"NOT_EQUALS":return t!==e.value;case"CONTAINS":return"string"==typeof t&&t.indexOf(e.value)>=0;case"NOT_CONTAINS":return"string"==typeof t&&t.indexOf(e.value)<0}};return!t||("AND"===(r=t).operator?r.criteria.every(n):r.criteria.some(n));var r}}},9853:(e,t,n)=>{n.d(t,{$S:()=>s,Hn:()=>i,MU:()=>o});const r={web:{auto_init:!1,track_pageview_engagement:!0,track_form_submission:!1,track_link_click:!0,track_pageview_complete:!0,add_alchemy_taxonomy:!1,add_alchemy_entities:!1,engagement_edge_only:!0,segment_transition_edge_only:!0,activationConfigs:[]},freewheel:{auto_init:!0,activationConfigs:[]},dfp:{auto_init:!0,track_slot_rendered:!1,track_slot_viewable:!0,track_slot_clicked:!0,activationConfigs:[]}},i=e=>{const t=r[e];return(e,n)=>(null==t?void 0:t[e])??n},o=i("web"),s=i("dfp");i("facebook_pixel_v2")},2836:(e,t,n)=>{n.d(t,{z:()=>o});var r=n(3030);class i{context;constructor(e){this.context=e}getContext(){return this.context}updateContext(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach((e=>{let[t,n]=e;this.context[t]=n}))}}class o extends i{constructor(e){super(e)}getClient(){const e=document.title;return Promise.resolve({type:"web",user_agent:navigator.userAgent||"",url:(0,r.bk)(window.location.href),domain:window.location.hostname||"",title:e,referrer:(0,r.bk)(document.referrer)})}}},1568:(e,t,n)=>{n.d(t,{J:()=>u});var r=n(3735),i=n(2884),o=n(7554);const s=e=>t=>class extends t{key=e;put(e){return this.db.then((t=>t.put(e,this.key))).then(r.Q1)}getIfPresent(){return this.db.then((e=>e.get(this.key))).then(i.ij)}reset(){return this.db.then((e=>e.delete(this.key)))}},a=e=>(0,r.zG)(class{db;constructor(e){this.db=Promise.resolve((0,o.E)(e.namespace,e.logger,e.consent))}},s(e));class u extends(a("permutive-unprocessed-pba")){constructor(e){super(e)}}},5700:(e,t,n)=>{n.d(t,{LP:()=>o,dG:()=>r,eP:()=>i});const r=4096,i=`Cookie exceeds maximum supported size of ${r} bytes for most browsers.`,o="Cookie is missing required parameters."},5461:(e,t,n)=>{n.d(t,{S:()=>u});var r=n(3735),i=n(5700);class o{namespace;config;logger;constructor(e,t,n){this.namespace=e,this.config=t,this.logger=n}makeCookie(e,t,n){return[encodeURIComponent(this.namespace.getNamespacedStorageKey(e)),"=",t?encodeURIComponent(t):"","; expires=",n,"; domain=",this.config.cookieDomain,"; path=/; samesite=none; secure"].join("")}setCookie(e,t){if(!(t&&e&&this.config.cookieExpiry&&this.config.cookieDomain)){const{cookieExpiry:n,cookieDomain:r}=this.config??{};throw this.logger.warn(`Unable to set cookie. ${i.LP}`,{value:t,cookieName:e,cookieExpiry:n,cookieDomain:r}),new Error(i.LP)}const n=this.makeCookie(e,t,this.config.cookieExpiry);if(n.length>i.dG)throw this.logger.warn(`Unable to set cookie ${this.namespace.getNamespacedStorageKey(e)}. ${i.eP}`),new Error(i.eP);return this.logger.debug(`Setting cookie ${n}`),document.cookie=n,!0}getCookie(e){const t=arguments.length>1&&void 0!==arguments[1]&&arguments[1]?e:this.namespace.getNamespacedStorageKey(e),n=new RegExp("\\b"+encodeURIComponent(t)+"=([^;]+)").exec(document.cookie);return null!==n?decodeURIComponent(n[1]):null}deleteCookie(e){if(!e||!this.config.cookieDomain)return!1;const t=this.makeCookie(e,void 0,"Thu, 01 Jan 1970 00:00:00 UTC");return this.logger.debug(`Deleting cookie ${t}`),document.cookie=t,!0}}var s=n(4769);const a=e=>{const{logger:t,consentTracking:n}=e,r=e=>(t.debug(`Cookie: Failed to set cookie ${e} as consent is revoked`),!1);return e=>class extends e{setCookie=(0,s.v)(super.setCookie.bind(this),r,n.isRevoked)}},u=(e,t,n,i)=>new((0,r.zG)(o,a({consentTracking:i,logger:n})))(e,t,n)},9773:(e,t,n)=>{n.d(t,{S:()=>l});var r=n(3735),i=n(2688),o=n(787),s=n(365);class a{namespace;constructor(e){this.namespace=e}getExternalData(e){const t=this.namespace.getNamespacedStorageKey(e);return window.localStorage.getItem(t)}getExternalJsonData(e){const t=this.getExternalData(e);return null===t?null:(0,o.A)(t)}setExternalData(e,t){const n=this.namespace.getNamespacedStorageKey(e);try{window.localStorage.setItem(n,t)}catch(e){}}setExternalJsonData(e,t){return(0,r.zG)((n=t,(0,s.Y3)((function(){var e=JSON.stringify(n);if("string"!=typeof e)throw new Error("Converting unsupported structure to JSON");return e}),r.yR)),(0,s.UI)((t=>this.setExternalData(e,t))),(0,s.g_)((e=>{throw(0,i.w)(e)}),r.Q1));var n}removeExternalData(e){const t=this.namespace.getNamespacedStorageKey(e);window.localStorage.removeItem(t)}}var u=n(4769);const c=e=>{const{logger:t,consentTracking:n}=e,r=e=>{t.debug(`External Data: Failed to set key ${e} as consent is revoked`)},i=r,o=r;return e=>class extends e{setExternalData=(0,u.v)(super.setExternalData.bind(this),i,n.isRevoked);setExternalJsonData=(0,u.v)(super.setExternalJsonData.bind(this),o,n.isRevoked)}},l=(e,t,n)=>new((0,r.zG)(a,c({consentTracking:n,logger:t})))(e)},342:(e,t,n)=>{n.d(t,{SX:()=>s});var r=n(3992);class i{sdkInitTimestamp;prefix="[Permutive]"+(self.document?"[Main]":"[Worker]");debugStyle=["color: blue"].join(";");constructor(e){this.sdkInitTimestamp=e}get timeDeltaFromInit(){return`[${(new Date).getTime()-this.sdkInitTimestamp}ms]`}log(){return console.log.bind(self.console,this.timeDeltaFromInit,this.prefix)(...arguments)}debug(){return console.debug.bind(self.console,"%s%c%s",this.timeDeltaFromInit,this.debugStyle,this.prefix)(...arguments)}warn(){return console.warn.bind(self.console,this.timeDeltaFromInit,this.prefix)(...arguments)}error(){return console.error.bind(self.console,this.timeDeltaFromInit,this.prefix)(...arguments)}}class o{log(){}debug(){}warn(){}error(){}}const s=function(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.RP;return e.loggingEnabled&&void 0!==(null===(t=self.console)||void 0===t?void 0:t.log)?new i(n):new o}},8491:(e,t,n)=>{n.d(t,{Q:()=>o});var r=n(3735);const i="[MESSAGES]";class o{logger;messageListenerMap={};replayQueue={};onceTracker={};defaultMessageOptions={withReplay:!1,once:!1};constructor(e){this.logger=e}on(e,t,n){const r=this.mergeMessageOptions(n);r.withReplay&&this.processReplayQueue(e,t);const i=s(e,this.messageListenerMap).push(t)-1;return r.once&&this.addToOnceTracker(e,i),i}once(e,t){return this.on(e,t,{once:!0})}off(e,t){if(null==t)return this.messageListenerMap[e]=[],void(this.replayQueue[e]=[]);t<0?this.logError('Index for "off" fell out of range',{index:t}):s(e,this.messageListenerMap)[t]=r.Q1}emit(e,t,n){const r=this.mergeMessageOptions(n);s(e,this.messageListenerMap).length>0?(this.logDebug(`Emitting Event: ${e}`),this.emitMessageWithPayload(e,t)):r.withReplay&&this.addToReplayQueue(e,t)}addToReplayQueue(e,t){s(e,this.replayQueue).push(t)}processReplayQueue(e,t){var n;null===(n=this.replayQueue[e])||void 0===n||n.forEach((e=>t(e)))}emitMessageWithPayload(e,t){var n;null===(n=this.messageListenerMap[e])||void 0===n||n.forEach(((n,r)=>{n(t),this.removeListenerIfSetToFireOnlyOnce(e,r)}))}addToOnceTracker(e,t){s(e,this.onceTracker).push(t)}removeListenerIfSetToFireOnlyOnce(e,t){var n;null!==(n=this.onceTracker[e])&&void 0!==n&&n.includes(t)&&this.off(e,t)}mergeMessageOptions(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{...this.defaultMessageOptions,...e}}logError(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.error(i,...t)}logDebug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.debug(i,...t)}}const s=(e,t)=>t[e]??=[]},5619:(e,t,n)=>{n.d(t,{Eq:()=>f,X:()=>d,b:()=>l});var r=n(2851),i=n(2116),o=n(4268),s=n(2751),a=n(4011),u=n(3735),c=n(2884);const l=()=>({continent:void 0,environment:"",events_count:0,os:"",sample_rate:0,sdk_version:"",segments_count:0,session_count:0,session_init_count:0,session_view_count:0,user_agent:""}),f=o.n_({continent:{equals:(e,t)=>e===t},environment:s.Eq,events_count:a.Eq,os:s.Eq,sample_rate:a.Eq,sdk_version:s.Eq,segments_count:a.Eq,session_count:a.Eq,session_init_count:a.Eq,session_view_count:a.Eq,user_agent:s.Eq}),d=e=>{const t=_(e.userId),n=(0,u.zG)(r.vP(e.userId,e.sessionId),r.UI((e=>{let[t,n]=e;return`${t},${n}`})),_),o=String(Math.random()),s=(0,u.zG)(e.sdkVariant,c.UI((e=>`-${e}`)),c.fS((()=>""))),a={environment:"web",events_count:0,os:p(window.navigator.userAgent||""),sample_rate:e.sampleRate,sdk_version:"v20.4.1"+s,segments_count:0,user_agent:window.navigator.userAgent||""};return(0,u.zG)(i.vP({session_count:t(e.sessionId),session_init_count:n(r.a9(o)),session_view_count:n(e.viewId)}),i.UI((0,u.ls)((t=>r.vP({...t,continent:(0,u.zG)(e.continent,r.UI(c.FS))})),r.UI((e=>({...a,...e}))))))},p=e=>{const t=e.toLowerCase();return t.includes("windows")?"windows":t.includes("iphone")||t.includes("ipad")?"ios":t.includes("android")?"android":t.includes("macintosh")?"macos":t.includes("linux")?"linux":"unknown"},_=e=>t=>i.dQ((n=>{let{previousState:i}=n;const c=(0,u.zG)(r.vP(e,t),r.Rp(function(e){if(null!==e&&"object"==typeof e&&"scope"in e&&"lastValue"in e&&"count"in e)return e;return{scope:"",lastValue:"",count:1}}(i),((e,t)=>{let[n,r]=t;return{scope:n,lastValue:r,count:n!==e.scope?1:r!==e.lastValue?e.count+1:e.count}})),r.D8(o.n_({scope:s.Eq,lastValue:s.Eq,count:a.Eq})));return{state:c,value:(0,u.zG)(c,r.UI((e=>e.count)))}}))},6478:(e,t,n)=>{n.d(t,{p:()=>d});var r=n(2688),i=n(3735),o=n(2652),s=n(5619),a=n(2851),u=n(3328),c=n(2707),l=n(7407),f=n(3992);const d=e=>{let t=e.context.current;(0,i.zG)(e.context,a.D8(s.Eq),a.Rp((0,i.bc)(s.b(),s.b()),((e,t)=>{let[,n]=e;return(0,i.bc)(n,t)})),(e=>e.onChange((e=>{let[n,r]=e;s.Eq.equals({...n,continent:void 0},{...r,continent:void 0})||p({beacon:!1}),t=r}))));const n="[Metrics Reporter]";let d=!0;const p=async o=>{let{beacon:s}=o;const a=t,f=(0,i.zG)(c.of(e.metrics.consume()),c.Y$((()=>d),(()=>{})),c.tS(u.EQ((()=>c.of(void 0)),(t=>c.Y3((()=>(async(t,n)=>{if(!t)return e.api.metrics(n);if(!e.api.metricsBeacon(n))throw new Error("Failed to send beacon.")})(s,{context:a,items:t})),(i=>{d=!1,function(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];e.logger.error(n,...r)}(`Failed to publish metrics ${(0,r.w)(i).message}`,t)}))))),l.UI(i.Q1));return f()};(0,f.HJ)((()=>p({beacon:!1})),5e3),(0,o.Bf)((()=>p({beacon:!0})),{capture:!1})}},4074:(e,t,n)=>{n.d(t,{Mc:()=>l,gT:()=>s});var r=n(3735),i=n(2884),o=n(1828);function s(e,t,n,r,i){const o=r.getData("metricsEnabled")??(()=>{const e=Math.random()<=n.metricsSamplingPercentage/100;return r.setData("metricsEnabled",e),e})()?new a(e,t,i):new u;return o.track({name:"sdk_initialisation_start_time_seconds",value:e/1e3,labels:{}}),o}class a{sdkInitTimestamp;timeOriginSdkInit;logger;prefix="[Metrics]";timeOriginForContext=l();pendingMetrics=[];pendingCounters={};pendingTimers={};constructor(e,t,n){this.sdkInitTimestamp=e,this.timeOriginSdkInit=t,this.logger=n}isEnabled(){return!0}consume(){const e=this.pendingMetrics.concat(Object.values(this.pendingCounters).flat());return this.pendingMetrics=[],this.pendingCounters={},e}track(e){this.logDebug(`Tracking ${e.name}`,{metric:e}),this.pendingMetrics.push(e)}trackCounter(e){if(this.logDebug(`Tracking ${e.name}`,{metric:e}),e.name in this.pendingCounters){const t=Object.keys(e.labels),n=this.pendingCounters[e.name].findIndex((n=>Object.keys(n.labels).length===t.length&&t.every((t=>n.labels[t]===e.labels[t]))));-1===n?this.pendingCounters[e.name].push(e):this.pendingCounters[e.name][n]=c(this.pendingCounters[e.name][n],e.value)}else this.pendingCounters[e.name]=[e]}synchroniseTimeBetweenContexts(e){return(0,r.zG)(o.gz(i.G5)(this.timeOriginForContext,this.timeOriginSdkInit),i.UI((t=>{let[n,r]=t;return e+n-r})))}trackTimeSinceInit(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:performance.now();(0,r.zG)(this.synchroniseTimeBetweenContexts(n),i.UI((e=>(e-this.sdkInitTimestamp)/1e3)),i.UI((n=>this.track({name:e,value:n,labels:t}))))}startTimer(e,t){const n=performance.now(),r=this.generateRandomKey(e);return this.pendingTimers[r]={startTime:n,labels:t},r}stopTimer(e,t){const n=this.pendingTimers[t];if(n){const r=(performance.now()-n.startTime)/1e3;this.logDebug("timer stopped",e,r),this.track({name:e,value:r,labels:n.labels}),delete this.pendingTimers[t]}}generateRandomKey(e){return`${e}-${[...Array(24)].map((()=>Math.random().toString(36)[2])).join("")}`}logDebug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.debug(this.prefix,...t)}}class u{isEnabled(){return!1}consume(){return[]}track(e){}trackCounter(e){}trackTimeSinceInit(e,t){}startTimer(e,t){return""}stopTimer(e,t){}}const c=(e,t)=>({...e,value:e.value+t}),l=()=>(0,r.zG)(i.Y3((()=>performance.timeOrigin)),i.hX((e=>"number"==typeof e&&!Number.isNaN(e))))},8317:(e,t,n)=>{n.d(t,{S:()=>o});var r=n(3735),i=n(2652);class o{db;options;constructor(e,t){this.db=e,this.options=t}getSessionId(){return this.options.session_id}sessionHasChanged(){return this.options.hasChanged}static decodeSessionData(e){return e&&"object"==typeof e&&e.hasOwnProperty("session_id")&&e.hasOwnProperty("last_updated")?{...e,last_updated:new Date(e.last_updated)}:null}reset(){return this.db.delete(this.options.session_data_key)}async persistSessionData(e){const t=e.last_updated.toISOString();await this.db.put({...e,last_updated:t},this.options.session_data_key)}static generateNewSession(e){return{session_id:(0,i.k$)(),last_updated:e}}static hasExpired(e,t,n){if(isNaN(t.getTime()))return!0;return e>new Date(t.getTime()+1e3*n)}static async initialise(e,t,n){const s={timeout_seconds:1800,session_data_key:"permutive-session",hasChanged:!1,logger:n};e.deleteCookie(s.session_data_key);const a=new Date,u=await t.get(s.session_data_key).catch(r.gn),c=o.decodeSessionData(u),l=null===c||o.hasExpired(a,c.last_updated,s.timeout_seconds)?{...o.generateNewSession(a),hasChanged:!0}:{...c,last_updated:a,hasChanged:!1},f=new o(t,(0,i.PM)(s,l));return await f.persistSessionData(l),f}}},4026:(e,t,n)=>{n.d(t,{S:()=>m});var r=n(3735),i=n(2688),o=n(787),s=n(365),a=n(2652),u=n(4730),c=n(926);class l{config;namespace;logger;prefix="[Data Store]";permutiveData={};permutiveDataSize=0;localStorageScheduler;localStorageQueue=new Set;debouncedStorageKeys;debouncedFlush;constructor(e,t,n){this.config=e,this.namespace=t,this.logger=n,this.localStorageScheduler=new u.b(e.localStorageWriteDelay,e.localStorageWriteMaxDelay),this.debouncedFlush=this.localStorageScheduler.schedule(this.flushLocalStorageQueue.bind(this)),this.debouncedStorageKeys=new Set(e.localStorageDebouncedKeys),this.localStorageScheduler.scheduleForPageUnload(this.flushLocalStorageQueue.bind(this)),this.permutiveData=this.buildData()}reset(){this.permutiveData={}}getDataSize(){return this.permutiveDataSize}getData(e){return this.permutiveData[e]}setData(e,t){this.permutiveData[e]=t,this.requestWrite(e)}deleteKey(e){delete this.permutiveData[e],this.requestWrite(e)}requestWrite(e){this.debouncedStorageKeys.has(e)?(this.localStorageQueue.add(e),this.debouncedFlush()):this.writeData(e)}flushLocalStorageQueue(){for(let e of this.localStorageQueue)this.writeData(e);this.localStorageQueue.clear()}buildData(){return{...this.getDataChunk("misc"),...this.getDataChunk("queries")}}getDataChunk(e){const t=this.namespace.getNamespacedStorageKey(this.chunkKeyToStorageKey(e)),n=window.localStorage.getItem(t),r=null===n?null:(0,o.A)(n);return n&&r?(this.permutiveDataSize+=2*n.length,r):{}}chunkKeyToStorageKey(e){switch(e){case"queries":return this.config.permutiveDataQueriesKey;case"misc":return this.config.permutiveDataMiscKey;default:throw new Error(`Unhandled chunk key "${e}"`)}}writeData(e){this.logger.debug(`Data Store: Writing ${e} to localStorage`);const[t,n]=this.dataKeyToChunkInfo(e);return s.Y3((()=>window.localStorage.setItem(this.namespace.getNamespacedStorageKey(t),JSON.stringify(n))),(t=>{const n=(0,i.w)(t);return this.logError(`Failed to set ${e}. Got ${n}`),n}))}dataKeyToChunkInfo(e){const t=e=>(0,a.eu)(this.permutiveData,e);switch(e){case"internal_query_states":case"external_query_states":case"event-source-id":return[this.chunkKeyToStorageKey("queries"),t(f)];case c.Kd:case"identities":case"amp_ready":case"metricsEnabled":case"addon:tradedesk":case"addon:tracking_pixel":case"addon:eyeota_pixel":case"addon:pinterest_pixel":case"addon:facebook_pixel_v2":case"addon:tiktok_pixel":case"addon:appnexus":case"addon:ddp":case"addon:gigya":case"addon:neustar_fabrick":case"pubmatic":case"lotame":return[this.chunkKeyToStorageKey("misc"),t(d)];default:throw new Error(`Unhandled data key "${e}"`)}}logError(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.error(this.prefix,...t)}}const f=["internal_query_states","external_query_states","event-source-id"],d=[c.Kd,"identities","amp_ready","metricsEnabled","addon:tradedesk","addon:tracking_pixel","addon:eyeota_pixel","addon:pinterest_pixel","addon:facebook_pixel_v2","addon:tiktok_pixel","addon:appnexus","addon:ddp","addon:gigya","addon:neustar_fabrick","pubmatic","lotame"];var p=n(4769);const _=e=>{const{logger:t,consentTracking:n}=e,r=e=>(t.debug(`Data Store: Failed to write ${e} as consent is revoked`),s.F2(void 0));return e=>class extends e{writeData=(0,p.v)(super.writeData.bind(this),r,n.isRevoked)}},m=(e,t,n,i)=>new((0,r.zG)(l,_({consentTracking:i,logger:n})))(e,t,n)},569:(e,t,n)=>{n.d(t,{L:()=>r});class r{config;constructor(e){this.config=e}getNamespacedStorageKey(e){return`${this.config.stateNamespace}${e}`}}},7575:(e,t,n)=>{n.d(t,{u:()=>r});class r{trace;metrics;messages;_isRealtime=!1;_isReady=!1;constructor(e,t,n){this.trace=e,this.metrics=t,this.messages=n}isRealtime(){return this._isRealtime}isReady(){return this._isReady}setAsRealtime(e){this._isRealtime=!0,this.trace.measureSinceInit("sdk_realtime").finish(),this.messages.emit("permutive:realtime"),this.metrics.trackTimeSinceInit("sdk_realtime_targeting_set_task_duration_seconds",{}),this.metrics.trackTimeSinceInit("sdk_lifecycle_timestamps",{timestamp_name:"sdk_realtime",time_origin:"sdk_init"},performance.now()),this.metrics.track({name:"sdk_user_segments_count",value:e,labels:{}})}setAsReady(){this._isReady=!0,this.trace.measureSinceInit("sdk_ready").finish(),this.messages.emit("permutive:ready"),this.metrics.trackTimeSinceInit("sdk_initialisation_task_duration_seconds",{}),window.performance&&window.performance.memory&&(this.metrics.track({name:"sdk_heap_memory_bytes_used",value:window.performance.memory.usedJSHeapSize,labels:{}}),this.metrics.track({name:"sdk_heap_memory_limit_fraction_used",value:window.performance.memory.usedJSHeapSize/window.performance.memory.jsHeapSizeLimit,labels:{}}))}}},3898:(e,t,n)=>{n.d(t,{a:()=>y});var r=n(3735),i=n(4923),o=n(2751),s=(n(5605),i.dp,i.xb,function(e){return function(t){return Object.keys(t).sort(e.compare)}}),a=s(o.Df);i.dx,i.e$;i.Bu,i.P5,i.Su,i.UI;i.ri;function u(e){return i.vP(e)}i._r;i.jt;i.yW,i.G,i.t9;var c=i.HA,l=(i.nn,i.kp),f=i.CC,d=i.RF,p=(i.I8,i.mS,i.RJ,i._Y,i.V_),_=i.EW,m=i.nu,g=(i.SW,i.zV,i.Ub,i.vA,i.qS),v=(i.mK,function(e){return function(t){var n=s(e);return function(e,r){var i=n(e);if(0===i.length)return t.of({});for(var o=t.of({}),s=function(n){o=t.ap(t.map(o,(function(e){return function(t){return e[n]=t,e}})),r(n,e[n]))},a=0,u=i;a<u.length;a++){s(u[a])}return o}}});i.hX,i.DZ,i.uK,i.tV;i.oA,i.oh;var h="Record";i.Eh,i.uZ,o.Df,o.Df,o.Df,o.Df,o.Df,o.Df,o.Df,o.Df,o.Df,o.Df,o.Df,o.Df,o.Df,o.Df,o.Df,o.Df,o.Df,o.Df,o.Df,o.Df,o.Df,o.Df,o.Df,o.Df,o.Df,i.nr,o.Df,o.Df,o.Df,o.Df,o.Df,o.Df,o.Df,o.Df;class y{config;localStorage;logger;permutiveData;cookies;externalData;constructor(e,t,n,r,i,o){this.config=e,this.localStorage=t,this.logger=n,this.permutiveData=r,this.cookies=i,this.externalData=o}async reset(){return this.logger.log("Resetting State"),(0,r.zG)(this.cookies.deleteCookie(this.config.cookieName),(e=>this.externalData.removeExternalData(this.config.cookieName)),(e=>a({_paols:!0,_papns:!0,_pcrdbs:!0,_pcrprs:!0,_pdfps:!0,_pfws:!0,_pnativo:!0,_prps:!0,_prubicons:!0,_psegs:!0,_psmart:!0,"permutive-id":!0,"permutive-loaded":!0,"permutive-prebid-rtd":!0,"permutive-events-cache":!0,_pssps:!0,_ppsts:!0}).forEach((e=>this.externalData.removeExternalData(e)))),(e=>this.permutiveData.reset()),(e=>Promise.all([this.localStorage.delete(this.config.permutiveDataMiscKey),this.localStorage.delete(this.config.permutiveDataQueriesKey)])),r.Q1)}}},7274:(e,t,n)=>{n.d(t,{u:()=>r});class r{permutiveData;permutiveReset;userId;viewId;logger;constructor(e,t,n,r,i){this.permutiveData=e,this.permutiveReset=t,this.userId=n,this.viewId=r,this.logger=i}getPermutiveData(e){return this.permutiveData.getData(e)}setPermutiveData(e,t){return this.permutiveData.setData(e,t)}getStateSizeInBytes(){return this.logger.warn("getStateSizeInBytes needs to be updated to reflect new event persistence"),this.permutiveData.getDataSize()}reset(){return this.permutiveReset.reset()}}},9117:(e,t,n)=>{n.d(t,{M:()=>a});var r=n(3735),i=n(2884),o=n(2851),s=n(2652);class a{config;clientContext;cookies;externalData;ref;isNewlyGenerated;setState;constructor(e,t,n,i,s){this.config=e,this.clientContext=t,this.cookies=n,this.externalData=i;const[a,u]=o.Ue(this.getOrGenerateUserId());this.ref=(0,r.zG)(a,o.UI((e=>e.userId))),this.isNewlyGenerated=(0,r.zG)(a,o.UI((e=>e.isNewlyGenerated))),this.setState=u,(0,r.zG)(o.vP(this.ref,s),o.YP((e=>{let[t,n]=e;n?(this.cookies.setCookie(this.config.cookieName,t),this.externalData.setExternalData(this.config.cookieName,t),this.clientContext.updateContext(["user_id",t])):(this.cookies.deleteCookie(this.config.cookieName),this.externalData.removeExternalData(this.config.cookieName))})))}isEqual(e){return this.ref.current===e}get(){return this.ref.current}set(e){this.setState({userId:e,isNewlyGenerated:!1})}reset(){this.setState({userId:(0,s.k$)(),isNewlyGenerated:!0})}getOrGenerateUserId(){return(0,r.zG)(this.getUserIdFromCookie(),i.wp((()=>this.getUserIdFromLocalStorage())),i.UI((e=>({userId:e,isNewlyGenerated:!1}))),i.fS((()=>({userId:(0,s.k$)(),isNewlyGenerated:!0}))))}getUserIdFromCookie(){return this.getUserIdFromStorageIfValid("cookie")}getUserIdFromLocalStorage(){return this.getUserIdFromStorageIfValid("localStorage")}getUserIdFromStorageIfValid(e){const t=i.DT(s.Gz);return(0,r.zG)("cookie"===e?this.cookies.getCookie(this.config.cookieName):this.externalData.getExternalData(this.config.cookieName),i.ij,i.tS(t))}}},9880:(e,t,n)=>{n.d(t,{W:()=>r});class r{ref;constructor(e){this.ref=e}get(){return this.ref.current}}},4656:(e,t,n)=>{n.d(t,{e:()=>a});var r=n(2851),i=n(2652),o=n(3735),s=n(2884);const a=e=>{const t={viewId:(0,o.zG)(e.viewId,s.DT((e=>"string"==typeof e&&(0,i.Gz)(e))),s.fS(i.k$)),watsonEnabled:e.watson.enabled};return(0,o.zG)(r.Ue(t),(e=>{let[n,r]=e;return{ref:n,setState:(0,o.ls)((e=>e(n.current,t)),r)}}))}},7554:(e,t,n)=>{n.d(t,{E:()=>i});var r=n(8259);const i=(e,t,n)=>{const i=window.localStorage;return(0,r.rK)(i,"[Local Storage]",e,t,n)}},9332:(e,t,n)=>{n.d(t,{u:()=>i});n(2233);var r=n(8259);const i=(e,t,n)=>{const i=window.sessionStorage;return(0,r.rK)(i,"[Session Storage]",e,t,n)}},8259:(e,t,n)=>{n.d(t,{oP:()=>u,rK:()=>f});var r=n(2688),i=n(787),o=n(365),s=n(3735),a=n(4769);class u{storage;namespace;constructor(e,t){this.storage=e,this.namespace=t}async put(e,t){const n=this.namespace.getNamespacedStorageKey(t.toString());return this.storage.setItem(n,JSON.stringify(e)),t}async get(e){const t=this.namespace.getNamespacedStorageKey(e.toString()),n=this.storage.getItem(t);return null===n?null:(0,i.A)(n)}async delete(e){const t=this.namespace.getNamespacedStorageKey(e.toString());this.storage.removeItem(t)}async deleteStore(){}}const c=e=>{const{logger:t,consent:n,prefix:r}=e,i=(e,n)=>(t.debug(`${r} Failed to write ${String(n)} as consent is revoked`),Promise.resolve(n));return e=>class extends e{put=(0,a.v)(super.put.bind(this),i,(()=>!n.current))}},l=e=>{const{logger:t,prefix:n,storage:i}=e;return e=>class extends e{isSupported=null;isStorageSupported(){return null!==this.isSupported||(this.isSupported=o.Y3((()=>{const e="_permutive_ls_test";return i.setItem(e,e),i.getItem(e),i.removeItem(e),!0}),r.w),(0,s.zG)(this.isSupported,o.EQ((e=>{t.warn(`${n} Is NOT supported`,e)}),(()=>{t.debug(`${n} Is supported`)})))),this.isSupported}async put(e,t){return(0,s.zG)(this.isStorageSupported(),o.EQ((e=>{throw e}),(()=>super.put(e,t))))}async get(e){return(0,s.zG)(this.isStorageSupported(),o.EQ((()=>null),(()=>super.get(e))))}async delete(e){return(0,s.zG)(this.isStorageSupported(),o.EQ(s.Q1,(()=>super.delete(e))))}async deleteStore(){return(0,s.zG)(this.isStorageSupported(),o.EQ(s.Q1,(()=>super.deleteStore())))}}},f=(e,t,n,r,i)=>new((0,s.zG)(u,l({logger:r,prefix:t,storage:e}),c({logger:r,consent:i,prefix:t})))(e,n)},2497:(e,t,n)=>{n.d(t,{SD:()=>f});var r=n(2884),i=n(3328),o=n(4923),s=n(3735),a=n(2851),u=n(2652);const c={tradedesk:21,ddp:755,appnexus:32,pubmatic:76,neustar_fabrick:468},l="[TCF]",f=(e,t)=>{const[n,f,p]=(0,s.zG)(a.Ue(r.YP),(e=>{let[n,...i]=e;return[(0,s.zG)(n,a.bw(r.UI((e=>{t.debug(l,`Status "${e.type}"`,e)})))),...i]})),_=e.__tcfapi;if(_){const e=new Set(["tcloaded","useractioncomplete"]);_("addEventListener",2,((n,i)=>{i?"loaded"===n.cmpStatus&&e.has(n.eventStatus)&&(t.debug(l,"TCF API loaded",n),f(r.G({type:"loaded",data:n}))):(t.warn(l,"TCF API failed to register event listener"),f(r.G({type:"aborted"})),p())}))}else t.debug(l,"TCF API missing from the page"),f(r.G({type:"missing"})),p();const[m,g]=(0,s.zG)(a.gS(i.uZ()),(e=>{let[t,n]=e;return[t,(0,s.ls)(i.of,n)]}));return(0,s.zG)(a.vP(n,m),a.bw((e=>{let[n,i]=e;return(0,s.zG)(n,r.UI((e=>{const n=i();switch(t.debug(l,`Processing ${n.length} listeners`,n),e.type){case"missing":n.forEach((n=>{let[r,i]=n;t.debug(l,`Invoking ${r} as TCF API missing`),i(e)}));break;case"aborted":n.forEach((e=>{let[n]=e;t.debug(l,`Invoking ${n} skipped as TCF API aborted`)}));break;case"loaded":n.forEach((n=>{let[i,a]=n;(0,s.zG)(d(e.data),r.EQ((()=>{t.debug(l,`Invoking ${i} as GDPR does not apply`),a(e)}),(n=>(0,s.zG)(c,o.P5(i),r.tS((e=>(0,s.zG)(n,o.P5(e.toString())))),r.UI((n=>{n?(t.debug(l,`${i} has consent`,{vendor:i}),a(e)):t.debug(l,`${i} does not have consent`,{vendor:i})}))))))}))}})))}))),{registerVendorOnValidConsent:(e,t)=>g([e,t]),getStatusOrAbortOnTimeout:e=>new Promise((t=>{const i=setTimeout((()=>t({type:"aborted"})),e);(0,s.zG)(n,a.UI(r.UI((e=>{clearTimeout(i),t(e)}))))})).then((0,u.bw)((e=>t.debug(l,"TCF status resolved as",{status:e}))))}},d=e=>e.gdprApplies?r.G(e.vendor.consents):r.YP},6037:(e,t,n)=>{n.d(t,{C:()=>a});var r=n(5851),i=n(3735);n(7305);const o=(s=[[{name:"dfp",import:Promise.resolve().then(n.bind(n,4388))}],[],[],[],[],[],[],[],[],[],[],[],[{name:"freewheel",import:Promise.resolve().then(n.bind(n,2097))}],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[{name:"web",import:Promise.resolve().then(n.bind(n,4400))}],[],[],[],[]],(0,i.zG)((0,r.xH)(s),(0,r.u4)({},((e,t)=>({...e,[t.name]:t.import})))));var s;const a=e=>{const t=Object.entries(o).map((async t=>{let[n,r]=t;return e.logger.log(`Loading addon ${n}`),(await r).load(e)}));return Promise.all(t)}},3248:(e,t,n)=>{n.d(t,{h:()=>r});const r=e=>{window.googletag=window.googletag||{cmd:[]},window.googletag.cmd.push((()=>{const t=googletag.pubads(),n=()=>{e.track("AdRequest",{ad_server_id:"dfp",cohorts:t.getTargeting("permutive")})},r=t.getSlots().filter((e=>e.getResponseInformation())).length;for(let e=0;e<r;e++)n();t.addEventListener("slotRequested",n)}))}},9658:(e,t,n)=>{n.r(t),n.d(t,{createAddon:()=>E,getCachedDFPSegments:()=>b});var r=n(2688),i=n(365),o=n(3735),s=n(2884),a=n(2851),u=n(9853),c=n(2652);const l="_pdfps";n(5700);var f=n(5851),d=n(2751);let p=!1;let _=null;const m=(e,t)=>{const{logger:n}=t;(0,o.zG)(e,s.UI((e=>{!0!==p&&e.pubadsReady&&(_??=r=>{let{slot:i}=r;const{getContentUrl:s}=i;if(!s||"function"!=typeof s)return;(0,o.zG)(s(),(0,d.pn)("&trunc=1"))&&(n.debug("DFP content URL has been truncated!"),(e=>{let{metrics:t,logger:n}=e;p||(t.track({name:"sdk_targeting_size_limit_exceeded_count",value:1,labels:{target:"dfp"}}),p=!0,n.debug("DFP has exceeded targeting limit"))})(t),_&&e.pubads().removeEventListener("slotRenderEnded",_),_=null)},e.pubads().addEventListener("slotRenderEnded",_))})))},g=(e,t,n,r)=>{const{logger:i}=t;m(e,t);(0,o.zG)(e,s.UI((e=>(e=>{e.cmd.push((()=>{const{getTargeting:t,setTargeting:o}=e.pubads(),s=t("permutive")||[],a=Object.values(n.eligibleSegments).map(String).concat(n.cloudCohorts).concat("rts"),u=(0,f.uK)((e=>a.includes(e))),{left:c}=u(s),l=r.concat(c).concat("rts");i.debug("DFP setting GPT targeting to",l),o("permutive",l)}))})(e))))};var v=n(4388);const h={liveSegments:[],cloudCohorts:[],eligibleSegments:{}},y={segments:h,getGAMKeyValues:()=>({permutive:""})},b=e=>e.getExternalJsonData(l)||[],w=(e,t,n)=>{const{logger:i,externalData:o,api:s}=t;let a=n.map(String).concat(h.cloudCohorts);i.debug("DFP is updating with targeting values",a),g(e,t,h,a);try{o.setExternalJsonData(l,a)}catch(e){const t=(0,r.w)(e),n="DFP failed to set data. Got:";i.error(n,t),s.reportError(`${n} ${t.message}`)}return((e,t)=>{let{api:n,logger:r}=e;(0,u.$S)("sync_segments_cookie",!1)?(r.debug("DFP syncing segment cookie _pdfps"),n.segmentSync({key:l,value:t})):r.debug("DFP sync segments cookie not enabled, skipping sync")})(t,JSON.stringify(a)),i.debug("DFP live segments updated to",n),n},E=async e=>{const{api:t,logger:n,activationManager:r,messages:u,externalData:f,nextGenOutput:d,userId:p,cookies:_}=e,m=await(0,c.a4)((()=>window.googletag),(()=>!!window.googletag),{waitTimeInMs:10,maxAttempts:200,exponentialBackOff:!1});s.Wi(m)&&n.error("[DFP]: unable to find google tag script on the page"),(0,o.zG)(m,s.UI((e=>(e=>e.cmd.push((()=>e.pubads().setTargeting("prmtvsdk","web"))))(e))));y.getGAMKeyValues=()=>({...(0,o.zG)((0,v.generateProjectSpecificKVs)(e),i.Vn((e=>{var n;return n=e,t.reportError(`[DFP] ${n}`,p.get()),e})),i.fS((()=>({})))),permutive:y.segments.liveSegments.join(",")}),h.eligibleSegments=(e=>{const t=e.getSpecializedActivations("dfp"),n={};for(const e of t.dfp)n[e]=e;for(const e of Object.keys(t.dfp_legacy)){const r=Number(e);n[r]=t.dfp_legacy[r]}return n})(r);const g=(0,o.zG)(d.queryLanguageCohorts.all,a.UI((e=>(n.debug("DFP received QL segments",{qlSegments:e}),((e,t)=>e.filter((e=>e in t)).map((e=>t[e])))(e,h.eligibleSegments)))),a.D8(c.cO)),b=d.activations.dfp??a.a9([]);return(0,o.zG)(a.vP(g,b),a.YP((0,c.Z_)(t,p,(t=>{let[r,i]=t;n.debug("DFP received updated cohorts",{filteredQlSegments:r,cloudCohorts:i}),h.cloudCohorts=i,h.liveSegments=w(m,e,r)})))),n.debug("DFP initialised with segments",h),u.on("permutive:reset",(0,c.Z_)(t,p,(()=>{n.debug("DFP received 'permutive:reset' event"),f.removeExternalData(l),_.deleteCookie(l)}))),u.emit("permutive:dfp:ready"),y}},4388:(e,t,n)=>{n.r(t),n.d(t,{generateProjectSpecificKVs:()=>D,load:()=>d});var r=n(2688),i=n(365),o=n(2884),s=n(3735),a=n(922),u=n(9853),c=n(2652),l=n(9658);const f={},d=e=>{(0,u.Hn)("dfp")("auto_init",!1)&&e.q.push({functionName:"addon",arguments:["dfp",{}]}),window.googletag=window.googletag||{},window.googletag.cmd=window.googletag.cmd||[],window.googletag.cmd.push((()=>p(e)))},p=e=>{e.permutive.ready((0,c.Z_)(e.api,e.userId,(()=>I(e.metrics))),"realtime");k(e.externalData);(0,s.zG)(D(e),i.tS((e=>i.Y3((()=>(0,c.qh)(e).forEach((e=>{let[t,n]=e;googletag.pubads().setTargeting(t,n)}))),r.w))),i.Vn((t=>e.api.reportError(`[DFP:load], ${t}`,e.userId.get())))),y(e.permutive),googletag.cmd.push((()=>{b(e.permutive),w(e.permutive)})),window.addEventListener("message",m(e.permutive),!1)},_=e=>{let{advertiserId:t,campaignId:n,lineItemId:r,creativeId:i}=e;return{advertiser_id:(0,c.rH)(t),campaign_id:(0,c.rH)(n),line_item_id:(0,c.rH)(r),creative_id:(0,c.rH)(i)}},m=e=>t=>{try{const n=JSON.parse(t.data);if(!n.permutive_type||"google_ad_click"!==n.permutive_type)return;const{ad_unit_path:r,creative_id:i,advertiser_id:o,order_id:s,line_item_id:a}=(null==n?void 0:n.data)??{},u=_({lineItemId:a,advertiserId:o,campaignId:s,creativeId:i});let c;Object.keys(f).some((e=>{const{slot:t,creative_id:n}=f[e];if((null==t?void 0:t.ad_unit_path)===r&&n===u.creative_id)return c=f[e],!0})),c=c??{...u,is_empty:!1},g(e,c)}catch{}},g=(e,t)=>{a.PH&&t&&e.track("SlotClicked",t)},v={},h=(e,t,n)=>{f[t]=n,E(e,n),v[t]&&v[t](),v[t]=P(e,t)},y=e=>{const t=googletag.pubadsReady&&googletag.pubads().getSlots();t&&t.forEach((t=>{const n=t.getResponseInformation();if(!n)return;const r={..._(n),is_empty:!1,service_name:"publisher_ads",slot:S(t)},i=t.getSlotElementId();h(e,i,r)}))},b=e=>{googletag.pubads().addEventListener("slotRenderEnded",(t=>{const n={..._(t),is_empty:t.isEmpty,service_name:t.serviceName,slot:S(t.slot)};if(t.size){const[e,r]=t.size;"number"==typeof e&&"number"==typeof r&&(n.width=e,n.height=r)}const r=t.slot.getSlotElementId();h(e,r,n)}))},w=e=>{a.EW&&googletag.pubads().addEventListener("impressionViewable",(t=>{let{slot:n,serviceName:r}=t;const i=n.getResponseInformation();if(!i)return;const o={..._(i),service_name:r,slot:S(n)};e.track("SlotViewable",o)}))},E=(e,t)=>{if(!a.CL)return;var n;n={...t,rendered_timestamp:Date.now()},e.track("SlotRendered",n)},I=e=>{let t=0;const n=googletag.pubadsReady&&googletag.pubads().getSlots();n&&n.forEach((e=>e.getResponseInformation()&&t++));const r=0===t?"sdk_targeting_realtime_success_count":"sdk_targeting_realtime_fail_count";e.track({name:r,value:1,labels:{target:"dfp"}})},k=e=>{const t=(0,l.getCachedDFPSegments)(e);googletag.cmd.push((()=>{const{getTargeting:e,setTargeting:n}=googletag.pubads(),r=e("permutive")||[];n("permutive",[...new Set([...t.map(String),...r])])}))},S=e=>{const t={ad_unit_path:e.getAdUnitPath(),slot_element_id:e.getSlotElementId()};return a.jH?{...t,...(()=>{const t={},n=[];let r=[];const i=(e,i)=>{const o="slot"===e?e=>t[e]=1:()=>{},s=i.getTargetingKeys();r=s;for(let s=0;s<r.length;s++){const a=r[s];if(void 0!==t[a]&&"service"===e)continue;const u=[],c=i.getTargeting(a);for(let e=0;e<c.length;e++)u.push(c[e].toString());u.length>0&&(o(a),n.push({key:a,value:u}))}};return i("slot",e),i("service",googletag.pubads()),{targeting_keys:n}})()}:t},P=(e,t)=>{let n=[];const r=()=>(0,s.zG)((0,s.bc)((0,s.zG)(o.Y3((()=>document.getElementById(t))),o.tS(o.ij),o.tS(o.KQ((e=>e.querySelector("iframe"))))),o.ij(document.activeElement)),o.RD,o.UI((n=>{let[r,i]=n;"hidden"===document.visibilityState&&r===i&&g(e,f[t])})));return document.addEventListener("visibilitychange",r),n.push((()=>document.removeEventListener("visibilitychange",r))),()=>{n.forEach((e=>e())),n=[]}},D=e=>{let{userId:t,viewId:n}=e;return i.Y3((()=>({})),r.w)}},4400:(e,t,n)=>{n.r(t),n.d(t,{WebAddon:()=>E,load:()=>w});var r=n(2688),i=n(365),o=n(3735),s=n(4011),a=n(2884),u=n(7209),c=n(922),l=n(9853),f=n(2652);const d=(0,l.MU)("add_alchemy_entities",!1),p=(0,l.MU)("add_alchemy_taxonomy",!1);function _(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return{...e&&p?{taxonomy_labels:"$alchemy_taxonomy_labels"}:{},...e&&d?{entity_names:"$alchemy_entity_names"}:{}}}function m(e,t,n,r){const i={isp_info:"$ip_isp_info",geo_info:"$ip_geo_info",...g(),...e,...t};n.track("Pageview",i).then((e=>{e&&r.emit("permutive:event:pageview",e)}))}function g(){return{}}var v=n(3992);const h=["mousemove","click","scroll"],y=["email","tel","submit","reset","button","file","password","radio","checkbox"],b=["email","e-mail","password","tel","telephone","phone","name_first","name_last","sa_zip"],w=e=>{(0,l.Hn)("web")("auto_init",!1)&&e.q.push({functionName:"addon",arguments:["web",{auto_init:!0}]})};class E{permutive;options;api;clientContext;logger;dirtyState=!1;cancelEngagementTimer=()=>{};totalCompletion=0;totalEngagedTime=0;pageEngagementDetected;cleanupPageEngagementDetection=o.Q1;constructor(e){this.permutive=e.permutive,this.options=e,this.api=e.api,this.clientContext=e.clientContext,this.logger=e.logger,this.options.customProperties.setCustomProps(e.page||{});this.pageEngagementDetected=(()=>{this.dirtyState=!0}).bind(this),m(_(this.clientContext.getContext().isArticle),this.options.customProperties.getCustomProps(),this.permutive,this.options.messages),this.enablePageEngagementDetection(),"loading"!==document.readyState?this.attachListeners():window.addEventListener("DOMContentLoaded",this.attachListeners.bind(this),!1),c.t2&&(this.cancelEngagementTimer=this.registerEngagementInterval(this.getEventInterval()))}sendFormSubmissionEvent(e){{const t=e.currentTarget,n={form:{method:t.method||"GET",properties:this.serializeForm(t),..."string"==typeof t.id?{id:t.id}:{},...t.name&&"string"==typeof t.name?{name:t.name}:{},...t.action&&"string"==typeof t.action?{action:t.action}:{}}};this.permutive.track("FormSubmission",n)}}async trackEngagementInterval(e){const t=this.updateState(e);!function(e,t,n,r,i,o){const s={isp_info:"$ip_isp_info",geo_info:"$ip_geo_info",engaged_time:e,total_engaged_time:t,...i,completion:n,total_completion:r};o.track("PageviewEngagement",s)}(t.engaged_time,t.total_engaged_time,t.completion,t.total_completion,this.options.customProperties.getCustomProps(),this.permutive)}async reset(e){this.disablePageEngagementDetection(),this.dirtyState=!1;const t=this.updateWebOptions(e);this.options.pageviewState.setState(((e,n)=>{var r,i;return{viewId:(null===(r=t.context)||void 0===r?void 0:r.view_id)??(0,f.k$)(),watsonEnabled:(null===(i=t.watson)||void 0===i?void 0:i.enabled)??n.watsonEnabled}})),this.totalCompletion=0,this.totalEngagedTime=0,this.options.customProperties.setCustomProps(this.options.page||{}),this.enablePageEngagementDetection(),m(_(this.clientContext.getContext().isArticle),this.options.customProperties.getCustomProps(),this.permutive,this.options.messages),c.t2&&(this.cancelEngagementTimer(),this.cancelEngagementTimer=this.registerEngagementInterval(this.getEventInterval()))}serializeForm(e){return[...e.getElementsByTagName("input")].filter((e=>!(!e.type||!e.id||e.disabled||e.checked||"fieldset"===e.nodeName.toLowerCase()||-1!==y.indexOf(e.type.toLowerCase())||-1!==b.indexOf(e.name.toLowerCase())))).map((e=>({name:e.name||e.id,value:e.value}))).filter((e=>e.value.length<120))}registerEngagementInterval(e){return(0,v.UM)((()=>{this.dirtyState&&this.trackEngagementInterval(e)}),1e3*e)}attachListeners(){const e=e=>"a"===e.tagName.toLowerCase(),t=e=>e instanceof Element,n=t=>e(t)?(0,a.G)(t):t.parentElement?e(t.parentElement)?(0,a.G)(t.parentElement):n(t.parentElement):a.YP;c.eV&&[].slice.call(document.getElementsByTagName("form"),0).forEach((e=>e.addEventListener("submit",(0,o.ls)(a.DT(this.canTrackPermutiveEvent("FormSubmission")),a.UI((0,f.Z_)(this.options.api,this.options.userId,this.sendFormSubmissionEvent.bind(this)))))));(0,l.MU)("track_link_click",!0)&&document.body.addEventListener("click",(0,o.ls)(a.DT(this.canTrackPermutiveEvent("LinkClick")),a.UI((e=>({event:e,anchor:(0,o.zG)(e.target,a.ij,a.tS(a.DT(t)),a.tS(n))}))),a.DZ((e=>{let{event:t,anchor:n}=e;return a.pC(n)?a.G({event:t,anchor:n.value}):a.YP})),a.UI((e=>{let{event:t,anchor:n}=e;return I(this.permutive,n,(r=t,!("_blank"===n.target||r.metaKey||r.ctrlKey||r.shiftKey||2===r.which||3===r.which)));var r}))),{capture:!0})}updateState(e){const t=Math.max(this.totalCompletion,this.getCurrentCompletion()),n=t-this.totalCompletion;return this.totalEngagedTime+=e,this.totalCompletion=t,this.dirtyState=!1,{engaged_time:e,total_engaged_time:this.totalEngagedTime,completion:n,total_completion:this.totalCompletion}}getCurrentCompletion(){if("function"==typeof this.options.getPageCompletion)return(0,o.zG)((0,i.Y3)((0,o.ls)(this.options.getPageCompletion,Number,(e=>isNaN(e)?0:e),(0,u.uZ)(s.Df)(0,1)),r.w),(0,i.EQ)((e=>(this.logger.warn("Web: invoking getPageCompletion threw an error. Got",e),0)),(e=>(this.logger.debug("Web: invoking getPageCompletion returned",e),e))));return(()=>{const e=document.documentElement.scrollHeight,t=window.pageYOffset+window.innerHeight;return t<=0?0:t>=e?1:t/e})()}registerPageEngagementCleanup(e){"function"==typeof e?this.cleanupPageEngagementDetection=()=>(0,i.Y3)((()=>{e(),this.cleanupPageEngagementDetection=o.Q1}),(e=>this.logger.warn("Page detection cleanup threw an error",(0,r.w)(e)))):this.logger.warn("No page detection cleanup was registered")}enablePageEngagementDetection(){this.options.addPageEngagementDetection&&(0,o.zG)(this.options.addPageEngagementDetection(this.pageEngagementDetected),(e=>this.registerPageEngagementCleanup(e))),this.setDirtyEventListenersTo(!0,this.getDirtyEvents())}disablePageEngagementDetection(){this.cleanupPageEngagementDetection(),this.setDirtyEventListenersTo(!1,this.getDirtyEvents())}setDirtyEventListenersTo(e,t){const n=e?window.addEventListener:window.removeEventListener;return t.forEach((e=>n(e,this.pageEngagementDetected))),null}getDirtyEvents(){return this.options.dirtyEvents||h}getEventInterval(){return this.options.eventInterval||5}canTrackPermutiveEvent(e){return t=>{var n,s;return(0,o.zG)(null===(n=this.options)||void 0===n||null===(s=n.filterPermutiveEvent)||void 0===s?void 0:s[e],a.DT((e=>"function"==typeof e)),a.tS((0,o.ls)((e=>i.Y3((()=>e(t)),(e=>new Error(`Threw an unexpected error: ${(0,r.w)(e)}`)))),i.tS(i.DT((e=>"boolean"==typeof e),(()=>new Error("Did not return a boolean")))),(0,f.bw)(i.Vn((t=>this.logger.error(`Filter predicate for "${e}" event failed`,t)))),a.Uo)),a.fS((()=>!0)))}}updateWebOptions(e){(0,f.Kn)(e)||(e={}),e.watson&&"object"==typeof e.watson&&"enabled"in e.watson&&"boolean"==typeof e.watson.enabled||delete e.watson,"object"==typeof e.filterPermutiveEvent&&null!==e.filterPermutiveEvent||delete e.filterPermutiveEvent,"context"in e&&!(0,f.Kn)(e.context)&&delete e.context;const t={addPageEngagementDetection:void 0,context:void 0,dirtyEvents:void 0,eventInterval:void 0,filterPermutiveEvent:void 0,getPageCompletion:void 0,page:void 0,watson:void 0};return this.options={...this.options,...t,...e}}}const I=(e,t,n)=>{if(window.location.href&&t.href){const r=0===t.href.indexOf("data:")?"NOT_URL":t.href;e.track("LinkClick",{dest_url:r},{useBeacon:n})}}},9078:(e,t,n)=>{n.d(t,{a:()=>r});class r{messages;handlers={};messageQueue={};constructor(e){var t,n;this.messages=e;null===(t=(n=window).addEventListener)||void 0===t||t.call(n,"message",(e=>{var t;"permutive"===(null==e||null===(t=e.data)||void 0===t?void 0:t.origin)&&this.handle(e)}),!1),this.messages.once("permutive:api:ready",(function(){var e,t;null===(e=(t=window).postMessage)||void 0===e||e.call(t,{origin:"permutive",type:"sdk-init"},"*")}))}listen(e,t){if(e in this.handlers||(this.handlers[e]=[]),this.handlers[e].push(t),e in this.messageQueue){const t=this.messageQueue[e];if(void 0===t)return;for(let e=0;e<t.length;e++){const n=t[e];this.handle(n)}}}handle(e){if(e.data.type in this.handlers)this.handlers[e.data.type].forEach((t=>{t(e)}));else{(this.messageQueue[e.data.type]??=[]).push(e)}}}},533:(e,t,n)=>{n.d(t,{o:()=>r,s:()=>i});class r extends Error{static errorName="NetworkRequestFailedError";name=r.errorName;constructor(){super(r.defaultMessage)}static get defaultMessage(){return"Network request failed"}}class i extends Error{static errorName="NetworkRequestTimeoutError";name=i.errorName;constructor(){super(i.defaultMessage)}static get defaultMessage(){return"Network request timed out"}}},7423:(e,t,n)=>{n.d(t,{F:()=>f});var r=n(2688),i=n(3735),o=n(2884),s=n(3328),a=n(3030),u=n(533),c=n(6392);class l{urls;config;network;metricsCollector;logger;webClient;prefix="[API]";constructor(e,t,n,r,i){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:()=>o.YP;this.urls=e,this.config=t,this.network=n,this.metricsCollector=r,this.logger=i,this.webClient=s}async reportError(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Date;const l=(0,r.w)(e);if(this.logError("Reporting error:\n",l),!this.config.sendClientErrors)return void this.logDebug("Send errors not enabled. Skipping");const f=(0,i.zG)(this.webClient,c.UI(o.fS((()=>{var e,t,n,r;return{domain:(null===(e=self.location)||void 0===e?void 0:e.hostname)??"",referrer:"document"in self?null===(t=self.document)||void 0===t?void 0:t.referrer:"",url:(null===(n=self.location)||void 0===n?void 0:n.href)??"",user_agent:(null===(r=navigator)||void 0===r?void 0:r.userAgent)??""}}))),c.UI((e=>{var r,i;const o={error_message:(null==l||null===(r=l.message)||void 0===r?void 0:r.toString())??"",stack_trace:null==l||null===(i=l.stack)||void 0===i?void 0:i.split("\n")},s=t?{user_id:t}:{};return{platform:"web",sdk_version:"v20.4.1",ql_runtime_version:"v10.0.2",timestamp:n,domain:e.domain,url:(0,a.bk)(e.url),referrer:(0,a.bk)(e.referrer),user_agent:e.user_agent,error_message:o.error_message??String(l),stack_trace:o.stack_trace,...s}}))),d=e=>this.network.req({url:this.urls.getSdkErrorsUrl("/errors",o.G(this.config.sdkErrorsApiVersion)),method:"POST",payload:[e],contentType:"text/plain",dataType:"text",withCredentials:!1}),p=e=>{this.metricsCollector.trackCounter({name:"sdk_http_generic_network_request_fail_count_total",value:1,labels:{network_error_type:e}})};await(0,i.zG)([u.o,u.s],s.Ew((e=>l.name===e.errorName||l.message.indexOf(e.errorName)>=0||l.message.indexOf(e.defaultMessage)>=0)),o.g_((()=>{const e=f();return d(e).catch((0,i.ls)(r.w,(e=>this.logError(e))))}),(async e=>p(e.errorName))))}logDebug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.debug(this.prefix,...t)}logError(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.error(this.prefix,...t)}}class f extends l{identifyPromise;identify(e,t,n){const r=()=>this.reqWithMetrics(e,"sdk_http_identify_seconds",{url:this.urls.getEndpointUrl("/identify",o.G(this.config.apiVersion)),method:"POST",payload:{user_id:t.get(),aliases:n},contentType:"text/plain",dataType:"json",withCredentials:!0});return this.identifyPromise?this.identifyPromise=this.identifyPromise.then(r):this.identifyPromise=r()}metrics(e){return this.network.req({url:this.urls.getEndpointUrl("/internal/metrics",o.G(this.config.apiVersion)),method:"POST",payload:e,contentType:"text/plain",dataType:"text",withCredentials:!1})}metricsBeacon(e){return this.network.reqWithBeacon({url:this.urls.getEndpointUrl("/internal/metrics",o.G(this.config.apiVersion)),payload:e})}reset(e){return this.reqWithMetrics(e,"sdk_http_reset_seconds",{url:this.urls.getEndpointUrl("/reset",o.G(this.config.apiVersion)),method:"POST",payload:null,contentType:"text/plain",dataType:"json",withCredentials:!0})}segmentSync(e){return this.network.req({url:`https://${this.config.segmentSyncApiHost}/sync/${e.key}`,method:"POST",payload:`value=${encodeURIComponent(e.value)}`,contentType:"application/x-www-form-urlencoded",dataType:"json",withCredentials:!0})}appnexus(e){return this.network.req({url:e,method:"GET",contentType:"text/plain",dataType:"json",withCredentials:!0,timeout:2e3})}pxid(e){return this.network.req({url:this.urls.makeAuthenticatedUrl(e),method:"GET",contentType:"text/plain",dataType:"json",withCredentials:!0,timeout:2e3})}queries(){const e={addons:{dfp:{activations:{dfp:[],dfp_legacy:{}},auto_init:!0,track_slot_rendered:!1,track_slot_viewable:!1,track_slot_clicked:!1,track_targeting_keys:!1,sync_segments_cookie:!1},web:{auto_init:!1,track_pageview_engagement:!0,track_pageview_complete:!0,track_form_submission:!1,track_link_click:!1,engagement_edge_only:!0,segment_transition_edge_only:!1}},queries:{queries:{},eventSegments:{},eventsLookup:[],literalsLookup:[],subexpressionsLookup:[],stateSyncReplays:[],propertiesLookup:[]},queries_metadata:{}},t=`${this.config.cdnBaseUrl.startsWith("dev.local:")?"http":"https"}://${this.config.cdnBaseUrl}/queries/6adbc4e9-beda-4b9e-9117-43ec3a80e1d0-amp.json`;return this.network.req({url:t,withCredentials:!1,dataType:"json",method:"GET"}).catch((()=>e))}pxidReset(e){return this.network.req({url:this.urls.makeAuthenticatedUrl(e),method:"POST",payload:null,contentType:"text/plain",dataType:"json",withCredentials:!0})}uploadCohortMemberships(e,t){return this.reqWithMetrics(e,"sdk_http_upload_cohort_memberships_seconds",{url:this.urls.getCCSCohortMembershipEndpointUrl("/amp/cohorts",o.G("alpha"),[["i",t.user_id]]),method:"POST",payload:t,contentType:"text/plain",dataType:"json",withCredentials:!1})}reqWithMetrics(e,t,n){const r=e.startTimer(t,{});return this.network.req(n).then((n=>(0,i.zG)(e.stopTimer(t,r),(e=>n))))}}},7354:(e,t,n)=>{n.d(t,{E:()=>y});var r=n(365),i=n(3735),o=n(533),s=n(3992),a=n(2884),u=n(9384),c=function(e){return"Left"===e._tag},l=function(e){return"Right"===e._tag};function f(e){return{_tag:"Left",left:e}}function d(e){return{_tag:"Right",right:e}}function p(e,t){return{_tag:"Both",left:e,right:t}}var _=function(e,t,n){return function(r){switch(r._tag){case"Left":return e(r.left);case"Right":return t(r.right);case"Both":return n(r.left,r.right)}}},m=_;m(d,f,(function(e,t){return p(t,e)}));var g=d,v="These",h=(i.yR,i.yR,u.Xl,n(2652));class y{metrics;constructor(e){this.metrics=e}req(e){return this.reqImpl(e).then((e=>(0,i.MZ)(e)))}reqWithBeacon(e){var t,n;let{url:r,payload:i}=e;const o=JSON.stringify(i),s=(null===(t=navigator)||void 0===t||null===(n=t.sendBeacon)||void 0===n?void 0:n.call(t,r,JSON.stringify(i)))??!1;return this.trackRequestMetrics({is_beacon:!0,is_error:!s,request:{method:"POST",url:r,content_length:o.length}}),s}reqImpl(e){const t="arraybuffer",{url:n,dataType:c,contentType:l,method:f,withCredentials:_,timeout:m}=e;return new Promise(((g,v)=>{const y=new XMLHttpRequest,b="POST"===e.method?"string"==typeof(w=e.payload)?w:JSON.stringify(w):null;var w;const E=e=>this.trackRequestMetrics({is_beacon:!1,request:{method:f,url:n,content_length:(null==b?void 0:b.length)??0},response:e});y.onload=(0,s.GL)((()=>{var e,n;return(0,i.zG)(y.status,r.DT((e=>e<400),(()=>{const e="text"===y.responseType||""===y.responseType?y.responseText:"Couldn't access response text";return`Failed ajax request. Status code was ${y.status}. ${e}`})),r.tS((()=>"json"===c?y.responseText?r.Y3((()=>JSON.parse(y.responseText)),(e=>`Failed to parse response as JSON. Response was ${JSON.stringify(y.responseText)}. Got ${e}`)):r.F2(null):"text"===c?r.F2(y.responseText):r.F2(y.response))),(0,h.bw)((0,i.ls)(a.IS,(n={content_length:"text"===y.responseType||""===y.responseType?(null===(e=y.responseText)||void 0===e?void 0:e.length)??0:y.responseType===t?y.response.byteLength:0,response_time_ms:self.performance.now()-I,status_code:y.status},function(e){return u.Wi(e)?d(n):p(e.value,n)}),E)),r.EQ(v,g))})),y.onerror=(0,s.GL)((()=>{E(r.t$("network error")),v(new o.o)})),y.ontimeout=(0,s.GL)((()=>{E(r.t$("timeout")),v(new o.s)})),y.open(f,n,!0),l&&y.setRequestHeader("content-type",l),y.timeout=m||y.timeout,y.withCredentials=_||y.withCredentials,y.responseType="binary"===c?t:y.responseType;const I=self.performance.now();y.send(b)}))}trackRequestMetrics(e){var t;if(null===(t=this.metrics)||void 0===t||!t.isEnabled())return;const n=new URL(e.request.url).pathname;if(n.includes("metrics"))return;const r=t=>this.metrics.track({name:"sdk_http_request_count_total",value:1,labels:{request_method:e.request.method,request_path:n,request_content_length:e.request.content_length,...t}});var o;!0===e.is_beacon?r({is_beacon:!0,is_error:e.is_error}):(0,i.zG)((o=e.response,c(o)?u.YP:(l(o),u.G(o.right))),a.aD((()=>({})),(e=>({response_content_length:e.content_length,response_status:e.status_code,response_time_ms:e.response_time_ms}))),(t=>({is_beacon:!1,is_error:!l(e.response),...t})),r)}}},7548:(e,t,n)=>{n.d(t,{X:()=>i,k:()=>r});const r=e=>({id:e.id,name:e.name,time:new Date(e.time),properties:e.properties||{},session_id:e.session_id,view_id:e.view_id}),i=e=>({id:e.id,name:e.name,time:(o(e.time)?e.time:new Date).toISOString(),properties:e.properties||{},session_id:e.session_id,view_id:e.view_id}),o=e=>isFinite(e)&&e instanceof Date},310:(e,t,n)=>{n.d(t,{s:()=>i});var r=n(2884);class i{config;PATH_JOINER_Q="?";PATH_JOINER_A="&";constructor(e){this.config=e}getBaseUrl(){return`${this.config.apiProtocol}://${this.config.apiHost}`}getEndpointUrl(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return this.getUrl("base",e,t,n)}getSdkErrorsUrl(e,t){return this.getUrl("sdk-errors",e,t,[])}getAdvertiserEndpointUrl(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return this.getUrl("adv",e,t,n)}getClassificationModelsEndpointUrl(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return this.getUrl("clm",e,t,n)}getAudienceMatchingEndpointUrl(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];const i=`${e}/${n}/audiences`;return this.getUrl("audience-matching",i,t,r)}getCCSCohortMembershipEndpointUrl(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return this.getUrl("ccs",e,t,n)}makeAuthenticatedUrl(e){return this.makeUrlWithQueryParams(e,[["k",this.config.apiKey]])}getUrlPrefix(e){switch(e){case"base":return"";case"adv":return"/adv";case"sdk-errors":return"/sdk-errors";case"clm":return"/clm";case"audience-matching":return"/audience-matching";case"ccs":return"/ccs"}}getUrl(e,t,n,i){const o=this.getUrlPrefix(e),s=(0,r.g_)((()=>""),(e=>`/${e}`))(n),a=`${this.getBaseUrl()}${o}${s}${t}`;return this.makeUrlWithQueryParams(a,i.concat([["k",this.config.apiKey]]))}makeUrlWithQueryParams(e,t){const n=t.map((e=>{let[t,n]=e;return`${t}=${n}`})).join(this.PATH_JOINER_A),r=e.includes(this.PATH_JOINER_Q)?this.PATH_JOINER_A:this.PATH_JOINER_Q;return`${e}${r}${n}`}}},9851:(e,t,n)=>{n.r(t),n.d(t,{startMaster:()=>le});var r=n(2851),i=n(3735),o=n(2116),s=n(2884),a=n(3328),u=n(2652),c=n(6392),l=n(4923),f=n(1828),d=n(6017),p=n(7241);var _=n(4074),m=n(7407),g=n(6862),v=n(7341),h=n(4870);function y(e,t){return function(n){return e.map(n,t.compact)}}function b(e,t,n){var r=y(e,t),o=(0,v.UI)(e,n);return function(e){return h.s4(r((0,i.zG)(e,o(s.IS))),r((0,i.zG)(e,o(s.EK))))}}function w(e,t){return function(n){return function(r){return e.map(r,(function(e){return t.filter(e,n)}))}}}function E(e,t){return function(n){return function(r){return e.map(r,(function(e){return t.filterMap(e,n)}))}}}function I(e,t){var n=w(e,t);return function(e){var t=n((0,d.ff)(e)),r=n(e);return function(e){return(0,h.s4)(t(e),r(e))}}}function k(e,t){var n=E(e,t);return function(e){return function(t){return(0,h.s4)((0,i.zG)(t,n((function(t){return(0,s.IS)(e(t))}))),(0,i.zG)(t,n((function(t){return(0,s.EK)(e(t))}))))}}}var S=n(9384);function P(e){return(0,i.ls)(s.G,e.of)}function D(e){return(0,i.a9)(e.of(s.YP))}function U(e){return function(t){return e.map(t,s.G)}}function G(e){return(0,i.ls)(s.ij,e.of)}function z(e){var t=G(e);return function(e){return(0,i.ls)(e,t)}}function O(e){var t=K(e),n=z(e);return function(e){return t(n(e))}}function C(e){return function(t){return(0,i.ls)(t,e.of)}}function T(e){var t=K(e),n=C(e);return function(e){return t(n(e))}}function x(e){return function(t){return function(n){return e.of(s.DT(t)(n))}}}function M(e){return(0,i.ls)(s.Uo,e.of)}function A(e){return function(t,n){return function(r){return e.map(r,s.EQ(t,n))}}}function R(e){return function(t,n){return function(r){return e.chain(r,s.EQ(t,n))}}}function q(e){return function(t){return function(n){return e.chain(n,s.EQ(t,e.of))}}}function L(e){return(0,v.UI)(e,s.dO)}function B(e){return(0,f.ap)(e,s.G5)}function K(e){var t=D(e);return function(n){return function(r){return e.chain(r,s.EQ((function(){return t()}),n))}}}function $(e){var t=P(e);return function(n){return function(r){return e.chain(r,s.EQ(n,t))}}}var Y=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},F=function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},N=P(m.PM),j=(m.PM,m.of,m.PM,m.dO,m.UI(s.Uo)),W=(m.dO,m.qo,m.UA,m.PM,function(e){return function(){return Y(void 0,void 0,void 0,(function(){return F(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,e().then(S.G)];case 1:return[2,t.sent()];case 2:return t.sent(),[2,S.YP];case 3:return[2]}}))}))}}),Q=(m.PM,m.UA,m.PM,m.UA,L(m.dO)),H=B(m.Hi),V=N,J=K(m.UA),Z=(m.UA,m.PM,m.dO,s.Ri,m.dO,s.Ri,s.dO,m.dO,s.xu,m.dO,s.xu,m.dO,s.xu,m.dO,s.xu,function(e,t){return(0,i.zG)(e,Q(t))}),X=function(e,t){return(0,i.zG)(e,H(t))},ee=function(e,t){return(0,i.zG)(e,J(t))},te="TaskOption",ne={URI:te,map:Z},re={URI:te,map:Z,ap:X,chain:ee},ie=(S.F4,(0,v.YO)(ne)),oe=(0,g.a)(re),se=(S.Xl,n(3992)),ae=n(8377);const ue=(e,t)=>{const[n,o]=r.gS(a.uZ());return(0,i.zG)(t,r.UI(c.UI((t=>{a.Od(t)&&e.all().then((e=>(0,i.zG)(t,a.UI((0,ae.H5)((()=>e))),o)))}))),r.UI((e=>e()))),n},ce=(e,t)=>{let n=!1;return r.UI(c.UI((0,u.bw)((r=>{n||(n=(0,i.zG)(r,a.G((e=>{let[,t]=e;return"Pageview"===t.name}))),n&&e.trackTimeSinceInit("sdk_lifecycle_timestamps",{timestamp_name:t,time_origin:"sdk_init"}))}))))};function le(e,t){let{metrics:g,trace:v,...h}=e;return e=>y=>o.dQ((0,i.ls)((0,u.rO)({previousState:fe}),(o=>{let{stopped:u,previousState:b}=o;const w=(0,i.zG)(y.currentTimestampSecs.current,s.DT((()=>!1)));(0,i.zG)(u,r.YP((e=>e&&t.stop())));const E={...h,migratedStateMaps:b.stateMigrated?{external:s.YP,internal:s.YP}:h.migratedStateMaps(),globals:self._____workerGlobals,initialTimestampSecs:w,timeOriginMainContext:(0,_.Mc)(),metricsEnabled:g.isEnabled(),previousState:b.workerState};t.send(E),v.measureSinceInit("post_worker_config_duration").finish(),g.trackTimeSinceInit("sdk_lifecycle_timestamps",{timestamp_name:"master_sent_worker_config",time_origin:"sdk_init"},performance.now());const I=v.startSpan("worker_config_response_duration"),k=t.next();k.then((()=>{I.finish(),g.trackTimeSinceInit("sdk_lifecycle_timestamps",{timestamp_name:"master_received_worker_config_response",time_origin:"sdk_init"},performance.now())}));const S=((e,t)=>{const o=(0,i.zG)((()=>t),m.UI((e=>s.lo(!e))),J((()=>j(e()))),ie("eventsCache"),oe("eventsCacheService",(()=>(0,i.zG)((0,se.N1)(W((()=>Promise.resolve().then(n.bind(n,7476))))),Q((e=>e.eventCacheService)))))),u=o();return e=>{let{priorCachedEventsRequests:t,...n}=e;return e=>{let{previousState:o,stopped:l}=e;const f=r.a9(c.of(a.bM())),[d,p]=r.Ue({eventsToPublish:r.a9(c.of(a.bM())),priorCachedEventsResponses:f,state:r.a9(o)});return u.then(s.EQ((()=>p({eventsToPublish:n.eventsToPublish,priorCachedEventsResponses:f,state:r.a9(void 0)})),(e=>{let{eventsCache:r,eventsCacheService:i}=e;const{state:s,value:{newEvents:a}}=i({eventsCache:r,eventsToProcessOnPageUnload:n.eventsToPublishOnPageUnload,newEvents:n.eventsToPublish})({previousState:o,stopped:l});p({eventsToPublish:a,priorCachedEventsResponses:ue(r,t),state:s})}))),{state:(0,i.zG)(d,r.VS((e=>e.state))),value:(0,i.bc)((0,i.zG)(d,r.VS((e=>e.priorCachedEventsResponses))),{...n,eventsToPublish:(0,i.zG)(d,r.VS((e=>e.eventsToPublish)))})}}}})(e,k.then((e=>e.eventsCachedInWorker)));return(0,i.zG)((()=>t.read()),function(e,t){const n=e=>(0,i.zG)(e,l.Hd((e=>e in t)),(e=>{let{left:t,right:n}=e;return{buffers:n,nonBuffers:t}}));return o=>{const{buffers:s,nonBuffers:a}=n(e),[u,c]=r.Ue({...a,...(0,i.zG)(s,l.Su((e=>()=>{const n=s[e];return s[e]=t[e].empty,n})))});return(async()=>{for(;;){const e=(0,i.zG)(await o(),p.UI(n),p.ur({concat:(e,n)=>({nonBuffers:{...e.nonBuffers,...n.nonBuffers},buffers:(()=>{const r={...e.buffers};for(const e in n.buffers)r[e]=e in r?t[e].concat(r[e],n.buffers[e]):n.buffers[e];return r})()})})),r=(0,i.zG)(e.buffers,l.Su(((e,n)=>(s[e]=t[e].concat(s[e],n),()=>{const n=s[e];return s[e]=t[e].empty,n}))));c({...u.current,...e.nonBuffers,...r})}})(),(0,i.zG)(e,l.Su((e=>(0,i.zG)(u,r.UI((t=>t[e]))))))}}({activations:b.activations,cohorts:b.cohorts,context:{},eventsToPublish:a.cS,eventsToPublishOnPageUnload:a.cS,externalData:{},geoIP:s.YP,metrics:a.cS,priorCachedEventsRequests:a.cS,realtime:!1,state:b.workerState,transitionsSinceInit:{segmentsEntered:a.cS,segmentsExited:a.cS},workerStateFlushed:!1,stateMigratedThisInitialisation:!1},{eventsToPublish:a.uZ(),metrics:a.uZ(),priorCachedEventsRequests:a.uZ()}),(e=>{let{metrics:t,...n}=e;return t.onChange((e=>e().forEach((e=>g.track(e))))),n}),(e=>{let{workerStateFlushed:n,stateMigratedThisInitialisation:o,activations:p,cohorts:_,state:m,...v}=e;const{value:[h,w],state:E}=S(v)({stopped:u,previousState:b.masterEventsCache});return function(e,t,n){const o=(0,i.zG)(r.vP(t),r.UI((0,i.ls)(l.UI((e=>"function"==typeof e?e:c.of(e))),(0,f.Yt)(c.G5))));let a=o.current();e(a),(0,i.zG)(o,r.YP((t=>{const r=t(),o=(0,i.zG)(r,l.z7(((e,t)=>{var r;return t!==a[e]&&(null===(r=n[e])||void 0===r||!r.isEmpty(t))})),s.DT((0,d.ff)(l.xb)));s.pC(o)&&(a={...a,...o.value},e(o.value))})))}(t.send,{addonsLoaded:y.addonsLoaded,consent:y.consent,contextualCohorts:y.contextualCohorts,enrichmentReplacementMap:y.enrichmentReplacementMap,eventSourceId:y.eventSourceId,identities:y.identities,userId:y.userId,userIdIsNewlyGenerated:y.userIdIsNewlyGenerated,initdAddons:y.initdAddons,newEvents:(0,i.zG)(y.newEvents,ce(g,"pageview_sent_to_worker")),sessionId:y.sessionId,viewId:y.viewId,webClient:y.webClient,pageviewState:y.pageviewState,priorCachedEventsResponses:h},{newEvents:{isEmpty:a.xb},priorCachedEventsResponses:{isEmpty:a.xb}}),g.trackTimeSinceInit("sdk_lifecycle_timestamps",{timestamp_name:"master_sent_worker_input",time_origin:"sdk_init"},performance.now()),{state:r.vP({activations:p,cohorts:_,masterEventsCache:E,workerState:m,stateMigrated:(0,i.zG)(r.vP(n,o),r.Rp(b.stateMigrated,((e,t)=>{let[n,r]=t;return e||n&&r})))}),value:{...w,stateMigratedThisInitialisation:o,activations:{dfp:r.UI((e=>e.dfp),p),xandr_ssp:r.UI((e=>e.xandr_ssp),p)},cohorts:{all:r.UI((e=>e.all),_),ql:r.UI((e=>e.ql),_),qlCustom:r.UI((e=>e.qlCustom),_),qlStandard:r.UI((e=>e.qlStandard),_)}}}}))})))}const fe=e=>ge(e)?{activations:de(e.activations),cohorts:_e(e.cohorts),masterEventsCache:e.masterEventsCache,workerState:e.workerState,stateMigrated:!!e.stateMigrated}:{activations:de(null),cohorts:_e(null),masterEventsCache:null,workerState:null,stateMigrated:!1},de=e=>ge(e)?{dfp:me(e.dfp),xandr_ssp:me(e.xandr_ssp)}:pe(),pe=()=>({dfp:a.cS,xandr_ssp:a.cS}),_e=e=>ge(e)?{all:me(e.all),ql:me(e.ql),qlCustom:me(e.qlCustom),qlStandard:me(e.qlStandard)}:ve(),me=e=>Array.isArray(e)?e:a.cS,ge=e=>null!==e&&"object"==typeof e&&!Array.isArray(e),ve=()=>({all:a.cS,ql:a.cS,qlCustom:a.cS,qlStandard:a.cS})},108:(e,t,n)=>{n.r(t),n.d(t,{runCoreInWebWorker:()=>s});var r=n(3992);var i=n(2707),o=n(3735);const s=()=>{const e=(0,n(8537).Z)(),t=(e=>{const t=[],n=[],i=()=>{for(;t.length>0&&n.length>0;)n.shift()()},o=e=>new Promise((t=>{n.push((()=>t(e()))),(0,r.HJ)(i)}));return e.addEventListener("message",(0,r.GL)((e=>{null!==e.data&&(t.push(e.data),(0,r.HJ)(i))}))),{next:()=>o((()=>t.shift())),read:()=>o((()=>t.splice(0)))}})(e);return e.postMessage(null),s=>(0,o.zG)((0,r.SF)((()=>Promise.resolve().then(n.bind(n,9851)))),s.trace.traceTask("import-master"),i.fF,i.UI((n=>n.startMaster(s,{...t,send:t=>e.postMessage(t),stop:()=>e.terminate()}))))}},3931:(e,t,n)=>{n.r(t),n.d(t,{runNextGenFeatures:()=>Ze});var r=n(3735),i=n(2851),o=n(2116),s=n(3992),a=n(2884),u=n(2652);function c(e){let{messages:t}=e;const[n,r]=i.Ue(new Set);return t.on("permutive:addon:preinit",(e=>r(new Set([...n.current,e])))),n}function l(){const e=()=>Math.floor(Date.now()/1e3),[t,n]=i.Ue(e());return(0,s.UM)((()=>n(e())),1e3),t}function f(){const[e,t]=i.Ue(!1);return(0,u.aT)((()=>t(!0)),navigator.userAgent),e}var d=n(3328),p=n(2688),_=n(365),m=n(7241),g=n(2197),v=n(4923),h=n(4870),y=n(9853);const b="[PrebidJS]";function w(e){const t=(()=>{const e=["pbjs",...window._pbjsGlobals||[]];return[...new Set(e)]})();e.logger.debug(b,"Found keys",t);return o.K4((()=>(0,r.zG)(t,d.UI((0,r.ls)((e=>(e=>{const t={maxAttempts:100,waitTimeInMs:50};let n;return{windowPropertyKey:e,pbjs:(0,u.a4)((()=>n),(()=>{const t=(0,r.zG)(window,(0,u.vg)(e));return!(null==t||!t.que||"function"!=typeof(null==t?void 0:t.getEvents)||(n=t,0))}),t)}})(e)),(t=>(0,r.zG)(i.p4(t.pbjs),i.UI((n=>{const i=_.pF((n=>(n.message=`Failed to resolve key "${t.windowPropertyKey}". ${n.message}`,e.reportError(`${b} ${n.toString()}`),a.YP)));return(0,r.zG)(n,(0,u.bw)(a.UI((n=>e.logger.debug(b,`Completed check for key "${t.windowPropertyKey}"`,{result:n})))),a.UI(i),a.UI(a.UI((e=>({windowPropertyKey:t.windowPropertyKey,pbjs:e})))))})))))),(e=>i.vP(...e)),i.UI((e=>({completedChecks:e.every(a.pC),pbjsKeyPairs:e.map(a.xH)}))),i.UI((e=>{let{pbjsKeyPairs:t,completedChecks:n}=e;const i=t.filter(a.pC),[o,...s]=i;return{completedChecks:n,mainPair:o??a.YP,otherPairs:(0,r.zG)(s,d.DZ(r.yR))}})))))}const E="[Prebid Monitoring]",I=(e,t)=>{e.metrics.trackCounter({name:"sdk_prebid_monitoring_key_flag_count_total",labels:t,value:1})},k=(e,t)=>{e.metrics.trackCounter({name:"sdk_prebid_monitoring_key_bidder_flag_count_total",labels:t,value:1})},S=function(e,t){const n=P(e);return o.K4((()=>(0,r.zG)(t,i.UI((0,r.ls)(a.DT((e=>e.consent)),a.UI((e=>e.prebidJS)))),i.D8(a.Eh((0,u.Or)())),i.bw((0,r.ls)(a.tS((e=>e.completedChecks?e.mainPair:a.YP)),a.UI((t=>I(e,{flag:"prebid_main_key",prebid_key:t.windowPropertyKey}))))),i.UI(a.UI((e=>(0,r.zG)(e.mainPair,a.UI((t=>[t,...e.otherPairs])),a.fS((()=>e.otherPairs)))))),i.Rp(new Set,((t,i)=>(0,r.zG)(i,a.UI(d.hX((e=>!t.has(e.windowPropertyKey)))),a.hX(d.Od),(0,u.bw)(a.EQ((()=>e.logger.debug(E,"Nothing to report")),(t=>e.logger.debug(E,"Reporting",t)))),a.fS((()=>[])),d.UI((t=>(0,r.zG)((t=>(0,r.zG)(_.Y3((function(){var n;const{pbjs:i,windowPropertyKey:o}=t;e.logger.log(E,`Reporting on "${o}"`,t);const s=D(i);e.logger.debug(E,`Version ${i.version} parsed as`,s);const a="function"==typeof(u=i).readConfig?u.readConfig():u.getConfig();var u;e.logger.debug(E,"Read config",a);const c=(0,r.zG)((null===(n=a.realTimeData)||void 0===n?void 0:n.dataProviders)??[],d.Ew((e=>"permutive"===e.name)));return e.logger.debug(E,"Read data provider config",c),{pbjs:i,config:a,dataProviderConfig:c,installedModules:i.installedModules||[],version:s,windowPropertyKey:o}}),p.w),_.ak("bidders",(e=>n.acBidders(e))),_.ak("permutiveRTDProvider",(e=>n.permutiveRTDProvider(e))),_.ak("consent",(e=>n.consent(e))),_.ak("targeting",(e=>n.targeting(e)))))(t),_.Pd((n=>e.reportError(`[Prebid Monitoring] Failed to report pair "${t.windowPropertyKey}", ${n.message}`)),(()=>t.windowPropertyKey))))),d.hp,(e=>new Set([...t,...e]))))),(e=>({reportedKeys:e})))))};const P=e=>({acBidders:t=>_.Y3((()=>{(0,y.Hn)("prebid")("data_provider_config",{ac_bidders:[]});const n=[],i=(0,r.zG)(t.dataProviderConfig,a.UI((e=>{var t;return(null==e||null===(t=e.params)||void 0===t?void 0:t.acBidders)??[]})),a.fS((()=>[]))),o=[...new Set([...n,...i])];return e.logger.debug(E,"Determined acBidders as",{acBidders:o,dynamicBidders:n,staticBidders:i}),o.forEach((n=>{k(e,{flag:"prebid_ac_bidder",prebid_key:t.windowPropertyKey,prebid_bidder:n})})),{acBidders:o,dynamicBidders:n,readBidders:i}}),p.w),consent:t=>_.Y3((()=>{var n,r,i,o,s,a;const u=t.windowPropertyKey;t.config.consentManagement&&"object"==typeof t.config.consentManagement&&I(e,{prebid_key:u,flag:"prebid_has_consent_management"});const c=t.installedModules.includes("gdprEnforcement");c&&I(e,{prebid_key:u,flag:"prebid_gdpr_enforcement_module"});const l=(null===(n=t.config)||void 0===n||null===(r=n.consentManagement)||void 0===r||null===(i=r.gdpr)||void 0===i||null===(o=i.rules)||void 0===o||null===(s=o.find((e=>"storage"===(null==e?void 0:e.purpose))))||void 0===s||null===(a=s.vendorExceptions)||void 0===a?void 0:a.includes("permutive"))||!1;return l&&I(e,{prebid_key:u,flag:"prebid_storage_exception"}),{hasGDPREnforcementModule:c,addedAsStorageException:l}}),p.w),permutiveRTDProvider:t=>_.Y3((()=>{const n=t.installedModules.includes("permutiveRtdProvider");return n&&I(e,{prebid_key:t.windowPropertyKey,flag:"prebid_permutive_rtd"}),n}),p.w),targeting:t=>{const n=(0,r.ls)(d.UI((e=>[e,null])),v.sq),i=(t,n)=>(0,r.zG)(t,(0,u.bw)((t=>e.logger.debug(E,`Processing ${t.length} bidder request(s)`,t))),d.hX((e=>n.hasOwnProperty(e.bidderCode)&&null===n[e.bidderCode])),m.vM((e=>e.bidderCode)),v.DZ(d.f2((0,u.lo)([[e=>(e=>{var t,n,r;const i=null==e||null===(t=e.user)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.find((e=>"permutive.com"===e.name));return!(null==i||null===(r=i.segment)||void 0===r||!r.length)})(e.ortb2),()=>a.G("ortb2")],[e=>{return t=e.params,["permutive","p_standard"].some((e=>{var n,r,i,o;return(null==t||null===(n=t.visitor)||void 0===n||null===(r=n[e])||void 0===r?void 0:r.length)||(null==t||null===(i=t.keywords)||void 0===i||null===(o=i[e])||void 0===o?void 0:o.length)}));var t},()=>a.G("params")],()=>a.YP]))),(0,u.bw)((t=>e.logger.debug(E,"Bidders targeting method's updated",t)))),o=o=>{e.logger.debug(E,"Bidders found with no targeting method",o);let s=n(o);const a=n=>(0,r.zG)(i([n],s),(0,u.bw)((e=>{s={...s,...e}})),(0,u.bw)(v.Su(((n,r)=>k(e,{flag:`prebid_${r}_targeting_success`,prebid_key:t.windowPropertyKey,prebid_bidder:n})))),(0,u.bw)((()=>{Object.values(s).includes(null)||(e.logger.debug(E,`Cleaning up "bidRequested" listener for ${t.windowPropertyKey}`),t.pbjs.offEvent("bidRequested",a))})));t.pbjs.onEvent("bidRequested",a)};return _.Y3((()=>{const s=(0,r.zG)(t.pbjs.getEvents(),d.DZ((0,r.ls)(a.DT((e=>"bidRequested"===e.eventType)),a.UI((0,u.vg)("args")))));return(0,r.zG)(t.bidders.acBidders,a.DT(d.Od),a.EQ((()=>e.logger.debug(E,"No bidders for targeting")),(0,r.ls)(n,(e=>({...e,...i(s,e)})),v.uK(g.ff((e=>null===e))),h.Pd((0,r.ls)(v.XP,a.DT(d.Od),a.UI(o)),v.Su(((n,r)=>k(e,{prebid_bidder:n,prebid_key:t.windowPropertyKey,flag:`prebid_${r}_targeting_success`})))))))}),p.w)}}),D=e=>{const[t,n,r]=e.version.split("-")[0].replace("v","").split(".").map((e=>parseInt(e)));return{major:t,minor:n,patch:r}},U=function(e,t){const n=(0,r.zG)(t.pbjs,i.VS((0,r.ls)(a.tS(a.KQ((e=>{var t;return null===(t=e.getUserIdsAsync)||void 0===t?void 0:t.call(e).then((()=>{var t;return(null===(t=e.getUserIdsAsEids)||void 0===t?void 0:t.call(e))??[]}))}))),a.UI(i.p4),a.fS((()=>i.a9(a.YP))))),i.UI(a.tS(a.Uo)),i.bw(a.mU((t=>(t.length>0?t.forEach((t=>{e.metrics.trackCounter({name:"sdk_prebid_alternative_identifiers_count_total",labels:{alternative_user_id_name:t.source},value:1})})):e.metrics.trackCounter({name:"sdk_prebid_alternative_identifiers_count_total",labels:{identifier:"NONE"},value:1}),a.YP))))),s=(0,r.zG)(t.pbjs,i.UI(a.tS(a.KQ((e=>{var t;return null===(t=e.getUserIdsAsEids)||void 0===t?void 0:t.call(e)})))));return o.K4((()=>(0,r.zG)(i.vP(n,s),i.UI((e=>{let[t,n]=e;return(0,r.zG)(t,a.wp((()=>n)))})),i.UI((0,r.ls)(a.UI(d.DZ((e=>{var t,n;return"string"==typeof(null===(t=e.uids)||void 0===t||null===(n=t[0])||void 0===n?void 0:n.id)?a.G((0,r.bc)(e.source,{id:e.uids[0].id})):a.YP}))),a.tS(m.c2),a.UI(v.sq))),i.bw((t=>{a.pC(t)&&e.logger.debug("[Prebid Identifiers]","Found identifiers",t.value)})))))};var G=n(2097);const z=new Set(["AdRequest","Reaction","PageviewEngagement","SegmentEntry","SegmentExit"]);class O{events;listeners;static highVolumeEvents=(()=>{const e=new Set([...z]);return e.delete("Reaction"),e})();constructor(){this.events=[],this.listeners=[]}newEvent(e,t){O.highVolumeEvents.has(e.name)||this.events.push([e,t]),[...this.listeners].forEach((n=>{this.handle(e,t,n)}))}addListener(e){this.listeners.push(e);const t={replay:()=>(this.replay(e),t),remove:()=>(this.remove(e),t)};return t}handle(e,t,n){const r="string"==typeof n.name&&e.name===n.name,i=n.name.test&&n.name.test(e.name),o=r||i;if(o)try{n.callback(e,t)}catch(e){window.console&&window.console.error&&window.console.error("callback error: ",e)}o&&n.once&&this.remove(n)}replay(e){let t=-1!==this.listeners.indexOf(e);for(let n=0;n<this.events.length&&t;n++)this.handle(this.events[n][0],this.events[n][1],e),t=-1!==this.listeners.indexOf(e)}remove(e){const t=this.listeners.indexOf(e);-1!==t&&this.listeners.splice(t,1)}}var C=n(6392),T=n(1828);var x=n(8377),M=n(2707),A=n(7407);const R="[Event Upload]",q=(e,t,n,a)=>o.dQ((o=>{let{stopped:c,previousState:l}=o;Array.isArray(l)&&(0,r.zG)(l,Y(e))();const f=new Set([...z]),[p,{appendUntrackedEvents:m,appendUploadResults:g}]=(0,r.zG)((()=>{const[e,t]=i.gS(d.uZ()),[n,o]=i.gS(d.uZ());return(0,r.bc)({uploadResults:e,untrackedEvents:n},{appendUploadResults:t,appendUntrackedEvents:o})})(),(0,x.pL)((0,r.ls)((function(e){const[t,n]=(0,r.zG)(e.uploadResults,F(d.bj));return{...e,uploadResults:t,erroredEventsAsJSON:n}}),(function(e){const[t,n]=(0,r.zG)(e.erroredEventsAsJSON,F(d.UI((0,x.H5)((0,u.rO)({event:(0,u.rO)({time:e=>new Date(e)})})))));return{...e,erroredEventsAsJSON:t,erroredEvents:n}}),(function(e){let{uploadResults:t,untrackedEvents:n,...o}=e;const s=(0,r.zG)(t,i.UI(C.UI((0,r.ls)(d.hp,d.UI((0,x.H5)((0,u.rO)({time:e=>new Date(e)}))))))),a=(0,r.zG)(i.vP(s,n),i.UI(C.RD),i.UI(C.UI((e=>{let[t,n]=e;return n.concat(t)}))));return{...o,successEvents:a}}),(function(e){const[t,n]=(0,r.zG)(e.successEvents,F(d.UI((0,x.H5)((0,u.rO)({time:e=>e.toISOString()})))));return{...e,successEvents:t,successEventsAsJSON:n}})))),[v,h]=i.Ue(0),[y,b]=i.Ue(0),w=(0,r.zG)(t,i.UI(C.UI((e=>(0,r.zG)(e,d.uK((e=>{let[,t]=e;return!f.has(t.event.name)})),(e=>{let{left:t,right:n}=e;return(0,r.zG)(t,d.UI((0,x.H5)((e=>e.event))),m),n}))))),i.UI(C.UI((e=>(e.length>0&&((0,s.HJ)((()=>h(v.current+e.length)),500),(0,s.HJ)((()=>b(y.current+e.length)),5e3)),e))))),E=e=>t=>(0,r.zG)(e,d.hX((e=>{let[n]=e;return!t.closeEventsProcessed.includes(n)})),d.zo(t.queue)),I=(0,r.zG)(i.vP(v,y,w,n,c,a),i.Rp({closeEventsProcessed:d.cS,noQueueItemsProcessed:0,queue:d.cS},((t,n)=>{let[i,o,s,a,c,l]=n;return c?t:(0,r.zG)(t,(0,u.rO)({queue:d.zo(s())}),(t=>l?(0,r.zG)(t,(t=>n=>(0,r.zG)(n,E(t),$(e),(0,u.rO)({right:(0,u.bw)((0,r.ls)(d.UI((0,r.ls)((0,x.H5)((0,u.rO)({time:e=>e.toISOString()})),_.F2)),g))}),(e=>{let{left:t,right:i}=e;return(0,r.zG)(n,(0,u.rO)({closeEventsProcessed:(0,r.zG)(i,d.UI(x.li),d.zo),queue:(0,r.zG)(t.map(x.li),(e=>new Set(e)),(e=>d.hX((t=>{let[n]=t;return e.has(n)})))),noQueueItemsProcessed:e=>e+n.queue.length}))})))(a)):o>t.noQueueItemsProcessed||i===t.noQueueItemsProcessed+t.queue.length?(t=>((0,r.zG)(t.queue,Y(e),A.UI(g))(),{closeEventsProcessed:t.closeEventsProcessed,noQueueItemsProcessed:t.noQueueItemsProcessed+t.queue.length,queue:d.cS}))(t):t))}))),k=(0,r.zG)(n,i.UI(E),i.ap(I),i.D8(d.Eh({equals:(e,t)=>e[0]===t[0]})));return{state:k,value:p}})),L=(e,t)=>e.permutiveUrls.getEndpointUrl("/batch/events",a.G(e.config.apiVersion),[["enrich",JSON.stringify(t.requiresEnrichment)],["sdkp",JSON.stringify(t.sdkProcessed)]]),B=e=>(0,r.zG)(e.events,d.UI((0,r.ls)(x.Yg,(e=>e.event)))),K=(0,r.ls)(m.vM((e=>{let[t,n]=e;return`${n.requiresEnrichment}${n.sdkProcessed}`})),(e=>Object.values(e)),d.UI((e=>({requiresEnrichment:e[0][1].requiresEnrichment,events:e,sdkProcessed:e[0][1].sdkProcessed})))),$=e=>(0,r.ls)(K,d.YO("request"),d.Hr("success",(t=>{let{request:n}=t;return e.logger.debug(R,"Uploading via beacon",n),e.permutiveApi.reqWithBeacon({url:L(e,n),payload:B(n)})})),d.tS((e=>(0,r.zG)(e.request.events,d.UI((t=>{let[n,{event:i}]=t;return e.success?_.F2((0,r.bc)(n,i)):_.t$((0,r.bc)(n,i))}))))),d.UI((0,u.bw)(_.EQ((t=>{let[,n]=t;return e.metrics.trackCounter({name:"sdk_event_beacon_fail_count_total",labels:{event_name:n.name},value:1})}),(t=>{let[,n]=t;return e.metrics.trackCounter({name:"sdk_event_beacon_success_count_total",labels:{event_name:n.name},value:1})})))),d.oh),Y=e=>t=>(0,r.zG)(K(t),A.uU((t=>(0,r.zG)(t,(e=>t=>(e.logger.debug(R,"Uploading",t),M.Y3((()=>e.permutiveApi.req({payload:B(t),url:L(e,t),method:"POST",contentType:"text/plain",dataType:"json",withCredentials:!1})),(t=>(e.reportError(`Error sending events batch. Got ${_.KC(t)}`),t)))))(e),M.UI(d.UI((e=>e.body))),M.EQ((e=>(0,r.zG)(t.events,d.UI((()=>_.t$(e))))),d.UI(_.F2)),A.UI(d.$R(t.events))))),A.UI(d.tS(d.UI((t=>{let[n,[i,{event:o}]]=t;return(0,r.zG)(n,_.EQ((e=>_.t$((0,r.bc)(i,{event:{...o,time:o.time.toISOString()},error:e}))),(e=>"request_id"in e?_.t$((0,r.bc)(i,{event:{...o,time:o.time.toISOString()},error:e})):_.F2((0,r.bc)(i,{...o,id:e.id,time:e.time})))),(0,u.bw)(_.EQ((t=>{let[,{event:n}]=t;return e.metrics.trackCounter({name:"sdk_event_upload_fail_count_total",labels:{event_name:n.name},value:1})}),(t=>{let[,n]=t;return e.metrics.trackCounter({name:"sdk_event_upload_success_count_total",labels:{event_name:n.name},value:1})}))))}))))),F=e=>t=>(0,r.zG)(t,i.En(2,d.uZ()),(0,x.H5)(i.UI(C.UI(e)))),N=(e,t,n,s)=>(0,r.zG)(o.K4((()=>{const[e,t]=i.Ue(i.a9(C.of([])));return{eventsToPublishBufferRef:i.xH(e),publishEvents:n=>{(0,r.zG)(i.vP(e.current,n),i.UI(C.RD),i.UI(C.UI(d.xH)),t)}}})),o.ak("eventUpload",(t=>{let{eventsToPublishBufferRef:r}=t;return q(e,r,n,s)})),o.ak("eventHandler",(e=>{let{eventUpload:t}=e;return n=t.successEventsAsJSON,s=t.erroredEventsAsJSON,o.K4((()=>{const e=new O;return(0,r.zG)(n,i.UI((e=>e())),i.bw((t=>t.forEach((t=>{let[,n]=t;return e.newEvent(n,null)}))))),(0,r.zG)(s,i.UI((e=>e())),i.bw((t=>t.forEach((t=>{let[,{event:n,error:r}]=t;return e.newEvent(n,r)}))))),{eventHandlerAfterUpload:e}}));var n,s})),o.ak("eventResolver",(e=>{let{eventUpload:n}=e;return((e,t,n,s)=>o.K4((()=>{(0,r.zG)(i.vP({unresolvedEvents:t,erroredEvents:s,successEvents:n}),i.UI((0,T.Yt)(C.G5)),i.Rp({},((e,t)=>{const n=t();return(0,r.zG)(n.unresolvedEvents,a.DT(d.Od),a.UI((0,r.ls)(v.sq,(t=>({...e,...t})))),a.fS((()=>e)),(e=>(0,r.zG)(n.successEvents,d.u4(e,((e,t)=>{let[n,i]=t;return(0,r.zG)(v.P5(n,e),a.UI((t=>(t.succeed(i),v.EG(n)(e)))),a.fS((()=>e)))})))),(e=>(0,r.zG)(n.erroredEvents,d.u4(e,((e,t)=>{let[n,{event:i,error:o}]=t;return(0,r.zG)(v.P5(n,e),a.UI((t=>(t.fail(`Failed to track ${i.name}. ${"error"in o?o.error.message:o.message}`),v.EG(n)(e)))),a.fS((()=>e)))})))))})))})))(0,t,n.successEvents,n.erroredEvents)})),o.UI((e=>{let{publishEvents:t,eventHandler:n}=e;return{eventHandlerAfterUpload:n.eventHandlerAfterUpload,publishEvents:t}}))),j="_pnativo",W=function(e){let{externalData:t}=e;return o.K4((()=>{t.removeExternalData(j)}))};var Q,H,V,J,Z,X=-1,ee=function(e){addEventListener("pageshow",(function(t){t.persisted&&(X=t.timeStamp,e(t))}),!0)},te=function(){return window.performance&&performance.getEntriesByType&&performance.getEntriesByType("navigation")[0]},ne=function(){var e=te();return e&&e.activationStart||0},re=function(e,t){var n=te(),r="navigate";return X>=0?r="back-forward-cache":n&&(document.prerendering||ne()>0?r="prerender":document.wasDiscarded?r="restore":n.type&&(r=n.type.replace(/_/g,"-"))),{name:e,value:void 0===t?-1:t,rating:"good",delta:0,entries:[],id:"v3-".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12),navigationType:r}},ie=function(e,t,n){try{if(PerformanceObserver.supportedEntryTypes.includes(e)){var r=new PerformanceObserver((function(e){Promise.resolve().then((function(){t(e.getEntries())}))}));return r.observe(Object.assign({type:e,buffered:!0},n||{})),r}}catch(e){}},oe=function(e,t,n,r){var i,o;return function(s){t.value>=0&&(s||r)&&((o=t.value-(i||0))||void 0===i)&&(i=t.value,t.delta=o,t.rating=function(e,t){return e>t[1]?"poor":e>t[0]?"needs-improvement":"good"}(t.value,n),e(t))}},se=function(e){requestAnimationFrame((function(){return requestAnimationFrame((function(){return e()}))}))},ae=function(e){var t=function(t){"pagehide"!==t.type&&"hidden"!==document.visibilityState||e(t)};addEventListener("visibilitychange",t,!0),addEventListener("pagehide",t,!0)},ue=function(e){var t=!1;return function(n){t||(e(n),t=!0)}},ce=-1,le=function(){return"hidden"!==document.visibilityState||document.prerendering?1/0:0},fe=function(e){"hidden"===document.visibilityState&&ce>-1&&(ce="visibilitychange"===e.type?e.timeStamp:0,pe())},de=function(){addEventListener("visibilitychange",fe,!0),addEventListener("prerenderingchange",fe,!0)},pe=function(){removeEventListener("visibilitychange",fe,!0),removeEventListener("prerenderingchange",fe,!0)},_e=function(){return ce<0&&(ce=le(),de(),ee((function(){setTimeout((function(){ce=le(),de()}),0)}))),{get firstHiddenTime(){return ce}}},me=function(e){document.prerendering?addEventListener("prerenderingchange",(function(){return e()}),!0):e()},ge=[1800,3e3],ve=[.1,.25],he=function(e,t){t=t||{},function(e,t){t=t||{},me((function(){var n,r=_e(),i=re("FCP"),o=ie("paint",(function(e){e.forEach((function(e){"first-contentful-paint"===e.name&&(o.disconnect(),e.startTime<r.firstHiddenTime&&(i.value=Math.max(e.startTime-ne(),0),i.entries.push(e),n(!0)))}))}));o&&(n=oe(e,i,ge,t.reportAllChanges),ee((function(r){i=re("FCP"),n=oe(e,i,ge,t.reportAllChanges),se((function(){i.value=performance.now()-r.timeStamp,n(!0)}))})))}))}(ue((function(){var n,r=re("CLS",0),i=0,o=[],s=function(e){e.forEach((function(e){if(!e.hadRecentInput){var t=o[0],n=o[o.length-1];i&&e.startTime-n.startTime<1e3&&e.startTime-t.startTime<5e3?(i+=e.value,o.push(e)):(i=e.value,o=[e])}})),i>r.value&&(r.value=i,r.entries=o,n())},a=ie("layout-shift",s);a&&(n=oe(e,r,ve,t.reportAllChanges),ae((function(){s(a.takeRecords()),n(!0)})),ee((function(){i=0,r=re("CLS",0),n=oe(e,r,ve,t.reportAllChanges),se((function(){return n()}))})),setTimeout(n,0))})))},ye={passive:!0,capture:!0},be=new Date,we=function(e,t){Q||(Q=t,H=e,V=new Date,ke(removeEventListener),Ee())},Ee=function(){if(H>=0&&H<V-be){var e={entryType:"first-input",name:Q.type,target:Q.target,cancelable:Q.cancelable,startTime:Q.timeStamp,processingStart:Q.timeStamp+H};J.forEach((function(t){t(e)})),J=[]}},Ie=function(e){if(e.cancelable){var t=(e.timeStamp>1e12?new Date:performance.now())-e.timeStamp;"pointerdown"==e.type?function(e,t){var n=function(){we(e,t),i()},r=function(){i()},i=function(){removeEventListener("pointerup",n,ye),removeEventListener("pointercancel",r,ye)};addEventListener("pointerup",n,ye),addEventListener("pointercancel",r,ye)}(t,e):we(t,e)}},ke=function(e){["mousedown","keydown","touchstart","pointerdown"].forEach((function(t){return e(t,Ie,ye)}))},Se=[100,300],Pe=0,De=1/0,Ue=0,Ge=function(e){e.forEach((function(e){e.interactionId&&(De=Math.min(De,e.interactionId),Ue=Math.max(Ue,e.interactionId),Pe=Ue?(Ue-De)/7+1:0)}))},ze=function(){return Z?Pe:performance.interactionCount||0},Oe=function(){"interactionCount"in performance||Z||(Z=ie("event",Ge,{type:"event",buffered:!0,durationThreshold:0}))},Ce=[200,500],Te=0,xe=function(){return ze()-Te},Me=[],Ae={},Re=function(e){var t=Me[Me.length-1],n=Ae[e.interactionId];if(n||Me.length<10||e.duration>t.latency){if(n)n.entries.push(e),n.latency=Math.max(n.latency,e.duration);else{var r={id:e.interactionId,latency:e.duration,entries:[e]};Ae[r.id]=r,Me.push(r)}Me.sort((function(e,t){return t.latency-e.latency})),Me.splice(10).forEach((function(e){delete Ae[e.id]}))}},qe=[2500,4e3],Le={};const Be=function(e){let t=0;const n=n=>{if(0===t)return;const r=Ke(n);r&&e.metrics.track({name:`sdk_web_vitals_${r.suffix}`,labels:{},value:r.value})},s=(0,u.HP)((()=>{he(n),function(e,t){t=t||{},me((function(){var n,r=_e(),i=re("LCP"),o=function(e){var t=e[e.length-1];t&&t.startTime<r.firstHiddenTime&&(i.value=Math.max(t.startTime-ne(),0),i.entries=[t],n())},s=ie("largest-contentful-paint",o);if(s){n=oe(e,i,qe,t.reportAllChanges);var a=ue((function(){Le[i.id]||(o(s.takeRecords()),s.disconnect(),Le[i.id]=!0,n(!0))}));["keydown","click"].forEach((function(e){addEventListener(e,a,!0)})),ae(a),ee((function(r){i=re("LCP"),n=oe(e,i,qe,t.reportAllChanges),se((function(){i.value=performance.now()-r.timeStamp,Le[i.id]=!0,n(!0)}))}))}}))}(n),function(e,t){t=t||{},me((function(){var n,r=_e(),i=re("FID"),o=function(e){e.startTime<r.firstHiddenTime&&(i.value=e.processingStart-e.startTime,i.entries.push(e),n(!0))},s=function(e){e.forEach(o)},a=ie("first-input",s);n=oe(e,i,Se,t.reportAllChanges),a&&ae(ue((function(){s(a.takeRecords()),a.disconnect()}))),a&&ee((function(){var r;i=re("FID"),n=oe(e,i,Se,t.reportAllChanges),J=[],H=-1,Q=null,ke(addEventListener),r=o,J.push(r),Ee()}))}))}(n),function(e,t){t=t||{},me((function(){Oe();var n,r=re("INP"),i=function(e){e.forEach((function(e){e.interactionId&&Re(e),"first-input"===e.entryType&&!Me.some((function(t){return t.entries.some((function(t){return e.duration===t.duration&&e.startTime===t.startTime}))}))&&Re(e)}));var t,i=(t=Math.min(Me.length-1,Math.floor(xe()/50)),Me[t]);i&&i.latency!==r.value&&(r.value=i.latency,r.entries=i.entries,n())},o=ie("event",i,{durationThreshold:t.durationThreshold||40});n=oe(e,r,Ce,t.reportAllChanges),o&&(o.observe({type:"first-input",buffered:!0}),ae((function(){i(o.takeRecords()),r.value<0&&xe()>0&&(r.value=0,r.entries=[]),n(!0)})),ee((function(){Me=[],Te=ze(),r=re("INP"),n=oe(e,r,Ce,t.reportAllChanges)})))}))}(n)}));return o.K4((n=>{let{stopped:o}=n;t++,(0,r.zG)(o,i.YP((e=>{e&&t--}))),e.metrics.isEnabled()&&s()}))};const Ke=e=>(e=>"CLS"===e.name)(e)?{value:e.value,suffix:`${e.name.toLowerCase()}_score`}:(e=>["INP","FID","LCP"].includes(e.name))(e)?{value:e.value/1e3,suffix:`${e.name.toLowerCase()}_seconds`}:void 0;var $e=n(926);const Ye=(e,t)=>{const{activationManager:n,externalData:s,metrics:a,permutiveData:u}=e;return(0,r.zG)(o.of({}),o.ak("psegs",(()=>((e,t)=>o.K4((n=>{let{stopped:o}=n;const s="_psegs";(0,r.zG)(i.vP(t,o),i.YP((t=>{let[n,i]=t;i||(0,r.zG)(n,d.EQ((()=>e.removeExternalData(s)),(t=>e.setExternalJsonData(s,t))))})))})))(e.externalData,t.qlSegments))),o.ak("webVitals",(()=>Be(e))),o.ak("nativo",(()=>W({activationManager:n,externalData:s,metrics:a,queryLanguageCohorts:t.qlSegments,...t}))),o.ak("twitterPixel",(()=>(0,$e.eJ)({activationManager:n,metrics:a,permutiveData:u,queryLanguageCohorts:t.qlSegments,...t}))),o.ak("prebidJS",(()=>w(e))))};var Fe=n(5619);const Ne=()=>{const[e,t]=i.gS(d.uZ());return{trackEvent:e=>{let n,r,{event:i,useBeacon:o}=e;const s=new Promise(((e,t)=>{n=e,r=t}));return t([{localId:(0,u.k$)(),event:i,fail:r,succeed:n,useBeacon:o}]),s},trackedEvents:e}};n(4564);const je=function(e,t){return o.K4((()=>({addon:()=>({}),cohorts:i.a9(a.YP)})))};const We=(e,t)=>o.vP({contextual:je(e,t)}),Qe=function(e,t,n){return o.of({replacementMap:i.a9(a.of({$privacy_sandbox_topics_v2:[]}))})};i.a9([]),i.a9([]),i.a9([]),i.a9(Fe.b()),i.a9(a.YP),i.a9({segmentsEntered:[],segmentsExited:[]}),i.a9(!1),i.a9((e=>{let{event:t}=e;return Promise.resolve(t)})),new O,i.a9(a.YP),i.a9(!1);function He(e,t,n){const{addonsLoaded:c,consent:l,currentTimestampSecs:f,enabledAddons:p,identities:_,sdkVariant:m,sessionId:g,userId:v,userIdIsNewlyGenerated:h,viewId:y,pageviewState:b}=t,[w,E]=(0,r.zG)(i.Ue(i.a9(d.cS)),(e=>{let[t,n]=e;return[i.xH(t),n]})),I=a.ij(e.permutiveData.getData("event-source-id")),k=(0,r.zG)(v,i.Rp(-1,(e=>e+1)),i.UI((t=>(0,r.zG)(I,a.hX((()=>0===t)),a.fS((()=>{const t=(0,u.k$)();return e.permutiveData.setData("event-source-id",t),t}))))));return(0,r.zG)(o.vP({computeTimeMetrics:(P=e.metrics,o.K4((e=>{let{stopped:t}=e;const n=(0,s.HJ)((()=>{(0,r.zG)((0,s.iE)(),(0,u.bw)((()=>(0,s.ho)(!1))),d.UI((e=>{let[t,n]=e;return(n-t)/1e3})),(e=>{P.track({name:"sdk_ui_thread_compute_first10s_total_seconds",value:e.reduce(((e,t)=>e+t),0),labels:{}}),P.track({name:"sdk_ui_thread_compute_first10s_total_task_overrun_seconds",value:(0,r.zG)(e,d.hX((e=>e>.05)),d.UI((e=>e-.05)),d.u4(0,((e,t)=>e+t))),labels:{}}),P.track({name:"sdk_ui_thread_compute_first10s_longest_task_seconds",value:Math.max(0,...e),labels:{}})}))}),1e4);(0,r.zG)(t,i.YP((e=>e&&n())))}))),audiences:We(e,t),privacySandboxTopics:Qe(e,g,l)}),o.UI((e=>{const{reset:t,trackEvent:n,trackedEvents:o}=((e,t)=>{const[n,o]=i.Ue(0),s=(0,r.zG)(i.vP(n,t),i.UI((()=>[]))),a=(0,r.zG)(i.vP(s,e),i.D8(((e,t)=>{let[,n]=e,[,r]=t;return n===r})),i.UI((e=>{let[t]=e;const n=Ne();return t.forEach(n.trackEvent),n})));return{reset:()=>o(n.current+1),trackEvent:(0,r.zG)(i.vP(a,s),i.UI((e=>{let[t,n]=e;return e=>(n.push(e),t.trackEvent(e))}))),trackedEvents:(0,r.zG)(a,i.VS((e=>e.trackedEvents)))}})(v,y),[s,a,u]=(0,r.zG)(o,i.En(3,d.uZ()));return{...e,reset:t,trackEvent:n,unresolvedEvents:(0,r.zG)(s,i.UI(C.UI(d.UI((e=>(0,r.bc)(e.localId,{fail:e.fail,succeed:e.succeed})))))),eventsToProcessLocally:(0,r.zG)(a,i.UI(C.UI(d.hX((e=>!e.useBeacon))))),eventsToUploadViaBeacon:(0,r.zG)(u,i.UI(C.UI(d.hX((e=>e.useBeacon)))))}})),o.ak("eventPublication",(n=>{let{unresolvedEvents:r}=n;return N(e,r,w,t.sdkClosing)})),o.ak("webClient",(()=>o.K4((()=>(0,r.zG)(y,i.VS((()=>(0,r.zG)(f,i.VS((()=>i.p4(e.clientContext.getClient()))),i.Rp(a.YP,((e,t)=>(0,r.zG)(t,a.tS(a.Uo),a.hX((t=>a.Wi(e)||t!==e.value)),a.wp((()=>e))))),i.D8(a.Eh({equals:(e,t)=>e===t||JSON.stringify(e)===JSON.stringify(t)})))))))))),o.ak("core",(t=>{let{audiences:s,eventPublication:u,eventsToProcessLocally:m,privacySandboxTopics:w,webClient:I}=t;return(0,r.zG)(n({contextualCohorts:s.contextual.cohorts,addonsLoaded:c,consent:l,currentTimestampSecs:f,enrichmentReplacementMap:w.replacementMap,eventSourceId:k,identities:_,initdAddons:p,newEvents:(0,r.zG)(m,i.UI(C.UI(d.UI((e=>(0,r.bc)(e.localId,e.event)))))),sessionId:g,userId:v,userIdIsNewlyGenerated:h,viewId:y,webClient:I,pageviewState:b}),o.bw((e=>{let{eventsToPublish:t}=e;return(0,r.zG)(t,i.UI(C.UI(Ve)),u.publishEvents)})),o.bw((e=>{let{eventsToPublishOnPageUnload:t}=e;return(0,r.zG)(t,i.UI(Ve),E)})),o.bw((t=>{let{externalData:n}=t;return(0,r.zG)(n,i.UI((t=>(0,r.zG)(Object.entries(t),d.UI((t=>{let[n,i]=t;return(0,r.zG)(i,a.EQ((()=>e.externalData.removeExternalData(n)),(t=>e.externalData.setExternalJsonData(n,t))))}))))))})),o.bw((t=>{let{context:n}=t;return(0,r.zG)(n,i.UI((t=>{const n=Object.entries(t);e.clientContext.updateContext(...n)})))})))})),o.bw((e=>{let{core:t,eventPublication:n,eventsToUploadViaBeacon:o,webClient:s}=e;return(0,r.zG)(i.vP({cohorts:t.cohorts.all,eventsIO:o,segments:t.cohorts.ql,sessionId:g,userId:v,viewId:y,webClient:s}),i.UI((e=>{let{webClient:t,...n}=e;return(0,r.zG)(t,a.UI((e=>({...n,webClient:e}))))})),i.UI(a.EQ((()=>C.of(d.bM())),(e=>{let{cohorts:t,eventsIO:n,segments:i,sessionId:o,userId:s,viewId:a,webClient:u}=e;return(0,r.zG)(n,C.UI(d.UI((e=>{let{event:n,localId:c}=e;return(0,r.bc)(c,{requiresEnrichment:!0,sdkProcessed:!1,event:{user_id:s,name:n.name,segments:i,cohorts:t,properties:{...n.properties,client:{...u,...n.properties.client??{}}},session_id:o,time:new Date,view_id:a}})}))))}))),n.publishEvents)})),o.ak("metricContext",(e=>{let{core:n}=e;return(0,r.zG)(n.geoIP,i.UI(a.tS((e=>{var t;return a.ij(null===(t=e.geo_info)||void 0===t?void 0:t.continent)}))),(e=>Fe.X({continent:e,sampleRate:t.metricSampleRate,sdkVariant:m,sessionId:g,userId:v,viewId:y})))})),o.ak("sdkql",(t=>{let{core:n}=t;return Ye(e,{addonsLoaded:c,consent:l,initdAddons:p,qlSegments:n.cohorts.ql})})),o.ak("strategicPartnerships",(t=>{let{sdkql:n}=t;return((e,t)=>o.vP({prebid_identifiers:U(e,t)}))(e,{pbjs:(0,r.zG)(n.prebidJS,i.UI((e=>(0,r.zG)(e.mainPair,a.UI((e=>e.pbjs))))))})})),o.ak("mediaAndEntertainment",(t=>{let{core:n}=t;return((e,t)=>(0,r.zG)(o.vP({freewheel:(0,G.freewheelService)({activationManager:e.activationManager,externalData:e.externalData,...t})}),o.UI((0,r.a9)({}))))(e,{addonsLoaded:c,consent:l,initdAddons:p,queryLanguageCohorts:n.cohorts.ql})})),o.ak("advertisers",(t=>{let{sdkql:n}=t;return((e,t)=>(0,r.zG)(o.of(t),o.ak("prebidMonitoring",(t=>{let{consent:n,prebidJS:r}=t;return S(e,i.vP({consent:n,prebidJS:r}))})),o.UI(r.Q1)))(e,{consent:l,prebidJS:n.prebidJS})})),o.UI((e=>{let{core:t,audiences:n,metricContext:r,sdkql:o,trackEvent:s,eventPublication:a,strategicPartnerships:u,reset:c}=e;return{activations:t.activations,addons:{contextual:n.contextual.addon},metricContext:r,pbjsPair:i.UI((e=>e.mainPair),o.prebidJS),queryLanguageCohorts:{all:t.cohorts.ql,custom:t.cohorts.qlCustom,standard:t.cohorts.qlStandard},segmentTransitionsSinceInit:t.transitionsSinceInit,trackEvent:s,realtime:t.realtime,eventHandlerAfterUpload:a.eventHandlerAfterUpload,prebidIdentifiers:u.prebid_identifiers,reset:c,stateMigratedThisInitialisation:t.stateMigratedThisInitialisation}})));var P}const Ve=d.UI((0,x.H5)((e=>({event:e,requiresEnrichment:!1,sdkProcessed:!0}))));function Je(e){return(0,r.ls)((0,u.rO)({previousState:e=>{if("string"!=typeof e)return{};try{return JSON.parse(e)}catch{return{}}}}),e,(0,u.rO)({state:i.UI(JSON.stringify)}))}function Ze(e){const t=function(e){const{activationManager:t,api:n,clientContext:r,config:i,externalData:o,logger:s,metrics:a,permutiveData:u,network:c,urls:l,namespace:f,trace:d}=e;return{activationManager:t,api:n,clientContext:r,config:i,externalData:o,logger:s,metrics:a,permutiveData:u,permutiveApi:c,permutiveUrls:l,reportError:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};n.reportError(e,null==t?void 0:t.userId,null==t?void 0:t.timestamp)},namespace:f,trace:d}}(e),n=function(e){const t={addonsLoaded:e.addonsLoaded,consent:(n=e.consentTracking,(0,r.zG)(n,a.EQ((()=>i.a9(!0)),(e=>e.consentRef)))),currentTimestampSecs:l(),enabledAddons:c(e),identities:e.identities,sdkClosing:f(),metricSampleRate:e.config.metricsSamplingPercentage/100,sdkVariant:a.ij(e.sdkVariant),sessionId:i.a9(e.sessionManager.getSessionId()),userId:e.userId.ref,userIdIsNewlyGenerated:e.userId.isNewlyGenerated,viewId:e.viewId.ref,pageviewState:e.pageviewState};var n;return t}(e);return function(e,t,n,a){const c=5e3;return(0,r.zG)(e,function(e,t){return n=>o=>{const{value:a,state:u}=n(o),[c,l]=i.Ue(u.current),f=(0,s.UM)((()=>l(u.current)),e),d=(0,r.zG)(i.vP(u,c),i.UI((e=>{let[t,n]=e;return t===n})));return(0,r.zG)(t,i.bw((e=>e&&f()))),{value:(0,r.bc)(d,a),state:(0,r.zG)(i.vP(t,u,c),i.UI((e=>{let[t,n,r]=e;return t?n:r})))}}}(c,a),Je,function(e){return t=>(0,r.ls)((0,u.rO)({previousState:t=>e.current?t:void 0}),t,(0,u.rO)({state:(0,r.ls)((t=>i.vP(e,t)),i.UI((e=>{let[t,n]=e;return t?n:void 0})))}))}(n),function(e){return t=>(0,r.ls)((0,u.rO)({previousState:()=>localStorage.getItem(e)}),t,(0,u.rO)({state:(0,u.bw)(i.YP((t=>{switch(typeof t){case"string":localStorage.setItem(e,t);break;case"undefined":localStorage.removeItem(e);break;case"object":if(null===t){localStorage.removeItem(e);break}throw new Error("Permutive app raised an invalid state.");default:throw new Error("Permutive app raised an invalid state.")}})))}))}(t),o.UI((e=>{let[t,n]=e;return n})))({stopped:i.a9(!1)}).value}(He(t,n,e.core),e.namespace.getNamespacedStorageKey("permutive-app"),n.consent,n.sdkClosing)}},2233:(e,t,n)=>{n.d(t,{iq:()=>f,B9:()=>_,ti:()=>g});var r=n(2688),i=n(787),o=n(365),s=n(2884),a=n(3735),u=n(2652);var c=n(3030);const l="__permutive.",f="__permutiveConfigQueryParams";const d={default:{windowKey:"permutive",environment:"default",apiHost:"api.permutive.com",apiKey:"",apiProtocol:"https",cdnBaseUrl:"cdn.permutive.com",cdnProtocol:"https",pxidHost:"prmutv.co",apiVersion:"v2.0",sdkErrorsApiVersion:"v2",advertiserApiVersion:"v2",classificationModelsApiVersion:"v1",loggingEnabled:!1,tracingEnabled:!1,requestTimeout:5e3,cookieDomain:"."+(0,c._Y)(window.location.hostname),cookieName:"permutive-id",cookieExpiry:function(){const e=new Date;return e.setMonth(e.getMonth()+6),e.toUTCString()}(),eventsTTLInDays:null,permutiveDataMiscKey:"permutive-data-misc",permutiveDataQueriesKey:"permutive-data-queries",stateNamespace:"",sendClientErrors:!0,metricsSamplingPercentage:20,eventsCacheLimitBytes:25e5,segmentSyncApiHost:"8512b548-2306-4976-a576-a880f2c35e4e.partner.permutive.app",consentRequired:!1,sdkType:"stable",viewId:null,localStorageDebouncedKeys:[],localStorageWriteDelay:1e3,localStorageWriteMaxDelay:1500,watson:{enabled:!0}},production:{},development:{apiProtocol:"http",loggingEnabled:!0,tracingEnabled:!0,sendClientErrors:!1}},p=e=>{const t={consentRequired:!0,loggingEnabled:!0,sendClientErrors:!0,tracingEnabled:!0},n={eventsTTLInDays:!0,eventsCacheLimitBytes:!0,metricsSamplingPercentage:!0,requestTimeout:!0,localStorageWriteDelay:!0,localStorageWriteMaxDelay:!0};return Object.keys(e).reduce(((r,i)=>{if(t.hasOwnProperty(i)){const t="true"===e[i];return{...r,[i]:t}}if(n.hasOwnProperty(i)){const t=Number(e[i]);return isNaN(t)?r:{...r,[i]:t}}return{...r,[i]:e[i]}}),{})},_=function(){let{getQueryParams:e=c.zM}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=e=>Object.entries(e).reduce(((e,t)=>{let[n,r]=t;if(!(0===n.indexOf(l)))return e;const i=n.replace(l,"");return[...e,[i,r]]}),[]);return(0,a.zG)(o.Y3((()=>(0,a.zG)(e(),t,(e=>(0,u.m8)(...e)),p,(e=>m({queryConfig:e})))),(e=>`Failed to parse query params. Got ${(0,r.w)(e).message}`)))},m=e=>{let{queryConfig:t}=e;const n=(0,a.zG)(s.Y3((()=>window.sessionStorage.getItem(f))),s.tS(s.ij),s.tS((0,a.ls)(i.A,s.ij)),s.fS((()=>({}))));return(0,u.PM)(n,t)},g=(e,t)=>{const n=(e.environment&&d[e.environment])??{};return(0,u.PM)(d.default,n,e,t)}},4564:(e,t,n)=>{n.d(t,{NY:()=>m,vk:()=>d,qA:()=>f});var r=n(2688),i=n(365),o=n(3735),s=n(2707),a=n(8259),u=n(1410),c=n(2851);var l=n(30);const f=()=>({opt_in:!0,token:u.L}),d=()=>({opt_in:!1,token:""}),p=e=>{return(0,o.ls)((t=e,e=>(0,o.zG)((0,l.J)(t.consentRequired,e),(e=>{let{consentData:n,isValid:r}=e;return t.consentDatabase.put(n,u.L),r}))),(e=>{let{logger:t,messages:n}=e;return e=>{const r=e?"given":"revoked";return t.log("Consent has been",r),n.emit(`permutive:consent:${r}`),e}})(e));var t},_=e=>(t,n)=>{e.on("permutive:consent:revoked",t),e.on("permutive:consent:given",n)},m=async e=>{const{logger:t,namespace:n,consentRequired:f,messages:d}=e,m=new a.oP(window.localStorage,n),g=(0,l.J)(f,await m.get(u.L)),v=await(0,o.zG)(s.Y3((()=>m.put(g.consentData,u.L)),(e=>new Error(`LocalStorage access is required. ${(0,r.w)(e).message}`))),(e=>e()));if(i.nM(v))return v;const{consentRef:h,giveConsent:y,revokeConsent:b,isRevoked:w,isGiven:E}=function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const[t,n]=c.Ue(e),r=()=>!0===t.current;return{consentRef:t,revokeConsent:()=>(n(!1),t.current),giveConsent:()=>(n(!0),t.current),isRevoked:()=>!r(),isGiven:r}}(g.isValid),I={consentRef:h,isGiven:E,isRevoked:w,listenForConsent:_(d)};I.listenForConsent(b,y);const k=p({consentDatabase:m,consentRequired:f,logger:t,messages:d});return i.F2({consentTracking:I,consentValidation:k,consentDatabase:m})}},1410:(e,t,n)=>{n.d(t,{L:()=>r});const r="permutive-consent"},7708:(e,t,n)=>{n.d(t,{D:()=>f});var r=n(5851),i=n(365),o=n(3735),s=n(2884),a=n(7407),u=n(4922),c=n(1410),l=n(30);const f=e=>{const{partialTagWithKey:t}=e,n=t.key;var f;window[n].consent=(f=e,(0,o.ls)(f.consentModule.consentValidation,s.DT(Boolean),s.UI((0,u.H)(f)),o.Q1));const d=(0,s.EQ)((()=>{return t={consentDatabase:e.consentModule.consentDatabase,consentRequired:e.tag.config.consentRequired},(0,o.zG)((0,o.a9)(t.consentDatabase.get(c.L)),(0,a.UI)((e=>(0,l.J)(t.consentRequired,e).isValid)));var t}),a.of);return(0,o.zG)((0,o.zG)((e=>{let{consentModule:t,tag:n}=e;const i=(0,r.Ew)((function(e){return"consent"===e.functionName}))(n.q);return(0,s.UI)((e=>t.consentValidation(e.arguments[0])))(i)})(e),d),(0,a.UI)((e=>e?(0,i.F2)(!0):(0,i.t$)("No consent to run on the page"))))}},4769:(e,t,n)=>{n.d(t,{v:()=>r});const r=(e,t,n)=>function(){const r=n()?t:e;return r(...arguments)}},30:(e,t,n)=>{n.d(t,{J:()=>s});var r=n(3735),i=n(2884),o=n(4564);const s=(e,t)=>(0,r.zG)((0,i.ij)(t),(t=>!1===e&&(0,i.Wi)(t)?{isValid:!0,consentData:(0,o.qA)()}:(e=>(0,i.pC)(e)&&(e=>null!==e&&"object"==typeof e)(e.value)&&(e=>{var t;return!0===e.opt_in&&"string"==typeof e.token&&(null===(t=e.token)||void 0===t?void 0:t.length)>0})(e.value))(t)?{isValid:!0,consentData:t.value}:{isValid:!1,consentData:(0,o.vk)()}))},3298:(e,t,n)=>{n.d(t,{S:()=>g});var r=n(3735),i=n(2884),o=n(5851),s=n(2851),a=n(8612),u=n(2497),c=n(3992);var l=n(2652);class f{wait_prev;block_next;task;started;complete;constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.wait_prev=t.wait_prev||!1,this.block_next=t.block_next||!1,this.started=!1,this.complete=!1,this.task=e}waits(){return this.wait_prev}blocks(){return this.block_next}execute(e){this.started=!0,this.task((()=>{this.complete=!0,e()}))}}var d=n(6315);n(7305);class p{logger;api;activationManager;sessionManager;metrics;viewId;userId;network;clientContext;unprocessedEvents;taskQueue;identities;permutiveReset;messages;addons;trace;permutiveRealtime;state;customProperties;config;permutiveData;externalData;cookies;identitiesIngestor;global;nextGen;pageviewState;initialisedAddons=[];tcf;constructor(e,t,n,r,i,o,s,a,c,l,f,d,p,_,m,g,v,h,y,b,w,E,I,k,S,P,D){this.logger=e,this.api=t,this.activationManager=n,this.sessionManager=r,this.metrics=i,this.viewId=o,this.userId=s,this.network=a,this.clientContext=c,this.unprocessedEvents=l,this.taskQueue=f,this.identities=d,this.permutiveReset=p,this.messages=_,this.addons=m,this.trace=g,this.permutiveRealtime=v,this.state=h,this.customProperties=y,this.config=b,this.permutiveData=w,this.externalData=E,this.cookies=I,this.identitiesIngestor=k,this.global=S,this.nextGen=P,this.pageviewState=D,this.tcf=(0,u.SD)(window,this.logger)}identify(e){const t="[Identify]";this.logger.debug("<call> identify",e);const n=(0,l.b2)(),{left:s,right:u}=this.identities.parseCustomerDefinedIdentities(e);if(s.length>0)throw new Error(s.join(" "));const c={...this.identities.getIdentitiesMap(),...u.reduce(((e,t)=>{let{tag:n,id:r,priority:i,expiry:o}=t;return{...e,[n]:{id:r,...void 0!==i?{priority:i}:{},...void 0!==o?{expiry:o}:{}}}}),{})},p=(0,r.zG)(Object.values(c),o.DZ((e=>i.ij(e.id)))),_=this.identities.getPrioritizedIdentities(c);if("string"==typeof e&&(0,a.Bt)("6adbc4e9-beda-4b9e-9117-43ec3a80e1d0","8512b548-2306-4976-a576-a880f2c35e4e",p,window.location.hostname,this.userId.get()))return n.resolve(),n.promise;const m=async e=>{await(0,d.Yj)({clientContext:this.clientContext,global:this.global,identities:this.identities,logger:this.logger,reset:this.permutiveReset,userId:this.userId},e.user_id)};return this.taskQueue.add(new f((async e=>{this.logger.debug("<task> identify",u);const r=async()=>{this.logger.log(t,"request identity");const e=await this.api.identify(this.metrics,this.userId,_);this.userId.isEqual(e.user_id)?this.metrics.track({name:"sdk_identity_remained_total",value:1,labels:{identify_reason:"identify_call"}}):(this.metrics.track({name:"sdk_identity_changed_total",value:1,labels:{identify_reason:"identify_call"}}),await m(e))};this.identities.setIdentities(u).identifyRequestRequired()?await r():this.logger.log(t,"skip request"),this.logger.debug("<done> identify",u),e(),n.resolve(),await this.identitiesIngestor.ingestIfEligible(u).catch((e=>this.api.reportError(`Couldn't ingest identities, got ${e}`,this.userId.get())))}),{wait_prev:!0,block_next:!0})),n.promise}on(e,t){return this.nextGen.eventHandlerAfterUpload.addListener({name:e,callback:t,once:!1})}once(e,t){return this.nextGen.eventHandlerAfterUpload.addListener({name:e,callback:t,once:!0})}pageviewTracked=!1;track(){const[e,t,n]=[arguments.length<=0?void 0:arguments[0],(arguments.length<=1?void 0:arguments[1])||{},(arguments.length<=2?void 0:arguments[2])||{}],r=this.trace.startSpan(`track("${e}")`);this.logger.log("<call> track",e);const i=(0,l.b2)();this.pageviewTracked||"Pageview"!==e||(this.pageviewTracked=!0,this.metrics.trackTimeSinceInit("sdk_lifecycle_timestamps",{timestamp_name:"pageview_tracked",time_origin:"sdk_init"})),this.metrics.trackCounter({name:"sdk_event_track_count_total",labels:{event_name:e},value:1}),i.promise.then((()=>{this.metrics.trackCounter({name:"sdk_event_track_success_count_total",labels:{event_name:e},value:1}),r.finish()}),(()=>{this.metrics.trackCounter({name:"sdk_event_track_fail_count_total",labels:{event_name:e},value:1}),r.finish()}));const o=n.unprocessedData??{},s=o.sessionId??this.sessionManager.getSessionId(),a=o.viewId??this.viewId.get(),u={success:n.success||(e=>{}),error:n.error||((e,t)=>{})};return this.taskQueue.add(new f((r=>{this.logger.log("<task> track",e);return(o.client?Promise.resolve(o.client):this.clientContext.getClient()).then((o=>{const c={name:e,properties:{...t,client:t.client?(0,l.PM)(o,t.client):o},session_id:s,view_id:a,time:new Date};return this.nextGen.trackEvent.current({event:c,useBeacon:n.useBeacon??!1}).then((e=>{this.logger.log("<done> track",c.name),u.success(e),i.resolve(c),r()})).catch((e=>{u.error(e),this.api.reportError(e,this.userId.get()),i.reject(e)}))}))}))),i.promise}trigger(e,t,n){const r=(0,l.b2)();this.logger.log("<call> trigger",e);const i=t=>(i,o)=>{if(i.properties.segment_number===e){const s={result:t};this.logger.debug("<fire> trigger",{event:i,error:o,segmentCode:e,payload:s}),n(s),r.resolve(s)}};return this.nextGen.eventHandlerAfterUpload.addListener({name:"SegmentEntry",callback:i(!0),once:!1}),this.nextGen.eventHandlerAfterUpload.addListener({name:"SegmentExit",callback:i(!1),once:!1}),this.logger.log("<done> trigger",e),r.promise}query(){return Promise.resolve({result:!1})}segment(e,t){const n=(0,l.b2)();this.logger.log("<call> segment",e);return this.taskQueue.add(new f((r=>{this.logger.log("<task> segment",e);const i=this.nextGen.queryLanguageCohorts.all.current.includes(e)||!1;t(i),n.resolve(),this.logger.log("<done> segment",e),r()}))),n.promise}segments(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"all";const n=(0,l.b2)();this.logger.log("<call> segments");return this.taskQueue.add(new f((r=>{this.logger.log("<task> segments ("+t+")");const i=i=>{e(i),n.resolve(i),this.logger.log("<done> segments ("+t+")"),r()};"dfp"===t?this.messages.once("permutive:dfp:ready",(()=>{this.addons.dfp&&i([...this.addons.dfp.segments.liveSegments])})):i([...this.nextGen.queryLanguageCohorts.all.current])}))),n.promise}reset(){return Promise.all([this.api.reset(this.metrics),this.identities.reset(),this.permutiveReset.reset(),this.nextGen.reset(),this.userId.reset()]).then((()=>{this.messages.emit("permutive:reset")})).catch((e=>{this.api.reportError(`Error resetting internals. Got ${e}`)}))}addon(e,t){this.logger.debug("[Addon]",`Called for ${e}`,t);const o={...t,permutive:this,api:this.api,activationManager:this.activationManager,network:this.network,clientContext:this.clientContext,logger:this.logger,unprocessedEvents:this.unprocessedEvents,metrics:this.metrics,state:this.state,messages:this.messages,userId:this.userId,viewId:this.viewId,customProperties:this.customProperties,config:this.config,permutiveData:this.permutiveData,sessionManager:this.sessionManager,addons:this.addons,externalData:this.externalData,cookies:this.cookies,nextGenOutput:this.nextGen,identities:this.identities,pageviewState:this.pageviewState,tcf:this.tcf},a=((0,r.zG)(this.nextGen.pbjsPair,s.UI(i.UI((0,l.vg)("pbjs")))),e=>{this.initialisedAddons.push(e),this.messages.emit("permutive:addon:preinit",e)});if(-1===this.initialisedAddons.indexOf(e))switch(a(e),e){case"web":Promise.resolve().then(n.bind(n,4400)).then((e=>this.addons.web=new e.WebAddon(o))).then((()=>this.messages.emit("permutive:web:ready")));break;case"publishers":case"overlays":case"scriptrunner":case"nativo":case"facebook_pixel_v2":case"tiktok_pixel":case"eyeota_pixel":case"rubicon":case"rubicon_ssp":case"tracking_pixel":case"twitter_pixel":case"pinterest_pixel":case"local_storage":case"appnexus_adserver":case"prebid":case"classification_models":case"clean_room":case"gam_log":case"smart":case"tradedesk":case"ddp":case"dbm":case"appnexus":case"pubmatic":case"ssp":0;break;case"dfp":Promise.resolve().then(n.bind(n,9658)).then((async e=>this.addons.dfp=await e.createAddon(o)));break;case"freewheel":Promise.resolve().then(n.bind(n,2097)).then((e=>this.addons.freewheel=new e.FreeWheelAddon(o)))}else"web"===e&&!0!==t.auto_init&&((e,t,n,r)=>new Promise(((o,s)=>{const a=(0,i.Y3)(e);if((0,i.pC)(a))return o(a.value);n.once(t,(()=>(0,i.g_)((()=>s(new Error(`Error after waiting for event ${t}`))),o)((0,i.Y3)(e))));const u=(null==r?void 0:r.timeout)??1e4;(0,c.HJ)((()=>s(new Error(`Event ${t} was not received within the timeout period ${u}ms`))),u)})))((()=>{if(!this.addons.web)throw new Error('"web" addon not ready');return this.addons.web.reset(t)}),"permutive:web:ready",this.messages).catch((e=>{this.api.reportError(`Got error while trying to reset web. Got ${e.message}`,this.state.userId.get())}))}ready(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"initialised";const n=(0,l.b2)(),r=()=>{e(),n.resolve()};switch(t){case"initialised":this.permutiveRealtime.isReady()?r():this.messages.on("permutive:ready",r);break;case"realtime":this.permutiveRealtime.isRealtime()?r():this.messages.once("permutive:realtime",r)}return n.promise}}var _=n(4769);const m=e=>{const{logger:t,consentTracking:n}=e,i=function(){return t.debug("Methods[track]: Cannot track as consent is revoked"),Promise.resolve(null)};return e=>class extends e{constructor(){super(...arguments),n.isRevoked()&&this.consentRevoked(),n.listenForConsent((()=>this.consentRevoked()),r.Q1)}async consentRevoked(){return await this.sessionManager.reset(),this.reset()}track=(0,_.v)(super.track.bind(this),i,n.isRevoked)}},g=(e,t,n,i,o,s,a,u,c,l,f,d,_,g,v,h,y,b,w,E,I,k,S,P,D,U,G,z)=>new((0,r.zG)(p,m({consentTracking:U,logger:e})))(e,t,n,i,o,s,a,u,c,l,f,d,_,g,v,h,y,b,w,E,I,k,S,P,D,G,z)},6416:(e,t,n)=>{n.d(t,{O:()=>u});var r=n(1828),i=n(365),o=n(3735);const s=e=>(0,o.zG)((e=>"function"==typeof e.Map?(0,i.F2)(new e.Map([["a",1]])):(0,i.t$)("Maps not supported"))(e),i.tS((e=>1===e.size?(0,i.F2)(null):(0,i.t$)("Iterable Maps not supported")))),a=e=>(0,o.zG)((e=>"function"==typeof e.Set?(0,i.F2)(new e.Set([1,2])):(0,i.t$)("Sets not supported"))(e),i.tS((e=>2===e.size?(0,i.F2)(null):(0,i.t$)("Iterable Sets not supported")))),u=e=>(0,o.zG)((0,r.gz)(i.G5)(s(e),a(e),(e=>e.Worker&&e.Blob?(0,i.F2)(null):(0,i.t$)("WebWorkers not supported"))(e)),(e=>(0,i.UI)(o.Q1)(e)))},6315:(e,t,n)=>{n.d(t,{Yj:()=>u,TZ:()=>a});var r=n(2688),i=n(2652);var o=n(8612);const s=async e=>{await e.identities.thirdParty,await function(e,t){return(0,o.Bt)("6adbc4e9-beda-4b9e-9117-43ec3a80e1d0","8512b548-2306-4976-a576-a880f2c35e4e",e.identities.getPrioritizedIdentities(e.identities.getIdentitiesMap()).map((e=>e.id)),window.location.hostname,e.userId.get())?t.reset():Promise.resolve()}(e,e.permutiveMethods);const t=await function(e){const t=e.trace.startSpan("identify");0;return(async e=>{const t="[Identify Init]",{logger:n,api:r,userId:o,identities:s,metrics:a,identitiesIngestor:u,messages:c,sessionManager:l}=e,f=await s.thirdParty,d=s.extractIdentifyFromQueue(e),p={...s.getIdentitiesMap(),...d.reduce(((e,t)=>{let{tag:n,id:r,priority:i,expiry:o}=t;return{...e,[n]:{id:r,...o?{expiry:o}:{},...void 0!==i?{priority:i}:{}}}}),{})},_=s.setIdentities(Object.entries(p).map((e=>{let[t,{id:n,priority:r,expiry:i}]=e;return{tag:t,id:n,...i?{expiry:i}:{},...void 0!==r?{priority:r}:{}}})));s.setReady();const m=s.getPrioritizedIdentities(p);n.log("Begin identification");const g=e.sessionCount>1&&l.sessionHasChanged()||f.identifyRequestRequired()||_.identifyRequestRequired()?await(n.debug(t,"request identity"),r.identify(a,o,m).then((e=>{const r=e.user_id;return o.isEqual(r)?{identityChanged:!1}:(n.debug(t,"fetch received new user id",r),{identityChanged:!0,userId:r})})).catch((e=>(r.reportError(`${t} Fetch failed. Got ${e}`,o.get()),{identityChanged:!1}))).then((0,i.bw)((t=>e.metrics.track({name:`sdk_identity_${t.identityChanged?"changed":"remained"}_total`,value:1,labels:{identify_reason:"sdk_init"}}))))):(n.debug(t,"skip request"),{identityChanged:!1});return u.ingestIfEligible(m).catch((e=>r.reportError(`Couldn't ingest identities, got ${e}`,g.identityChanged?g.userId:o.get()))),c.emit("permutive:user:ready"),n.debug(t,"result",g),g})(e).catch((t=>(e.api.reportError(`Failed to identify. Got ${(0,r.w)(t)}`),{identityChanged:!1}))).then((e=>(t.finish(),e)))}(e);return t.identityChanged?await u(e,t.userId):e.logger.log("Identity has not changed"),t},a=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e=>{};s(e).then(t),c(e.global,e.clientContext)};async function u(e,t){e.logger.log("Identity has changed"),await e.reset.reset(),e.userId.set(t),c(e.global,e.clientContext),e.identities.setIdentities([])}function c(e,t){return e.context=t.getContext()}},5919:(e,t,n)=>{function r(e,t,n,r){r.debug("set SDK as ready"),e.emit("permutive:api:ready"),e.emit("permutive:queries:initialised"),t.track({name:"sdk_local_storage_byte_total",value:n.getStateSizeInBytes(),labels:{}}),r.warn("sdk_query_states_byte_total metric needs re-implementing")}n.d(t,{R:()=>r})},7985:(e,t,n)=>{n.d(t,{$o:()=>s,je:()=>a});var r=n(365),i=n(3735),o=n(2233);const s=e=>{var t,n;const o="8512b548-2306-4976-a576-a880f2c35e4e",s=void 0!==(null===(t=e[o])||void 0===t?void 0:t.q)&&void 0!==(null===(n=e[o])||void 0===n?void 0:n.config)?o:"permutive";return(0,i.zG)(e[s],(0,r.ij)("Can't find permutive tag on the page"),(0,r.UI)((e=>({tag:e,key:s}))))},a=(e,t)=>{let{tag:n,key:r}=e;return{...n,config:(0,o.ti)({...n.config,windowKey:r},t)}}},7078:(e,t,n)=>{n.d(t,{LA:()=>a});var r=n(5851),i=n(7209),o=n(2652);const s=(e,t,n)=>{let{api:r,state:i}=n;r.reportError(`Function "permutive.${t.functionName}" caused an error: ${e.message}`,i.userId.get())};function a(e,t,n,r,i,o){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:f;const c=u(e),l=o.startSpan("queued_methods"),d={api:i,state:t},p=e=>{if(e.functionName in n){n[e.functionName].apply(r,e.arguments)}else s(new Error("Does not exist."),e,d)},_=e=>!a.includes(e);c.forEach((e=>{try{_(e.functionName)&&p(e)}catch(t){const n=t instanceof Error?t:new Error("Unknown error.");s(n,e,d)}})),l.finish()}function u(e){const t=(0,r.uK)((e=>-1!==l.indexOf(e.functionName)))(e),n=t.right,s=t.left.filter((e=>"consent"!==e.functionName)),a=(0,i.Zt)(((e,t)=>c(e)&&c(t)?(0,o.lW)(d).compare(e.arguments[0],t.arguments[0]):(0,o.lW)(l).compare(e.functionName,t.functionName)));return(0,r.DY)(a)(n).concat(s)}const c=e=>"addon"===e.functionName,l=["identify","trigger","addon","track"],f=["identify"],d=["dfp","appnexus_adserver","web"]},4922:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{H:()=>initialiseWebSDK,f:()=>initialisationSequence});var _permutive_permutive_utils_ts_error__WEBPACK_IMPORTED_MODULE_35__=__webpack_require__(2688),fp_ts_Option__WEBPACK_IMPORTED_MODULE_45__=__webpack_require__(2884),fp_ts_Either__WEBPACK_IMPORTED_MODULE_47__=__webpack_require__(365),fp_ts_function__WEBPACK_IMPORTED_MODULE_33__=__webpack_require__(3735),fp_ts_TaskEither__WEBPACK_IMPORTED_MODULE_32__=__webpack_require__(2707),_framework_ref__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2851),_identity_legacy_NeustarFabrickIdentitiesIngestor__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(6967),_identity_legacy_PermutiveIdentities__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(8612),_identity_legacy_PermutiveIdentitiesIngestorNoOp__WEBPACK_IMPORTED_MODULE_40__=__webpack_require__(7658),_sdkql_blockers__WEBPACK_IMPORTED_MODULE_48__=__webpack_require__(122),_core_activations_PermutiveActivationManagerWeb__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(8975),_core_activations_PermutiveAddons__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(9853),_core_context_PermutiveClientContextWeb__WEBPACK_IMPORTED_MODULE_39__=__webpack_require__(2836),_sdkql_event_collection_events_cache_store_crypto_CryptoUtils__WEBPACK_IMPORTED_MODULE_57__=__webpack_require__(4064),_sdkql_event_collection_events_cache_store_crypto_HashcodeDigest__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(6197),_sdkql_event_collection_events_cache_store_crypto_SHA256Digest__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(6272),_sdkql_event_collection_PermutiveEventCustomProps__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(7748),_core_events_unprocessed_UnprocessedPrebidAuctions__WEBPACK_IMPORTED_MODULE_42__=__webpack_require__(1568),_core_internals_CookiesWeb__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(5461),_core_internals_ExternalDataWeb__WEBPACK_IMPORTED_MODULE_38__=__webpack_require__(9773),_core_internals_PermutiveLogger__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(342),_core_internals_SDKMessages__WEBPACK_IMPORTED_MODULE_55__=__webpack_require__(8491),_core_metrics_MetricReporter__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(6478),_core_metrics_Metrics__WEBPACK_IMPORTED_MODULE_56__=__webpack_require__(4074),_core_session_SessionManager__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(8317),_core_state_PermutiveDataStoreWeb__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(4026),_core_state_PermutiveNamespace__WEBPACK_IMPORTED_MODULE_54__=__webpack_require__(569),_core_state_PermutiveRealtime__WEBPACK_IMPORTED_MODULE_41__=__webpack_require__(7575),_core_state_PermutiveReset__WEBPACK_IMPORTED_MODULE_43__=__webpack_require__(3898),_core_state_PermutiveStateWeb__WEBPACK_IMPORTED_MODULE_46__=__webpack_require__(7274),_core_state_PermutiveUserId__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(9117),_core_state_PermutiveViewId__WEBPACK_IMPORTED_MODULE_34__=__webpack_require__(9880),_core_store_LocalStorage__WEBPACK_IMPORTED_MODULE_37__=__webpack_require__(7554),_core_store_SessionStorage__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(9332),_core_tcf_TCF__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(2497),_dynamic_addons_LoadAddons__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(6037),_dynamic_messages_PermutiveMessages__WEBPACK_IMPORTED_MODULE_49__=__webpack_require__(9078),_http_PermutiveApi__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(7423),_http_PermutiveNetwork__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(7354),_http_PermutiveUrls__WEBPACK_IMPORTED_MODULE_53__=__webpack_require__(310),_utils_PermutiveUtils__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(2652),_utils_task_queue_PermutiveTaskQueue__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__(4996),_utils_Trace__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__(6574),_utils_urls_UrlHelpers__WEBPACK_IMPORTED_MODULE_36__=__webpack_require__(3030),_Config__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__(2233),_Consent_Consent__WEBPACK_IMPORTED_MODULE_23__=__webpack_require__(4564),_Consent_InitialisationCheckWeb__WEBPACK_IMPORTED_MODULE_24__=__webpack_require__(7708),_initialisation_browserFeatures__WEBPACK_IMPORTED_MODULE_51__=__webpack_require__(6416),_initialisation_identity__WEBPACK_IMPORTED_MODULE_25__=__webpack_require__(6315),_initialisation_initialisationLifecycle__WEBPACK_IMPORTED_MODULE_50__=__webpack_require__(5919),_initialisation_permutiveTag__WEBPACK_IMPORTED_MODULE_26__=__webpack_require__(7985),_initialisation_queuedMethods__WEBPACK_IMPORTED_MODULE_27__=__webpack_require__(7078),_PermutiveMethodsWeb__WEBPACK_IMPORTED_MODULE_28__=__webpack_require__(3298),_framework_compute_time_measurement__WEBPACK_IMPORTED_MODULE_29__=__webpack_require__(3992),fp_ts_Task__WEBPACK_IMPORTED_MODULE_44__=__webpack_require__(7407),main_constants_common__WEBPACK_IMPORTED_MODULE_30__=__webpack_require__(922),main_dynamic_addons_dfp_ad_request__WEBPACK_IMPORTED_MODULE_52__=__webpack_require__(3248),_core_state_pageview_state__WEBPACK_IMPORTED_MODULE_31__=__webpack_require__(4656);const prefix="[Initialisation Web]",initialiseWebSDK=_ref=>{let{consentModule,core,logger,messages,metrics,namespace,network,partialTagWithKey,permutiveData,tag,trace,sessionStorage,configFromQueryParams,urls}=_ref;return(0,fp_ts_TaskEither__WEBPACK_IMPORTED_MODULE_32__.Y3)((async()=>{const windowKey=partialTagWithKey.key,permutiveGlobal=window[windowKey],config=tag.config,pageviewState=(0,_core_state_pageview_state__WEBPACK_IMPORTED_MODULE_31__.e)(config),viewId=(0,fp_ts_function__WEBPACK_IMPORTED_MODULE_33__.zG)(pageviewState.ref,_framework_ref__WEBPACK_IMPORTED_MODULE_0__.UI((e=>e.viewId)),(e=>new _core_state_PermutiveViewId__WEBPACK_IMPORTED_MODULE_34__.W(e))),{consentTracking,consentValidation}=consentModule;(0,fp_ts_function__WEBPACK_IMPORTED_MODULE_33__.zG)(consentTracking.consentRef,_framework_ref__WEBPACK_IMPORTED_MODULE_0__.YP((e=>{e?sessionStorage.put(configFromQueryParams,_Config__WEBPACK_IMPORTED_MODULE_22__.iq).then(fp_ts_function__WEBPACK_IMPORTED_MODULE_33__.Q1,(e=>{logger.warn(prefix,`Failed to cache "${_Config__WEBPACK_IMPORTED_MODULE_22__.iq}".`,(0,_permutive_permutive_utils_ts_error__WEBPACK_IMPORTED_MODULE_35__.w)(e))})):sessionStorage.delete(_Config__WEBPACK_IMPORTED_MODULE_22__.iq)}))),window[windowKey].consent=consentValidation;const context=(0,_utils_PermutiveUtils__WEBPACK_IMPORTED_MODULE_19__.PM)(tag.context||{},{path:window.location.pathname,url:(0,_utils_urls_UrlHelpers__WEBPACK_IMPORTED_MODULE_36__.bk)(window.location.href),referrer:(0,_utils_urls_UrlHelpers__WEBPACK_IMPORTED_MODULE_36__.bk)(document.referrer),view_id:viewId.get()}),createInternalsSpan=trace.startSpan("internals"),cookieStore=(0,_core_internals_CookiesWeb__WEBPACK_IMPORTED_MODULE_8__.S)(namespace,config,logger,consentTracking),localStorage=(0,_core_store_LocalStorage__WEBPACK_IMPORTED_MODULE_37__.E)(namespace,logger,consentTracking.consentRef),externalData=(0,_core_internals_ExternalDataWeb__WEBPACK_IMPORTED_MODULE_38__.S)(namespace,logger,consentTracking),clientContext=new _core_context_PermutiveClientContextWeb__WEBPACK_IMPORTED_MODULE_39__.z(context);(0,fp_ts_function__WEBPACK_IMPORTED_MODULE_33__.zG)(viewId.ref,_framework_ref__WEBPACK_IMPORTED_MODULE_0__.YP((e=>clientContext.updateContext(["view_id",e]))));const userId=new _core_state_PermutiveUserId__WEBPACK_IMPORTED_MODULE_13__.M(config,clientContext,cookieStore,externalData,consentTracking.consentRef),api=new _http_PermutiveApi__WEBPACK_IMPORTED_MODULE_17__.F(urls,config,network,metrics,logger),identityProviderEnv={permutive:permutiveGlobal,network,api,userId,metrics,permutiveData,messages,config,cookies:cookieStore,logger},identities=new _identity_legacy_PermutiveIdentities__WEBPACK_IMPORTED_MODULE_2__.lg(metrics,trace,permutiveData,identityProviderEnv,logger),identitiesIngestor=new _identity_legacy_PermutiveIdentitiesIngestorNoOp__WEBPACK_IMPORTED_MODULE_40__.z,permutiveRealtime=new _core_state_PermutiveRealtime__WEBPACK_IMPORTED_MODULE_41__.u(trace,metrics,messages),sessionManager=await _core_session_SessionManager__WEBPACK_IMPORTED_MODULE_11__.S.initialise(cookieStore,localStorage,logger),unprocessedArgs={consent:consentTracking.consentRef,logger,namespace},unprocessedEvents={PrebidAuctions:new _core_events_unprocessed_UnprocessedPrebidAuctions__WEBPACK_IMPORTED_MODULE_42__.J(unprocessedArgs)},customProperties=new _sdkql_event_collection_PermutiveEventCustomProps__WEBPACK_IMPORTED_MODULE_7__.X,permutiveReset=new _core_state_PermutiveReset__WEBPACK_IMPORTED_MODULE_43__.a(config,localStorage,logger,permutiveData,cookieStore,externalData),taskQueue=new _utils_task_queue_PermutiveTaskQueue__WEBPACK_IMPORTED_MODULE_20__.i(messages),activationManager=new _core_activations_PermutiveActivationManagerWeb__WEBPACK_IMPORTED_MODULE_3__.v(logger,permutiveGlobal,clientContext),[addonsLoadedRef,setAddonsLoaded]=_framework_ref__WEBPACK_IMPORTED_MODULE_0__.Ue(!1),eventCacheStoreFactory=()=>(0,fp_ts_function__WEBPACK_IMPORTED_MODULE_33__.zG)((0,_framework_compute_time_measurement__WEBPACK_IMPORTED_MODULE_29__.N1)((0,fp_ts_function__WEBPACK_IMPORTED_MODULE_33__.zG)((0,fp_ts_TaskEither__WEBPACK_IMPORTED_MODULE_32__.Y3)((()=>Promise.resolve().then(__webpack_require__.bind(__webpack_require__,9381))),String),trace.traceTask("import-DBStore-main-thread"))),(0,fp_ts_TaskEither__WEBPACK_IMPORTED_MODULE_32__.UI)((e=>{let{DBStore:t}=e;return new t((0,_core_store_LocalStorage__WEBPACK_IMPORTED_MODULE_37__.E)(namespace,logger,consentTracking.consentRef))}))),eventCacheFactory=()=>(0,fp_ts_function__WEBPACK_IMPORTED_MODULE_33__.zG)((0,_framework_compute_time_measurement__WEBPACK_IMPORTED_MODULE_29__.SF)((0,fp_ts_function__WEBPACK_IMPORTED_MODULE_33__.zG)((0,fp_ts_TaskEither__WEBPACK_IMPORTED_MODULE_32__.Y3)((()=>Promise.resolve().then(__webpack_require__.bind(__webpack_require__,5717))),String),trace.traceTask("import-events-cache"))),(0,fp_ts_TaskEither__WEBPACK_IMPORTED_MODULE_32__.tS)((e=>{let{EventsCache:t}=e;return(0,fp_ts_function__WEBPACK_IMPORTED_MODULE_33__.zG)(t.initialise(config,logger,(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};api.reportError(e,null==t?void 0:t.userId,null==t?void 0:t.timestamp)}),trace,metrics,userId.ref,eventCacheStoreFactory),trace.traceTask("initialise-events-cache-main-thread"))}))),nextGen=await(0,fp_ts_function__WEBPACK_IMPORTED_MODULE_33__.zG)((0,_framework_compute_time_measurement__WEBPACK_IMPORTED_MODULE_29__.SF)((()=>Promise.resolve().then(__webpack_require__.bind(__webpack_require__,3931)))),trace.traceTask("import-next-gen"),fp_ts_Task__WEBPACK_IMPORTED_MODULE_44__.UI((e=>{let{runNextGenFeatures:t}=e;return t({activationManager,addonsLoaded:addonsLoadedRef,api,clientContext,config,consentTracking:fp_ts_Option__WEBPACK_IMPORTED_MODULE_45__.G(consentTracking),core:core(eventCacheFactory),externalData,identities:identities.ref,logger,messages,metrics,namespace,network,permutiveData,sessionManager,urls,userId,viewId,pageviewState:pageviewState.ref,trace})})))();(0,_core_metrics_MetricReporter__WEBPACK_IMPORTED_MODULE_10__.p)({api,context:nextGen.metricContext,logger,messages,metrics});const state=new _core_state_PermutiveStateWeb__WEBPACK_IMPORTED_MODULE_46__.u(permutiveData,permutiveReset,userId,viewId,logger),addons={},permutiveMethods=(0,_PermutiveMethodsWeb__WEBPACK_IMPORTED_MODULE_28__.S)(logger,api,activationManager,sessionManager,metrics,viewId,userId,network,clientContext,unprocessedEvents,taskQueue,identities,permutiveReset,messages,addons,trace,permutiveRealtime,state,customProperties,config,permutiveData,externalData,cookieStore,identitiesIngestor,permutiveGlobal,consentTracking,nextGen,pageviewState);createInternalsSpan.finish(),[].forEach((s=>{fp_ts_Either__WEBPACK_IMPORTED_MODULE_47__.Y3((()=>eval(s)),(e=>{api.reportError({...e,message:`Error running custom script ${s}`},userId.get())}))}));const blockers=(0,_sdkql_blockers__WEBPACK_IMPORTED_MODULE_48__.X)({logger,messages});blockers.addBlocker("permutive:queries:initialised"),messages.on("permutive:user:ready",(()=>{permutiveGlobal.identify=permutiveMethods.identify.bind(permutiveMethods);const e=identities.extractIdentifyFromQueue({global:permutiveGlobal});e.length>0&&permutiveGlobal.identify(e)})),blockers.addBlocker("permutive:user:ready"),messages.on("permutive:blockers:empty",(()=>{permutiveGlobal.on=permutiveMethods.on.bind(permutiveMethods),permutiveGlobal.once=permutiveMethods.once.bind(permutiveMethods),permutiveGlobal.track=permutiveMethods.track.bind(permutiveMethods),permutiveGlobal.trigger=permutiveMethods.trigger.bind(permutiveMethods),permutiveGlobal.query=permutiveMethods.query.bind(permutiveMethods),permutiveGlobal.segment=permutiveMethods.segment.bind(permutiveMethods),permutiveGlobal.segments=permutiveMethods.segments.bind(permutiveMethods),permutiveGlobal.reset=permutiveMethods.reset.bind(permutiveMethods),permutiveGlobal.ready=permutiveMethods.ready.bind(permutiveMethods),permutiveGlobal.addon=permutiveMethods.addon.bind(permutiveMethods),permutiveGlobal.context=clientContext.getContext(),permutiveGlobal.addons=addons,permutiveGlobal.config=config,permutiveRealtime.setAsReady(),(0,_initialisation_queuedMethods__WEBPACK_IMPORTED_MODULE_27__.LA)(permutiveGlobal.q,state,permutiveGlobal,permutiveMethods,api,trace),setAddonsLoaded(!0)}));const loadAddonsSpan=trace.startSpan("load_addons");(0,_dynamic_addons_LoadAddons__WEBPACK_IMPORTED_MODULE_16__.C)({extMessages:new _dynamic_messages_PermutiveMessages__WEBPACK_IMPORTED_MODULE_49__.a(messages),nextGen,messages,viewId,state,sessionManager,api,clientContext,externalData,logger,metrics,namespace,network,permutive:permutiveGlobal,q:permutiveGlobal.q,userId}),loadAddonsSpan.finish(),await(0,_initialisation_identity__WEBPACK_IMPORTED_MODULE_25__.TZ)({api,clientContext,externalData,global:permutiveGlobal,identities,identitiesIngestor,logger,messages,metrics,network,permutiveMethods,reset:permutiveReset,trace,userId,sessionManager,sessionCount:nextGen.metricContext.current.session_count}),(0,_initialisation_initialisationLifecycle__WEBPACK_IMPORTED_MODULE_50__.R)(messages,metrics,state,logger),(0,fp_ts_function__WEBPACK_IMPORTED_MODULE_33__.zG)(_framework_ref__WEBPACK_IMPORTED_MODULE_0__.vP(nextGen.realtime,nextGen.queryLanguageCohorts.all),_framework_ref__WEBPACK_IMPORTED_MODULE_0__.D8(((e,t)=>e[0]===t[0])),_framework_ref__WEBPACK_IMPORTED_MODULE_0__.bw((e=>{let[t,n]=e;t&&permutiveRealtime.setAsRealtime(n.length)})))}),(e=>`Exception during initialisation. Got ${e}`))},initialisationSequence=e=>(0,fp_ts_function__WEBPACK_IMPORTED_MODULE_33__.zG)(fp_ts_TaskEither__WEBPACK_IMPORTED_MODULE_32__.Do,(0,fp_ts_TaskEither__WEBPACK_IMPORTED_MODULE_32__.ak)("support",(()=>(0,fp_ts_TaskEither__WEBPACK_IMPORTED_MODULE_32__.Uo)((0,_initialisation_browserFeatures__WEBPACK_IMPORTED_MODULE_51__.O)(self)))),(0,fp_ts_TaskEither__WEBPACK_IMPORTED_MODULE_32__.ak)("partialTagWithKey",(()=>(0,fp_ts_TaskEither__WEBPACK_IMPORTED_MODULE_32__.Uo)((0,_initialisation_permutiveTag__WEBPACK_IMPORTED_MODULE_26__.$o)(window)))),(0,fp_ts_TaskEither__WEBPACK_IMPORTED_MODULE_32__.ak)("configFromQueryParams",(()=>(0,fp_ts_TaskEither__WEBPACK_IMPORTED_MODULE_32__.Uo)((0,_Config__WEBPACK_IMPORTED_MODULE_22__.B9)()))),(0,fp_ts_TaskEither__WEBPACK_IMPORTED_MODULE_32__.Hr)("tag",(e=>(0,_initialisation_permutiveTag__WEBPACK_IMPORTED_MODULE_26__.je)(e.partialTagWithKey,e.configFromQueryParams))),(0,fp_ts_TaskEither__WEBPACK_IMPORTED_MODULE_32__.UI)((e=>{{const t=e.partialTagWithKey.key,n=window[t];(0,main_dynamic_addons_dfp_ad_request__WEBPACK_IMPORTED_MODULE_52__.h)(n)}return e})),(0,fp_ts_TaskEither__WEBPACK_IMPORTED_MODULE_32__.Hr)("logger",(e=>{let{tag:t}=e;return(0,_core_internals_PermutiveLogger__WEBPACK_IMPORTED_MODULE_9__.SX)(t.config)})),(0,fp_ts_TaskEither__WEBPACK_IMPORTED_MODULE_32__.Hr)("urls",(e=>{let{tag:t}=e;return new _http_PermutiveUrls__WEBPACK_IMPORTED_MODULE_53__.s(t.config)})),(0,fp_ts_TaskEither__WEBPACK_IMPORTED_MODULE_32__.Hr)("namespace",(e=>{let{tag:t}=e;return new _core_state_PermutiveNamespace__WEBPACK_IMPORTED_MODULE_54__.L(t.config)})),(0,fp_ts_TaskEither__WEBPACK_IMPORTED_MODULE_32__.Hr)("messages",(e=>{let{logger:t}=e;return new _core_internals_SDKMessages__WEBPACK_IMPORTED_MODULE_55__.Q(t)})),(0,fp_ts_TaskEither__WEBPACK_IMPORTED_MODULE_32__.ak)("consentModule",(e=>(0,fp_ts_function__WEBPACK_IMPORTED_MODULE_33__.zG)((()=>(0,_Consent_Consent__WEBPACK_IMPORTED_MODULE_23__.NY)({...e,consentRequired:e.tag.config.consentRequired})),(0,fp_ts_TaskEither__WEBPACK_IMPORTED_MODULE_32__.Vn)((e=>e.message))))),(0,fp_ts_TaskEither__WEBPACK_IMPORTED_MODULE_32__.Hr)("sessionStorage",(e=>(0,_core_store_SessionStorage__WEBPACK_IMPORTED_MODULE_14__.u)(e.namespace,e.logger,e.consentModule.consentTracking.consentRef))),(0,fp_ts_TaskEither__WEBPACK_IMPORTED_MODULE_32__.Hr)("permutiveData",(e=>{let{tag:t,namespace:n,logger:r,consentModule:i}=e;return(0,_core_state_PermutiveDataStoreWeb__WEBPACK_IMPORTED_MODULE_12__.S)(t.config,n,r,i.consentTracking)})),(0,fp_ts_TaskEither__WEBPACK_IMPORTED_MODULE_32__.Hr)("metrics",(t=>{let{tag:n,logger:r,permutiveData:i}=t;return(0,_core_metrics_Metrics__WEBPACK_IMPORTED_MODULE_56__.gT)(e.contextsInitTimestampPerformance,(0,_core_metrics_Metrics__WEBPACK_IMPORTED_MODULE_56__.Mc)(),n.config,i,r)})),(0,fp_ts_TaskEither__WEBPACK_IMPORTED_MODULE_32__.Hr)("trace",(e=>{let{tag:t}=e;return new _utils_Trace__WEBPACK_IMPORTED_MODULE_21__.l(t.config)})),(0,fp_ts_TaskEither__WEBPACK_IMPORTED_MODULE_32__.ak)("core",(t=>{let{metrics:n,trace:r,tag:i,permutiveData:o}=t;return e.coreWorker({trace:r,isSecureContext:(0,_sdkql_event_collection_events_cache_store_crypto_CryptoUtils__WEBPACK_IMPORTED_MODULE_57__.T)(i.config),metrics:n,permutiveConfig:i.config,optimisedActivationsConfig:_core_activations_PermutiveActivationManagerWeb__WEBPACK_IMPORTED_MODULE_3__.U,organizationId:"8512b548-2306-4976-a576-a880f2c35e4e",sdkInitTimestampPerformance:e.contextsInitTimestampPerformance,sdkInitTimestampDate:e.contextsInitTimestamp,trackPageviewComplete:main_constants_common__WEBPACK_IMPORTED_MODULE_30__.Uy??!1,migratedStateMaps:()=>({internal:(0,fp_ts_function__WEBPACK_IMPORTED_MODULE_33__.zG)(o.getData("internal_query_states"),fp_ts_Option__WEBPACK_IMPORTED_MODULE_45__.DT(_utils_PermutiveUtils__WEBPACK_IMPORTED_MODULE_19__.Kn)),external:(0,fp_ts_function__WEBPACK_IMPORTED_MODULE_33__.zG)(o.getData("external_query_states"),fp_ts_Option__WEBPACK_IMPORTED_MODULE_45__.DT(_utils_PermutiveUtils__WEBPACK_IMPORTED_MODULE_19__.Kn))})})})),(0,fp_ts_TaskEither__WEBPACK_IMPORTED_MODULE_32__.Hr)("network",(e=>{let{metrics:t}=e;return new _http_PermutiveNetwork__WEBPACK_IMPORTED_MODULE_18__.E(t)})),(0,fp_ts_TaskEither__WEBPACK_IMPORTED_MODULE_32__.ak)("consent",(e=>(0,_Consent_InitialisationCheckWeb__WEBPACK_IMPORTED_MODULE_24__.D)(e))),(0,fp_ts_TaskEither__WEBPACK_IMPORTED_MODULE_32__.tS)((e=>initialiseWebSDK(e))))},7029:(e,t,n)=>{n.r(t),n.d(t,{runSdk:()=>s});var r=n(365),i=n(3735);var o=n(4922);const s=e=>{(0,o.f)(e)().then((0,r.g_)((e=>console.warn(`Permutive was not initialized. ${e}`)),i.Q1))}},2652:(e,t,n)=>{n.d(t,{Bf:()=>h,G6:()=>I,Gz:()=>b,HP:()=>z,Kn:()=>l,Or:()=>P,PM:()=>d,PQ:()=>k,Z_:()=>U,a4:()=>_,aT:()=>v,b2:()=>p,bw:()=>C,cO:()=>S,eu:()=>m,k$:()=>y,lW:()=>D,lo:()=>T,m8:()=>w,qh:()=>f,rH:()=>M,rO:()=>O,vg:()=>G});var r=n(5851),i=n(3735),o=n(2884),s=n(7209),a=n(6017),u=n(2751),c=n(3992);const l=e=>"object"==typeof e&&!Array.isArray(e)&&null!==e,f=e=>Object.entries(e);function d(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce(((e,t)=>({...e,...t})),{})}a.ff(u.xb);function p(){let e,t;return{promise:new Promise(((n,r)=>{e=n,t=r})),reject:t,resolve:e}}function _(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r={waitTimeInMs:50,exponentialBackOff:!1,maxAttempts:20},{waitTimeInMs:s,exponentialBackOff:a,maxAttempts:u}=d(r,n);let l=0;const f=n=>new Promise((r=>Promise.resolve(t()).then((t=>t?Promise.resolve(e()).then((e=>r((0,o.G)(e)))):(0,i.zG)(l++,(e=>e<u?(0,c.HJ)((()=>r(f(n*(a?2:1)))),n):r(o.YP)))))));return f(s)}function m(e,t){const n=Object.create(null);for(const r of t)n[r]=e[r];return n}let g=[];function v(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:navigator.userAgent;if(g.unshift(e),g.length>1)return;const n=["beforeunload","pagehide"],r=n.concat(["visibilitychange"]),i=e=>{if(!o&&e){o=!0;const e=g;g=[],e.forEach((e=>{try{e()}catch{}}))}};let o=!1;r.forEach((e=>{window.addEventListener(e,(()=>{const n=("visibilitychange"!==e||document.hidden)&&E(t);i(n)}))})),n.forEach((e=>{window.addEventListener(e,(()=>i(!0)))}))}function h(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t={capture:!0,...t};const n=["visibilitychange","pagehide"];n.forEach((n=>window.addEventListener(n,(()=>o.Y3((()=>{"pagehide"!==n&&"hidden"!==document.visibilityState||e()}))),{capture:t.capture})))}function y(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(e=>(e^(self.crypto||self.msCrypto).getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)))}function b(e){return 36===e.length&&/^[0-9A-F]{8}-[0-9A-F]{4}-4[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i.test(e)}function w(){const e={},t=arguments.length;for(let n=0;n<t;n++){const[t,r]=n<0||arguments.length<=n?void 0:arguments[n];e[t]=r}return e}function E(e){return/Mobi|Android/i.test(e)}function I(e){return/^((?!chrome|android).)*safari/i.test(e)}function k(e,t){return new Promise((n=>{(0,c.HJ)((()=>{Promise.resolve(e()).then(n)}),(null==t?void 0:t.timeout)??0)}))}function S(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}const P=()=>({equals:(e,t)=>Object.is(e,t)});function D(e){return(0,s.Zt)(((t,n)=>{const r=e.indexOf(t),i=e.indexOf(n);switch(!0){case-1===r&&-1===i:return 0;case-1!==r&&-1===i:return-1;case-1===r&&-1!==i:return 1;default:return r<=i?-1:1}}))}function U(e,t,n){return function(){try{return n(...arguments)}catch(n){e.reportError(n,t.get())}}}function G(e){return t=>null!=t&&e in t?t[e]:void 0}function z(e){let t=o.YP;const n=(0,o.fS)((()=>{const n=e();return t=(0,o.G)(n),n}));return()=>n(t)}const O=e=>t=>{const n={...t};for(const i in e){var r;n[i]=null===(r=e[i])||void 0===r?void 0:r.call(e,t[i])}return n};function C(e){return t=>(e(t),t)}const T=e=>t=>{const n=e.slice(0,-1),s=e.slice(-1)[0];return(0,i.zG)(n,r.f2((e=>{let[n,r]=e;return(0,i.zG)(t,o.DT(n),o.UI(r))})),o.fS((()=>s(t))))},x=e=>t=>{if("number"==typeof t)return t;if("string"==typeof t){const n=e(t);return Number.isNaN(n)?void 0:n}},M=x(parseInt);x(parseFloat)},6574:(e,t,n)=>{n.d(t,{l:()=>o});var r=n(3992);const i=`permutive.${self.document?"main":"worker"}.`;class o{config;shouldUsePerformanceMark=!1;constructor(e){var t;this.config=e,this.shouldUsePerformanceMark=((null===(t=self.performance)||void 0===t?void 0:t.mark)&&this.config.tracingEnabled)??!1}startSpan(e){const t=this.generateSpan(e);return t.start(),{spanId:t.spanId,finish:t.finish}}measureSinceInit(e){const t=this.generateSpan(`${e}_since_init`);return t.start({startTime:r.NC}),{spanId:t.spanId,finish:t.finish}}traceTask(e){return t=>async()=>{const n=this.startSpan(e),r=await t();return n.finish(),r}}measureBetween(e,t,n){const r=this.generateSpan(e);r.start({startTime:t}),r.finish({startTime:n})}generateSpan(e){if(!this.shouldUsePerformanceMark)return{spanId:null,start:()=>{},finish:()=>{}};const{spanName:t,startMarkerName:n,endMarkerName:r}=o.generateUniqueMarkerNames(e);return{spanId:n,start:e=>{var t;return null===(t=self.performance)||void 0===t?void 0:t.mark(n,e)},finish:e=>{var i,o,s;null===(i=self.performance)||void 0===i||i.mark(r,{startTime:(null==e?void 0:e.startTime)??performance.now()}),null===(o=self.performance)||void 0===o||null===(s=o.measure)||void 0===s||s.call(o,t,n,r)}}}static generateUniqueMarkerNames(e){const t=`${i}${e}`,n=`${t}${o.generateId()}`;return{spanName:t,startMarkerName:`${n}_start`,endMarkerName:`${n}_end`}}static generateId(){return"_"+Math.random().toString(36).substr(2,9)}}},4730:(e,t,n)=>{n.d(t,{b:()=>o});var r=n(2652),i=n(3992);class o{timeoutDurationInMilliseconds;maxTimeOutDurationInMilliseconds;constructor(e,t){this.timeoutDurationInMilliseconds=e,this.maxTimeOutDurationInMilliseconds=t}schedule(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.timeoutDurationInMilliseconds,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.maxTimeOutDurationInMilliseconds;return this.debounce(e,t,n)}scheduleAccumulated(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.timeoutDurationInMilliseconds,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.maxTimeOutDurationInMilliseconds;return this.debounce(e,n,r,t)}scheduleForPageUnload(e){return(0,r.aT)(e)}debounce(e,t,n,o){let s,a,u,c=[];return l=>{o&&(u=o.concat(u??o.empty,l));const f=(0,r.b2)();c.push(f);var d;return null===(d=s)||void 0===d||d(),s=(0,i.HJ)((()=>{var t;null===(t=a)||void 0===t||t(),a=void 0;const n=e(u||l);c.forEach((e=>e.resolve(n))),u=null==o?void 0:o.empty,c=[]}),t),a||(a=(0,i.HJ)((()=>{var t;null===(t=s)||void 0===t||t(),a=void 0;const n=e(u||l);c.forEach((e=>e.resolve(n))),u=null==o?void 0:o.empty,c=[]}),n)),f.promise}}}},4996:(e,t,n)=>{n.d(t,{i:()=>i});var r=n(3992);class i{messages;queue=[];nextNotify=null;constructor(e){this.messages=e,e.on("permutive:taskQueue:update",(()=>{this.execute()}))}add(e){this.queue.push(e),this.notify()}notify(){const e=()=>{this.messages.emit("permutive:taskQueue:update")},t=(new Date).getTime();null===this.nextNotify||this.nextNotify<t-50?(this.nextNotify=t,e()):this.nextNotify<=t&&(this.nextNotify=t+50,(0,r.HJ)(e,50))}execute(){if(0===this.queue.length)return;let e=!1,t=!1,n=0;for(let r=0;r<this.queue.length;r++){const i=this.queue[r];if(i.complete)n+=1;else if(i.started)t=!0,e=e||i.blocks();else{if(i.waits()&&t)break;e||(t=!0,e=e||i.blocks(),i.execute((()=>{this.notify()})))}}this.queue.splice(0,n)}size(){return this.queue.length}}},3030:(e,t,n)=>{n.d(t,{_Y:()=>s,bk:()=>o,zM:()=>i});var r=n(3735);const i=()=>{var e,t;const n=null===(e=window.location.href.split("?")[1])||void 0===e||null===(t=e.split("#")[0])||void 0===t?void 0:t.split("&");return void 0===n?{}:n.reduce(((e,t)=>{const[n,r]=t.split("=");return{...e,[n]:r}}),{})},o=e=>{if(!e)return"";return(0,r.zG)(e,(e=>{const t=e.length-1;return"/"===e[t]?e.slice(0,t):e}))};function s(e){const t=e.match(/\b(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\b/),n=e.match(/[a-z0-9][a-z0-9-]+\.[a-z.]{2,24}$/i),r=e.match(/localhost/);if(n&&n.length>0){const t=e.split(".").reverse();return t.length>=3&&t[1].match(/^(com|edu|gov|net|mil|org|nom|co|ac|name|info|biz)$/i)?t[2]+"."+t[1]+"."+t[0]:t[1]+"."+t[0]}return t&&(null==t?void 0:t.length)>0?t[0]:r&&(null==r?void 0:r.length)>0?"localhost":""}},7305:(e,t,n)=>{n(9853),n(2652),n(3992)},2097:(e,t,n)=>{n.r(t),n.d(t,{FreeWheelAddon:()=>_,freewheelService:()=>c,load:()=>p,realService:()=>f,stubService:()=>l});var r=n(9853),i=n(2851),o=n(3735),s=n(3328),a=n(2116),u=n(4011);const c=f;function l(e){let{externalData:t}=e;return a.K4((()=>{t.removeExternalData(m)}))}function f(e){const{activationManager:t,consent:n,externalData:r,initdAddons:c,queryLanguageCohorts:l,addonsLoaded:f}=e;return(0,o.zG)(i.vP({consent:n,addonsLoaded:f,addonInitd:i.UI((e=>e.has(d)),c)}),a.KD([[e=>{let{consent:t,addonsLoaded:n,addonInitd:r}=e;return!t||n&&!r},a.K4((()=>r.removeExternalData(m)))],[e=>{let{addonsLoaded:t,addonInitd:n}=e;return!t&&!n},a.K4(o.Q1)],a.K4((e=>{let{stopped:n}=e;const a=t.getSpecializedActivations(d),c=new Set([...a]);(0,o.zG)(l,i.UI(s.hX((e=>c.has(e)))),i.D8(s.Eh(u.Eq)),i.UI(s.UI((e=>e.toString()))),(e=>i.vP(e,n)),i.YP((e=>{let[t,n]=e;n||r.setExternalJsonData(m,t)})))}))]),a.UI(o.Q1))}const d="freewheel",p=e=>{(0,r.Hn)(d)("auto_init",!1)&&e.q.push({functionName:"addon",arguments:[d,{}]})};class _{constructor(e){}}const m="_pfws"},122:(e,t,n)=>{n.d(t,{X:()=>r});const r=e=>{let t=!0;const n=[];return{addBlocker:r=>{n.push(r),e.logger.log("<blockers> added blocker "+r),e.messages.on(r,(()=>{if(t){const i=n.indexOf(r);i>=0&&(n.splice(i,1),e.logger.log("<blockers> removed blocker "+r)),0===n.length&&(t=!1,e.messages.emit("permutive:blockers:empty"),e.logger.log("<blockers> complete"))}}))}}}},7748:(e,t,n)=>{n.d(t,{X:()=>i});var r=n(2851);class i{ref;setCustomProps;constructor(){const[e,t]=r.Ue({});this.ref=e,this.setCustomProps=t}getCustomProps(){return this.ref.current}}},5717:(e,t,n)=>{n.r(t),n.d(t,{EventsCache:()=>b,RESET_HISTORICAL:()=>v});var r=n(2688),i=n(1828),o=n(3328),s=n(365),a=n(3735),u=n(2884),c=n(7407),l=n(2707),f=n(7548),d=n(2652),p=n(4730);class _ extends Error{constructor(e){super(e),this.name="StoreClosingError"}}const m="permutive-events-cache",g="permutive-events-for-page",v="historical",h="[EVENTSCACHE]",y=e=>"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name;class b{config;logger;reportError;trace;metrics;userId;makeEventsStore;eventStore;eventsCache=this.makeEventsRepository(m);eventsForPage=this.makeEventsRepository(g);eventsTTLInMilliseconds;readiness;debouncedReportError=(()=>new p.b(5e3,5e3).schedule((e=>this.reportError(e.errorMessage,{userId:e.userId}))))();static initialise(e,t,n,r,i,o,s){return(0,a.zG)(s(),l.UI((a=>new b(e,t,n,r,i,o,s,a))))}constructor(e,t,n,r,i,o,s,l){this.config=e,this.logger=t,this.reportError=n,this.trace=r,this.metrics=i,this.userId=o,this.makeEventsStore=s,this.eventStore=l,this.eventsTTLInMilliseconds=(0,a.zG)((0,u.ij)(this.config.eventsTTLInDays),(0,u.tS)((e=>"number"==typeof e&&e>0?(0,u.G)(24*e*3600):u.YP))),this.eventsCache.events=(0,d.HP)((()=>(0,d.PQ)((0,a.zG)(c.tD((()=>this.trace.startSpan("load_event_cache"))),c.tS((e=>(0,a.zG)(this.loadFromDisk(),c.At((t=>()=>{e.finish(),this.logDebug(`Event cache loaded, #e ${t.length}`)}))))))))),this.readiness=this.eventsCache.events().then((()=>this.migratePreviousPagesEvents())),o.onChange((()=>this.reset()))}async migratePreviousPagesEvents(){const e=this.trace.startSpan("migrate_previous_for_page_events"),t=(0,c.pE)((e=>(0,l.Y3)((()=>e.flush()),r.w)));return(0,a.zG)([this.eventsForPage,this.eventsCache],t,(0,c.UI)((t=>{const n=o.bj(t);return n.length>0&&this.reportError(`Migrate previous events failed. Got:\n${n.join("\n ")}`,{userId:this.userId.current}),e.finish()})),(e=>e()))}all(){return Promise.all([this.eventsCache.events(),this.eventsForPage.events()]).then(o.xH)}async add(e,t){let{persistOnDisk:n}=t;return this.logDebug("Adding to cache",e),this.eventsForPage.events=(0,a.zG)(this.eventsForPage.events,c.UI((t=>[...t,e])),d.HP),n&&this.readiness.then((()=>this.eventsForPage.flush())),e}filterEventsByWorkspace(e){return e}pruneEventsToSizeLimit(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.config.eventsCacheLimitBytes;if(n<=0||t<=n)return this.logDebug(`Event size of ${t} less than limit of ${n}`),{events:e,sizeInBytes:t};this.logDebug("Events before pruning",{count:e.length,sizeInBytes:t,byteLimit:n});let r=1,i=[...e];for(;t>n;)i.splice(0,r),r*=2,t=2*JSON.stringify(i).length;return this.logDebug("Events after pruning",{count:i.length,sizeInBytes:t}),{events:i,sizeInBytes:t}}loadFromDisk(){const e=()=>[],t=(0,a.zG)(this.eventsTTLInMilliseconds,u.EQ((()=>a.yR),(e=>o.hX((t=>e>Date.now()-t.time.getTime())))));return(0,a.zG)(c.tD((()=>(this.logLog("Loading event cache..."),this.metrics.startTimer("sdk_load_events_cache_task_duration_seconds",{})))),c.YO("loadEventsCacheTask"),c.ak("eventsFromDisk",(()=>(0,a.zG)(o.nI([this.eventStore.get(m),this.eventStore.get(g)]),o.UI(l.LV((0,d.lo)([[e=>e instanceof _,(0,a.ls)(e,c.of)],t=>(0,a.zG)(c.tD((()=>this.reportError(`Error fetching data from store. Got ${t}`,{userId:this.userId.current}))),c.tS((()=>()=>this.reset("historical"))),c.UI(e))]),(0,a.ls)(u.fS(e),c.of))),o.vP(c.qA)))),c.At((e=>{let{eventsFromDisk:t,loadEventsCacheTask:n}=e;return()=>{this.logDebug("Read events from store:",t),this.metrics.stopTimer("sdk_load_events_cache_task_duration_seconds",n)}})),c.UI((0,a.ls)((0,d.vg)("eventsFromDisk"),o.xH,this.filterEventsByWorkspace,(e=>this.pruneEventsToSizeLimit(e,2*JSON.stringify(e).length)),(e=>(this.eventsCache.sizeInBytes=e.sizeInBytes,this.eventsCache.sizeInBytesLastSuccessfulWrite=e.sizeInBytes,e.events.length>0&&(this.metrics.track({name:"sdk_events_cache_byte_total",value:e.sizeInBytes,labels:{}}),this.metrics.track({name:"sdk_events_cache_size_total",value:e.events.length,labels:{}})),e.events)),o.UI(f.k),t)))}async reset(e){return(0,a.zG)(c.tD((()=>this.logDebug("Resetting Events Cache"))),c.tS((()=>this.eventStore.deleteStore())),l.tS((()=>this.makeEventsStore())),l.Zl((t=>(this.eventStore=t,e===v?i.gz(l.Ij)(this.eventsCache.reset,this.eventsForPage.flush):i.gz(l.Ij)(this.eventsCache.reset,this.eventsForPage.reset)))),l.wE((()=>()=>this.all())),l.fS((()=>c.of(w()))),(e=>e()))}getStateSizeInBytes(){return this.eventsForPage.sizeInBytes+this.eventsCache.sizeInBytes}makeEventsRepository(e){const t=(()=>{let e=Promise.resolve(s.F2((0,a.Q1)()));return t=>e=e.then(t)})(),n=e=>(0,a.zG)(c.tD((()=>this.logDebug(`Writing ${e.length} events to ${v.key}`))),c.tS((()=>this.eventStore.put(e.map(f.X),v.key))),l.UI(a.Q1)),i=(0,a.zG)(c.tD((()=>this.logDebug(`Deleting events for ${v.key}`))),c.tS((()=>this.eventStore.delete(v.key))),l.Vn(r.w)),o=(0,a.ls)(c.of,c.At((e=>()=>this.logError(`Events cache failed to put ${v.key}. Got ${e}`))),c.tS((0,d.lo)([[e=>y(e)&&v.retryAttempts<9,()=>(0,a.zG)(c.tD((()=>{v.retryAttempts+=1,this.logDebug(`Attempt #${v.retryAttempts} to write ${v.key} to EventsStore`)})),c.tS((()=>g)),c.tS((()=>p)))],[e=>y(e),e=>(0,a.zG)(c.tD((()=>this.logDebug(`Attempted ${v.retryAttempts} rewrite attempts and reached limit of 9 max writes.`,"Reporting QuotaExceededError to API"))),c.tS((()=>()=>this.debouncedReportError({errorMessage:`Events cache failed to put ${v.key}. Got ${e}`,userId:this.userId.current}))),c.tS((()=>l.t$(e))))],l.t$]))),u=e=>l.tD((()=>{this.logDebug(`Successfully wrote events for ${v.key} after ${v.retryAttempts} attempts`),v.retryAttempts=0,v.sizeInBytes=2*JSON.stringify(e).length,v.sizeInBytesLastSuccessfulWrite=v.sizeInBytes})),p=(0,a.zG)((()=>v.events()),c.tS((e=>(0,a.zG)(n(e),c.mU(s.EQ(o,(()=>u(e)))))))),_=(e,t)=>(0,a.zG)(e.events,c.UI((n=>{const r=2*JSON.stringify(n).length,i=this.pruneEventsToSizeLimit(n,r,t);return e.events=c.of(i.events),e.sizeInBytes=i.sizeInBytes,t-e.sizeInBytes}))),m=(e,t)=>{let[n,...r]=e;return n&&0!==t?(0,a.zG)(_(n,t),c.tS((e=>(this.logDebug(`${e} left after pruning ${n.key}`),m(r,e))))):c.of((0,a.Q1)())},g=(0,a.zG)(l.tD((()=>this.eventsForPage.sizeInBytes-this.eventsForPage.sizeInBytesLastSuccessfulWrite)),l.fX(s.DT((e=>e>0),(e=>new Error(`${this.eventsForPage.key} failed to write the same or smaller events cache of size ${e}`)))),l.tS((e=>{const t=1.2*e,n=[this.eventsCache,this.eventsForPage];return this.logDebug(`Pruning ${t} bytes from`,n),(0,a.zG)(m(n,t),l.fF)}))),v={key:e,events:c.of([]),sizeInBytes:0,sizeInBytesLastSuccessfulWrite:0,retryAttempts:0,flush:()=>(0,a.zG)(c.tD((()=>this.trace.startSpan(`write_${v.key}`))),c.tS((e=>(0,a.zG)(p,c.At((()=>()=>e.finish()))))),t),reset:()=>(0,a.zG)(c.tD((()=>{v.events=c.of([]),v.sizeInBytes=0,v.sizeInBytesLastSuccessfulWrite=0})),c.tS((()=>i)),t)};return v}logDebug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.debug(h,...t)}logWarn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.warn(h,...t)}logError(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.error(h,...t)}logLog(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.log(h,...t)}}const w=()=>[]},9381:(e,t,n)=>{n.r(t),n.d(t,{DBStore:()=>s});var r=n(2688),i=n(2884),o=n(2707);class s{db;constructor(e){this.db=Promise.resolve(e)}put(e,t){return(0,o.Y3)((()=>this.db.then((n=>n.put(e,t)))),r.w)}get(e){return(0,o.Y3)((()=>this.db.then((t=>t.get(e))).then(i.ij)),r.w)}delete(e){return(0,o.Y3)((()=>this.db.then((t=>t.delete(e)))),(e=>String(e)))}deleteStore(){return(0,o.Y3)((()=>this.db.then((e=>e.deleteStore()))),(e=>String(e)))}}},4064:(e,t,n)=>{function r(e){return"development"===e.environment?self.isSecureContext:"https:"===self.location.protocol}n.d(t,{T:()=>r})},6197:(e,t,n)=>{n(2652)},6272:(e,t,n)=>{n(3992)},7476:(e,t,n)=>{n.r(t),n.d(t,{eventCacheService:()=>f,eventNameBlacklist:()=>p});var r=n(2851),i=n(2116),o=n(6392),s=n(3735),a=n(3328),u=n(2652),c=n(8377),l=n(7548);const f=e=>i.dQ((0,s.ls)((e=>{let{previousState:t}=e;return function(e){if(e&&"object"==typeof e)return{previousUnloadEvents:"previousUnloadEvents"in e?d(e.previousUnloadEvents):[]};return{previousUnloadEvents:[]}}(t)}),(t=>{let{previousUnloadEvents:n}=t;n.forEach((t=>e.eventsCache.add((0,l.k)(t),{persistOnDisk:!0})));return{value:{newEvents:(0,s.zG)(e.newEvents,r.UI(o.UI((0,u.bw)(a.UI((t=>{let[,n]=t;p.has(n.name)||e.eventsCache.add(n,{persistOnDisk:!0})})))))),priorEvents:()=>e.eventsCache.all()},state:(0,s.zG)(e.eventsToProcessOnPageUnload,r.UI(a.hX((e=>{let[,t]=e;return!p.has(t.name)}))),r.UI(a.UI((0,s.ls)(c.Yg,l.X))),r.UI((e=>({previousUnloadEvents:e}))))}})));function d(e){return e&&Array.isArray(e)?e:[]}const p=new Set(["AdRequest","PageviewEngagement","PrebidAuctions","Reaction","SegmentEntry","SegmentExit","SlotRendered","ThirdPartySegments","VideoEngagement"])},926:(e,t,n)=>{n.d(t,{Kd:()=>i,eJ:()=>o});n(9853);var r=n(2116);n(2851),n(2652);const i="addon:twitter_pixel",o=function(e){return r.K4((()=>{}))}},1828:(e,t,n)=>{n.d(t,{Yt:()=>l,ap:()=>o,gz:()=>c});var r=n(3735),i=n(9384);function o(e,t){return function(n){return function(r){return e.ap(e.map(r,(function(e){return function(n){return t.ap(e,n)}})),n)}}}function s(e,t,n){return function(r){for(var i=Array(n.length+1),o=0;o<n.length;o++)i[o]=n[o];return i[n.length]=r,0===t?e.apply(null,i):s(e,t-1,i)}}var a={1:function(e){return[e]},2:function(e){return function(t){return[e,t]}},3:function(e){return function(t){return function(n){return[e,t,n]}}},4:function(e){return function(t){return function(n){return function(r){return[e,t,n,r]}}}},5:function(e){return function(t){return function(n){return function(r){return function(i){return[e,t,n,r,i]}}}}}};function u(e){return i.e$.call(a,e)||(a[e]=s(r.bc,e-1,[])),a[e]}function c(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=t.length,i=u(r),o=e.map(t[0],i),s=1;s<r;s++)o=e.ap(o,t[s]);return o}}function l(e){return function(t){for(var n=Object.keys(t),r=n.length,i=function(e){var t=e.length;switch(t){case 1:return function(t){var n;return(n={})[e[0]]=t,n};case 2:return function(t){return function(n){var r;return(r={})[e[0]]=t,r[e[1]]=n,r}};case 3:return function(t){return function(n){return function(r){var i;return(i={})[e[0]]=t,i[e[1]]=n,i[e[2]]=r,i}}};case 4:return function(t){return function(n){return function(r){return function(i){var o;return(o={})[e[0]]=t,o[e[1]]=n,o[e[2]]=r,o[e[3]]=i,o}}}};case 5:return function(t){return function(n){return function(r){return function(i){return function(o){var s;return(s={})[e[0]]=t,s[e[1]]=n,s[e[2]]=r,s[e[3]]=i,s[e[4]]=o,s}}}}};default:return s((function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];for(var i={},o=0;o<t;o++)i[e[o]]=n[o];return i}),t-1,[])}}(n),o=e.map(t[n[0]],i),a=1;a<r;a++)o=e.ap(o,t[n[a]]);return o}}},5851:(e,t,n)=>{n.d(t,{oA:()=>b,t9:()=>p,DZ:()=>y,Ew:()=>c,f2:()=>l,xH:()=>v,jV:()=>_,uK:()=>w,tV:()=>I,u4:()=>S,DY:()=>d});var r=n(3735),i=(n(7341),n(9384)),o=n(7241);i.r1;var s=function(e){return[e]};o.xP,o.Lx,o.u4,o.OE,o.nq,o.iw,o.YM,o.ZN,o.Eh,i.F4,o.YM,o.Z$,o.VV,o.Fp,o.j0;o.ur;var a=n(3328),u=n(4870);n(5605);a.P5,a.YM,a.Z$;a.cx;function c(e){return a.Ew(e)}var l=a.f2;a.JO,a.qr;var f=function(e){return e.slice()},d=function(e){return function(t){return t.length<=1?f(t):t.slice().sort(e.compare)}};var p=a.t9;function _(e){var t=p(e);return function(n,r){if(void 0===r){var i=_(e);return function(e){return i(e,n)}}return n.filter((function(e){return t(e,r)}))}}a.kp,a.Eq;var m=s,g=function(e){return function(t){return(0,r.zG)(t,function(e){return function(t){for(var n=[],r=0;r<t.length;r++)n.push.apply(n,e(r,t[r]));return n}}((function(t,n){return e(n)})))}},v=g(r.yR),h=function(e){return function(t){for(var n=[],r=0;r<t.length;r++){var o=e(r,t[r]);i.pC(o)&&n.push(o.value)}return n}},y=function(e){return h((function(t,n){return e(n)}))},b=y(r.yR),w=function(e){return E((function(t,n){return e(n)}))},E=function(e){return function(t){for(var n=[],r=[],i=0;i<t.length;i++){var o=t[i];e(i,o)?r.push(o):n.push(o)}return(0,u.s4)(n,r)}},I=function(e){return k((function(t,n){return e(n)}))},k=function(e){return function(t){for(var n=[],r=[],i=0;i<t.length;i++){var o=e(i,t[i]);"Left"===o._tag?n.push(o.left):r.push(o.right)}return(0,u.s4)(n,r)}},S=(a.Lx,a.xP,a.u4);a.OE,a.nq,a.iw,a.ZN,a.Eh,a.pR,a.pJ,a.oR,a.yW,a.j0,i.F4},6862:(e,t,n)=>{function r(e){return function(t){return function(n){return e.chain(n,(function(n){return e.map(t(n),(function(){return n}))}))}}}function i(e){return function(t,n){return function(r){return e.chain(r,(function(r){return e.map(n(r),(function(e){var n;return Object.assign({},r,((n={})[t]=e,n))}))}))}}}n.d(t,{a:()=>i,m:()=>r})},365:(e,t,n)=>{n.d(t,{G5:()=>v,dO:()=>_,Pd:()=>w,ak:()=>q,tS:()=>y,Y$:()=>C,g_:()=>G,ij:()=>x,DT:()=>k,fS:()=>O,pF:()=>z,nM:()=>S,t$:()=>a,UI:()=>p,Vn:()=>E,EQ:()=>U,F2:()=>u,LF:()=>T,KC:()=>R,i$:()=>A,Y3:()=>M});var r=n(6862),i=n(2690),o=n(3735),s=(n(7341),n(9384)),a=s.t$,u=s.F2,c=function(e,t){return(0,o.zG)(e,p(t))},l=function(e,t){return(0,o.zG)(e,g(t))},f=function(e,t){return(0,o.zG)(e,y(t))},d="Either",p=function(e){return function(t){return S(t)?t:u(e(t.right))}},_={URI:d,map:c},m=u,g=function(e){return function(t){return S(t)?t:S(e)?e:u(t.right(e.right))}},v={URI:d,map:c,ap:l},h=function(e){return function(t){return S(t)?t:e(t.right)}},y=h,b={URI:d,map:c,ap:l,chain:f},w=function(e,t){return function(n){return S(n)?a(e(n.left)):u(t(n.right))}},E=function(e){return function(t){return S(t)?a(e(t.left)):t}},I={URI:d,fromEither:o.yR},k=(0,i.DT)(I),S=s.nM,P=(s.tO,function(e,t){return function(n){return S(n)?e(n.left):t(n.right)}}),D=P,U=P,G=U,z=function(e){return function(t){return S(t)?e(t.left):t.right}},O=z,C=(0,i.Y$)(I,b),T=function(e){return S(e)?u(e.left):a(e.right)},x=function(e){return function(t){return null==t?a(e):u(t)}},M=function(e,t){try{return u(e())}catch(e){return a(t(e))}},A=D(o.yR,o.yR);function R(e){return e instanceof Error?e:new Error(String(e))}s.F4;var q=(0,r.a)(b);s.Xl},4268:(e,t,n)=>{n.d(t,{f7:()=>r,n_:()=>i,w4:()=>o});n(3735);var r=function(e){return{equals:function(t,n){return t===n||e(t,n)}}},i=function(e){return r((function(t,n){for(var r in e)if(!e[r].equals(t[r],n[r]))return!1;return!0}))},o={equals:function(e,t){return e===t}};o.equals},2690:(e,t,n)=>{n.d(t,{DT:()=>o,Y$:()=>u,fX:()=>a});var r=n(3735),i=n(9384);function o(e){return function(t,n){return function(r){return e.fromEither(t(r)?i.F2(r):i.t$(n(r)))}}}function s(e){return function(t){return(0,r.ls)(t,e.fromEither)}}function a(e,t){var n=s(e);return function(e){return function(r){return t.chain(r,n(e))}}}function u(e,t){return function(n,r){return function(o){return t.chain(o,(function(t){return e.fromEither(n(t)?i.F2(t):i.t$(r(t)))}))}}}},7341:(e,t,n)=>{function r(e,t){return function(n){return function(r){return e.map(r,(function(e){return t.map(e,n)}))}}}function i(e){return function(t){return function(n){return e.map(n,(function(e){var n;return(n={})[t]=e,n}))}}}function o(e){return function(t,n){return function(r){return e.map(r,(function(e){var r;return Object.assign({},e,((r={})[t]=n(e),r))}))}}}n.d(t,{Hr:()=>o,UI:()=>r,YO:()=>i})},6392:(e,t,n)=>{n.d(t,{G5:()=>l,RD:()=>_,UI:()=>a,of:()=>u});var r=n(3735),i=(n(7341),n(9384)),o=function(e,t){return function(){return t(e())}},s=function(e,t){return function(){return e()(t())}},a=function(e){return function(t){return o(t,e)}},u=r.a9,c="IO",l={URI:c,map:o,ap:s},f=(r.yR,r.yR,i.F4,u(i.Xl)),d=function(e){var t=function(e){return function(t){return function(){for(var n=[e(0,i.YM(t))()],r=1;r<t.length;r++)n.push(e(r,t[r])());return n}}}(e);return function(e){return i.Od(e)?t(e):f}},p=function(e){return d((function(t,n){return e(n)}))},_=p(r.yR)},2884:(e,t,n)=>{n.d(t,{G5:()=>D,Ri:()=>A,xu:()=>K,dO:()=>k,wp:()=>z,tS:()=>U,mU:()=>V,hX:()=>R,DZ:()=>q,xH:()=>H,g_:()=>W,Uo:()=>$,ij:()=>J,KQ:()=>X,DT:()=>f,Eh:()=>E,IS:()=>d,fS:()=>Q,EK:()=>p,lo:()=>C,Wi:()=>F,pC:()=>Y,UI:()=>I,EQ:()=>j,aD:()=>N,YP:()=>c,of:()=>S,RD:()=>re,G:()=>l,FS:()=>ee,Y3:()=>Z,bM:()=>O});var r=n(6862),i=n(3735),o=(n(7341),n(9384)),s=n(6017),a=n(4870);n(5605);function u(e,t){return function(n){return n?t.of(void 0):e.zero()}}var c=o.YP,l=o.G;function f(e){return function(t){return e(t)?l(t):c}}var d=function(e){return"Right"===e._tag?c:l(e.left)},p=function(e){return"Left"===e._tag?c:l(e.right)},_=function(e,t){return(0,i.zG)(e,I(t))},m=function(e,t){return(0,i.zG)(e,P(t))},g=function(e,t){return(0,i.zG)(e,U(t))},v=function(e,t){return(0,i.zG)(e,R(t))},h=function(e,t){return(0,i.zG)(e,q(t))},y=function(e,t){return(0,i.zG)(e,L(t))},b=function(e,t){return(0,i.zG)(e,B(t))},w="Option",E=function(e){return{equals:function(t,n){return t===n||(F(t)?F(n):!F(n)&&e.equals(t.value,n.value))}}},I=function(e){return function(t){return F(t)?c:l(e(t.value))}},k={URI:w,map:_},S=l,P=function(e){return function(t){return F(t)||F(e)?c:l(t.value(e.value))}},D={URI:w,map:_,ap:m},U=function(e){return function(t){return F(t)?c:e(t.value)}},G={URI:w,map:_,ap:m,chain:g},z=function(e){return function(t){return F(t)?e():t}},O=function(){return c},C=u({URI:w,zero:O},{URI:w,of:S}),T=U(i.yR),x=(0,a.s4)(c,c),M=function(e){return F(e)?x:(0,a.s4)(d(e.value),p(e.value))},A={URI:w,compact:T,separate:M},R=function(e){return function(t){return F(t)?c:e(t.value)?t:c}},q=function(e){return function(t){return F(t)?c:e(t.value)}},L=function(e){return function(t){return(0,a.s4)(v(t,(0,s.ff)(e)),v(t,e))}},B=function(e){return(0,i.ls)(I(e),M)},K={URI:w,map:_,compact:T,separate:M,filter:v,filterMap:h,partition:y,partitionMap:b},$=p,Y=o.pC,F=function(e){return"None"===e._tag},N=function(e,t){return function(n){return F(n)?e():t(n.value)}},j=N,W=j,Q=function(e){return function(t){return F(t)?e():t.value}},H=T,V=(0,r.m)(G),J=function(e){return null==e?c:l(e)},Z=function(e){try{return l(e())}catch(e){return c}},X=function(e){return(0,i.ls)(e,J)},ee=j(i.r5,i.yR);o.F4;var te=S(o.Xl),ne=function(e){var t=function(e){return function(t){var n=e(0,o.YM(t));if(F(n))return c;for(var r=[n.value],i=1;i<t.length;i++){var s=e(i,t[i]);if(F(s))return c;r.push(s.value)}return l(r)}}(e);return function(e){return o.Od(e)?t(e):te}},re=function(e){return ne((function(t,n){return e(n)}))}(i.yR)},7209:(e,t,n)=>{n.d(t,{Fp:()=>u,VV:()=>a,Zt:()=>s,uZ:()=>c});var r=n(4268),i=n(3735),o=function(e){return function(t,n){return t===n||0===e(t,n)}},s=function(e){return{equals:o(e),compare:function(t,n){return t===n?0:e(t,n)}}},a=(i.W8,function(e){return function(t,n){return t===n||e.compare(t,n)<1?t:n}}),u=function(e){return function(t,n){return t===n||e.compare(t,n)>-1?t:n}},c=function(e){var t=a(e),n=u(e);return function(e,r){return function(i){return n(t(i,r),e)}}};r.w4.equals},6017:(e,t,n)=>{n.d(t,{ff:()=>r});n(3735);var r=function(e){return function(t){return!e(t)}}},3328:(e,t,n)=>{n.d(t,{$R:()=>D,DZ:()=>Y,EQ:()=>m,Eh:()=>ne,Eq:()=>T,Ew:()=>w,G:()=>le,Hr:()=>pe,JO:()=>I,Lx:()=>Q,OE:()=>H,Od:()=>p,P5:()=>v,Su:()=>L,UI:()=>q,YM:()=>h,YO:()=>de,Z$:()=>y,ZN:()=>ee,bM:()=>M,bj:()=>P,cS:()=>ue,cx:()=>b,f2:()=>E,hX:()=>K,hp:()=>S,iw:()=>J,j0:()=>fe,kp:()=>C,nI:()=>ae,nq:()=>V,oR:()=>se,of:()=>x,oh:()=>B,pJ:()=>oe,pR:()=>re,qr:()=>k,t9:()=>U,tS:()=>A,u4:()=>W,uK:()=>F,uZ:()=>te,vP:()=>Z,xH:()=>R,xP:()=>j,xb:()=>d,yW:()=>ce,zo:()=>G});var r=n(4268),i=n(3735),o=n(7341),s=n(9384),a=n(4011),u=n(7209),c=n(7241),l=n(4870),f=(n(5605),function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}),d=function(e){return 0===e.length},p=c.Od,_=(c.Ce,c.ws,c.R3);c.Im;var m=function(e,t){return function(n){return p(n)?t(n):e()}},g=c.dC;function v(e,t){return void 0===t?function(t){return v(e,t)}:g(e,t)?s.YP:s.G(t[e])}var h=function(e){return p(e)?s.G(c.YM(e)):s.YP},y=function(e){return p(e)?s.G(c.Z$(e)):s.YP};var b=function(e){return function(t){for(var n=0;n<t.length;n++)if(e(t[n]))return s.G(n);return s.YP}};function w(e){return function(t){for(var n=0;n<t.length;n++)if(e(t[n]))return s.G(t[n]);return s.YP}}var E=function(e){return function(t){for(var n=0;n<t.length;n++){var r=e(t[n]);if(s.pC(r))return r}return s.YP}};var I=function(e){return function(t){for(var n=t.length-1;n>=0;n--){var r=e(t[n]);if(s.pC(r))return r}return s.YP}},k=function(e){return function(t){for(var n=t.length-1;n>=0;n--)if(e(t[n]))return s.G(n);return s.YP}},S=function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];"Right"===r._tag&&t.push(r.right)}return t},P=function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];"Left"===r._tag&&t.push(r.left)}return t};function D(e,t){return void 0===t?function(t){return D(t,e)}:function(e,t,n){for(var r=[],i=Math.min(e.length,t.length),o=0;o<i;o++)r[o]=n(e[o],t[o]);return r}(e,t,(function(e,t){return[e,t]}))}function U(e){return function(t,n){if(void 0===n){var r=U(e);return function(e){return r(t,e)}}for(var i,o=0;o<n.length;o++)if(i=n[o],e.equals(i,t))return!0;return!1}}var G=function(e){return function(t){return d(t)?e:d(e)?t:t.concat(e)}};var z=function(e,t){return(0,i.zG)(e,q(t))},O=function(e,t,n){return(0,i.zG)(e,W(t,n))},C=function(e,t){return(0,i.zG)(e,oe(t))},T=function(e,t){return(0,i.zG)(e,se(t))},x=c.of,M=function(){return ue},A=function(e){return function(t){return(0,i.zG)(t,function(e){return function(t){if(d(t))return ue;for(var n=[],r=0;r<t.length;r++)n.push.apply(n,e(r,t[r]));return n}}((function(t,n){return e(n)})))}},R=A(i.yR),q=function(e){return function(t){return t.map((function(t){return e(t)}))}},L=function(e){return function(t){return t.map((function(t,n){return e(n,t)}))}},B=function(e){for(var t=[],n=[],r=0,i=e;r<i.length;r++){var o=i[r];"Left"===o._tag?t.push(o.left):n.push(o.right)}return(0,l.s4)(t,n)},K=function(e){return function(t){return t.filter(e)}},$=function(e){return function(t){for(var n=[],r=0;r<t.length;r++){var i=e(r,t[r]);s.pC(i)&&n.push(i.value)}return n}},Y=function(e){return $((function(t,n){return e(n)}))},F=(i.yR,function(e){return N((function(t,n){return e(n)}))}),N=function(e){return function(t){for(var n=[],r=[],i=0;i<t.length;i++){var o=t[i];e(i,o)?r.push(o):n.push(o)}return(0,l.s4)(n,r)}},j=function(e){return function(t){return function(n){return n.reduce((function(n,r,i){return e.concat(n,t(i,r))}),e.empty)}}},W=function(e,t){return H(e,(function(e,n,r){return t(n,r)}))},Q=function(e){var t=j(e);return function(e){return t((function(t,n){return e(n)}))}},H=function(e,t){return function(n){for(var r=n.length,i=e,o=0;o<r;o++)i=t(o,i,n[o]);return i}},V=function(e,t){return J(e,(function(e,n,r){return t(n,r)}))},J=function(e,t){return function(n){return n.reduceRight((function(e,n,r){return t(r,n,e)}),e)}},Z=function(e){return function(t){return O(t,e.of(M()),(function(t,n){return e.ap(e.map(t,(function(e){return function(t){return(0,i.zG)(e,_(t))}})),n)}))}},X="ReadonlyArray",ee=function(e){return{show:function(t){return"[".concat(t.map(e.show).join(", "),"]")}}},te=function(){return{concat:function(e,t){return d(e)?t:d(t)?e:e.concat(t)},empty:ue}},ne=function(e){return(0,r.f7)((function(t,n){return t.length===n.length&&t.every((function(t,r){return e.equals(t,n[r])}))}))},re=function(e){return(0,u.Zt)((function(t,n){for(var r=t.length,i=n.length,o=Math.min(r,i),s=0;s<o;s++){var u=e.compare(t[s],n[s]);if(0!==u)return u}return a.Df.compare(r,i)}))},ie={URI:X,map:z},oe=function(e){return function(t){for(var n=f([],e(t),!0),r=[];n.length>0;){var i=n.shift();s.nM(i)?n.unshift.apply(n,e(i.left)):r.push(i.right)}return r}},se=function(e){return function(t){var n=e(t),r=[],i=[];function o(t){s.nM(t)?e(t.left).forEach((function(e){return r.push(e)})):i.push(t.right)}for(var a=0,u=n;a<u.length;a++){o(u[a])}for(;r.length>0;)o(r.shift());return i}},ae=(c.oo,function(e){return d(e)?ue:e.slice()}),ue=c.cS;function ce(e){return function(t){return t.every(e)}}var le=function(e){return function(t){return t.some(e)}},fe=function(e){var t=c.j0(e);return function(n){return m((function(){return e.empty}),t(n))}},de=(s.F4,(0,o.YO)(ie)),pe=(0,o.Hr)(ie);c.w6,c.QI,c.Ss},7241:(e,t,n)=>{n.d(t,{R3:()=>v,Im:()=>g,ur:()=>$,QI:()=>F,cS:()=>f,Lx:()=>G,xP:()=>C,c2:()=>y,Eh:()=>A,ZN:()=>M,vM:()=>I,YM:()=>R,j0:()=>Y,Od:()=>d,dC:()=>p,Z$:()=>L,UI:()=>P,Fp:()=>K,VV:()=>B,of:()=>S,Ce:()=>m,ws:()=>_,w6:()=>w,u4:()=>U,nq:()=>z,iw:()=>T,OE:()=>O,Ss:()=>N,oo:()=>h});var r,i=n(4268),o=n(3735),s=(n(7341),n(9384)),a=n(7209),u=function(e){return{concat:a.VV(e)}},c=function(e){return{concat:a.Fp(e)}};r=void 0;var l=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},f=s.Xl,d=s.Od,p=function(e,t){return e<0||e>=t.length},_=function(e){return function(t){return l([e],t,!0)}},m=_,g=function(e){return function(t){return l(l([],t,!0),[e],!1)}},v=g,h=function(e,t,n){if(d(n)){var r=s.r1(n);return r.splice(e,0,t),r}return[t]},y=function(e){return d(e)?s.G(e):s.YP},b=function(e){return function(t){for(var n=Math.max(0,Math.floor(t)),r=[e(0)],i=1;i<n;i++)r.push(e(i));return r}},w=function(e,t){return e<=t?b((function(t){return e+t}))(t-e+1):[e]};function E(e,t){return t?e.concat(t):function(t){return t.concat(e)}}var I=function(e){return function(t){for(var n={},r=0,i=t;r<i.length;r++){var o=i[r],a=e(o);s.e$.call(n,a)?n[a].push(o):n[a]=[o]}return n}};var k=function(e){return function(t){for(var n=[e,t[0]],r=1;r<t.length;r++)n.push(e,t[r]);return n}},S=s.ri,P=function(e){return D((function(t,n){return e(n)}))},D=function(e){return function(t){for(var n=[e(0,R(t))],r=1;r<t.length;r++)n.push(e(r,t[r]));return n}},U=function(e,t){return O(e,(function(e,n,r){return t(n,r)}))},G=function(e){return function(t){return function(n){return n.slice(1).reduce((function(n,r){return e.concat(n,t(r))}),t(n[0]))}}},z=function(e,t){return T(e,(function(e,n,r){return t(n,r)}))},O=function(e,t){return function(n){return n.reduce((function(e,n,r){return t(r,e,n)}),e)}},C=function(e){return function(t){return function(n){return n.slice(1).reduce((function(n,r,i){return e.concat(n,t(i+1,r))}),t(0,n[0]))}}},T=function(e,t){return function(n){return n.reduceRight((function(e,n,r){return t(r,n,e)}),e)}},x=s.YM,M=function(e){return{show:function(t){return"[".concat(t.map(e.show).join(", "),"]")}}},A=function(e){return(0,i.f7)((function(t,n){return t.length===n.length&&t.every((function(t,r){return e.equals(t,n[r])}))}))},R=(s.F4,x),q=s.Gb,L=function(e){return e[e.length-1]},B=function(e){var t=u(e);return function(e){return e.reduce(t.concat)}},K=function(e){var t=c(e);return function(e){return e.reduce(t.concat)}},$=function(e){return function(t){return t.reduce(e.concat)}},Y=function(e){var t=$(e);return function(e){return(0,o.ls)(function(e){return function(t){var n=q(t);return d(n)?(0,o.zG)(n,k(e),m(R(t))):t}}(e),t)}};function F(e,t){return void 0===t?m(e):(0,o.zG)(t,m(e))}var N=function(e,t){return(0,o.zG)(e,E([t]))}},4923:(e,t,n)=>{n.d(t,{Bu:()=>m,CC:()=>A,DZ:()=>X,EG:()=>_,EW:()=>Y,Eh:()=>ue,G:()=>O,HA:()=>T,Hd:()=>P,I8:()=>q,P5:()=>g,RF:()=>R,RJ:()=>B,SW:()=>N,Su:()=>h,UI:()=>y,Ub:()=>W,V_:()=>$,XP:()=>f,_Y:()=>K,_r:()=>S,dp:()=>u,dx:()=>d,e$:()=>p,hX:()=>Z,jt:()=>D,kp:()=>M,mK:()=>V,mS:()=>L,nn:()=>x,nr:()=>le,nu:()=>F,oA:()=>oe,oh:()=>se,qS:()=>H,ri:()=>I,sq:()=>G,t9:()=>C,tV:()=>te,uK:()=>ee,uZ:()=>ce,vA:()=>Q,vP:()=>k,xb:()=>c,yW:()=>z,z7:()=>U,zV:()=>j});var r=n(4268),i=n(3735),o=n(9384),s=n(4870),a=n(2751),u=(n(5605),function(e){return Object.keys(e).length}),c=function(e){for(var t in e)if(o.e$.call(e,t))return!1;return!0},l=function(e){return function(t){return Object.keys(t).sort(e.compare)}},f=l(a.Df);var d=function(e,t){return function(n){if(o.e$.call(n,e)&&n[e]===t)return n;var r=Object.assign({},n);return r[e]=t,r}},p=function(e,t){return o.e$.call(t,e)};function _(e){return function(t){if(!o.e$.call(t,e))return t;var n=Object.assign({},t);return delete n[e],n}}function m(e){return function(t,n){if(void 0===n){var r=m(e);return function(e){return r(e,t)}}for(var i in t)if(!o.e$.call(n,i)||!e.equals(t[i],n[i]))return!1;return!0}}function g(e,t){return void 0===t?function(t){return g(e,t)}:o.e$.call(t,e)?o.G(t[e]):o.YP}var v={};function h(e){return function(t){var n={};for(var r in t)o.e$.call(t,r)&&(n[r]=e(r,t[r]));return n}}function y(e){return h((function(t,n){return e(n)}))}function b(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(2===e.length)return b(a.Df).apply(void 0,e);var n=l(e[0]);return function(e,t){return function(r){for(var i=e,o=n(r),s=o.length,a=0;a<s;a++){var u=o[a];i=t(u,i,r[u])}return i}}}function w(e){if("compare"in e){var t=l(e);return function(e){return function(n){return function(r){for(var i=e.empty,o=t(r),s=o.length,a=0;a<s;a++){var u=o[a];i=e.concat(i,n(u,r[u]))}return i}}}}return w(a.Df)(e)}function E(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(2===e.length)return E(a.Df).apply(void 0,e);var n=l(e[0]);return function(e,t){return function(r){for(var i=e,o=n(r),s=o.length-1;s>=0;s--){var a=o[s];i=t(a,r[a],i)}return i}}}var I=function(e,t){var n;return(n={})[e]=t,n};function k(e){return V(a.Df)(e)}function S(e){return function(t){var n={},r={};for(var i in t)if(o.e$.call(t,i)){var a=e(i,t[i]);switch(a._tag){case"Left":n[i]=a.left;break;case"Right":r[i]=a.right}}return(0,s.s4)(n,r)}}function P(e){return function(t){var n={},r={};for(var i in t)if(o.e$.call(t,i)){var a=t[i];e(i,a)?r[i]=a:n[i]=a}return(0,s.s4)(n,r)}}function D(e){return function(t){var n={};for(var r in t)if(o.e$.call(t,r)){var i=e(r,t[r]);o.pC(i)&&(n[r]=i.value)}return n}}function U(e){return function(t){var n={},r=!1;for(var i in t)if(o.e$.call(t,i)){var s=t[i];e(i,s)?n[i]=s:r=!0}return r?n:t}}var G=function(e){for(var t={},n=0,r=e;n<r.length;n++){var i=r[n];t[i[0]]=i[1]}return t};function z(e){return function(t){for(var n in t)if(!e(t[n]))return!1;return!0}}function O(e){return function(t){for(var n in t)if(e(t[n]))return!0;return!1}}function C(e){return function(t,n){if(void 0===n){var r=C(e);return function(e){return r(t,e)}}for(var i in n)if(e.equals(n[i],t))return!0;return!1}}var T=function(e,t){return(0,i.zG)(e,y(t))},x=function(e,t){return(0,i.zG)(e,h(t))},M=function(e){var t=ne(e);return function(e,n,r){return(0,i.zG)(e,t(n,r))}},A=function(e){return function(t){var n=re(e)(t);return function(e,t){return(0,i.zG)(e,n(t))}}},R=function(e){var t=ie(e);return function(e,n,r){return(0,i.zG)(e,t(n,r))}},q=function(e,t){return(0,i.zG)(e,Z(t))},L=function(e,t){return(0,i.zG)(e,X(t))},B=function(e,t){return(0,i.zG)(e,ee(t))},K=function(e,t){return(0,i.zG)(e,te(t))},$=function(e){var t=b(e);return function(e,n,r){return(0,i.zG)(e,t(n,r))}},Y=function(e){var t=w(e);return function(e){var n=t(e);return function(e,t){return(0,i.zG)(e,n(t))}}},F=function(e){var t=E(e);return function(e,n,r){return(0,i.zG)(e,t(n,r))}},N=function(e,t){return(0,i.zG)(e,S(t))},j=function(e,t){return(0,i.zG)(e,P(t))},W=function(e,t){return(0,i.zG)(e,D(t))},Q=function(e,t){return(0,i.zG)(e,U(t))},H=function(e){var t=J(e);return function(e){var n=t(e);return function(e,t){return n(e,(0,i.ls)(i.SK,t))}}},V=function(e){var t=H(e);return function(e){var n=t(e);return function(e){return n(e,i.yR)}}},J=function(e){return function(t){var n=l(e);return function(e,r){var i=n(e);if(0===i.length)return t.of(v);for(var o=t.of({}),s=function(n){o=t.ap(t.map(o,(function(e){return function(t){var r;return Object.assign({},e,((r={})[n]=t,r))}})),r(n,e[n]))},a=0,u=i;a<u.length;a++){s(u[a])}return o}}},Z=function(e){return U((function(t,n){return e(n)}))},X=function(e){return D((function(t,n){return e(n)}))},ee=function(e){return P((function(t,n){return e(n)}))},te=function(e){return S((function(t,n){return e(n)}))};function ne(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(1===e.length){var n=b(e[0]);return function(e,t){return n(e,(function(e,n,r){return t(n,r)}))}}return ne(a.Df).apply(void 0,e)}function re(e){if("compare"in e){var t=w(e);return function(e){var n=t(e);return function(e){return n((function(t,n){return e(n)}))}}}return re(a.Df)(e)}function ie(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(1===e.length){var n=E(e[0]);return function(e,t){return n(e,(function(e,n,r){return t(n,r)}))}}return ie(a.Df).apply(void 0,e)}var oe=function(e){var t={};for(var n in e)if(o.e$.call(e,n)){var r=e[n];o.pC(r)&&(t[n]=r.value)}return t},se=function(e){var t={},n={};for(var r in e)if(o.e$.call(e,r)){var i=e[r];o.nM(i)?t[r]=i.left:n[r]=i.right}return(0,s.s4)(t,n)},ae="ReadonlyRecord";function ue(e){var t=m(e);return(0,r.f7)((function(e,n){return t(e)(n)&&t(n)(e)}))}function ce(e){return{concat:function(t,n){if(c(t))return n;if(c(n))return t;var r=Object.assign({},t);for(var i in n)o.e$.call(n,i)&&(r[i]=o.e$.call(t,i)?e.concat(t[i],n[i]):n[i]);return r},empty:v}}a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df;function le(e,t){return o.e$.call(void 0===t?this:t,e)}a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df},8377:(e,t,n)=>{n.d(t,{H5:()=>s,Yg:()=>i,li:()=>r,pL:()=>o});n(3735);function r(e){return e[0]}function i(e){return e[1]}var o=function(e){return function(t){return[e(r(t)),i(t)]}},s=function(e){return function(t){return[r(t),e(i(t))]}}},2197:(e,t,n)=>{n.d(t,{ff:()=>r});var r=function(e){return function(t){return!e(t)}}},4870:(e,t,n)=>{n.d(t,{Pd:()=>i,s4:()=>r});n(3735);var r=function(e,t){return{left:e,right:t}},i=function(e,t){return function(n){return r(e(o(n)),t(s(n)))}},o=function(e){return e.left},s=function(e){return e.right}},7407:(e,t,n)=>{n.d(t,{qA:()=>b,Hi:()=>y,qo:()=>w,dO:()=>v,UA:()=>E,PM:()=>h,ak:()=>D,YO:()=>P,tS:()=>m,mU:()=>I,At:()=>S,tD:()=>u,UI:()=>d,of:()=>_,uU:()=>O,pE:()=>C});var r=n(6862),i=n(3735);function o(e,t){var n=(0,r.m)(t);return function(t){return n((0,i.ls)(t,e.fromIO))}}var s=n(7341),a=n(9384),u=function(e){return function(){return Promise.resolve().then(e)}};var c=function(e,t){return(0,i.zG)(e,d(t))},l=function(e,t){return(0,i.zG)(e,p(t))},f=function(e,t){return(0,i.zG)(e,m(t))},d=function(e){return function(t){return function(){return Promise.resolve().then(t).then(e)}}},p=function(e){return function(t){return function(){return Promise.all([Promise.resolve().then(t),Promise.resolve().then(e)]).then((function(e){return(0,e[0])(e[1])}))}}},_=function(e){return function(){return Promise.resolve(e)}},m=function(e){return function(t){return function(){return Promise.resolve().then(t).then((function(t){return e(t)()}))}}},g="Task";var v={URI:g,map:c},h={URI:g,of:_},y={URI:g,map:c,ap:l},b={URI:g,map:c,ap:l,of:_},w={URI:g,map:c,ap:l,chain:f},E={URI:g,map:c,of:_,ap:l,chain:f},I=(i.yR,(0,r.m)(w)),k={URI:g,fromIO:u},S=o(k,w),P=(a.F4,(0,s.YO)(v)),D=(0,r.a)(w),U=_(a.Xl),G=function(e){var t=function(e){return function(t){return function(){return Promise.all(t.map((function(t,n){return Promise.resolve().then((function(){return e(n,t)()}))})))}}}(e);return function(e){return a.Od(e)?t(e):U}},z=function(e){var t=function(e){return function(t){return function(){return a.Gb(t).reduce((function(t,n,r){return t.then((function(t){return Promise.resolve().then(e(r+1,n)).then((function(e){return t.push(e),t}))}))}),Promise.resolve().then(e(0,a.YM(t))).then(a.ri))}}}(e);return function(e){return a.Od(e)?t(e):U}},O=function(e){return G((function(t,n){return e(n)}))},C=function(e){return z((function(t,n){return e(n)}))}},2707:(e,t,n)=>{n.d(t,{Do:()=>ge,ak:()=>he,tS:()=>re,fX:()=>de,wE:()=>me,Zl:()=>ie,Y$:()=>pe,Uo:()=>$,tD:()=>B,fF:()=>K,fS:()=>N,t$:()=>M,Hr:()=>ve,UI:()=>X,Vn:()=>te,EQ:()=>Y,LV:()=>F,of:()=>se,Ij:()=>ye,Y3:()=>j});var r=n(6862),i=n(1828),o=n(365),s=n(3735),a=n(7341);function u(e){return(0,s.ls)(o.F2,e.of)}function c(e){return(0,s.ls)(o.t$,e.of)}function l(e){return function(t){return e.map(t,o.F2)}}function f(e){return function(t){return e.map(t,o.t$)}}function d(e){return function(t){return(0,s.ls)(o.ij(t),e.of)}}function p(e){var t=d(e);return function(e){var n=t(e);return function(e){return(0,s.ls)(e,n)}}}function _(e){var t=v(e),n=p(e);return function(e){var r=n(e);return function(e){return t(r(e))}}}function m(e){return(0,a.UI)(e,o.dO)}function g(e){return(0,i.ap)(e,o.G5)}function v(e){return function(t){return function(n){return e.chain(n,(function(n){return o.nM(n)?e.of(n):t(n.right)}))}}}function h(e){return function(t){return function(n){return e.chain(n,(function(n){return o.nM(n)?t():e.of(n)}))}}}function y(e){return function(t,n){return function(r){return e.map(r,o.Pd(t,n))}}}function b(e){return function(t){return function(n){return e.map(n,o.Vn(t))}}}function w(e){return function(t,n){return function(r){return e.map(r,o.EQ(t,n))}}}function E(e){return function(t,n){return function(r){return e.chain(r,o.EQ(t,n))}}}function I(e){return function(t){return function(n){return e.chain(n,o.EQ(t,e.of))}}}function k(e){return function(t){return function(n){return e.chain(n,(function(n){return o.nM(n)?t(n.left):e.of(n)}))}}}function S(e){var t=k(e);return function(n){return t((function(t){return e.map(n(t),(function(e){return o.nM(e)?e:o.t$(t)}))}))}}function P(e){return function(t){return function(n){return e.chain(n,o.EQ((function(n){return e.map(t(n),o.t$)}),(function(t){return e.of(o.F2(t))})))}}}function D(e){return function(t){return e.map(t,o.LF)}}function U(e){return function(t){return e.map(t,o.i$)}}var G=n(2690);function z(e,t){return function(n){var r=(0,s.ls)(n,e.fromTask);return function(e){return t.chain(e,r)}}}var O=n(9384),C=n(7407),T=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},x=function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},M=c(C.PM),A=u(C.PM),R=l(C.dO),q=f(C.dO),L=(0,s.ls)(C.tD,R),B=(C.tD,L),K=R,$=C.of,Y=(C.tD,w(C.dO)),F=E(C.UA),N=I(C.UA),j=function(e,t){return function(){return T(void 0,void 0,void 0,(function(){var n;return x(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,e().then(O.F2)];case 1:return[2,r.sent()];case 2:return n=r.sent(),[2,O.t$(t(n))];case 3:return[2]}}))}))}},W=(C.dO,C.PM,C.PM,C.UA,C.UA,C.UA,C.UA,C.dO,function(e,t){return(0,s.zG)(e,X(t))}),Q=function(e,t){return(0,s.zG)(e,ne(t))},H=function(e,t){return(0,s.zG)(e,re(t))},V=function(e,t,n){return(0,s.zG)(e,ee(t,n))},J=function(e,t){return(0,s.zG)(e,te(t))},Z=function(e,t){return(0,s.zG)(e,oe(t))},X=m(C.dO),ee=y(C.dO),te=b(C.dO),ne=g(C.Hi),re=v(C.UA),ie=re,oe=h(C.UA),se=A,ae=M,ue="TaskEither";var ce={URI:ue,map:W},le={URI:ue,map:W,ap:Q,chain:H},fe={URI:ue,fromEither:$},de=(0,G.fX)(fe,le),pe=(0,G.Y$)(fe,le),_e={URI:ue,fromIO:B,fromTask:K},me=z(_e,le);var ge=se(O.F4),ve=(0,a.Hr)(ce),he=(0,r.a)(le),ye=(O.Xl,{URI:ue,bimap:V,mapLeft:J,map:W,of:se,ap:Q,chain:H,alt:Z,fromIO:B,fromTask:K,throwError:ae})},5605:(e,t,n)=>{function r(e,t){return function(n){var r=e.traverse(n);return function(e,i){return n.map(r(e,i),t.separate)}}}function i(e,t){return function(n){var r=e.traverse(n);return function(e,i){return n.map(r(e,i),t.compact)}}}n.d(t,{BL:()=>i,Fj:()=>r})},3735:(e,t,n)=>{n.d(t,{MZ:()=>i,Q1:()=>c,SK:()=>p,W8:()=>s,a9:()=>o,bc:()=>f,gn:()=>a,ls:()=>l,r5:()=>u,yR:()=>r,zG:()=>d});function r(e){return e}var i=r;function o(e){return function(){return e}}var s=o(!0),a=o(null),u=o(void 0),c=u;function l(e,t,n,r,i,o,s,a,u){switch(arguments.length){case 1:return e;case 2:return function(){return t(e.apply(this,arguments))};case 3:return function(){return n(t(e.apply(this,arguments)))};case 4:return function(){return r(n(t(e.apply(this,arguments))))};case 5:return function(){return i(r(n(t(e.apply(this,arguments)))))};case 6:return function(){return o(i(r(n(t(e.apply(this,arguments))))))};case 7:return function(){return s(o(i(r(n(t(e.apply(this,arguments)))))))};case 8:return function(){return a(s(o(i(r(n(t(e.apply(this,arguments))))))))};case 9:return function(){return u(a(s(o(i(r(n(t(e.apply(this,arguments)))))))))}}}function f(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e}function d(e,t,n,r,i,o,s,a,u){switch(arguments.length){case 1:return e;case 2:return t(e);case 3:return n(t(e));case 4:return r(n(t(e)));case 5:return i(r(n(t(e))));case 6:return o(i(r(n(t(e)))));case 7:return s(o(i(r(n(t(e))))));case 8:return a(s(o(i(r(n(t(e)))))));case 9:return u(a(s(o(i(r(n(t(e))))))));default:for(var c=arguments[0],l=1;l<arguments.length;l++)c=arguments[l](c);return c}}var p=function(e,t){return t}},9384:(e,t,n)=>{n.d(t,{F2:()=>f,F4:()=>v,G:()=>a,Gb:()=>m,Od:()=>p,Wi:()=>i,Xl:()=>g,YM:()=>_,YP:()=>s,e$:()=>h,nM:()=>u,pC:()=>o,r1:()=>y,ri:()=>d,t$:()=>l,tO:()=>c});var r=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},i=function(e){return"None"===e._tag},o=function(e){return"Some"===e._tag},s={_tag:"None"},a=function(e){return{_tag:"Some",value:e}},u=function(e){return"Left"===e._tag},c=function(e){return"Right"===e._tag},l=function(e){return{_tag:"Left",left:e}},f=function(e){return{_tag:"Right",right:e}},d=function(e){return[e]},p=function(e){return e.length>0},_=function(e){return e[0]},m=function(e){return e.slice(1)},g=[],v={},h=Object.prototype.hasOwnProperty,y=function(e){return r([e[0]],e.slice(1),!0)}},4011:(e,t,n)=>{n.d(t,{Df:()=>i,Eq:()=>r});var r={equals:function(e,t){return e===t}},i={equals:r.equals,compare:function(e,t){return e<t?-1:e>t?1:0}};r.equals,i.compare},2751:(e,t,n)=>{n.d(t,{Df:()=>i,Eq:()=>r,pn:()=>s,xb:()=>o});var r={equals:function(e,t){return e===t}},i={equals:r.equals,compare:function(e,t){return e<t?-1:e>t?1:0}},o=function(e){return 0===e.length},s=function(e,t){return function(n){return n.endsWith(e,t)}}},8537:(e,t,n)=>{n.d(t,{Z:()=>o});var r=n(477),i=n.n(r);function o(){return i()('/*! permutive-javascript-sdk v20.4.1 (web) (built 2024-06-27T06:12:33.334Z) */(()=>{"use strict";var e={688:(e,t,n)=>{function r(e){return e instanceof Error?e:new Error("string"==typeof e?e:JSON.stringify(e))}n.d(t,{w:()=>r})},992:(e,t,n)=>{n.d(t,{GL:()=>a,HJ:()=>u,N1:()=>f,NC:()=>r,RP:()=>i,UM:()=>c,t_:()=>l});const r=performance.now(),i=(new Date).getTime();let o=[],s=!1;const a=e=>function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return u((()=>e(...n)))},u=(e,t)=>{if(!s){const n=self.setTimeout(e,t);return()=>self.clearTimeout(n)}let n;const r=()=>{void 0!==n&&s&&o.length<1e4&&o.push([n,performance.now()]),n=void 0},i=[self.setTimeout((()=>{n=performance.now(),self.requestAnimationFrame(r),e()}),t),self.setTimeout(r,t)];return()=>{void 0===n&&i.forEach((e=>self.clearTimeout(e)))}},c=(e,t)=>{if(!s){const n=self.setInterval(e,t);return()=>self.clearInterval(n)}let n=!1,r=()=>{};const i=self.setInterval((()=>{r=u((()=>{n||e()}))}),t);return()=>{n=!0,r(),self.clearInterval(i)}},l=e=>new Promise(((t,n)=>e.then(a(t),a(n)))),f=e=>()=>l(e())},851:(e,t,n)=>{n.d(t,{g1:()=>G,YO:()=>w,oQ:()=>O,a9:()=>_,Ue:()=>d,gS:()=>v,D8:()=>A,VS:()=>k,xH:()=>z,En:()=>g,fF:()=>x,Hr:()=>I,UI:()=>y,Rp:()=>U,vP:()=>E,bw:()=>D,YP:()=>h});var r=n(735),i=n(567),o=n(328),s=n(652);function a(e){let t=e,n=[],r=!1;return{addListener(e){if(r)return()=>{};let i=t;const o=()=>{Object.is(t,i)||(i=t,e(t))};n=[...n,o];return()=>{n=n.filter((e=>e!==o))}},notify(e){if(r)throw new Error("Ref bug: Attempted to notify a terminated notifier");Object.is(e,t)||(t=e,n.forEach((e=>e())))},terminate(){r=!0,n=[]}}}function u(e,t){let n=0;return function(){try{if(n++>0)throw new Error(e);return t(...arguments)}finally{n--}}}function c(e,t){let n=[...new Set(e)].filter((e=>"final"!==e.state));if(0===n.length)return{state:"final",onStateChange:()=>()=>{}};const r=()=>0===n.length?"final":n.some((e=>"might_change"===e.state))?"might_change":"nominal",[i,o]=l(r(),(e=>"might_change"!==e&&t())),s=()=>o(r());return n.forEach((t=>{t.onStateChange((t=>{switch(t){case"final":n=e.filter((e=>"final"!==e.state)),s();break;case"might_change":o("might_change");break;case"nominal":s();break;default:throw new Error(`Ref bug: Invalid state ${t}`)}}))})),i}function l(e,t){if("final"===e)return[{state:"final",onStateChange:()=>()=>{}},()=>{}];const{terminate:n,notify:r,addListener:i}=a(e),o={state:e,onStateChange:i},s=u("Disallowed recursion in Branch.",(e=>{if("final"===o.state){if("final"===e)return;throw new Error(`Attempted to change state of final branch to ${e}.`)}try{null==t||t(e),o.state=e,r(e)}finally{"final"===e&&n()}}));return[o,s]}var f=n(341),p=n(392);const m="Ref";function d(e){const[t,n,r]=function(){const[e,t]=l("nominal"),n=u("Disallowed recursion in Branch.",(n=>{if("final"===e.state)throw new Error("Attempted to mutate a finalized Ref.");const r=e.state;try{t("might_change"),n()}finally{t(r)}}));return[e,n,()=>t("final")]}(),[i,o]=T(t,e);return[i,e=>n((()=>o(e))),r]}function v(e){let t=e.empty;const n=()=>()=>{const n=t;return t=e.empty,n},[r,i,o]=d(n());return[r,r=>{t=e.concat(t,r),i(n())},o]}function g(e,t){return n=>{let i=new Array(e).fill(t.empty);return new Array(e).fill(null).map(((e,o)=>(0,r.zG)(n,y(p.UI((e=>{const n=t.concat(i[o],e);return i=i.map(((n,r)=>r===o?t.empty:t.concat(n,e))),n}))))))}}function _(e){return{get current(){return e},onChange:()=>()=>{},branch:{state:"final",onStateChange:()=>()=>{}}}}function h(e){return t=>{const n=t.onChange(e);return e(t.current),n}}function y(e,t){if(t){const[n,r]=T(t.branch,e(t.current));return t.onChange((t=>r(e(t)))),n}return t=>y(e,t)}const b={URI:m,map:(e,t)=>y(t)(e)},w=f.YO(b),I=f.Hr(b),S=e=>k((t=>y(t)(e))),G={URI:m,of:_,map:b.map,ap:(e,t)=>S(t)(e)};function k(e,t){return t?z(y(e,t)):t=>z(y(e,t))}function z(e){if("final"===e.branch.state)return e.current;const[t,n]=function(e,t){let n=t;const r=[e.state,n.state].includes("might_change")?"might_change":"nominal",[i,o]=l(r),s=e=>t=>{switch(t){case"final":o(e().state);break;case"might_change":o("might_change");break;case"nominal":"might_change"===e().state?o("might_change"):o("nominal");break;default:throw new Error(`Ref bug: Unexpected upstream state ${t}`)}};e.onStateChange(s((()=>n)));const a=s((()=>e));let u=n.onStateChange(a);return[i,e=>{n=e,u(),u=e.onStateChange(a),a(n.state)}]}(e.branch,e.current.branch),[r,i]=T(t,e.current.current);let o=e.current.onChange(i);return e.onChange((e=>{o(),o=e.onChange(i),n(e.branch),i(e.current)})),r}function U(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return e=>{if(2===t.length){let n=t[0];return y((e=>(n=t[1](n,e),n)),e)}let n=i.bM();return y((e=>{const r=t[0](n,e);return n=i.G(r),r}),e)}}function E(){if(0===arguments.length||C(arguments.length<=0?void 0:arguments[0]))return P(...arguments);const e=arguments.length<=0?void 0:arguments[0],t=Object.keys(e);return(0,r.zG)(Object.values(e),(e=>P(...e)),y((0,r.ls)(o.Su(((e,n)=>[t[e],n])),Object.fromEntries)))}function P(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(0===t.length)return _([]);if(1===t.length)return y((e=>[e]))(t[0]);let r=!1;t.forEach((e=>e.onChange((()=>{if("might_change"!==e.branch.state)throw new Error("Ref bug: Received a change notification without a `might_change` state.");r=!0}))));const i=t.map((0,s.vg)("branch")),o=()=>{r&&(r=!1,l(t.map((e=>e.current))))},a=c(i,o),[u,l]=T(a,t.map((e=>e.current)));return u}function x(e){const[t,n,o]=d(i.YP);return e().then((0,r.ls)(i.G,n,o)),t}function A(e){const t=e.hasOwnProperty("equals")?e.equals:e;return function(e){return t=>{if("final"===t.branch.state)return t;let n=i.YP;return y((t=>{if(i.Wi(n))return n=i.G(t),t;const r=e(n.value,t);return n=i.G(r),r}),t)}}(((e,n)=>t(e,n)?e:n))}function O(e){return C(e)?e:_(e)}function D(e){return t=>(h(e)(t),t)}function T(e,t){if("final"===e.state)return[_(t),()=>{}];const n=a(t);e.onStateChange((e=>{"final"===e&&n.terminate()}));let r=t;return[{get current(){return r},onChange:n.addListener,branch:e},u("Disallowed recursion in Ref.",(e=>{r=e,n.notify(r)}))]}function C(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)&&"function"==typeof e.onChange}},116:(e,t,n)=>{n.d(t,{Hr:()=>g,K4:()=>u,KD:()=>y,UI:()=>f,VS:()=>m,YO:()=>_,ak:()=>v,bw:()=>p,dQ:()=>c,kR:()=>b,of:()=>l,vP:()=>d,yi:()=>h});var r=n(851),i=n(735),o=n(652),s=n(923),a=n(567);const u=e=>(0,i.ls)((t=>{let{previousState:n,...r}=t;return e(r)}),(e=>({value:e,state:r.a9(void 0)}))),c=i.yR,l=(0,i.ls)(i.a9,u),f=e=>t=>(0,i.ls)(t,(0,o.rO)({value:e})),p=e=>t=>(0,i.ls)(t,(0,o.rO)({value:(0,o.bw)(e)}));function m(e){return t=>n=>{let{previousState:i,...o}=n;const s=t({previousState:Array.isArray(i)?i[0]:void 0,...o}),a=e(s.value)({previousState:Array.isArray(i)?i[1]:void 0,...o});return{value:a.value,state:r.vP(s.state,a.state)}}}function d(e){return t=>{let{previousState:n,...o}=t;const a=S(n)?n:{},u=(0,i.zG)(e,s.Su(((e,t)=>t({previousState:a[e],...o}))));return{value:(0,i.zG)(u,s.UI((e=>e.value))),state:(0,i.zG)(u,s.UI((e=>e.state)),(e=>r.vP(e)))}}}function v(e,t){return n=>(0,i.ls)((0,o.rO)({previousState:I}),(o=>{const s=n(o),a=t(s.value)({...o,previousState:o.previousState[e]});return{value:(0,i.zG)([s.value,a.value],(t=>{let[n,r]=t;if(!S(n))throw new Error("Service.bind() was passed an upstream Service with a non-record value.");return{...n,[e]:r}})),state:(0,i.zG)(r.vP(s.state,a.state),r.UI((t=>{let[n,r]=t;if(void 0===n)return{[e]:r};if(!S(n))throw new Error("Service.bind() was passed an upstream Service with a non-record state.");return{...n,[e]:r}})))}}))}const g=(e,t)=>f((n=>({...n,[e]:t(n)})));function _(e){return t=>(0,i.ls)((0,o.rO)({previousState:(0,i.ls)(I,(t=>t[e]))}),t,(0,o.rO)({value:t=>({[e]:t}),state:r.UI((t=>({[e]:t})))}))}const h=(e,t)=>{const n=t||(t=>t===e);return t=>c((s=>{let{previousState:a,...u}=s;const c=Array.isArray(a)&&2===a.length&&n(a[0])?a[1]:void 0;return(0,i.zG)({previousState:c,...u},t,(0,o.rO)({state:r.UI((t=>[e,t]))}))}))},y=e=>{const t=e.slice(0,-1),n=e.slice(-1)[0],r=[...t.map((e=>{let[t,n]=e;return[t,(0,i.a9)(n)]})),(0,i.a9)(n)];return b((0,o.lo)(r))};function b(e){return(0,i.ls)(r.UI(e),w)}function w(e){const t=(0,i.zG)(e,r.Rp(0,(e=>e+1)));return n=>{let{previousState:o,stopped:s,...u}=n;return(0,i.zG)(r.vP(e,t),r.Rp(((e,n)=>{let[c,l]=n;return(0,i.zG)(e,a.UI((e=>e.state.current)),a.fS((()=>o)),(e=>c({previousState:e,stopped:(0,i.zG)(r.vP(s,t),r.UI((e=>{let[t,n]=e;return t||n!==l}))),...u})))})),(e=>({value:r.UI((e=>e.value),e),state:r.VS((e=>e.state),e)})))}}function I(e){return S(e)?e:{}}function S(e){return"object"==typeof e&&null!==e}},930:(e,t,n)=>{n.d(t,{d:()=>f,m:()=>l});var r=n(735),i=n(365),o=n(567),s=n(851),a=n(652),u=n(116),c=n(268);const l=e=>u.dQ((t=>{let{stopped:n,previousState:u}=t;const c=function(e){return g(e)?e:{validityKey:"",lastSuccess:o.YP}}(u),l=(0,r.zG)(c,(e=>({...e,inFlight:o.YP,lastSuccess:(0,r.zG)(e.lastSuccess,o.UI(i.F2))}))),f=(0,r.zG)(e,s.UI((e=>"currentTimestampSecs"in e&&"freshness"in e&&"validity"in e?e:{currentTimestampSecs:0,validity:{key:e.validityKey,maxAge:Number.MAX_SAFE_INTEGER},freshness:{key:e.freshnessKey,maxAge:Number.MAX_SAFE_INTEGER},refresh:e.refresh})),(e=>s.vP(e,n)),s.Rp(s.a9(l),((e,t)=>{let[n,u]=t;if(u)return e;const c=n.validity.key(),l=o.hX((e=>n.currentTimestampSecs-e.timestamp<=n.validity.maxAge)),f=(0,a.HP)(n.freshness.key),p=o.hX((e=>n.currentTimestampSecs-e.timestamp<=n.freshness.maxAge&&e.freshnessKey===f())),m=(0,r.zG)(e,s.UI((0,r.ls)(o.DT((e=>e.validityKey===c)),o.EQ((()=>({validityKey:c,inFlight:o.YP,lastSuccess:o.YP})),(0,a.rO)({inFlight:l,lastSuccess:o.tS(i.EQ((e=>o.G(i.t$(e))),(0,r.ls)(o.G,l,o.UI((e=>i.F2(e))))))})))),s.D8(d()));if((0,r.zG)(m.current,(e=>(0,r.zG)(e.inFlight,o.wp((()=>(0,r.zG)(e.lastSuccess,o.tS(o.Uo)))),p,o.pC))))return m;const v=()=>({timestamp:n.currentTimestampSecs,freshnessKey:f(),output:o.YP});return(0,r.zG)(n.refresh,o.EQ((()=>m),(0,r.ls)(s.fF,s.UI(o.EQ((()=>(0,r.zG)(m,s.UI((0,a.rO)({inFlight:()=>o.G(v())})))),i.EQ((e=>(0,r.zG)(m,s.UI((0,a.rO)({inFlight:()=>o.YP,lastSuccess:(0,r.ls)(o.tS((0,r.ls)(o.Uo,o.hX((e=>o.pC(e.output))))),i.Yo((()=>e)),o.G)})))),(e=>s.a9({validityKey:c,inFlight:o.YP,lastSuccess:o.G(i.F2({...v(),output:o.G(e)}))}))))),s.xH)))})),s.xH,s.D8(d())),p=(0,r.zG)(f,s.UI((e=>({validityKey:e.validityKey,lastSuccess:(0,r.zG)(e.lastSuccess,o.tS(o.Uo))}))),s.D8(v())),m=(0,r.zG)(p,s.Rp(-1,(e=>e+1)));return{value:(0,r.zG)(f,s.UI((0,r.ls)((0,a.vg)("lastSuccess"),o.UI(i.UI((e=>e.output))),o.fS((()=>i.F2(o.YP)))))),state:(0,r.zG)(s.vP(p,m),s.UI((e=>{let[t,n]=e;return n>0?t:v().equals(t,c)?u:t})))}})),f=e=>t=>(0,r.ls)((0,a.rO)({previousState:(0,r.ls)(o.DT(g),o.YO("s1"),o.Hr("s2",(t=>{let{s1:n}=t;return(0,r.zG)(n,(0,a.rO)({lastSuccess:o.UI((0,a.rO)({output:o.tS(e)}))}))})),o.UI((e=>{let{s1:t,s2:n}=e;return v().equals(t,n)?t:n})),o.FS)}),t),p=()=>c.n_({freshnessKey:(0,a.Or)(),timestamp:(0,a.Or)(),output:o.Eh((0,a.Or)())});function m(e){return"object"==typeof e&&null!==e&&(!(!("freshnessKey"in e)||!_(e.freshnessKey))&&("timestamp"in e&&"number"==typeof e.timestamp&&!(!("output"in e)||!(0,a.El)(e.output))))}const d=()=>c.n_({validityKey:(0,a.Or)(),inFlight:o.Eh(p()),lastSuccess:o.Eh(i.Eh((0,a.Or)(),p()))}),v=()=>c.n_({validityKey:(0,a.Or)(),lastSuccess:o.Eh(p())});function g(e){return"object"==typeof e&&null!==e&&(!(!("validityKey"in e)||!_(e.validityKey))&&!!("lastSuccess"in e&&(0,a.El)(e.lastSuccess)&&(0,r.zG)(e.lastSuccess,o.EQ((()=>!0),m))))}function _(e){return null===e||"string"==typeof e||"number"==typeof e}},548:(e,t,n)=>{n.d(t,{X:()=>i,k:()=>r});const r=e=>({id:e.id,name:e.name,time:new Date(e.time),properties:e.properties||{},session_id:e.session_id,view_id:e.view_id}),i=e=>({id:e.id,name:e.name,time:(o(e.time)?e.time:new Date).toISOString(),properties:e.properties||{},session_id:e.session_id,view_id:e.view_id}),o=e=>isFinite(e)&&e instanceof Date},656:(e,t,n)=>{n.d(t,{F:()=>c,I:()=>u});var r=n(851),i=n(392),o=n(328),s=n(735),a=n(652);const u=(e,t)=>{let n=!1;return r.UI(i.UI((0,a.bw)((r=>{n||(n=(0,s.zG)(r,o.G((e=>{let[,t]=e;return"Pageview"===t.name}))),n&&e.trackTimeSinceInit("sdk_lifecycle_timestamps",{timestamp_name:t,time_origin:"sdk_init"}))}))))},c=(e,t)=>{const n=u(e,t);return(0,s.ls)(r.En(2,o.uZ()),(e=>{let[t,i]=e;return(0,s.zG)(i,n,r.UI((e=>e()))),t}))}},296:(e,t,n)=>{n.r(t),n.d(t,{service:()=>qr});var r=n(735),i=n(116),o=n(851),s=n(567);function a(e){return e[0]}function u(e){return e[1]}var c=function(e){return function(t){return[e(a(t)),u(t)]}},l=function(e){return function(t){return[a(t),e(u(t))]}};const f=e=>{const t=e.current;return(0,r.zG)(e,o.UI((e=>e===t?{segmentsEntered:[],segmentsExited:[]}:{segmentsEntered:(0,r.zG)(e,m(t)),segmentsExited:(0,r.zG)(t,m(e))})))},p=e=>new Set(e),m=e=>t=>(0,r.zG)(t,d((t=>!e.has(t)))),d=e=>t=>{const n=[];return t.forEach((t=>e(t)&&n.push(t))),n};var v=n(392),g=n(328),_=n(652),h=n(268),y=n(751);const b=e=>{let{events:t,...n}=e;return i.K4((e=>{let{stopped:i}=e;const[a,u,c]=(0,r.zG)(t,o.En(3,g.uZ())),l=(0,r.zG)(o.vP(n.viewId,n.currentTimestampSecs,c,i),o.Rp(s.YP,((e,t)=>{let[n,i,o,a]=t;if(a)return e;const u=o();return(0,r.zG)(e,s.hX((e=>e.id===n)),s.EQ((()=>({id:n,lastEngagementTime:i})),(e=>({id:n,lastEngagementTime:(0,r.zG)(u,g.dF((e=>{let[,t]=e;return"PageviewEngagement"===t.name})),s.EQ((()=>e.lastEngagementTime),(e=>{let[,t]=e;return Math.floor(t.time.getTime()/1e3)})))}))),s.G)})),(e=>o.vP(e,n.currentTimestampSecs)),o.UI((e=>{let[t,n]=e;return(0,r.zG)(t,s.hX((e=>600>n-e.lastEngagementTime)),s.UI((e=>e.id)))})),o.D8(s.Eh(y.Eq))),f={PageviewEngagement:{engaged_time:0},SegmentEntry:new Set,SegmentExit:new Set,CohortEntry:new Set,CohortExit:new Set},p=(0,r.zG)(o.vP({events:a,sessionId:n.sessionId,viewIdOpt:l,stopped:i}),o.Rp(s.YP,((e,t)=>{let{events:n,sessionId:i,viewIdOpt:o,stopped:a}=t;if(a)return e;const u=(0,r.zG)(o,s.UI((t=>(0,r.zG)(e,s.tS((0,_.vg)("unprocessedPVC")),s.hX((e=>e.viewId===t)),s.fS((()=>({aggregations:f,customProperties:{},sessionId:i,viewId:t}))),(e=>(0,r.zG)(n(),g.u4(e,((e,t)=>{let[,n]=t;return function(e,t){switch(t.name){case"Pageview":return t.view_id!==e.viewId?e:{...e,customProperties:t.properties};case"SegmentEntry":{const n=t.properties.segment_number;return(0,r.zG)(e,(0,_.rO)({aggregations:e=>e.SegmentExit.has(n)?(0,r.zG)(e,(0,_.rO)({CohortExit:S(String(n)),SegmentExit:S(n)})):(0,r.zG)(e,(0,_.rO)({CohortEntry:I(String(n)),SegmentEntry:I(n)}))}))}case"SegmentExit":{const n=t.properties.segment_number;return(0,r.zG)(e,(0,_.rO)({aggregations:e=>e.SegmentEntry.has(n)?(0,r.zG)(e,(0,_.rO)({CohortEntry:S(String(n)),SegmentEntry:S(n)})):(0,r.zG)(e,(0,_.rO)({CohortExit:I(String(n)),SegmentExit:I(n)}))}))}case"PageviewEngagement":{if(t.view_id!==e.viewId)return e;const n=t.properties;return(0,r.zG)(e,(0,_.rO)({aggregations:(0,_.rO)({PageviewEngagement:()=>({engaged_time:n.total_engaged_time,completion:n.total_completion})})}))}default:return e}}(e,n)})))))))),c=(0,r.zG)(e,s.EQ((()=>v.of(g.cS)),(e=>(0,r.zG)(e.unprocessedPVC,s.hX((e=>{var t;return e.viewId!==(null===(t=s.FS(u))||void 0===t?void 0:t.viewId)})),s.EQ((()=>e.pvcsToProcessImmediately),(t=>{let n=[...e.pvcsToProcessImmediately(),w(t)];return()=>{const e=n;return n=g.cS,e}}))))));return s.G({pvcsToProcessImmediately:c,unprocessedPVC:u})})));return{eventsToProcessImmediately:(0,r.zG)(p,o.UI(s.EQ((()=>()=>g.cS),(e=>e.pvcsToProcessImmediately))),(e=>o.vP(e,u)),o.UI(v.RD),o.UI(v.UI(g.xH))),eventsToProcessOnPageUnload:(0,r.zG)(p,o.UI(s.tS((0,_.vg)("unprocessedPVC"))),o.D8(s.Eh((0,h.MW)({aggregations:(0,_.Or)(),customProperties:(0,_.Or)(),sessionId:(0,_.Or)(),viewId:(0,_.Or)()}))),o.UI((0,r.ls)(s.UI(w),g.Yo)))}}))},w=e=>(0,r.bc)(`PageviewComplete-${e.viewId}`,{name:"PageviewComplete",time:new Date,session_id:e.sessionId,view_id:e.viewId,properties:{...e.customProperties,aggregations:(0,r.zG)(e.aggregations,(0,_.rO)({SegmentEntry:G,SegmentExit:G,CohortEntry:G,CohortExit:G}))}});const I=e=>t=>{const n=new Set(t);return n.add(e),n},S=e=>t=>{const n=new Set(t);return n.delete(e),n},G=e=>[...e];var k=n(992);const z=()=>({kind:"null",value:null}),U=e=>({kind:"string",value:e}),E=e=>({kind:"number",value:e}),P=e=>({kind:"array",value:e}),x=e=>({kind:"object",value:e}),A=e=>e,O=()=>({kind:"bottom"}),D=e=>({kind:"inner",a:e}),T=e=>({kind:"top",error:e}),C=e=>({kind:"unbounded",group:e}),q=(e,t)=>({kind:"windowed",key:t,group:e}),M=(e,t,n)=>({kind:"countLimit",n,limit:t,group:e}),R=(e,t,n)=>({kind:"uniqueLimit",n,limit:t,group:e}),F=e=>({kind:"numberGroup",group:e}),j=e=>({kind:"stringGroup",group:e}),Y=e=>({kind:"tuple",tuple:e}),$=e=>({state:e}),N=(e,t)=>({commands:e,payload:t});var L=n(209);const B=(e,t)=>{switch(e.kind){case"bottom":return{kind:"bottom"};case"inner":return D(t(e.a));case"top":return T(e.error)}},Q=e=>(0,L.Zt)(((t,n)=>{if("bottom"===t.kind&&"bottom"===n.kind)return 0;if("bottom"===t.kind)return-1;if("bottom"===n.kind)return 1;if("top"===t.kind&&"top"===n.kind)return y.Df.compare(t.error,n.error);if("top"===t.kind)return 1;if("top"===n.kind)return-1;if("inner"===t.kind&&"inner"===n.kind)return e.compare(t.a,n.a);throw new Error("Non exhaustive match in extendedAlgebraOrd")}));var H=n(885),K=n(500),V=n(365),W=function(e){return-1===e?1:1===e?-1:0};function J(e,t){return(0,K.oA)(e.map(t))}function X(e,t,n,r){const i=(e,t)=>{if(0===e.length)return(0,K.oA)(t.map((e=>(0,s.G)({1:e[1],2:n(s.YP,(0,s.G)(e[2]))}))));if(0===t.length)return(0,K.oA)(e.map((e=>(0,s.G)({1:e[1],2:n((0,s.G)(e[2]),s.YP)}))));if(e.length>0&&t.length>0&&(0,L.lt)(r)(e[0][1],t[0][1])){const[r,...o]=e,a=r[1],u=r[2];return(0,K.Ce)({1:a,2:n((0,s.G)(u),s.YP)})(i(o,t))}if(e.length>0&&t.length>0&&(0,L.gt)(r)(e[0][1],t[0][1])){const[r,...o]=t,a=r[1],u=r[2];return(0,K.Ce)({1:a,2:n(s.YP,(0,s.G)(u))})(i(e,o))}if(e.length>0&&t.length>0){const[r,...o]=e,[a,...u]=t,c=r[1],l=r[2],f=a[2];return(0,K.Ce)({1:c,2:n((0,s.G)(l),(0,s.G)(f))})(i(o,u))}throw new Error("Non exhaustive match in mapOption2")},o=(0,L.Uz)((e=>e[1]))(r),a=(e=>{const t=J(e,(e=>(0,s.pC)(e[2])?(0,s.G)({1:e[1],2:e[2].value}):s.YP));return 0===t.length?s.YP:(0,s.G)(t)})(i((0,K.DY)(o)([...e].map((e=>({1:e[0],2:e[1]})))),(0,K.DY)(o)([...t].map((e=>({1:e[0],2:e[1]}))))));return(0,s.UI)((e=>new Map(e.map((e=>[e[1],e[2]])))))(a)}function Z(e,t,n,r){const i=(0,L.Uz)((e=>e[0]))(r),o=(0,K.DY)(i)([...t]).reduceRight(((e,t)=>{if((0,V.nM)(e)){const r=n(t[1],e.left);return(0,s.pC)(r)?(0,V.t$)(r.value):(0,V.F2)(t[0])}return e}),(0,V.t$)(e));return(0,s.Uo)(o)}function ee(e,t){return new Map([...e].map(t))}function te(e,t){return new Map([...e].filter(t))}var ne=n(11);function re(e){return JSON.stringify(ie(e))}function ie(e){switch(e.kind){case"null":return ae.encode(e);case"string":return ue.encode(e);case"number":return ce.encode(e);case"array":return le.encode(e);case"object":return fe.encode(e)}}function oe(e){return null===e?ae.decode(e):"number"==typeof e?ce.decode(e):"string"==typeof e?ue.decode(e):Array.isArray(e)?le.decode(e):fe.decode(e)}const se=(e,t)=>(0,V.t$)(`Failed to decode. Input was ${JSON.stringify(e)}. Codec type was ${t}`),ae={encode:e=>null,decode:e=>null===e?(0,V.F2)({kind:"null",value:null}):se(e,"SimpleNull")},ue={encode:e=>e.value,decode:e=>"string"==typeof e?(0,V.F2)(U(e)):se(e,"SimpleString")},ce={encode:e=>e.value,decode:e=>"number"==typeof e?(0,V.F2)(E(e)):se(e,"SimpleNumber")},le={encode:e=>e.value.map(ie),decode:e=>{if(Array.isArray(e)){const t=(0,K.fw)(V.g1)(oe)(e);return(0,V.UI)(P)(t)}return se(e,"SimpleArray")}},fe={encode:e=>{const t=[...e.value.entries()];return Object.assign({},...Array.from(t,(([e,t])=>({[e]:ie(t)}))))},decode:e=>{if(e&&e.constructor===Object){const t=(0,K.fw)(V.g1)((([e,t])=>(0,r.zG)(oe(t),(0,V.UI)((t=>(0,r.bc)(e,t))))))(Object.entries(e));return(0,V.UI)((e=>x(new Map([...e]))))(t)}return se(e,"SimpleObject")}};function pe(e){return(0,r.zG)(e,de,(0,s.UI)(re),(0,s.fS)((()=>"<encode error>")))}function me(e){return(0,s.UI)(be)(function(e){switch(e.state.kind){case"top":return(0,s.G)(U(e.state.error));case"bottom":return s.YP;case"inner":return de(e.state.a)}}(e))}function de(e){return function(e){switch(e.kind){case"numberGroup":case"stringGroup":return ve(e.group);case"tuple":return e.tuple.length>0}}(e.payload)?(0,s.G)(P(function(e,t){const n=(0,s.UI)((e=>(0,K.Ce)(e)(t)))(e);return(0,s.fS)((()=>t))(n)}((0,s.UI)((e=>U(function(e){const t=e=>(0,s.EQ)((()=>""),(e=>"b"+JSON.stringify(e)))(e.bound),n=e=>{switch(e.operation){case"add":return"p";case"mul":return"m";case"max":return"v";case"min":return"n"}},r=e=>{const r=t(e[1])+n(e[1]);return 1===e[2]?r:r+JSON.stringify(e[2])};return e.map(r).join("")}(e))))(e.commands),function(e){const t=e=>{switch(e.kind){case"bottom":return{kind:"null",value:null};case"top":return U(e.error);case"inner":return E(e.a)}},n=e=>J([ge,_e,e=>(0,r.zG)(e,ye,x,s.G)],(t=>t(e))),i=e=>J([ge,he,e=>(0,r.zG)(e,ye,(e=>ee(e,(([e,t])=>[JSON.stringify(e),t]))),x,s.G)],(t=>t(e)));switch(e.kind){case"tuple":return e.tuple.map(t);case"stringGroup":return n(e.group);case"numberGroup":return i(e.group)}}(e.payload)))):s.YP}function ve(e){switch(e.kind){case"unbounded":return e.group.size>0;case"windowed":return e.group.size>0||(0,s.pC)(e.key);case"countLimit":case"uniqueLimit":return e.group.size>0||(0,s.pC)(e.limit)}}function ge(e){switch(e.kind){case"unbounded":return s.YP;case"windowed":return(0,s.G)(U("w"));case"countLimit":return(0,s.G)(U(1===e.n?"x":`x${e.n}`));case"uniqueLimit":return(0,s.G)(U(1===e.n?"u":`u${e.n}`))}}function _e(e){switch(e.kind){case"unbounded":return s.YP;case"windowed":return(0,s.G)(U((0,s.pC)(e.key)?e.key.value:""));case"countLimit":case"uniqueLimit":return(0,s.G)(U((0,s.pC)(e.limit)?e.limit.value:""))}}function he(e){switch(e.kind){case"unbounded":return s.YP;case"windowed":return(0,s.pC)(e.key)?(0,s.G)(E(e.key.value)):(0,s.G)({kind:"null",value:null});case"countLimit":case"uniqueLimit":return(0,s.pC)(e.limit)?(0,s.G)(E(e.limit.value)):(0,s.G)({kind:"null",value:null})}}function ye(e){switch(e.kind){case"unbounded":case"windowed":case"countLimit":case"uniqueLimit":return e.group}}function be(e){switch(e.kind){case"array":return 0===e.value.length?{kind:"null",value:null}:1===e.value.length?be(e.value[0]):P(e.value.map(be));case"object":return(0,r.zG)(te(e.value,(([e,t])=>"null"!==t.kind)),(e=>ee(e,(e=>[e[0],be(e[1])]))),x);default:return e}}function we(e){const t=e=>{if(0===e.length)return{kind:"bottom"};const t=(e=>{if(4!==e.length)return s.YP;const[t,n,r,i]=e;if("string"===t.kind&&"string"===n.kind&&"object"===i.kind){const e=(0,s.DT)((e=>Ie(e[1].value)&&Se(e[2].value)))({1:t,2:n});return(0,s.UI)((e=>({prim:e[1].value,grp:e[2].value,cutoff:r,m:i.value})))(e)}return s.YP})(e);if((0,s.pC)(t)){const{prim:e,grp:n,cutoff:r,m:i}=t.value,o=Ge(r,i,ke(n));return"string"==typeof o?T(o):D(N(ze(e),o))}const n=(e=>{if(3!==e.length)return s.YP;const[t,n,r]=e;if("string"===t.kind&&"object"===r.kind){const e=(0,s.DT)((e=>Se(e.value)))(t);return(0,s.UI)((e=>({grp:e.value,cutoff:n,m:r.value})))(e)}return s.YP})(e);if((0,s.pC)(n)){const{grp:e,cutoff:t,m:r}=n.value,i=Ge(t,r,ke(e));return"string"==typeof i?T(i):D(N(s.YP,i))}const r=(e=>{if(2!==e.length)return s.YP;const[t,n]=e;if("string"===t.kind&&"object"===n.kind){const e=(0,s.DT)((e=>Ie(e.value)))(t);return(0,s.UI)((e=>({prim:e.value,m:n.value})))(e)}return s.YP})(e);if((0,s.pC)(r)){const{prim:e,m:t}=r.value;return D(N(ze(e),j(C(t))))}const i=(e=>{if(1!==e.length)return s.YP;const[t]=e;return"object"===t.kind?(0,s.G)({m:t.value}):s.YP})(e);if((0,s.pC)(i)){const{m:e}=i.value;return D(N(s.YP,j(C(e))))}const o=(e=>{if(e.length<1)return s.YP;const[t,...n]=e;if("string"===t.kind){const e=(0,s.DT)((e=>Ie(e.value)))(t);return(0,s.UI)((e=>({prim:e.value,rest:n})))(e)}return s.YP})(e);if((0,s.pC)(o)){const{prim:e,rest:t}=o.value;return D(N(ze(e),Ee(t)))}return D(N(s.YP,Ee(e)))},n=e=>"array"===e.kind?(0,K.tS)(n)(e.value):[e];return"null"===e.kind?$({kind:"bottom"}):$(t(n(e)))}function Ie(e){const t=e.split("");if(!0==(0===t.length))return!1;{const[e,...n]=t;return-1!=="bpmvn".indexOf(e)&&n.every((e=>-1!=="bpmvn0123456789.".indexOf(e)))}}function Se(e){const t=e.split("");switch(!0){case 0===t.length:return!1;case"w"===t[0]&&void 0===t[1]:return!0;default:{const[e,...n]=t;return-1!=="ux".indexOf(e)&&-1===n.map((e=>!isNaN(parseInt(e)))).indexOf(!1)}}}function Ge(e,t,n){switch(e.kind){case"string":return j(n({1:(0,s.G)(e.value),2:t}));case"number":case"null":return F(n({1:"null"===e.kind?s.YP:(0,s.G)(e.value),2:te(ee(t,(([e,t])=>[Number(e),t])),(e=>!isNaN(e[0])))}));default:return"{bad cutoff}"}}function ke(e){const t=e=>t=>R(t[2],t[1],e),n=e=>t=>M(t[2],t[1],e),r=e.split("");switch(!0){case"w"===r[0]&&void 0===r[1]:return e=>q(e[2],e[1]);case"u"===r[0]&&void 0===r[1]:return t(1);case"u"===r[0]&&void 0!==r[1]:return t(parseInt(r.slice(1).join("")));case"x"===r[0]&&void 0===r[1]:return n(1);case"x"===r[0]&&void 0!==r[1]:return n(parseInt(r.slice(1).join("")));default:throw new Error("This should never happen if you use isGroupCommand")}}function ze(e){const t=e=>(0,s.Wi)(e.bound)||"add"===e.operation||"mul"===e.operation?(0,s.G)(e):s.YP,n=(e,n,i)=>{const o=((e,n)=>(0,r.zG)(e,(e=>{switch(e){case"p":return(0,s.G)("add");case"m":return(0,s.G)("mul");case"v":return(0,s.G)("max");case"n":return(0,s.G)("min");default:return s.YP}}),s.UI((e=>({operation:e,bound:n}))),s.tS(t)))(e,i);return(0,s.UI)((e=>{const{init:t,rest:r}=(0,K.zT)((e=>{return"number"==typeof(t=parseInt(e))&&isFinite(t)&&Math.floor(t)===t;var t}))(n);return{1:{1:e,2:0===t.length?1:parseInt(t.join(""))},2:r.join("")}}))(o)};return(0,s.UI)(A)((0,H.nI)(Ue(e,(e=>{const t=e.split("");if(0===t.length)return s.YP;const[i,...o]=t;if("b"===i){const{init:e,rest:t}=(0,r.zG)(o,(0,K.zT)((e=>-1!=="1234567890.".indexOf(e))));if(0===e.length||0===t.length)return s.YP;const i=parseFloat(e.join("")),[a,...u]=t;return n(a,u,(0,s.G)(i))}return n(i,o,s.YP)}))))}function Ue(e,t){const n=t(e);return(0,s.fS)((()=>[]))((0,s.UI)((e=>[e[1]].concat(Ue(e[2],t))))(n))}function Ee(e){return Y(e.map(Pe))}function Pe(e){switch(e.kind){case"number":return D(e.value);case"string":return T(e.value);case"null":return{kind:"bottom"};case"object":return T("{object}");case"array":return T("{array}")}}var xe=n(828);const Ae={strategy:(e,t,n)=>r=>{if((0,s.Wi)(n))return t;if("delta"===e&&(0,s.Wi)(t))return s.YP;if((0,s.Wi)(t))return n;if((0,s.pC)(t)&&(0,s.pC)(n))return r(t.value,n.value);throw new Error("Non exhaustive match in combineCommand.strategy")},operation:(e,t,n,i,o,a)=>{const u=(0,K.pR)(Q(a)),c=(0,r.zG)(t.bound,s.EQ((()=>r.yR),(e=>t=>(0,L.VV)(a)(o.fromNumber(e),t))));if("append"===e&&"add"===t.operation)return(0,K.yL)(n,i,Re("append",(0,r.ls)(o.plus,c)));if("append"===e&&"mul"===t.operation)return(0,K.yL)(n,i,Re("append",(0,r.ls)(o.times,c)));if("append"===e&&"max"===t.operation)return(0,L.Fp)(u)(n,i);if("join"===e&&"add"===t.operation)return(0,K.yL)(n,i,Re("join",(0,L.Fp)(a)));if("join"===e&&"mul"===t.operation)return(0,K.yL)(n,i,Re("join",(0,L.Fp)(a)));if("join"===e&&"max"===t.operation)return(0,L.Fp)(u)(n,i);if("min"===t.operation)return Ae.operation(e,{operation:"max",bound:t.bound},n,i,o,function(e){return(0,L.Zt)(((t,n)=>W(e.compare(t,n))))}(a));if("delta"===e&&"max"===t.operation)return(0,L.gt)(u)(n,i)?n:i.map(O);if("delta"===e)return(0,K.yL)(n,i,((e,t)=>(0,L.gt)(Q(a))(e,t)?B(e,c):{kind:"bottom"}));throw new Error("Non exhaustive match in combineCommand.operation")},extend:(e,t,n,r)=>{if("delta"===e&&"top"===n.kind&&"top"===r.kind)return(0,L.gt)(y.Df)(n.error,r.error)?T(n.error):{kind:"bottom"};if("delta"===e&&"bottom"===r.kind)return n;if("delta"===e&&"bottom"===n.kind)return{kind:"bottom"};if("top"===n.kind&&"top"===r.kind)return T((0,L.Fp)(y.Df)(n.error,r.error));if("top"===n.kind)return n;if("top"===r.kind)return r;if("inner"===n.kind&&"inner"===r.kind)return t(n.a,r.a);if("bottom"===n.kind)return r;if("bottom"===r.kind)return n;throw new Error("Non exhaustive match in extend")}},Oe={fromNumber:r.yR,plus:(e,t)=>e+t,times:(e,t)=>e*t};function De(e,t,n,r){if("unbounded"===e.kind&&"unbounded"===t.kind){const i=e.group,o=t.group;return(0,s.fS)(O)((0,s.UI)((e=>D(C(e))))(X(i,o,n,r)))}if("windowed"===e.kind&&"windowed"===t.kind){const i=e.key,o=e.group,a=t.key,u=t.group,c=(0,L.Fp)((0,s.pR)(r))(i,a);return(0,s.fS)(O)((0,s.UI)((e=>D(q(e,c))))(X(o,u,n,r)))}if("countLimit"===e.kind&&"countLimit"===t.kind){const i=e.n,o=t.n;if(i===o){const o=e.limit,a=e.group,u=t.limit,c=t.group,l=(0,L.Fp)((0,s.pR)(r))(o,u);return(0,s.fS)(O)((0,s.UI)((e=>D(M(e,l,i))))(X(a,c,n,r)))}return T("Non matching counts")}if("uniqueLimit"===e.kind&&"uniqueLimit"===t.kind){const i=e.n,o=t.n;if(i===o){const o=e.limit,a=e.group,u=t.limit,c=t.group,l=(0,L.Fp)((0,s.pR)(r))(o,u);return(0,s.fS)(O)((0,s.UI)((e=>D(R(e,l,i))))(X(a,c,n,r)))}return T("Non matching counts")}return T("Non matching group types")}function Te(e,t,n){return(0,s.fS)(z)(Ce(e,s.YP)(t,n))}function Ce(e,t){const n=t=>(n,r)=>Ae.strategy(e,n,r)(Ce(e,t)),i=(t,r,i)=>{if("stringGroup"===r.kind&&"stringGroup"===i.kind){const e=De(r.group,i.group,n(t),y.Df);return B(e,(e=>j(Me(e,y.Df))))}if("numberGroup"===r.kind&&"numberGroup"===i.kind){const e=De(r.group,i.group,n(t),ne.Df);return B(e,(e=>F(Me(e,ne.Df))))}if("tuple"===r.kind&&"tuple"===i.kind){const n=(0,s.pC)(t)?t.value:[];return D(Y(function(e,t,n,r,i,o){const a=(e,t)=>({1:(0,K.ke)(e)(t).concat((0,K.KB)(Math.max(0,e-t.length),O)),2:(0,K.md)(e)(t)}),u=(t,n,r)=>{if(0===t.length)return Ae.operation(e,{operation:"max",bound:s.YP},n,r,i,o);if(t.length>0){const[s,...c]=t,l=a(s[2],n),f=l[1],p=l[2],m=a(s[2],r),d=m[1],v=m[2];return Ae.operation(e,s[1],f,d,i,o).concat(u(c,p,v))}throw new Error("Non exhaustive match in recurse")};return(0,K.GY)((0,K.Qp)((e=>"bottom"===e.kind))((0,K.GY)(u(t,n,r))))}(e,n,r.tuple,i.tuple,Oe,ne.Df)))}throw new Error(`Non matching payload. Got ${r.kind} and ${i.kind}`)},o=(e,n)=>{if((0,s.Eh)((0,H.Eh)((0,h.n_)({1:(0,h.n_)({operation:y.Eq,bound:(0,s.Eh)(ne.Eq)}),2:ne.Eq}))).equals(e.commands,n.commands)){const r=(0,s.Wi)(e.commands)?t:e.commands,o=i(r,e.payload,n.payload);return B(o,(t=>N(e.commands,t)))}if(o=e.commands,a=n.commands,(0,s.Eh)((0,H.Eh)((0,h.n_)({1:(0,h.n_)({operation:y.Eq}),2:ne.Eq}))).equals(o,a)){const o=(0,r.zG)(((e,t)=>(0,r.zG)((0,xe.gz)(s.G5)(e,t),(0,s.UI)((([e,t])=>H.yL(e,t,((e,t)=>({1:{operation:e[1].operation,bound:(0,r.zG)((0,xe.gz)(s.G5)(e[1].bound,t[1].bound),s.UI((([e,t])=>Math.min(e,t))),s.wp((()=>e[1].bound)),s.wp((()=>t[1].bound)))},2:e[2]})))))))(e.commands,n.commands),s.wp((()=>t))),a=i(o,e.payload,n.payload);return B(a,(e=>N(o,e)))}throw new Error(`Non matching primitive strings. Got ${pe(e)} and ${pe(n)}`);var o,a};return(t,n)=>me($(Ae.extend(e,o,we(t).state,we(n).state)))}function qe(e,t,n){const r=(0,s.UI)((t=>te(e,(([e,r])=>(0,L.gf)(n)(e,t)))))(t);return(0,s.fS)((()=>e))(r)}function Me(e,t){switch(e.kind){case"unbounded":return e;case"windowed":return(0,s.Wi)(e.key)?e:q(qe(e.group,e.key,t),e.key);case"countLimit":{const n=e.limit,r=e.n,i=e.group,o=Z(r,i,((e,t)=>t<=1?s.YP:(0,s.G)(t-1)),t),a=(0,L.Fp)((0,s.pR)(t))(n,o);return M(qe(i,a,t),a,r)}case"uniqueLimit":{const n=e.limit,r=e.n,i=e.group,o=(e,t)=>{if("object"===e.kind){const n=[...e.value.keys(),...t.keys()],i=new Set(n);return i.size>=r?s.YP:(0,s.G)(i)}return s.YP},a=Z(new Set,i,o,t),u=(0,L.Fp)((0,s.pR)(t))(n,a);return R(qe(i,u,t),u,r)}}}function Re(e,t){return(n,r)=>Ae.extend(e,((e,n)=>D(t(e,n))),n,r)}function Fe(e,t){return Te("append",e,t)}function je(e,t){return Te("join",e,t)}var Ye=n(923),$e=n(17),Ne=n(767),Le=n(341),Be=n(870);function Qe(e,t){return function(n){return e.map(n,t.compact)}}function He(e,t,n){var i=Qe(e,t),o=(0,Le.UI)(e,n);return function(e){return Be.s4(i((0,r.zG)(e,o(s.IS))),i((0,r.zG)(e,o(s.EK))))}}function Ke(e,t){return function(n){return function(r){return e.map(r,(function(e){return t.filter(e,n)}))}}}function Ve(e,t){return function(n){return function(r){return e.map(r,(function(e){return t.filterMap(e,n)}))}}}function We(e,t){var n=Ke(e,t);return function(e){var t=n((0,$e.ff)(e)),r=n(e);return function(e){return(0,Be.s4)(t(e),r(e))}}}function Je(e,t){var n=Ve(e,t);return function(e){return function(t){return(0,Be.s4)((0,r.zG)(t,n((function(t){return(0,s.IS)(e(t))}))),(0,r.zG)(t,n((function(t){return(0,s.EK)(e(t))}))))}}}var Xe=n(679),Ze=n(384);function et(e){return(0,r.ls)(s.G,e.of)}function tt(e){return(0,r.a9)(e.of(s.YP))}function nt(e){return function(t){return e.map(t,s.G)}}function rt(e){return(0,r.ls)(s.ij,e.of)}function it(e){var t=rt(e);return function(e){return(0,r.ls)(e,t)}}function ot(e){var t=vt(e),n=it(e);return function(e){return t(n(e))}}function st(e){return function(t){return(0,r.ls)(t,e.of)}}function at(e){var t=vt(e),n=st(e);return function(e){return t(n(e))}}function ut(e){return function(t){return function(n){return e.of(s.DT(t)(n))}}}function ct(e){return(0,r.ls)(s.Uo,e.of)}function lt(e){return function(t,n){return function(r){return e.map(r,s.EQ(t,n))}}}function ft(e){return function(t,n){return function(r){return e.chain(r,s.EQ(t,n))}}}function pt(e){return function(t){return function(n){return e.chain(n,s.EQ(t,e.of))}}}function mt(e){return(0,Le.UI)(e,s.dO)}function dt(e){return(0,xe.ap)(e,s.G5)}function vt(e){var t=tt(e);return function(n){return function(r){return e.chain(r,s.EQ((function(){return t()}),n))}}}function gt(e){var t=et(e);return function(n){return function(r){return e.chain(r,s.EQ(n,t))}}}var _t=n(151),ht=et(_t.PM),yt=(_t.PM,_t.of),bt=(_t.PM,function(e){return wt(_t.tD(e))}),wt=nt(_t.dO),It=_t.UI(s.Uo),St=(_t.dO,ft(_t.qo)),Gt=(_t.UA,_t.PM,_t.PM,_t.UA,_t.PM,at(_t.UA)),kt=mt(_t.dO),zt=dt(_t.Hi),Ut=ht,Et=vt(_t.UA),Pt=(_t.UA,_t.PM,_t.dO,s.Ri,_t.dO,s.Ri,s.dO,Ke(_t.dO,s.xu)),xt=(_t.dO,s.xu,_t.dO,s.xu,_t.dO,s.xu,function(e,t){return(0,r.zG)(e,kt(t))}),At=function(e,t){return(0,r.zG)(e,zt(t))},Ot=function(e,t){return(0,r.zG)(e,Et(t))},Dt="TaskOption",Tt={URI:Dt,map:xt,ap:At,chain:Ot},Ct={URI:Dt,fromIO:bt,fromTask:wt},qt=(0,Xe.oU)(Ct,Tt),Mt=(Ze.F4,Ze.Xl,et(v.PM)),Rt=(v.PM,v.of,v.PM,v.dO,s.Uo,v.dO,v.qo,v.UA,v.UI(s.FS),v.UI(s.WG),v.PM,v.PM,v.UA,v.PM,v.UA,v.dO,v.G5,Mt),Ft=(v.UA,gt(v.UA));v.PM,v.dO,s.Ri,v.dO,s.Ri,s.dO,v.dO,s.xu,v.dO,s.xu,v.dO,s.xu,v.dO,s.xu,Ze.F4,Ze.Xl;const jt=new Set(["AdRequest","Reaction","PageviewEngagement","SegmentEntry","SegmentExit"]),Yt=e=>i.dQ((t=>{let{previousState:n}=t;const[i,a]=o.Ue(!1);const[u,c]=o.gS({empty:s.YP,concat:(e,t)=>(0,r.zG)(g.oA([e,t]),s.DT(g.Od),s.UI((e=>e.reduce(((e,t)=>({...e,...t}))))))}),l=(0,r.zG)((0,_.Kn)(n)?n:{},(0,_.rO)({stateOffset:(0,r.ls)(s.DT(_.BJ),s.fS((()=>0))),fetchUnseenKey:(0,r.ls)(s.DT(_.HD),s.fS((()=>"")))})),f=(0,r.zG)(o.gS(s.uZ({concat:function(e,t){return Object.assign({},e,t)}})),(t=>{let[n,i]=t;return(0,r.zG)(o.vP(e.lastProcessedEvents,e.internalStateDiff),o.bw((e=>{let[t,n]=e;if(t().filter((e=>!jt.has(e.name))).length>0)return i(n())}))),(0,r.zG)(o.vP({internalStateDiff:n,internalStateMap:e.internalStateMap}),o.D8(((e,t)=>e.internalStateDiff===t.internalStateDiff)))})),p=(0,r.zG)(o.vP(e.sessionId,f,i),o.Rp(o.a9({...l,inFlightRequest:!1,previousDecodedState:(0,r.zG)(e.internalStateMap.current,Nt,oe,V.fS((()=>x(new Map)))),sendFullStateWithUnseen:!1}),((t,n)=>{let[i,{internalStateDiff:a,internalStateMap:u},l]=n;return(0,r.zG)(t,o.VS((t=>{if(t.inFlightRequest)return o.a9(t);const n=!l&&t.sendFullStateWithUnseen,f=n||!e.groupIdIsNewlyGenerated&&i!==t.fetchUnseenKey;return(0,r.zG)(n?Rt(u):a,Ft((()=>()=>(0,r.zG)({},s.DT((()=>f))))),_t.tD,Et((0,r.ls)(Bt(t.previousDecodedState),Ne.Vn((0,_.bw)((t=>e.logger.error(t)))),It)),St((()=>_t.of({...t,inFlightRequest:!1})),(0,r.ls)(_t.of,_t.ak("processed",(n=>(0,r.zG)(e,$t({delta:n.delta,stateOffset:t.stateOffset,fetchUnseen:f}),_t.UI((0,_.bw)((0,r.ls)(s.UI((0,_.vg)("stateDelta")),s.hX($e.ff(Ye.xb)),c)))))),_t.UI((e=>({fetchUnseenKey:i,inFlightRequest:!1,sendFullStateWithUnseen:t.sendFullStateWithUnseen&&!n,previousDecodedState:e.decodedState,stateOffset:(0,r.zG)(e.processed,s.UI((e=>e.response.state_offset)),s.fS((()=>t.stateOffset)))}))))),o.fF,o.UI(s.fS((()=>({...t,inFlightRequest:!0})))))})))})),o.xH,o.UI((e=>({stateOffset:e.stateOffset,fetchUnseenKey:e.fetchUnseenKey}))),o.D8((0,h.MW)({stateOffset:ne.Eq,fetchUnseenKey:y.Eq})));return{state:p,value:{externalStateDelta:u}}})),$t=e=>t=>(0,r.zG)(e,s.DT((e=>e.fetchUnseen||$e.ff(Ye.xb)(e.delta))),yt,Et((e=>{return(0,r.zG)(t,(n={event_source_id:t.eventSourceId,fetch_unseen:e.fetchUnseen,group_id:t.groupId,last_seen_offset:e.stateOffset,state:e.delta},e=>Ne.Y3((()=>e.permutiveApi.req({url:e.permutiveUrls.getEndpointUrl("/state",s.G("v1.0"),[["fetch_unseen",JSON.stringify(n.fetch_unseen)]]),method:"POST",payload:{group_id:n.group_id,event_source_id:n.event_source_id,state:JSON.stringify(n.state),last_seen_offset:n.last_seen_offset},contentType:"text/plain",dataType:"json",withCredentials:!1})),(e=>`Error sending state delta. Got ${V.KC(e)}`))),Ne.Vn((0,_.bw)((e=>t.reportError(e)))),It,Pt((e=>!!e)),Gt((0,r.ls)(V.of,V.YO("response"),V.ak("stateDelta",(e=>{return t=e.response.state,(0,V.Y3)((function(){return JSON.parse(t)}),r.yR);var t})),V.Vn((0,_.bw)((e=>t.reportError(`Failed to parse State API response, got ${e}`)))),s.Uo)));var n}))),Nt=e=>(0,_.b0)(e,((e,t)=>t.state?s.G({[t.checksum]:t.state}):s.YP)),Lt=e=>t=>{const n=(0,r.zG)(t,Nt,oe,V.fS((()=>x(new Map))),(t=>Te("delta",t,e)));return{decodedState:je(n,e),delta:(0,r.zG)(n,ie,s.ij,s.fS((()=>({}))))}},Bt=e=>t=>()=>new Promise((n=>(0,k.HJ)((()=>(0,r.zG)(t,V.it(Lt(e),(e=>`Failed to compute delta for state sync. Got ${e}`)),n)))));n(605),Ye.dp;var Qt=Ye.xb,Ht=function(e){return function(t){return Object.keys(t).sort(e.compare)}};y.Df;Ye.dx,Ye.e$;Ye.Bu,Ye.P5,Ye.Su;var Kt=Ye.UI;Ye.ri;function Vt(e){return Ye.vP(e)}Ye._r;Ye.jt;Ye.yW,Ye.G,Ye.t9;var Wt=Ye.HA,Jt=(Ye.nn,Ye.kp),Xt=Ye.CC,Zt=Ye.RF,en=(Ye.I8,Ye.mS,Ye.RJ,Ye._Y,Ye.V_),tn=Ye.EW,nn=Ye.nu,rn=(Ye.SW,Ye.zV,Ye.Ub,Ye.vA,Ye.qS),on=(Ye.mK,function(e){return function(t){var n=Ht(e);return function(e,r){var i=n(e);if(0===i.length)return t.of({});for(var o=t.of({}),s=function(n){o=t.ap(t.map(o,(function(e){return function(t){return e[n]=t,e}})),r(n,e[n]))},a=0,u=i;a<u.length;a++){s(u[a])}return o}}}),sn=Ye.hX;Ye.DZ,Ye.uK,Ye.tV;Ye.oA,Ye.oh;var an="Record";Ye.Eh,Ye.uZ,y.Df,y.Df,y.Df,y.Df,y.Df,y.Df,y.Df,y.Df,y.Df,y.Df,y.Df,y.Df,y.Df,y.Df,y.Df,y.Df,y.Df,y.Df,y.Df,y.Df,y.Df,y.Df,y.Df,y.Df,y.Df,Ye.nr,y.Df,y.Df,y.Df,y.Df,y.Df,y.Df,y.Df,y.Df;var un,cn=n(688),ln=n(241);!function(e){e.sequenceNonEmptyArray=e=>{if(1===e.length)return e[0];const t=(0,r.bc)([],{},[]);for(const n of e){t[0].push(...n[0]);for(const e in n[1])t[1][e]=n[1][e];t[2].push(...n[2])}return t},e.sequenceArray=t=>(0,r.zG)(t,s.DT(g.Od),s.UI(e.sequenceNonEmptyArray))}(un||(un={}));class fn{queries;_state;queriesForReplay;eventsForReplay;trace;static init(e){return(0,r.zG)(_t.Do,_t.Hr("invalidatedQueryStates",(()=>(0,r.zG)(e.queries.metadata,Ye.z7(((t,n)=>{var r;return(null===(r=e.initialState.internalStateMap[t])||void 0===r?void 0:r.checksum)!==n}))))),_t.Hr("queriesForReplay",(e=>{let{invalidatedQueryStates:t}=e;return Object.keys(t)})),_t.ak("eventsForReplay",(t=>{let{queriesForReplay:n}=t;return(0,r.zG)(n,g.EQ((()=>_t.of(g.cS)),(()=>e.pastEvents)))})),_t.Hr("internalStateMap",(t=>{let{invalidatedQueryStates:n}=t;return(0,r.zG)(e.queries.metadata,Ye.Su(((t,r)=>t in n?{checksum:r}:e.initialState.internalStateMap[t])))})),_t.Hr("state",(t=>{let{internalStateMap:n}=t;return{...e.initialState,internalStateMap:n}})),_t.UI((t=>{let{eventsForReplay:n,queriesForReplay:r,state:i}=t;return new fn(e.environment.sessionId,e.environment.viewId,e.queries,i,r,n,e.trace)})))}static initialiseState(e){return e&&"object"==typeof e&&"externalStateMap"in e&&"internalStateMap"in e?e:{externalStateMap:s.YP,internalStateMap:{}}}process(e){const t=this.trace.startSpan("query_language_process_duration");return this.updateEffects((t=>({...t,getCurrentSession:()=>e.environment.sessionId,getCurrentView:()=>e.environment.viewId}))),(0,r.zG)(this.bootstrapIfNecessary(),g.zo(this.processTPD(e.environment.thirdPartyData)),g.zo(this.processLAL(e.environment.lookalikeModels)),g.zo((0,r.zG)(g.Yo(e.externalStateDelta),g.UI(this.updateExternalState.bind(this)))),g.zo(this.processEvents(e.newEvents)),s.DT(g.Od),s.tS(un.sequenceArray),s.UI((e=>{let n=e,r=0;for(;n[2].length>r;){r=n[2].length;const e=this.processEvents(n[2]);n=un.sequenceNonEmptyArray([n,...e])}return t.finish(),n})))}lookalikeTransitionSegmentNumbers;pageviewProperties={};bootstrapped=!1;numEventsForReplay;get numQueriesForReplay(){return 0===this.numEventsForReplay?0:this.queriesForReplay.length}constructor(e,t,n,i,o,s,a){this.queries=n,this._state=i,this.queriesForReplay=o,this.eventsForReplay=s,this.trace=a,this.numEventsForReplay=s.length,this.lookalikeTransitionSegmentNumbers=(0,r.zG)(this.queries.queriesByEvent["!UpdateLookalikeModels"]||[],g.UI(parseInt),(e=>new Set(e))),this.effects={getCurrentTime:()=>new Date,getCurrentSession:()=>e,getCurrentView:()=>t,getLookalikeModels:()=>({}),setSegmentActivation:(e,t,n)=>{throw new Error(`setSegmentActivation() called for segment ${n} without being overridden first.`)},...bn(this._state.internalStateMap)}}assignProcessingStrategyToEvents(e){const t=e=>t=>(0,r.bc)(e,t);return(0,r.zG)(e,g.pO(ln.aL(((e,t)=>{const n=dn(e[1]);return(0,r.zG)(t,g.zT((e=>{let[,t]=e;return dn(t)===n})),(e=>{let{init:t,rest:n}=e;return(0,r.bc)(t,n)}),c(((e,t)=>n=>(0,r.bc)(e,(0,r.zG)(n,g.Ce(t))))(n,e)))}))),g.tS((e=>{let[n,i]=e;if(!n)return(0,r.zG)(i,g.UI(t("event")));const o=(0,r.zG)(i,g.yW(this.isLookalikeTransition.bind(this)),(e=>e?"lookalikeTransition":"transition"));return(0,r.zG)(i,ln.ut(((e,n)=>(0,r.zG)(e,g.UI(t("event")),g.R3((0,r.zG)(n,t(o)))))))})))}isLookalikeTransition(e){let[,t]=e;return this.lookalikeTransitionSegmentNumbers.has(t.properties.segment_number)}updateEffects(e){this.effects=e(this.effects)}effects;lal=s.YP;tpdReady=!1;tpdEventsToProcess=[];updateExternalState(e){return(0,r.zG)(e,Ye.jt(((e,t)=>(0,r.zG)(Ye.P5(e,this.queries.metadata),s.tS((e=>Ye.P5(e,t))),s.tS((0,r.ls)(oe,s.Uo))))),(e=>(0,r.zG)(this._state.externalStateMap,s.UI(Ye.DZ((0,r.ls)(oe,s.Uo))),s.EQ((()=>e),(t=>(0,r.zG)({...t,...e},Ye.Su(((e,n)=>(0,r.zG)(Ye.P5(e,t),s.tS((e=>s.Y3((()=>je(n,e))))),s.fS((()=>n)))))))))),Ye.UI(ie),(0,_.bw)((e=>this._state={...this._state,externalStateMap:s.G(e)})),(()=>this.processWithoutEvent("updateExternalState")))}processLAL(e){return hn.equals(this.lal,e)?[]:(this.lal=e,this.updateEffects(function(e){const t=(0,r.zG)(e,s.fS((()=>({}))));return e=>({...e,getLookalikeModels:()=>t})}(e)),(0,r.zG)(g.Yo(e),g.UI((()=>this.processWithoutEvent("updateLAL")))))}bootstrapIfNecessary(){if(this.bootstrapped)return[];const e=this.trace.startSpan("query_language_bootstrap_duration"),t=this.eventsForReplay;return this.bootstrapped=!0,this.eventsForReplay=[],(0,r.zG)(t,g.R3(In(this.effects)),g.UI((e=>(0,r.zG)((0,r.bc)("",e),this.processEvent("bootstrap")))),(0,_.bw)((()=>e.finish())))}processTPD(e){const t=(0,r.zG)(e,s.UI(a),s.FS);if(this._state.tpdHash===t)return[];this.tpdReady=s.pC(e),this._state={...this._state,tpdHash:t};const n=(0,r.zG)(e,s.UI(u));return this.updateEffects(function(e){const t=yn((()=>(0,r.zG)(e,s.fS((()=>({"3p":{}}))))));return e=>{const n=yn((()=>({...t(),...e.get1PSegments()})));return{...e,getSegments:n,getSegmentsArray:yn((()=>wn(n()))),get3PSegments:t}}}(n)),(0,r.zG)(g.Yo(e),g.tS((()=>(0,r.zG)(this.tpdEventsToProcess,g.EQ((()=>g.of(this.processWithoutEvent("updateTPD"))),(0,r.ls)((0,_.bw)((()=>this.tpdEventsToProcess=[])),g.UI(this.processEvent("updateTPD"))))))))}processWithoutEvent(e){return(0,r.zG)((0,r.bc)("",In(this.effects)),this.processEvent(e))}processEvents(e){return(0,r.zG)(e,g.EQ((()=>g.bM()),(0,r.ls)(this.assignProcessingStrategyToEvents.bind(this),g.UI((e=>{let[t,n]=e;return(0,r.zG)(n,this.processEvent(t))})))))}processEvent(e){return(0,r.ls)((0,_.bw)(l((e=>{"Pageview"===e.name&&(this.pageviewProperties=e.properties)}))),(t=>{const[n,i]=t,o=this.getQueriesToProcess(e,t);var a,u;dn(i)&&this.updateEffects((a=i.properties.segment_number,u="SegmentEntry"===i.name,e=>{return(0,r.zG)(e,(t={"1p":{...e.get1PSegments()["1p"],[a]:u}},e=>{const n=yn((()=>({...t,...e.get3PSegments()})));return{...e,getSegments:n,getSegmentsArray:yn((()=>wn(n()))),get1PSegments:()=>t}}));var t}));const c=(0,r.zG)(this._state.externalStateMap,s.EQ((()=>e=>s.YP),(e=>t=>(0,r.zG)(Ye.P5(t,e),s.UI(gn))))),l="bootstrap"!==e?this.effects:{...this.effects,getCurrentTime:()=>i.time,getCurrentView:()=>i.view_id,getCurrentSession:()=>i.session_id},{left:f,right:p}=(0,r.zG)(o,g.tV((e=>(0,r.zG)(V.Y3((()=>_n(e,l,this.queries.rawQueries[e],this._state.internalStateMap[e]||{checksum:this.queries.metadata[e]},c(e),i)),(t=>`Failed to interpret query ${e}. Got ${t}`)),V.UI((t=>(0,r.bc)(e,t))))))),m=(0,r.zG)(p,g.hX((e=>{var t,n,r;let[i,o]=e;return Boolean(null===(t=o.result)||void 0===t?void 0:t.result)!==Boolean(null===(n=this._state.internalStateMap[i])||void 0===n||null===(r=n.result)||void 0===r?void 0:r.result)})),g.UI((e=>{var t;let[n,o]=e;return(0,r.bc)((0,_.k$)(),{...i,name:null!==(t=o.result)&&void 0!==t&&t.result?"SegmentEntry":"SegmentExit",properties:{...this.pageviewProperties,segment_number:Number(n)}})}))),d=Ye.sq(p);return this.applyQueryStateDiff(d),[f,d,m]}))}applyQueryStateDiff(e){const t=(0,r.zG)(Object.entries(e),g.DZ((0,r.ls)(s.DT((e=>{let[t,{dropExternalState:n}]=e;return!0===n})),s.UI((e=>{let[t]=e;return t})))),g.EQ((()=>e=>e),(e=>t=>{const n={...t};for(const t of e)delete n[t];return n})));this._state={externalStateMap:(0,r.zG)(this._state.externalStateMap,s.UI(t)),internalStateMap:{...this._state.internalStateMap,...e},tpdHash:this._state.tpdHash}}getQueriesToProcess(e,t){var n,i,o;const[,a]=t,u=this.tpdReady?r.yR:e=>g.e5(y.Eq)(e,[...this.queries.queriesByEvent["!UpdateSecondPartyData"]||[],...this.queries.queriesByEvent["!UpdateThirdPartyData"]||[]]);switch(e){case"bootstrap":return(0,r.zG)(this.queriesForReplay,u);case"event":return this.tpdReady&&this.tpdEventsToProcess.push(t),(0,r.zG)((null===(n=this.queries.queriesByEvent)||void 0===n?void 0:n[a.name])||[],u);case"lookalikeTransition":return(null===(i=this.queries.queriesByEvent)||void 0===i?void 0:i[a.name])||[];case"transition":const e=(null===(o=this.queries.queriesByEvent)||void 0===o?void 0:o[a.name])||[];if(s.pC(this.lal)){const t=this.queries.queriesByEvent["!UpdateLookalikeModels"]||[];return e.concat(t)}return e;case"updateExternalState":return(0,r.zG)(this._state.externalStateMap,s.fS((()=>({}))),Ye.XP);case"updateLAL":return this.queries.queriesByEvent["!UpdateLookalikeModels"]||[];case"updateTPD":return[...this.queries.queriesByEvent["!UpdateSecondPartyData"]||[],...this.queries.queriesByEvent["!UpdateThirdPartyData"]||[]];default:return[]}}get state(){return this._state}}const pn=(0,r.ls)(Ye.hX((e=>{var t;return Boolean(null===(t=e.result)||void 0===t?void 0:t.result)})),Ye.XP,g.UI(parseInt)),mn=(0,r.ls)(Kt((e=>e.activations??{})),sn((0,r.zG)(Boolean,(0,$e.xD)((0,$e.ff)(Qt)))));function dn(e){var t;return("SegmentEntry"===e.name||"SegmentExit"===e.name)&&void 0!==(null===(t=e.properties)||void 0===t?void 0:t.segment_number)}const vn=z,gn=(0,r.ls)(oe,V.fS(vn)),_n=(e,t,n,i,o,a)=>{const u={...i.activations},c={...t,setSegmentActivation:(t,n,r)=>{if(r!=e)throw new Error(`QL called setSegmentActivation for query ${r} while interpreting query ${e}`);t in u?u[t].includes(n)||(u[t]=[...u[t],n]):u[t]=[n]}},l=n.lift(a,c),f=gn(i.state||null),p=gn(l),m=(0,r.zG)(V.Y3((()=>Fe(f,p)),cn.w),V.pF((e=>{throw(0,cn.w)(`Failed to append lifted event ${re(p)} to internal state ${re(f)}. Got ${e}`)}))),[d,v]=(0,r.zG)(o,s.g_((()=>(0,r.bc)(m,!1)),(e=>(0,r.zG)(V.Y3((()=>(0,r.bc)(Fe(m,e),!1)),r.Q1),V.fS((()=>(0,r.bc)(m,!0))))))),g=ie(m),_=n.interpret(ie(d),c);return{checksum:i.checksum,...null===g?{}:{state:g},...!1===_.result?{}:{result:_},...Qt(u)?{}:{activations:u},...!1===v?{}:{dropExternalState:v}}},hn=s.Eh({equals:(e,t)=>e===t});function yn(e){let t,n=!1;return()=>(n||(t=e(),n=!0),t)}function bn(e){const t=yn((()=>(0,r.zG)(e,Ye.hX((e=>{var t;return Boolean(null===(t=e.result)||void 0===t?void 0:t.result)})),Ye.UI((()=>!0)),(e=>({"1p":e}))))),n={"3p":{}},i=yn((()=>({...t(),...n})));return{getSegments:i,getSegmentsArray:yn((()=>wn(i()))),get1PSegments:t,get3PSegments:()=>n}}function wn(e){return Object.keys(e).reduce(((t,n)=>{const r=Object.keys(e[n]),i=[];return r.forEach((t=>{!0===e[n][t]&&i.push(t)})),t[n]=i,t}),{})}const In=e=>({name:"",properties:{},session_id:e.getCurrentSession(),view_id:e.getCurrentView(),time:e.getCurrentTime()});var Sn=a,Gn=u;var kn=function(e){return function(t){return[Sn(t),e(Gn(t))]}},zn=n(656);const Un=e=>(0,r.zG)(e,g.uK((e=>e<1e7)),(t=>{let{left:n,right:r}=t;return{all:e,custom:r,standard:n}}));n(856);const En=e=>[e,_t.of(e)],Pn=a,xn=u,An=e=>t=>(0,r.zG)(xn(t),(t=>()=>new Promise((n=>{const r=t();r.then(s.G).then(n);const i=(0,k.HJ)((()=>n(s.YP)),e);r.then(i)})))),On="RefEventual",Dn=o.UI(En),Tn=e=>t=>o.vP((0,r.zG)(t,o.UI(Pn),o.UI(e)),(0,r.zG)(t,o.UI(xn),o.UI(_t.UI(e)))),Cn=e=>t=>o.vP((0,r.zG)(o.vP((0,r.zG)(e,o.UI(Pn)),(0,r.zG)(t,o.UI(Pn))),o.UI((e=>{let[t,n]=e;return n(t)}))),(0,r.zG)(o.vP((0,r.zG)(e,o.UI(xn)),(0,r.zG)(t,o.UI(xn))),o.UI((e=>{let[t,n]=e;return _t.ap(t)(n)})))),qn=e=>t=>(0,r.zG)(t.current,An(e),_t.UI(s.fS((()=>(e=>Pn(e.current))(t))))),Mn=o.UI(Pn),Rn=o.UI(xn),Fn={URI:On,map:(e,t)=>Tn(t)(e)},jn={URI:On,map:Fn.map,ap:(e,t)=>Cn(t)(e)},Yn=Le.UI(Fn,V.dO),$n=(V.G5,e=>Tn(V.F2)(e)),Nn=e=>Tn(V.fS(e)),Ln=e=>Mn(e.all),Bn=(e,t)=>n=>({all:(0,r.zG)(n,Yn(e)),byAdServer:(0,_.mQ)((0,r.ls)(t,s.UI((e=>(0,r.zG)(n,Yn(e))))))}),Qn=e=>(0,r.zG)(e,Dn,Hn),Hn=e=>(0,r.zG)(e,Tn(V.F2),Bn(r.yR,(e=>s.G(e.filterCohorts)))),Kn=e=>({all:(0,r.zG)(e.all,Nn((()=>g.bM()))),byAdServer:(0,_.mQ)((0,r.ls)(e.byAdServer,s.UI(Nn((()=>g.bM())))))}),Vn=e=>(0,r.zG)(e,Kn,Ln);var Wn=n(548);const Jn=e=>i.dQ((0,r.ls)((e=>{let{previousState:t}=e;return function(e){if(e&&"object"==typeof e)return{previousUnloadEvents:"previousUnloadEvents"in e?Xn(e.previousUnloadEvents):[]};return{previousUnloadEvents:[]}}(t)}),(t=>{let{previousUnloadEvents:n}=t;n.forEach((t=>e.eventsCache.add((0,Wn.k)(t),{persistOnDisk:!0})));return{value:{newEvents:(0,r.zG)(e.newEvents,o.UI(v.UI((0,_.bw)(g.UI((t=>{let[,n]=t;Zn.has(n.name)||e.eventsCache.add(n,{persistOnDisk:!0})})))))),priorEvents:()=>e.eventsCache.all()},state:(0,r.zG)(e.eventsToProcessOnPageUnload,o.UI(g.hX((e=>{let[,t]=e;return!Zn.has(t.name)}))),o.UI(g.UI((0,r.ls)(u,Wn.X))),o.UI((e=>({previousUnloadEvents:e}))))}})));function Xn(e){return e&&Array.isArray(e)?e:[]}const Zn=new Set(["AdRequest","PageviewEngagement","PrebidAuctions","Reaction","SegmentEntry","SegmentExit","SlotRendered","ThirdPartySegments","VideoEngagement"]),er=function(){return(0,r.bc)(...arguments)},tr=e=>(0,r.zG)(i.K4((t=>{let{stopped:n}=t;const[i,a]=o.Ue(o.a9(v.of(s.YP)));let u;const c=new Promise((e=>{u=e}));return{priorEvents:()=>c.then((e=>e())),externalStateDelta:o.xH(i),newEvents:(0,r.zG)(o.vP(e.newEvents,n),o.UI((e=>{let[t,n]=e;return n?()=>[]:t}))),setCachedPriorEvents:u,setExternalStateDelta:a}})),i.ak("segmentationService",(t=>{let{newEvents:n,priorEvents:a,externalStateDelta:u}=t;return(e=>i.dQ((t=>{let{previousState:n}=t;const i=o.vP({lookalikeModels:e.lookalikeModels,sessionId:e.sessionId,thirdPartyData:(0,r.zG)(e.thirdPartyData,o.UI(s.UI(kn(Ye.UI((e=>{const t={};return e.forEach((e=>t[e]=!0)),t})))))),viewId:e.viewId}),a=(0,r.zG)(o.vP({environment:i,externalStateDelta:e.externalStateDelta,newEvents:(0,r.zG)(e.newEvents,(0,zn.I)(e.metrics,"query_language_began_processing_pageview"))}),o.UI((0,_.rO)({environment:e=>v.of(e)})),o.UI((0,xe.Yt)(v.G5))),{processedState:u,stateMigratedThisInitialisation:c}=n?{processedState:n,stateMigratedThisInitialisation:!1}:(e.metrics.track({name:"sdk_query_state_migrated_workerisation_count_total",labels:{},value:1}),{stateMigratedThisInitialisation:!0,processedState:(0,r.zG)(e.migratedStateMaps(),(e=>{let{internal:t,external:n}=e;return{externalStateMap:n,internalStateMap:(0,r.zG)(t,s.fS((()=>({}))))}}))}),l=fn.initialiseState(u),f=(0,r.zG)(_t.of(i.current),_t.tS((t=>(0,r.zG)(fn.init({environment:t,initialState:l,pastEvents:e.priorEvents,queries:e.customQueries,trace:e.trace}),e.trace.traceTask("query_language_initialisation_duration")))),_t.UI((0,_.bw)((t=>{e.metrics.trackTimeSinceInit("sdk_lifecycle_timestamps",{timestamp_name:"query_language_ready",time_origin:"sdk_init"},performance.now()),e.metrics.trackCounter({name:"sdk_queries_to_replay_count",value:t.numQueriesForReplay,labels:{}})}))),(e=>o.fF(e))),{state:p,...m}=(0,r.zG)(o.vP({model:f,inputIO:(0,r.zG)(a,o.UI(s.G))}),o.UI((0,xe.Yt)(s.G5)),o.UI(s.EQ((()=>()=>({errors:[],events:[],internalStateDiff:s.YP})),(e=>{let{model:t,inputIO:n}=e;return(0,r.zG)(n,v.UI((e=>(0,r.zG)(t.process(e),s.EQ((()=>({errors:[],events:e.newEvents,internalStateDiff:s.YP})),(t=>{let[n,r,i]=t;return{errors:n,events:e.newEvents.concat(i),internalStateDiff:s.G(r)}}))))))}))),o.En(4,{empty:{errors:[],events:[],internalStateDiff:s.YP},concat:(e,t)=>({errors:e.errors.concat(t.errors),events:e.events.concat(t.events),internalStateDiff:(0,r.zG)(g.oA([e.internalStateDiff,t.internalStateDiff]),s.DT(g.Od),s.UI((e=>e.reduce(((e,t)=>({...e,...t}))))))})}),(t=>{let[n,i,a,u]=t;return{errors:(0,r.zG)(n,o.UI(v.UI((e=>e.errors)))),events:(0,r.zG)(i,o.UI(v.UI((e=>e.events))),(0,zn.F)(e.metrics,"query_language_processed_pageview")),internalStateDiff:(0,r.zG)(a,o.UI(v.UI((e=>e.internalStateDiff)))),state:(0,r.zG)(o.vP(f,u),o.UI((e=>{let[t,n]=e;return(0,r.zG)(t,s.UI((e=>(n(),e.state))),s.fS((()=>l)))})),o.D8(((e,t)=>JSON.stringify(e)===JSON.stringify(t))))}})),d=(0,r.zG)(p,o.UI((e=>e.internalStateMap)));return{state:p,value:{...m,stateMigratedThisInitialisation:c,internalStateMap:d,segments:(0,r.zG)(d,o.UI(pn),o.D8(g.Eh(ne.Eq)),o.UI(Un)),tpdUsage:(0,r.zG)(o.vP(e.thirdPartyData,d),o.UI((e=>{let[t,n]=e;return(0,r.zG)(t,s.UI((()=>mn(n))))})))}}})))({customQueries:e.customQueries,externalStateDelta:u,lookalikeModels:e.lookalikeModels,metrics:e.metrics,logger:e.logger,newEvents:n,priorEvents:a,sessionId:e.sessionId,thirdPartyData:e.thirdPartyData,viewId:e.viewId,migratedStateMaps:e.migratedStateMaps,trace:e.trace})})),i.UI((t=>(0,r.zG)(t.segmentationService.events,o.En(4,g.uZ()),(n=>{let[i,a,l,f]=n;return{...t,newEvents:i,realtime:(0,r.zG)(a,o.Rp(!1,((e,t)=>{const n=t();return e||n.some((e=>{let[,t]=e;return"Pageview"===t.name}))}))),currentPageviewSegments:(p={processedEvents:(0,r.zG)(l,o.UI(v.UI(g.UI(u)))),segments:t.segmentationService.segments,viewId:e.viewId},(0,r.zG)(o.vP(p.processedEvents,p.viewId,p.segments),o.Rp({pageviewProcessed:!1,resolvePageviewSegments:e=>{},segments:En({all:[],custom:[],standard:[]}),viewId:""},((e,t)=>{let[n,i,o]=t;const a=n();return(0,r.zG)(e,s.DT((e=>e.viewId===i)),s.EQ((()=>{if((0,r.zG)(a,g.G((e=>"Pageview"===e.name&&e.view_id===i))))return{pageviewProcessed:!0,resolvePageviewSegments:()=>{},segments:En(o),viewId:i};{const e=(0,_.b2)();return{pageviewProcessed:!1,resolvePageviewSegments:t=>e.resolve(t),segments:er(o,(()=>e.promise)),viewId:i}}}),(e=>{return e.pageviewProcessed?(0,r.zG)(e,(0,_.rO)({segments:()=>En(o)})):(0,r.zG)(a,g.G((e=>"Pageview"===e.name&&e.view_id===i)))?(e.resolvePageviewSegments(o),{pageviewProcessed:!0,resolvePageviewSegments:()=>{},segments:En(o),viewId:i}):(0,r.zG)(e,(0,_.rO)({segments:(t=o,c((()=>t)))}));var t})))})),o.UI((e=>e.segments)))),lastProcessedEvents:(0,r.zG)(f,o.UI(v.UI(g.UI(u))))};var p})))),i.Hr("cohorts",(t=>{let{segmentationService:n}=t;return(0,r.zG)(o.fF(e.nonQlCohorts),o.UI(s.UI((e=>(0,r.zG)(n.segments,o.UI((e=>e.all)),o.UI(g.UI(String)),Qn,(t=>({query_language:t,...e})))))))})),i.ak("stateSync",(t=>{let{segmentationService:n,lastProcessedEvents:r}=t;return Yt({eventSourceId:e.eventSourceId,groupId:e.groupId,groupIdIsNewlyGenerated:e.groupIdIsNewlyGenerated,internalStateDiff:n.internalStateDiff,internalStateMap:n.internalStateMap,lastProcessedEvents:r,logger:e.logger,permutiveApi:e.permutiveApi,permutiveUrls:e.permutiveUrls,reportError:e.reportError,sessionId:e.sessionId,viewId:e.viewId})})),i.bw((e=>{let{stateSync:t,setExternalStateDelta:n}=e;return n(t.externalStateDelta)})),i.ak("segmentTransitions",(t=>{let{segmentationService:n}=t;return(e=>(0,r.zG)(i.vP({currentSegmentsSet:i.K4((()=>(0,r.zG)(e.segments,o.UI(p))))}),i.ak("transitionsSinceInit",(e=>{let{currentSegmentsSet:t}=e;return i.of(f(t))})),i.UI((e=>{let{currentSegmentsSet:t,...n}=e;return n}))))({segments:(0,r.zG)(n.segments,o.UI((e=>e.all))),viewId:e.viewId})})),i.Hr("cohortsRef",(e=>{let{cohorts:t}=e;return(0,r.zG)(t,o.VS(s.EQ((()=>o.a9(g.bM())),(0,r.ls)((e=>Object.values(e)),g.UI((0,r.ls)(Kn,(e=>e.all),Mn,o.D8(g.Eh(y.Eq)))),g.vP(o.g1),o.UI(g.xH)))))})),i.Hr("createTrackRequest",(t=>{let{cohortsRef:n,segmentationService:i}=t;return(0,r.zG)(o.vP({cohorts:(0,r.zG)(n,o.UI(s.G)),qlSegments:(0,r.zG)(i.segments,o.UI(s.G)),webClient:e.webClient}),o.UI((0,xe.Yt)(s.G5)),o.UI(s.UI((t=>{let{cohorts:n,qlSegments:r,webClient:i}=t;return t=>({...t,segments:r.all,user_id:e.groupId,cohorts:n,properties:{...t.properties,client:{...i,...t.properties.client??{}}}})}))))})),e.trackPageviewComplete?(0,r.ls)(i.ak("pageviewComplete",(t=>{let{newEvents:n}=t;return b({currentTimestampSecs:e.currentTimestampSecs,events:n,sessionId:e.sessionId,viewId:e.viewId})})),i.UI((e=>{let{pageviewComplete:t,...n}=e;return{...n,eventsToCacheOnPageUnload:t.eventsToProcessOnPageUnload,eventsToPublishOnPageUnload:(0,r.zG)(o.vP(n.createTrackRequest,t.eventsToProcessOnPageUnload),o.UI((e=>{let[t,n]=e;return(0,r.zG)(t,s.EQ((()=>g.cS),(e=>(0,r.zG)(n,g.UI(l(e))))))}))),newEvents:t.eventsToProcessImmediately}}))):i.UI((e=>({...e,eventsToCacheOnPageUnload:o.a9(g.cS),eventsToPublishOnPageUnload:o.a9(g.cS)}))),i.ak("eventCache",(t=>{let{eventsToCacheOnPageUnload:n,newEvents:o,setCachedPriorEvents:s}=t;return(0,r.zG)(e.eventsCache,V.EQ((e=>(s(e),i.of({newEvents:o}))),(e=>(0,r.zG)(Jn({eventsCache:e,eventsToProcessOnPageUnload:n,newEvents:o}),i.UI((e=>{let{newEvents:t,priorEvents:n}=e;return s(n),{newEvents:t}}))))))})),i.UI((e=>({...e,newEvents:e.eventCache.newEvents}))),i.Hr("eventsToPublish",(t=>{let{cohorts:n,newEvents:i,segmentationService:a}=t;return(0,r.zG)(o.vP(i,e.webClient,a.segments,(0,r.zG)(n,o.UI(s.UI((0,r.ls)((e=>Object.values(e)),g.UI(Kn),g.UI((e=>e.all))))))),o.UI((t=>{let[n,i,o,a]=t;return(0,r.zG)(s.Do,s.Qt("webClient",i),s.Qt("cohorts",a),s.ak("events",(()=>(0,r.zG)(n(),s.DT(g.Od)))),yt,qt((e=>(0,r.zG)(e.cohorts,_t.uU(qn(1e3)),_t.UI(g.xH),_t.UI((t=>({...e,cohorts:t})))))),kt((t=>{let{cohorts:n,events:i,webClient:s}=t;return(0,r.zG)(i,g.UI(l((t=>({...t,segments:o.all,user_id:e.groupId,cohorts:n,properties:{...t.properties,client:{...s,...t.properties.client??{}}}})))))})),_t.UI(s.fS((()=>g.bM()))))})),(e=>{const[t,n]=o.gS(g.uZ());return(0,r.zG)(e,o.UI((e=>e().then(n)))),t}))})));var nr=n(963);const rr={web:{auto_init:!1,track_pageview_engagement:!0,track_form_submission:!1,track_link_click:!0,track_pageview_complete:!0,add_alchemy_taxonomy:!1,add_alchemy_entities:!1,engagement_edge_only:!0,segment_transition_edge_only:!0,activationConfigs:[]},freewheel:{auto_init:!0,activationConfigs:[]},dfp:{auto_init:!0,track_slot_rendered:!1,track_slot_viewable:!0,track_slot_clicked:!0,activationConfigs:[]}},ir=e=>{const t=rr[e];return(e,n)=>(null==t?void 0:t[e])??n};ir("web"),ir("dfp"),ir("facebook_pixel_v2");function or(e){return t=>(0,r.zG)(o.oQ(e),o.UI((0,_.rO)({backoffAfterErrorMs:e=>e??0,backoffAfterSuccessMs:e=>e??0})),(e=>i.dQ((n=>{let{previousState:i}=n;const[a,u]=o.Ue(function(e){if("object"!=typeof e||null===e)return{lastSuccess:0,lastError:0};return e}(i)),c=(0,r.zG)(o.vP(a,e),o.UI((e=>{let[t,n]=e;return Math.max(t.lastError+n.backoffAfterErrorMs,t.lastSuccess+n.backoffAfterSuccessMs)})));return{state:a,value:(0,r.ls)(s.DT((()=>Date.now()>=c.current)),s.UI(t),s.UI((0,_.bw)((e=>e.then((()=>u({...a.current,lastSuccess:Date.now()})),(()=>u({...a.current,lastError:Date.now()})))))))}}))))}const sr=function(e,t){return i.of(s.YP)};var ar=n(930);const ur=["pug"],cr=function(e,t){return(0,r.zG)(lr(e),or({backoffAfterErrorMs:6e5}),i.VS((e=>ar.m((0,r.zG)(t,o.UI((0,_.rO)({tpdUsage:s.UI((0,r.ls)(Ye.UI(Ye.z7((e=>!ur.includes(e)))),Ye.hX((0,$e.ff)(Ye.xb))))})),o.UI((t=>{let{tpdUsage:n,userId:i}=t;return{validityKey:()=>i,freshnessKey:(0,r.ls)((()=>n),s.EQ((()=>0),(0,r.ls)(JSON.stringify,_.vp))),refresh:(0,r.zG)(n,s.hX((e=>Object.keys(e).length>0)),s.UI(Ne.it((t=>(0,r.zG)(e({user_id:i,time:new Date,tpd_segments:t}),s.fS((()=>Promise.reject("Blocked by backoff."))))),(e=>`Failed to report TPD usage. Got ${e}`))))}})))))),i.UI(r.Q1))};const lr=e=>t=>{const{config:n,metrics:r,permutiveApi:i,permutiveUrls:o}=e,a=r.startTimer("sdk_http_tpd_usage_seconds",{});return i.req({url:o.getEndpointUrl("/tpd/usage",s.G(n.apiVersion)),method:"POST",payload:t,contentType:"text/plain",dataType:"json",withCredentials:!1}).then((e=>(r.stopTimer("sdk_http_tpd_usage_seconds",a),e)))};function fr(e,t){const n=["amp","gigya","pxid","sailthru"],a=(0,r.zG)(t.identities,o.UI(s.UI(Ye.z7((e=>!n.includes(e))))),o.UI(s.hX((0,$e.ff)(Ye.xb)))),u=e=>(0,_.vp)(JSON.stringify(e)),c=e=>[u(e),e];return(0,r.zG)(i.vP({fetchFromNewEndpoint:(0,r.zG)(pr(e),or({backoffAfterErrorMs:6e5})),fetchFromLegacyEndpoint:(0,r.zG)(mr(e),or({backoffAfterErrorMs:6e5}))}),i.VS((n=>{let{fetchFromNewEndpoint:u,fetchFromLegacyEndpoint:l}=n;return(0,r.zG)(ar.m((0,r.zG)(o.vP(t.userId,t.sessionId,a),o.UI((t=>{let[n,i,o]=t;return{validityKey:()=>n,freshnessKey:()=>`${dr(o)},${i}`,refresh:(0,r.zG)(o,s.YO("identities"),s.Hr("userId",(()=>n)),s.UI((0,r.ls)(Ne.it((t=>(0,r.zG)((t=>(0,r.zG)(u(t),s.UI((e=>e.catch((()=>(0,r.zG)(l(t.identities),s.fS((()=>e))))))),s.wp((()=>l(t.identities))),s.UI((0,_.bw)((t=>{const n=e.metrics.startTimer("sdk_get_third_party_data_task_duration_seconds",{});t.catch(r.Q1).then((()=>{e.metrics.stopTimer("sdk_get_third_party_data_task_duration_seconds",n)}))})))))(t),s.fS((()=>Promise.reject("Blocked by persistent backoff"))))),(e=>`Error fetching TPD. Got ${e}`)),Ne.UI(c))))}})))),ar.d((e=>s.G((e=>Array.isArray(e)?e:c(e))(e)))),i.UI(o.UI((0,r.ls)(V.fS((t=>(e.logger.warn("[TPD]",`Failed to retrieve usable value, using zero value. ${t}`),s.G(c({}))))),s.UI((0,_.bw)((()=>e.metrics.trackTimeSinceInit("sdk_lifecycle_timestamps",{timestamp_name:"audience_matching_ready",time_origin:"sdk_init"}))))))))})))}const pr=e=>async t=>{const n=e.metrics.startTimer("sdk_http_audience_matching_seconds",{}),i=await e.permutiveApi.req({url:e.permutiveUrls.getAudienceMatchingEndpointUrl("/id",s.G("v1"),t.userId),payload:{identities:(0,r.zG)(t.identities,Ye.Yz,g.UI((e=>{let[t,n]=e;return{tag:t,id:n}})))},method:"POST",withCredentials:!1,dataType:"json"});return e.metrics.stopTimer("sdk_http_audience_matching_seconds",n),i.items},mr=e=>async t=>{const n=e.metrics.startTimer("sdk_http_tpd_seconds",{}),r=await e.permutiveApi.req({url:e.permutiveUrls.getEndpointUrl("/tpd",s.G(e.config.apiVersion)),method:"POST",payload:{user_id:t},contentType:"text/plain",dataType:"json",withCredentials:!1});return e.metrics.stopTimer("sdk_http_tpd_seconds",n),r},dr=(0,r.ls)(JSON.stringify,_.vp);const vr=(e,t)=>(0,r.zG)(i.vP({data:fr(e,{identities:t.identities,sessionId:t.sessionId,userId:t.userId}),usageReporting:cr(e,o.vP({tpdUsage:t.tpdUsage,userId:t.userId}))}),i.ak("analytics",(e=>{let{data:n}=e;return function(e){return i.dQ((t=>{let{previousState:n}=t;const[i,a]=o.gS(g.uZ());var u;return{state:(0,r.zG)(o.vP(e.userId,e.providerSegments,e.sessionId,e.viewId),o.D8(((e,t)=>{let[n,r]=e,[i,o]=t;return n===i&&r===o})),o.Rp(null!==(u=n)&&"object"==typeof u?u:{userId:"",providerHashes:{}},((e,t)=>{let[n,i,o,u]=t;const c=(0,r.zG)(i,s.fS((()=>({})))),l=(0,r.zG)(c,Ye.UI((0,_.SL)(_.vp))),f=(0,r.zG)(e,s.DT((e=>e.userId===n)),s.UI((e=>e.providerHashes)),s.fS((()=>({}))));return(0,r.zG)(c,Ye.z7((e=>l[e]!==(f[e]||0))),(e=>Object.entries(e)),g.UI((e=>{let[t,n]=e;return(0,r.bc)((0,_.k$)(),{name:"ThirdPartySegments",properties:{data_provider:t,segments:[...n]},session_id:o,time:new Date,view_id:u})})),a),{userId:n,providerHashes:l}}))),value:i}}))}({providerSegments:(0,r.zG)(n,o.UI(s.UI(Gn))),sessionId:t.sessionId,userId:t.userId,viewId:t.viewId})})),i.UI((e=>{let{data:t,analytics:n}=e;return{data:t,analyticsEvents:n}}))),gr=function(e){const t={include_geo:!0,include_isp:!0,include_ip_hash:!0,include_ip:!1},n=e.trace.startSpan("geoip_data_retrieval");return(0,r.zG)(ar.m((0,r.zG)(e.sessionId,o.UI((n=>({validityKey:()=>(0,_.vp)(JSON.stringify(t)),freshnessKey:()=>n,refresh:s.G(Ne.Y3((()=>_r(e.permutiveApi,e.metrics,e.config,t,e.permutiveUrls)),(e=>`Error fetching geoip. Got ${e}`)))}))))),i.UI(o.UI(V.fS((t=>(e.logger.warn("[geoip]",`Failed to retrieve usable value, using zero value. ${t}`),s.G({})))))),i.bw(o.bw(s.UI((()=>{e.metrics.trackTimeSinceInit("sdk_lifecycle_timestamps",{timestamp_name:"geoip_data_ready",time_origin:"sdk_init"},performance.now()),n.finish()})))))};const _r=(e,t,n,r,i)=>{const o=[];r.include_geo&&o.push(["include","geo"]),r.include_isp&&o.push(["include","isp"]),r.include_ip&&o.push(["include","ip"]),r.include_ip_hash&&o.push(["include","ip_hash"]);const a=t.startTimer("sdk_http_geoip_seconds",{});return e.req({url:i.getEndpointUrl("/geoip",s.G(n.apiVersion),o),method:"GET",contentType:"text/plain",dataType:"json",withCredentials:!1}).then((e=>(t.stopTimer("sdk_http_geoip_seconds",a),e)))},hr=e=>t=>{const n=r=>{const i={...r};for(let o in r){const s=r[o];t.hasOwnProperty(s)?null!=e&&e.dropUnenriched&&void 0===t[s]?delete i[o]:i[o]=t[s]:null!==s&&"object"==typeof s&&s.constructor===Object&&(i[o]=n(s))}return i};return n},yr=e=>(0,r.zG)(wr(e),o.YO("data"),o.Hr("replacementMap",(e=>{let{data:t}=e;return(0,r.zG)(t,s.YO("data"),s.Hr("taxonomyLabels",(e=>{let{data:t}=e;return function(e){const t=e=>{const t=e.split("/").filter((e=>e));return t.map(((e,n)=>"/"+t.slice(0,n+1).join("/")))},n=g.xH(e.filter(Boolean).map((e=>t(e.label))));return g.jj(y.Eq)(n)}(t.taxonomy??[])})),s.UI((e=>{var t,n,i;let{data:o,taxonomyLabels:s}=e;return{$alchemy_concepts:o.concepts??[],$alchemy_document_emotion:(null===(t=o.emotion)||void 0===t||null===(n=t.document)||void 0===n?void 0:n.emotion)??null,$alchemy_document_sentiment:(null===(i=o.sentiment)||void 0===i?void 0:i.document)??null,$alchemy_entities:o.entities??[],$alchemy_entity_names:(0,r.zG)(o.entities??[],g.UI((e=>e.text))),$alchemy_keywords:o.keywords??[],$alchemy_taxonomy:o.taxonomy??[],$alchemy_taxonomy_labels:s,$taxonomy_labels:s}})))})),o.Hr("permutiveContext",(e=>{let{data:t}=e;return(0,r.zG)(t,s.EQ((()=>({})),(e=>({watson:e}))))})),(e=>({permutiveContext:(0,r.zG)(e,o.UI((e=>e.permutiveContext))),replacementMap:(0,r.zG)(e,o.UI((e=>e.replacementMap)))}))),br=()=>o.a9(s.G({})),wr=br;const Ir=function(e,t,n,r){return i.of({cohorts:s.YP,externalData:{[Sr]:o.a9(s.YP)}})};const Sr="_pssps",Gr=e=>{const t=(0,r.zG)((null==e?void 0:e.dfp)??[],g.UI(String),(e=>new Set(e)));return{id:"dfp",filterCohorts:g.hX((e=>t.has(e)))}};const kr=e=>{if(!e.metrics.isEnabled())return()=>{};const t=(0,r.zG)(e.adServers,g.UI((e=>(0,r.bc)(e.id,e))),Ye.sq,Ye.UI((t=>{const n=(0,r.zG)(e.cohorts,Ye.DZ((e=>e.byAdServer(t))),(e=>o.vP(e)),o.UI(Ye.UI((i=5e3,a="Timeout",e=>(0,r.zG)(e,An(i),_t.UI(s.pF((()=>V.t$(a)))))))),o.UI((0,xe.Yt)(_t.Hi)),o.UI(_t.UI((0,r.ls)(Ye.oh,Be.Vn(Ye.Su(((t,n)=>{e.logger.warn("[Targeting Metrics]",`[${t}]`,n)}))),Be.F2))),(e=>()=>e.current));var i,a;return(0,r.ls)(g.of,g.UI((e=>e.cohorts)),Ur,g.UI((e=>{let[t,n]=e;return{allCohorts:new Set(t),cohortCountByType:zr(t),requestCount:n}})),(i=>(0,r.zG)(n(),_t.UI(Ye.Su(((t,n)=>(i,o)=>{(0,r.zG)(n,g.Hr("actualCohortCount",(e=>{let{cohortCountByType:t}=e;return(0,r.zG)(t,Ye.P5(i))})),g.UI((n=>{const a={cohort_type:i,target:t},u=o.reduce(((e,t)=>n.allCohorts.has(t)?e+1:e),0),c=o.length-u;e.metrics.track({name:"sdk_ad_request_missed_cohorts",labels:a,value:n.requestCount*c}),e.metrics.track({name:"sdk_ad_request_successful_cohorts",labels:a,value:n.requestCount*u}),(0,r.zG)(n.actualCohortCount,s.UI((t=>{const r=t-u;e.metrics.track({name:"sdk_ad_request_superfluous_cohorts",labels:a,value:n.requestCount*r})})))})))})(t.id,i))))),(e=>e()))})));return e=>{if("AdRequest"===e.name)(n=e.properties).ad_server_id in t&&t[n.ad_server_id](n);var n}},zr=e=>({ql:(0,r.zG)(e,g.u4(0,((e,t)=>isNaN(parseInt(t))?e:e+1)))}),Ur=e=>(0,r.zG)(e,g.pO((e=>{const{init:t,rest:n}=(0,r.zG)(e,g.zT((t=>t===e[0])));return[t,n]})),g.UI((e=>[e[0],e.length]))),Er=e=>s.YP;const Pr=h.n_({cohorts:g.Eh((0,_.Or)()),ctx:(0,_.Or)()}),xr=g.cS;Promise.resolve(V.F2(xr)),h.n_({userId:(0,_.Or)(),lastSuccess:{equals:(e,t)=>e&&t&&Pr.equals(e,t)||e===t}});const Ar=h.n_({cohorts:K.Eh(h.n_({code:y.Eq,groups:K.Eh(ne.Eq)})),groups:K.Eh(ne.Eq)}),Or=(h.n_({userId:(0,_.Or)(),lastSuccess:{equals:(e,t)=>e===t||!!e&&!!t&&h.bc(y.Eq,Ar).equals(e,t)}}),()=>({_pcrdbs:o.a9(s.YP),_pcrprs:o.a9(s.YP)}));const Dr=function(e,t){return i.of({cohorts:s.YP,externalData:Or()})};const Tr=i.K4((()=>{}));const Cr=e=>t=>(0,r.zG)(e,Ye.UI((e=>t.reduce(((t,n)=>t+Number(e.has(n))),0)))),qr=e=>t=>{const{addonsLoaded:n,consent:a,currentTimestampSecs:u,identities:c,initdAddons:f,sessionId:p,userId:m,viewId:d,pageviewState:b}=t;return(0,r.zG)(i.K4((()=>{let n;const r=new Promise((e=>{n=e})),[i,a]=o.Ue(o.a9(s.YP));return{...t,adServers:[Gr(e.optimisedActivationsConfig.dfp)],nonQlCohortsT:()=>r,setNonQlCohorts:n,setTpdUsage:a,tpdUsage:o.xH(i)}})),i.ak("geoip",(()=>(e=>(0,r.zG)(e,gr,i.YO("data"),i.Hr("replacementMap",(e=>{let{data:t}=e;return(0,r.zG)(t,o.UI(s.UI((e=>{var t;return{$ip_geo_info:e.geo_info,$ip_geo_info_continent:null===(t=e.geo_info)||void 0===t?void 0:t.continent,$ip_isp_info:e.isp_info,$ip_address:e.ip,$ip_address_hash:e.ip_hash}}))))})),i.Hr("permutiveContext",(e=>{let{data:t}=e;return(0,r.zG)(t,o.UI(s.EQ((()=>({})),(e=>{var t,n,r,i,o,s,a,u,c;return{isp:null===(t=e.isp_info)||void 0===t?void 0:t.isp,organization:null===(n=e.isp_info)||void 0===n?void 0:n.organization,autonomous_system_number:null===(r=e.isp_info)||void 0===r?void 0:r.autonomous_system_number,autonomous_system_organization:null===(i=e.isp_info)||void 0===i?void 0:i.autonomous_system_organization,continent:null===(o=e.geo_info)||void 0===o?void 0:o.continent,country:null===(s=e.geo_info)||void 0===s?void 0:s.country,city:null===(a=e.geo_info)||void 0===a?void 0:a.city,province:null===(u=e.geo_info)||void 0===u?void 0:u.province,postal_code:null===(c=e.geo_info)||void 0===c?void 0:c.postal_code}}))))}))))({...e,sessionId:p}))),i.Hr("watson",(t=>{let{webClient:n}=t;return(0,r.zG)(n,o.UI(s.UI((e=>e.url))),(t=>yr({...e,pageUrl:t,watsonEnabled:(0,r.zG)(b,o.UI((e=>e.watsonEnabled)))})))})),i.ak("audienceMatching",(t=>{let{tpdUsage:n}=t;return vr(e,{identities:c,sessionId:p,tpdUsage:n,userId:m,viewId:d})})),i.UI((e=>{let{audienceMatching:{analyticsEvents:t,...n},newEvents:i,...s}=e;return{...s,audienceMatching:n,newEvents:(0,r.zG)(o.vP(i,t),o.UI(v.RD),o.UI(v.UI(g.xH)))}})),i.UI((e=>{const[t,n,i]=o.Ue(s.bM()),[a,u]=(0,r.zG)(e.newEvents,o.En(2,g.uZ())),c=(0,r.zG)(o.vP(a,t),o.UI((e=>{let[t,n]=e;return(0,r.zG)(n,s.UI((e=>(0,r.zG)(t,v.UI(g.UI((0,_.bw)((t=>{let[,n]=t;return e(n)}))))))),s.fS((()=>v.of(g.bM()))))})));return{...e,newEvents:c,newEventsForAdvertiserSegmentation:u,collectTargetingSuccessMetrics:e=>{n(s.G(e)),i()}}})),i.ak("enrichedEvents",(t=>{let{enrichmentReplacementMap:n,geoip:a,newEvents:u,watson:c}=t;return(0,r.zG)(o.vP({misc:n,geoip:a.replacementMap,watson:c.replacementMap}),o.UI((0,xe.Yt)(s.G5)),o.UI(s.UI((e=>{let{misc:t,geoip:n,watson:r}=e;return{...t,...n,...r}}))),(t=>i.K4((()=>((e,t,n,i)=>((0,r.zG)(t,o.UI(s.pC),o.YP((t=>{t&&e.trackTimeSinceInit("sdk_lifecycle_timestamps",{timestamp_name:"event_enrichment_ready",time_origin:"sdk_init"})}))),(0,r.zG)(n,o.VS((()=>(0,r.zG)(o.vP((0,r.zG)(t,o.UI(s.UI(hr({dropUnenriched:!0})))),i),o.UI((0,r.ls)((e=>{let[t,n]=e;return()=>(0,r.zG)(t,s.EQ((()=>[]),(e=>(0,r.zG)(n(),g.UI(l((0,_.rO)({properties:e})))))))})))))))))(e.metrics,t,m,u)))))})),i.UI((0,_.rO)({enrichedEvents:(0,zn.F)(e.metrics,"pageview_enriched")})),i.ak("lookalikeModels",(()=>(0,r.zG)(e.lookalikeModels,s.EQ((()=>(0,nr.lookalikeModelsService)({...e,consent:a,currentTimestampSecs:u})),i.of)))),i.ak("queryLanguage",(n=>{let{audienceMatching:s,nonQlCohortsT:a,enrichedEvents:u,lookalikeModels:c,setTpdUsage:l,userIdIsNewlyGenerated:f}=n;return(0,r.zG)((p={...e,...t,newEvents:u,thirdPartyData:s.data,groupId:m,groupIdIsNewlyGenerated:f,nonQlCohorts:a,lookalikeModels:c,migratedStateMaps:e.migratedStateMaps},(0,r.zG)(o.vP(p.eventSourceId,p.groupId,p.groupIdIsNewlyGenerated),o.D8((0,r.zG)(y.Eq,h.Uz((e=>{let[t]=e;return t})))),i.kR((e=>{let[t,n,o]=e;return(0,r.zG)(tr({...p,eventSourceId:t,groupId:n,groupIdIsNewlyGenerated:o,migratedStateMaps:p.migratedStateMaps}),i.yi(t))})),i.UI((e=>({stateMigratedThisInitialisation:(0,r.zG)(e,o.UI((e=>e.segmentationService.stateMigratedThisInitialisation))),cohorts:(0,r.zG)(e,o.VS((e=>e.cohortsRef))),currentPageviewSegments:{all:(0,r.zG)(e,o.VS((e=>e.currentPageviewSegments)),Tn((e=>e.all))),custom:(0,r.zG)(e,o.VS((e=>e.currentPageviewSegments)),Tn((e=>e.custom))),standard:(0,r.zG)(e,o.VS((e=>e.currentPageviewSegments)),Tn((e=>e.standard)))},eventsToPublish:(0,r.zG)(e,o.VS((e=>e.eventsToPublish))),eventsToPublishOnPageUnload:(0,r.zG)(e,o.VS((e=>e.eventsToPublishOnPageUnload))),realtime:(0,r.zG)(e,o.VS((e=>e.realtime)),o.Rp(!1,((e,t)=>e||t)),o.bw((e=>{e&&p.metrics.trackTimeSinceInit("sdk_lifecycle_timestamps",{timestamp_name:"worker_realtime",time_origin:"sdk_init"},performance.now())}))),segments:{all:(0,r.zG)(e,o.VS((e=>e.segmentationService.segments)),o.UI((e=>e.all))),custom:(0,r.zG)(e,o.VS((e=>e.segmentationService.segments)),o.UI((e=>e.custom))),standard:(0,r.zG)(e,o.VS((e=>e.segmentationService.segments)),o.UI((e=>e.standard)))},thirdPartyDataUsage:(0,r.zG)(e,o.VS((e=>e.segmentationService.tpdUsage))),transitionsSinceInit:(0,r.zG)(e,o.VS((e=>e.segmentTransitions.transitionsSinceInit)))}))))),i.bw((e=>{let{thirdPartyDataUsage:t}=e;return l(t)})));var p})),i.ak("classificationModels",(t=>{let{queryLanguage:r}=t;return sr(e,o.vP({consent:a,currentTimestampSecs:u,initdAddons:f,queryLanguageCohorts:Rn(r.currentPageviewSegments.all),realtime:r.realtime,addonsLoaded:n,userId:m}))})),i.ak("demandPartners",(n=>{let{queryLanguage:a}=n;return((e,t)=>(0,r.zG)(Ir(e.permutiveApi,e.permutiveUrls,e.reportError,t),i.UI((e=>{let{cohorts:t,externalData:n}=e;return{ssp:t,externalData:n}}))))(e,{cohorts:$n(a.currentPageviewSegments.all),consent:t.consent,url:(0,r.zG)(t.webClient,o.UI(s.UI((e=>e.url))))})})),i.ak("advertiserSegmentation",(t=>{let{demandPartners:i,queryLanguage:u,newEventsForAdvertiserSegmentation:c}=t;return Dr(e,o.vP({addonsLoaded:n,consent:a,customCohorts:Rn(u.currentPageviewSegments.custom),demandPartnerCohorts:(0,r.zG)(i.ssp,s.UI((e=>e.all)),s.UI((l=()=>g.bM(),o.UI((0,r.ls)(Pn,V.fS(l))))),s.fS((()=>o.a9(g.bM())))),initdAddons:f,realtime:u.realtime,sessionId:p,standardCohorts:Rn(u.currentPageviewSegments.standard),userId:m,viewId:d,events:c}));var l})),i.ak("ipIdentifier",(e=>{let{userId:t,geoip:n}=e;return(0,r.zG)(n.data,o.UI(s.tS(s.KQ((e=>e.ip))))),Tr})),i.ak("nonQlCohorts",(e=>{let{advertiserSegmentation:t,classificationModels:n,contextualCohorts:o,setNonQlCohorts:s,demandPartners:a,viewId:u}=e;return(0,r.zG)(i.of(Ye.oA({advertiser:t.cohorts,classificationModel:n,contextual:Er({contextualCohorts:o,viewId:u}),ssp:a.ssp})),i.bw(s))})),i.Hr("qlCohorts",(e=>{let{queryLanguage:t}=e;return(0,r.zG)(t.segments.all,o.UI(g.UI(String)))})),i.bw((t=>t.collectTargetingSuccessMetrics(kr({adServers:t.adServers,cohorts:{...t.nonQlCohorts,query_language:Qn(t.qlCohorts)},logger:e.logger,metrics:e.metrics})))),i.Hr("eventsToPublish",(t=>{let{qlCohorts:n,queryLanguage:i,nonQlCohorts:s}=t;const a=(e=>{if(!e.metrics.isEnabled())return e=>{};const t=(0,r.zG)(e.cohortsByType,Ye.UI(o.Rp(new Set,((e,t)=>new Set([...e,...t])))),(e=>o.vP(e)));return n=>{"Pageview"===n.name&&(0,k.HJ)((()=>(0,r.zG)(n.cohorts,Cr(t.current),Ye.Su(((t,n)=>e.metrics.track({name:"sdk_pageview_cohort_count",labels:{cohort_type:t},value:n}))))))}})({cohortsByType:(0,r.zG)(s,Ye.UI(Vn),Ye.dx("query_language",n)),metrics:e.metrics});return(0,r.zG)(i.eventsToPublish,o.UI(v.UI(g.UI((0,_.bw)((e=>{let[,t]=e;return a(t)}))))))})),i.UI((e=>{let{adServers:t,advertiserSegmentation:n,demandPartners:i,eventsToPublish:s,geoip:a,queryLanguage:u,nonQlCohorts:c,watson:l}=e;return{activations:(0,r.zG)(t,g.UI((e=>(0,r.zG)(Object.values(c),g.UI(Kn),g.DZ((t=>t.byAdServer(e))),g.UI(Mn),g.UI(o.D8(g.Eh(y.Eq))),(e=>o.vP(...e)),o.UI(g.xH),(t=>(0,r.bc)(e.id,t))))),Ye.sq),cohorts:{all:u.cohorts,ql:u.segments.all,qlCustom:u.segments.custom,qlStandard:u.segments.standard},context:(0,r.zG)(o.vP(l.permutiveContext,a.permutiveContext),o.UI((e=>{let[t,n]=e;return{...t,...n}}))),eventsToPublish:s,eventsToPublishOnPageUnload:u.eventsToPublishOnPageUnload,externalData:o.vP({...n.externalData,...i.externalData}),geoIP:a.data,realtime:u.realtime,stateMigratedThisInitialisation:u.stateMigratedThisInitialisation,transitionsSinceInit:u.transitionsSinceInit}})))}},652:(e,t,n)=>{n.d(t,{BJ:()=>f,El:()=>x,G6:()=>b,HD:()=>l,HP:()=>G,Kn:()=>c,Or:()=>I,PQ:()=>w,SL:()=>m,aT:()=>g,b0:()=>h,b2:()=>d,bw:()=>U,k$:()=>_,lo:()=>E,mQ:()=>k,rO:()=>z,vg:()=>S,vp:()=>p});var r=n(500),i=n(735),o=n(567),s=n(17),a=n(751),u=n(992);const c=e=>"object"==typeof e&&!Array.isArray(e)&&null!==e,l=e=>"string"==typeof e,f=e=>"number"==typeof e&&!Number.isNaN(e);function p(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t&=t;return t}function m(e){return t=>{let n=0;for(let r of t){n=n+e(r)|0}return n}}s.ff(a.xb);function d(){let e,t;return{promise:new Promise(((n,r)=>{e=n,t=r})),reject:t,resolve:e}}let v=[];function g(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:navigator.userAgent;if(v.unshift(e),v.length>1)return;const n=["beforeunload","pagehide"],r=n.concat(["visibilitychange"]),i=e=>{if(!o&&e){o=!0;const e=v;v=[],e.forEach((e=>{try{e()}catch{}}))}};let o=!1;r.forEach((e=>{window.addEventListener(e,(()=>{const n=("visibilitychange"!==e||document.hidden)&&y(t);i(n)}))})),n.forEach((e=>{window.addEventListener(e,(()=>i(!0)))}))}function _(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(e=>(e^(self.crypto||self.msCrypto).getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)))}function h(e,t){const n=Object.keys(e),r=n.length,i={};for(let s=0;s<r;s++){const r=n[s],a=t(r,e[r]);(0,o.pC)(a)&&(i[r]=a.value)}return i}function y(e){return/Mobi|Android/i.test(e)}function b(e){return/^((?!chrome|android).)*safari/i.test(e)}function w(e,t){return new Promise((n=>{(0,u.HJ)((()=>{Promise.resolve(e()).then(n)}),(null==t?void 0:t.timeout)??0)}))}const I=()=>({equals:(e,t)=>Object.is(e,t)});function S(e){return t=>null!=t&&e in t?t[e]:void 0}function G(e){let t=o.YP;const n=(0,o.fS)((()=>{const n=e();return t=(0,o.G)(n),n}));return()=>n(t)}const k=e=>{const t=new Map;return n=>(t.has(n)||t.set(n,e(n)),t.get(n))},z=e=>t=>{const n={...t};for(const i in e){var r;n[i]=null===(r=e[i])||void 0===r?void 0:r.call(e,t[i])}return n};function U(e){return t=>(e(t),t)}const E=e=>t=>{const n=e.slice(0,-1),s=e.slice(-1)[0];return(0,i.zG)(n,r.f2((e=>{let[n,r]=e;return(0,i.zG)(t,o.DT(n),o.UI(r))})),o.fS((()=>s(t))))},P=e=>t=>{if("number"==typeof t)return t;if("string"==typeof t){const n=e(t);return Number.isNaN(n)?void 0:n}};P(parseInt),P(parseFloat);function x(e){return"object"==typeof e&&null!==e&&"_tag"in e&&["None","Some"].includes(e._tag)}},963:(e,t,n)=>{n.r(t),n.d(t,{lookalikeModelsService:()=>b,realService:()=>I,stubService:()=>w});var r=n(735),i=n(567);const o=(e,t,n,r)=>t+(n-t)*r/(Math.pow(2,e)-1),s=(e,t)=>{const n=(e,t)=>{const n=e.toString(16);return("0".repeat(t)+n).slice(Math.min(-t,-n.length))};return`${n(e.getUint32(t),8)}-${n(e.getUint16(t+4),4)}-${n(e.getUint16(t+6),4)}-${n(e.getUint16(t+8),4)}-${n(e.getUint32(t+10),8)}${n(e.getUint16(t+14),4)}`},a=e=>{const t=[1,2],n=e.getInt8(0);if(1===n)return u(e);if(2===n)return c(e);{const r=(0,i.Y3)((()=>s(e,1))),o=(0,i.g_)((()=>"Couldn\'t decode model id"),(e=>`Model id was ${e}`))(r);throw new Error(`Decoding only supported for version(s): ${t}; Supplied version was ${n}; ${o}`)}},u=e=>l(e,1),c=e=>l(e,2),l=(e,t)=>{const n=s(e,1),r=((e,t)=>{switch(String.fromCharCode(e.getInt8(t))){case"1":return"1p";case"3":return"3p"}})(e,17),i=e.getInt8(18),o=e.getFloat32(19),a=e.getFloat32(23),[u,c]=((e,t,n,r,i,o)=>{const s={};let a=0;do{let n;1===o?(a=e.getUint16(t),n=e.getUint16(t+2),t+=4):(a=e.getUint32(t),n=e.getUint16(t+4),t+=6),s[0===a?"const":a]=n.toString(36)}while(0!==a);return[s,t]})(e,27,0,0,0,t);return[{version:t,id:n,data_preference:r,weights:u,precision:i,min:o,max:a},c]};var f=n(767),p=n(151),m=n(992),d=n(116),v=n(851),g=n(365),_=n(930),h=n(652);const y=()=>i.G({}),b=I;function w(e){return d.K4((()=>v.a9(y())))}function I(e){e.logger.warn("add cleanup of legacy LAL cache");const t=e.trace.startSpan("lookalike_models_data_retrieval_duration");return(0,r.zG)(_.m((0,r.zG)(v.vP(e.consent,e.currentTimestampSecs),v.UI((t=>{let[n,s]=t;return{currentTimestampSecs:s,validity:{maxAge:604800,key:()=>null},freshness:{maxAge:86400,key:()=>null},refresh:(0,r.zG)(n,i.DT(Boolean),i.UI((()=>f.fF(function(e){const t="Failed fetching binary models, reverting to JSON.\\nError: ",n="Failed fetching json models.\\nError: ";return(0,r.zG)(f.Y3((()=>G(e)),(e=>e.message)),m.N1,f.oU((e=>()=>function(e){const t=[];let n=0;for(;n<e.byteLength;){const[r,i]=a(new DataView(e,n));t.push(r),n+=i}return t}(e))),m.N1,f.UI(S((e=>{let{precision:t,max:n,min:r}=e;return{"1p":{},precision:t,min:r,max:n}}))),f.Vn((n=>(e.logger.log(t+n),e.metrics.track({name:"sdk_binary_models_missing_count",value:1,labels:{}}),n))),f.wp((()=>(0,r.zG)(f.Y3((()=>k(e)),(e=>e.message)),f.UI((e=>e.models)),f.UI(S((()=>({"1p":{}}))))))),f.UI((e=>(e=>{const t=Object.keys(e);return t.length>0&&e[t[0]].hasOwnProperty("precision")})(e)?(e=>{const t={},n=Object.keys(e),r=e=>{const t={"1p":{}},{precision:n,min:r,max:i}=e,s=e["1p"],a=Object.keys(s);for(let e=0;e<a.length;e++){const u=a[e],c=parseInt(s[u],36);t["1p"][u]=o(n,r,i,c)}return t};for(let i=0;i<n.length;i++){const o=n[i],s=e[o];t[o]=r(s)}return t})(e):e)),f.fS((t=>(e.reportError(n+t),p.of({})))))}(e)))))}})))),d.UI(v.UI((0,r.ls)(g.fS((t=>(e.logger.warn("[LAL]",`Failed to refresh, using zero value. ${t}`),y()))),(0,h.bw)(i.UI((()=>{t.finish(),e.metrics.trackTimeSinceInit("sdk_lifecycle_timestamps",{timestamp_name:"lookalike_models_ready",time_origin:"sdk_init"})})))))))}function S(e){return t=>{const n={};for(let r=0;r<t.length;r++){const i=t[r],{id:o,weights:s}=i;if(void 0===o||void 0===s)continue;const a=e(i);Object.keys(s).forEach((e=>{a["1p"][e]=s[e]})),n[o]=a}return n}}const G=e=>{const{permutiveApi:t,config:n,metrics:r}=e,i=r.startTimer("sdk_http_models_seconds",{});return t.req({url:z(n.cdnProtocol,n.cdnBaseUrl,"binary"),method:"GET",contentType:"text/plain",dataType:"binary",withCredentials:!1}).then((e=>(r.stopTimer("sdk_http_models_seconds",i),e)))},k=e=>{const{permutiveApi:t,config:n,metrics:r}=e,i=r.startTimer("sdk_http_models_seconds",{});return t.req({url:z(n.cdnProtocol,n.cdnBaseUrl,"json"),method:"GET",contentType:"text/plain",dataType:"json",withCredentials:!1}).then((e=>(r.stopTimer("sdk_http_models_seconds",i),e)))};function z(e,t,n){const r=`${e}://${t}`;switch(n){case"binary":return`${r}/models/v2/6adbc4e9-beda-4b9e-9117-43ec3a80e1d0-models.bin`;case"json":return`${r}/models/6adbc4e9-beda-4b9e-9117-43ec3a80e1d0-models.json`}}},869:(e,t,n)=>{n.d(t,{K:()=>E,O:()=>z});let r,i;const o=new WeakMap,s=new WeakMap,a=new WeakMap,u=new WeakMap,c=new WeakMap;let l={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return s.get(e);if("objectStoreNames"===t)return e.objectStoreNames||a.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return m(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function f(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(i||(i=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(d(this),t),m(o.get(this))}:function(...t){return m(e.apply(d(this),t))}:function(t,...n){const r=e.call(d(this),t,...n);return a.set(r,t.sort?t.sort():[t]),m(r)}}function p(e){return"function"==typeof e?f(e):(e instanceof IDBTransaction&&function(e){if(s.has(e))return;const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",o),e.removeEventListener("abort",o)},i=()=>{t(),r()},o=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",o),e.addEventListener("abort",o)}));s.set(e,t)}(e),t=e,(r||(r=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((e=>t instanceof e))?new Proxy(e,l):e);var t}function m(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",o)},i=()=>{t(m(e.result)),r()},o=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",o)}));return t.then((t=>{t instanceof IDBCursor&&o.set(t,e)})).catch((()=>{})),c.set(t,e),t}(e);if(u.has(e))return u.get(e);const t=p(e);return t!==e&&(u.set(e,t),c.set(t,e)),t}const d=e=>c.get(e);const v=["get","getKey","getAll","getAllKeys","count"],g=["put","add","delete","clear"],_=new Map;function h(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(_.get(t))return _.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=g.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!v.includes(n))return;const o=async function(e,...t){const o=this.transaction(e,i?"readwrite":"readonly");let s=o.store;return r&&(s=s.index(t.shift())),(await Promise.all([s[n](...t),i&&o.done]))[0]};return _.set(t,o),o}l=(e=>({...e,get:(t,n,r)=>h(t,n)||e.get(t,n,r),has:(t,n)=>!!h(t,n)||e.has(t,n)}))(l);var y=n(688),b=n(365),w=n(735),I=n(151),S=n(767),G=n(652),k=n(992);const z="[IDB]",U=(e,t,n,r,i,o)=>(0,w.zG)((0,I.of)(e.getNamespacedStorageKey(i)),(0,I.tS)((e=>(0,S.Y3)((async()=>n.put(r,o,e)),y.w))),(0,I.UI)((0,b.g_)((e=>{throw t.error(z,`Failed to store crypto key to ${r} due to unexpected error,\\n`,e),e}),(()=>o))),(e=>e()));class E{namespace;logger;cryptoAlg;idb;mainObjectStore;keyObjectStore;keyObjectKey;cryptoKey;MAX_CONSECUTIVE_PUTS=30;puts=1;hasForcedCompaction=!1;constructor(e,t,n,r,i,o,s,a){this.namespace=e,this.logger=t,this.cryptoAlg=n,this.idb=r,this.mainObjectStore=i,this.keyObjectStore=o,this.keyObjectKey=s,this.cryptoKey=a,this.logDebug("Created",this.idb)}static initialise(e,t,n,r,i,o,s,a,u,c){const l=(0,G.G6)(navigator.userAgent)&&!1,f=[c,r.isAvailable(),!l].every((e=>!0===e)),p=async(t,i,o)=>(0,w.zG)(await t.get(o,e.getNamespacedStorageKey(i)),(async e=>e??r.generateKey(!1)),(async r=>U(e,n,t,s,a,await r))).catch((e=>{const t=(0,y.w)(e);throw n.error(z,"Get crypto key failed. Got\\n",t),t})),m=(e,t,n)=>t.includes(n)?(0,w.Q1)():e.createObjectStore(n),d=()=>P(i,u,{upgrade:e=>{const t=[...e.objectStoreNames];m(e,t,o),m(e,t,s)}}).then((e=>{const t=[...e.objectStoreNames];return t.includes(o)&&t.includes(s)?e:Promise.reject(new Error("Object store(s) missing."))})),v=f?(0,b.Y3)((()=>function(e){if(!(0,G.G6)(navigator.userAgent)||!indexedDB.databases)return Promise.resolve();let t=()=>{},n=0;return new Promise((e=>{const r=()=>(n++,indexedDB.databases().finally((0,k.GL)(e)));t=(0,k.UM)(r,100),r()})).finally((()=>{t(),e.track({name:"sdk_idb_conn_attempt_safari_count",value:n,labels:{}})}))}(t).then((()=>d())).catch((e=>(n.error(`Re-creating IDB database ${i} due to error`,e),x(i).then((()=>d())))))),String):(0,b.t$)("Connection not attempted. Default to localStorage");return(0,b.g_)((e=>(0,S.t$)(e)),(t=>(0,w.zG)((0,S.Y3)((()=>t.then((async e=>({db:e,cryptoKey:await p(e,a,s)})))),String),(0,S.UI)((t=>{let{db:i,cryptoKey:u}=t;return new E(e,n,r,i,o,s,a,u)})))))(v)}async put(e,t){return(0,w.zG)((async()=>(0,w.bc)(JSON.stringify(e),this.cryptoKey)),(0,I.tS)((e=>{let[t,n]=e;return(0,I.of)(this.cryptoAlg.encrypt(n,t))})),(0,I.tS)((e=>async()=>(await this.recreateIfNecessary(this.puts++),e))),(0,I.tS)((e=>(0,S.Y3)((()=>this.idb.put(this.mainObjectStore,e,this.namespace.getNamespacedStorageKey(String(t)))),y.w))),(0,I.UI)((0,b.g_)((n=>{throw this.logError(`Failed to put "${t.toString()}" value`,e,". Got \\n",n),"QuotaExceededError"===n.name&&this.forceCompaction(),n}),(()=>t))),(e=>e()))}get(e){return(0,w.zG)(this.namespace.getNamespacedStorageKey(String(e)),(t=>this.idb.get(this.mainObjectStore,t).then((async e=>e?JSON.parse(await this.cryptoAlg.decrypt(this.cryptoKey,e)):null)).catch((t=>{const n=(0,y.w)(t);throw this.logError(`Get ${e.toString()} failed. Got`,n),n}))))}delete(e){return(0,w.zG)(this.namespace.getNamespacedStorageKey(String(e)),(e=>this.idb.delete(this.mainObjectStore,e)))}deleteStore(){return this.logDebug("Deleting",this.idb),this.idb.close(),x(this.idb.name)}forceCompaction(){if(this.hasForcedCompaction)return null;this.hasForcedCompaction=!0,this.logDebug("Attempting to force compaction");const e=`__${this.mainObjectStore}`;return P(e).then((t=>(t.close(),x(e))))}recreateIfNecessary(e){return(0,G.G6)(navigator.userAgent)&&e%this.MAX_CONSECUTIVE_PUTS==0?this.recreate():Promise.resolve()}async recreate(){const e=this.idb.name,t=this.idb.version,n=await this.idb.getAllKeys(this.mainObjectStore),r=[];for(const e of n)r.push([e,await this.idb.get(this.mainObjectStore,e)]);await this.deleteStore(),this.idb=await P(e,t,{upgrade:e=>{e.createObjectStore(this.mainObjectStore),e.createObjectStore(this.keyObjectStore)}}),await Promise.all(r.map((e=>{let[t,n]=e;return this.idb.put(this.mainObjectStore,n,t)}))),await U(this.namespace,this.logger,this.idb,this.keyObjectStore,this.keyObjectKey,this.cryptoKey),this.logDebug("Reset to",this.idb)}logDebug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.debug(z,...t)}logError(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.error(z,...t)}}const P=(0,w.ls)((function(e,t,{blocked:n,upgrade:r,blocking:i,terminated:o}={}){const s=indexedDB.open(e,t),a=m(s);return r&&s.addEventListener("upgradeneeded",(e=>{r(m(s.result),e.oldVersion,e.newVersion,m(s.transaction))})),n&&s.addEventListener("blocked",(()=>n())),a.then((e=>{o&&e.addEventListener("close",(()=>o())),i&&e.addEventListener("versionchange",(()=>i()))})).catch((()=>{})),a}),k.t_,(e=>e.then((e=>({close:e.close.bind(e),createObjectStore:(0,w.ls)(e.createObjectStore.bind(e),w.Q1),delete:(0,w.ls)(e.delete.bind(e),k.t_),get:(0,w.ls)(e.get.bind(e),k.t_),getAllKeys:(0,w.ls)(e.getAllKeys.bind(e),k.t_),get name(){return e.name},get objectStoreNames(){return e.objectStoreNames},put:(0,w.ls)(e.put.bind(e),k.t_),get version(){return e.version}}))))),x=(0,w.ls)((function(e,{blocked:t}={}){const n=indexedDB.deleteDatabase(e);return t&&n.addEventListener("blocked",(()=>t())),m(n).then((()=>{}))}),k.t_)},569:(e,t,n)=>{n.r(t),n.d(t,{make:()=>s});var r=n(735),i=n(869);const o=e=>{const{logger:t,consent:n,prefix:r}=e,i=(e,n)=>(t.debug(`${r} Failed to write ${String(n)} as consent is revoked`),Promise.resolve(n));return e=>class extends e{put=((e,t,n)=>function(){return(n()?t:e)(...arguments)})(super.put.bind(this),i,(()=>!n.current))}},s=(e,t,n,s,a,u,c,l,f,p,m)=>(0,r.zG)(i.K,o({logger:f,consent:p,prefix:i.O})).initialise(e,t,f,n,s,a,u,c,l,m)},828:(e,t,n)=>{n.d(t,{Qt:()=>s,Yt:()=>f,ap:()=>o,gz:()=>l});var r=n(735),i=n(384);function o(e,t){return function(n){return function(r){return e.ap(e.map(r,(function(e){return function(n){return t.ap(e,n)}})),n)}}}function s(e){return function(t,n){return function(r){return e.ap(e.map(r,(function(e){return function(n){var r;return Object.assign({},e,((r={})[t]=n,r))}})),n)}}}function a(e,t,n){return function(r){for(var i=Array(n.length+1),o=0;o<n.length;o++)i[o]=n[o];return i[n.length]=r,0===t?e.apply(null,i):a(e,t-1,i)}}var u={1:function(e){return[e]},2:function(e){return function(t){return[e,t]}},3:function(e){return function(t){return function(n){return[e,t,n]}}},4:function(e){return function(t){return function(n){return function(r){return[e,t,n,r]}}}},5:function(e){return function(t){return function(n){return function(r){return function(i){return[e,t,n,r,i]}}}}}};function c(e){return i.e$.call(u,e)||(u[e]=a(r.bc,e-1,[])),u[e]}function l(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=t.length,i=c(r),o=e.map(t[0],i),s=1;s<r;s++)o=e.ap(o,t[s]);return o}}function f(e){return function(t){for(var n=Object.keys(t),r=n.length,i=function(e){var t=e.length;switch(t){case 1:return function(t){var n;return(n={})[e[0]]=t,n};case 2:return function(t){return function(n){var r;return(r={})[e[0]]=t,r[e[1]]=n,r}};case 3:return function(t){return function(n){return function(r){var i;return(i={})[e[0]]=t,i[e[1]]=n,i[e[2]]=r,i}}};case 4:return function(t){return function(n){return function(r){return function(i){var o;return(o={})[e[0]]=t,o[e[1]]=n,o[e[2]]=r,o[e[3]]=i,o}}}};case 5:return function(t){return function(n){return function(r){return function(i){return function(o){var s;return(s={})[e[0]]=t,s[e[1]]=n,s[e[2]]=r,s[e[3]]=i,s[e[4]]=o,s}}}}};default:return a((function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];for(var i={},o=0;o<t;o++)i[e[o]]=n[o];return i}),t-1,[])}}(n),o=e.map(t[n[0]],i),s=1;s<r;s++)o=e.ap(o,t[n[s]]);return o}}},500:(e,t,n)=>{n.d(t,{Ce:()=>c,DY:()=>S,Eh:()=>R,GY:()=>I,Gb:()=>d,KB:()=>f,Lx:()=>T,Qp:()=>y,Su:()=>P,UI:()=>U,YM:()=>m,f2:()=>b,fw:()=>q,hX:()=>D,ke:()=>v,md:()=>h,oA:()=>O,pR:()=>F,tS:()=>E,yL:()=>G,yW:()=>j,zT:()=>_});var r=n(735),i=(n(341),n(384)),o=n(885),s=n(328),a=(n(870),n(605),function(e){return 0===e.length}),u=o.Od,c=o.Ce,l=(o.ws,o.R3),f=(o.Im,function(e,t){return e<=0?[]:o.KB(t)(e)});var p=o.dC,m=(s.P5,s.YM),d=(s.Z$,function(e){return u(e)?i.G(o.Gb(e)):i.YP}),v=function(e){return function(t){return p(e,t)?w(t):t.slice(0,e)}};var g=function(e,t){for(var n=e.length,r=0;r<n&&t(e[r]);r++);return r};function _(e){return function(t){var n=k(g(t,e))(t);return{init:n[0],rest:n[1]}}}var h=function(e){return function(t){return e<=0||a(t)?w(t):e>=t.length?[]:t.slice(e,t.length)}};function y(e){return function(t){return t.slice(g(t,e))}}s.cx;var b=s.f2;s.JO,s.qr;var w=function(e){return e.slice()},I=function(e){return a(e)?[]:e.slice().reverse()},S=function(e){return function(t){return t.length<=1?w(t):t.slice().sort(e.compare)}},G=function(e,t,n){for(var r=[],i=Math.min(e.length,t.length),o=0;o<i;o++)r[o]=n(e[o],t[o]);return r};s.t9;var k=function(e){return function(t){return e>=1&&u(t)?o.lx(e)(t):a(t)?[w(t),[]]:[[],w(t)]}};s.kp,s.Eq;var z=o.of,U=function(e){return function(t){return t.map((function(t){return e(t)}))}},E=function(e){return function(t){return(0,r.zG)(t,function(e){return function(t){for(var n=[],r=0;r<t.length;r++)n.push.apply(n,e(r,t[r]));return n}}((function(t,n){return e(n)})))}},P=function(e){return function(t){return t.map((function(t,n){return e(n,t)}))}},x=function(e){return function(t){for(var n=[],r=0;r<t.length;r++){var o=e(r,t[r]);i.pC(o)&&n.push(o.value)}return n}},A=function(e){return x((function(t,n){return e(n)}))},O=A(r.yR),D=function(e){return function(t){return t.filter(e)}},T=s.Lx,C=(s.xP,s.u4,s.OE),q=(s.nq,s.iw,function(e){var t=M(e);return function(e){return t((function(t,n){return e(n)}))}}),M=function(e){return function(t){return C(e.of([]),(function(n,i,o){return e.ap(e.map(i,(function(e){return function(t){return(0,r.zG)(e,l(t))}})),t(n,o))}))}},R=(s.ZN,s.Eh),F=s.pR,j=(s.pJ,s.oR,o.oo,s.yW);s.j0,i.F4,o.w6,o.QI,o.Ss},862:(e,t,n)=>{function r(e){return function(t){return function(n){return e.chain(n,(function(n){return e.map(t(n),(function(){return n}))}))}}}function i(e){return function(t,n){return function(r){return e.chain(r,(function(r){return e.map(n(r),(function(e){var n;return Object.assign({},r,((n={})[t]=e,n))}))}))}}}n.d(t,{a:()=>i,m:()=>r})},365:(e,t,n)=>{n.d(t,{g1:()=>b,G5:()=>y,dO:()=>g,Pd:()=>G,ak:()=>N,YO:()=>$,tS:()=>I,g_:()=>D,ij:()=>M,Yo:()=>E,DT:()=>U,Eh:()=>d,fS:()=>C,pF:()=>T,nM:()=>P,t$:()=>u,UI:()=>v,Vn:()=>k,EQ:()=>O,of:()=>_,F2:()=>c,LF:()=>q,KC:()=>Y,i$:()=>j,Y3:()=>R,it:()=>F});var r=n(862),i=n(690),o=n(735),s=n(341),a=n(384),u=a.t$,c=a.F2,l=function(e,t){return(0,o.zG)(e,v(t))},f=function(e,t){return(0,o.zG)(e,h(t))},p=function(e,t){return(0,o.zG)(e,I(t))},m="Either",d=function(e,t){return{equals:function(n,r){return n===r||(P(n)?P(r)&&e.equals(n.left,r.left):x(r)&&t.equals(n.right,r.right))}}},v=function(e){return function(t){return P(t)?t:c(e(t.right))}},g={URI:m,map:l},_=c,h=function(e){return function(t){return P(t)?t:P(e)?e:c(t.right(e.right))}},y={URI:m,map:l,ap:f},b={URI:m,map:l,ap:f,of:_},w=function(e){return function(t){return P(t)?t:e(t.right)}},I=w,S={URI:m,map:l,ap:f,chain:p},G=function(e,t){return function(n){return P(n)?u(e(n.left)):c(t(n.right))}},k=function(e){return function(t){return P(t)?u(e(t.left)):t}},z={URI:m,fromEither:o.yR},U=(0,i.DT)(z),E=(0,i.Yo)(z),P=a.nM,x=a.tO,A=function(e,t){return function(n){return P(n)?e(n.left):t(n.right)}},O=A,D=O,T=function(e){return function(t){return P(t)?e(t.left):t.right}},C=T,q=function(e){return P(e)?c(e.left):u(e.right)},M=function(e){return function(t){return null==t?u(e):c(t)}},R=function(e,t){try{return c(e())}catch(e){return u(t(e))}},F=function(e,t){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return R((function(){return e.apply(void 0,n)}),t)}},j=A(o.yR,o.yR);function Y(e){return e instanceof Error?e:new Error(String(e))}a.F4;var $=(0,s.YO)(g),N=(0,r.a)(S);a.Xl},856:(e,t,n)=>{n.d(t,{EQ:()=>b,F2:()=>a,KQ:()=>p,LF:()=>z,LU:()=>k,LV:()=>w,NG:()=>m,Pd:()=>h,UI:()=>d,Vn:()=>y,ap:()=>v,dQ:()=>G,fS:()=>I,i$:()=>U,ij:()=>f,m8:()=>c,pk:()=>l,t$:()=>u,tS:()=>g,vx:()=>S,wp:()=>_});var r=n(828),i=n(365),o=n(735),s=n(341);function a(e){return(0,o.ls)(i.F2,e.of)}function u(e){return(0,o.ls)(i.t$,e.of)}function c(e){return function(t){return e.map(t,i.F2)}}function l(e){return function(t){return e.map(t,i.t$)}}function f(e){return function(t){return(0,o.ls)(i.ij(t),e.of)}}function p(e){var t=f(e);return function(e){var n=t(e);return function(e){return(0,o.ls)(e,n)}}}function m(e){var t=g(e),n=p(e);return function(e){var r=n(e);return function(e){return t(r(e))}}}function d(e){return(0,s.UI)(e,i.dO)}function v(e){return(0,r.ap)(e,i.G5)}function g(e){return function(t){return function(n){return e.chain(n,(function(n){return i.nM(n)?e.of(n):t(n.right)}))}}}function _(e){return function(t){return function(n){return e.chain(n,(function(n){return i.nM(n)?t():e.of(n)}))}}}function h(e){return function(t,n){return function(r){return e.map(r,i.Pd(t,n))}}}function y(e){return function(t){return function(n){return e.map(n,i.Vn(t))}}}function b(e){return function(t,n){return function(r){return e.map(r,i.EQ(t,n))}}}function w(e){return function(t,n){return function(r){return e.chain(r,i.EQ(t,n))}}}function I(e){return function(t){return function(n){return e.chain(n,i.EQ(t,e.of))}}}function S(e){return function(t){return function(n){return e.chain(n,(function(n){return i.nM(n)?t(n.left):e.of(n)}))}}}function G(e){var t=S(e);return function(n){return t((function(t){return e.map(n(t),(function(e){return i.nM(e)?e:i.t$(t)}))}))}}function k(e){return function(t){return function(n){return e.chain(n,i.EQ((function(n){return e.map(t(n),i.t$)}),(function(t){return e.of(i.F2(t))})))}}}function z(e){return function(t){return e.map(t,i.LF)}}function U(e){return function(t){return e.map(t,i.i$)}}},268:(e,t,n)=>{n.d(t,{MW:()=>u,Uz:()=>s,bc:()=>o,f7:()=>r,n_:()=>i,w4:()=>a});n(735);var r=function(e){return{equals:function(t,n){return t===n||e(t,n)}}},i=function(e){return r((function(t,n){for(var r in e)if(!e[r].equals(t[r],n[r]))return!1;return!0}))},o=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return r((function(t,n){return e.every((function(e,r){return e.equals(t[r],n[r])}))}))},s=function(e){return function(t){return r((function(n,r){return t.equals(e(n),e(r))}))}},a={equals:function(e,t){return e===t}},u=i;a.equals},690:(e,t,n)=>{n.d(t,{DT:()=>s,Yo:()=>o,fX:()=>u});var r=n(735),i=n(384);function o(e){return function(t){return function(n){return e.fromEither(i.Wi(n)?i.t$(t()):i.F2(n.value))}}}function s(e){return function(t,n){return function(r){return e.fromEither(t(r)?i.F2(r):i.t$(n(r)))}}}function a(e){return function(t){return(0,r.ls)(t,e.fromEither)}}function u(e,t){var n=a(e);return function(e){return function(r){return t.chain(r,n(e))}}}},130:(e,t,n)=>{n.d(t,{At:()=>s,oU:()=>o});var r=n(862),i=n(735);function o(e,t){return function(n){var r=(0,i.ls)(n,e.fromIO);return function(e){return t.chain(e,r)}}}function s(e,t){var n=(0,r.m)(t);return function(t){return n((0,i.ls)(t,e.fromIO))}}},679:(e,t,n)=>{n.d(t,{oU:()=>i});var r=n(735);function i(e,t){return function(n){var i=(0,r.ls)(n,e.fromTask);return function(e){return t.chain(e,i)}}}},341:(e,t,n)=>{function r(e,t){return function(n){return function(r){return e.map(r,(function(e){return t.map(e,n)}))}}}function i(e){return function(t){return function(n){return e.map(n,(function(e){var n;return(n={})[t]=e,n}))}}}function o(e){return function(t,n){return function(r){return e.map(r,(function(e){var r;return Object.assign({},e,((r={})[t]=n(e),r))}))}}}n.d(t,{Hr:()=>o,UI:()=>r,YO:()=>i})},392:(e,t,n)=>{n.d(t,{G5:()=>m,PM:()=>p,RD:()=>y,UA:()=>v,UI:()=>u,dO:()=>f,of:()=>c,qo:()=>d});var r=n(735),i=(n(341),n(384)),o=function(e,t){return function(){return t(e())}},s=function(e,t){return function(){return e()(t())}},a=function(e,t){return function(){return t(e())()}},u=function(e){return function(t){return o(t,e)}},c=r.a9,l="IO",f={URI:l,map:o},p={URI:l,of:c},m={URI:l,map:o,ap:s},d={URI:l,map:o,ap:s,chain:a},v={URI:l,map:o,ap:s,of:c,chain:a},g=(r.yR,r.yR,i.F4,c(i.Xl)),_=function(e){var t=function(e){return function(t){return function(){for(var n=[e(0,i.YM(t))()],r=1;r<t.length;r++)n.push(e(r,t[r])());return n}}}(e);return function(e){return i.Od(e)?t(e):g}},h=function(e){return _((function(t,n){return e(n)}))},y=h(r.yR)},885:(e,t,n)=>{n.d(t,{Ce:()=>l,Eh:()=>I,Gb:()=>G,Im:()=>f,KB:()=>g,Od:()=>a,QI:()=>k,R3:()=>p,Ss:()=>z,dC:()=>u,lx:()=>w,nI:()=>v,of:()=>y,oo:()=>m,w6:()=>_,ws:()=>c,yL:()=>b});var r=n(735),i=(n(341),n(384)),o=n(241),s=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},a=function(e){return e.length>0},u=function(e,t){return e<0||e>=t.length},c=function(e){return function(t){return s([e],t,!0)}},l=c,f=function(e){return function(t){return s(s([],t,!0),[e],!1)}},p=f,m=function(e,t,n){if(a(n)){var r=d(n);return r.splice(e,0,t),r}return[t]},d=i.r1,v=function(e){return a(e)?i.G(e):i.YP},g=function(e){return function(t){for(var n=Math.max(0,Math.floor(t)),r=[e(0)],i=1;i<n;i++)r.push(e(i));return r}},_=function(e,t){return e<=t?g((function(t){return e+t}))(t-e+1):[e]};var h=d,y=function(e){return[e]},b=function(e,t,n){for(var r=[n(e[0],t[0])],i=Math.min(e.length,t.length),o=1;o<i;o++)r[o]=n(e[o],t[o]);return r};o.xP,o.Lx;var w=function(e){return function(t){var n=Math.max(1,e);return n>=t.length?[h(t),[]]:[(0,r.zG)(t.slice(1,n),l(S(t))),t.slice(n)]}},I=(o.u4,o.OE,o.nq,o.iw,o.YM,o.ZN,o.Eh),S=(i.F4,o.YM),G=function(e){return e.slice(1)};o.Z$,o.VV,o.Fp,o.j0;function k(e,t){return void 0===t?l(e):(0,r.zG)(t,l(e))}var z=function(e,t){return(0,r.zG)(e,p(t))};o.ur},567:(e,t,n)=>{n.d(t,{DT:()=>p,Do:()=>re,EK:()=>d,EQ:()=>K,Eh:()=>S,FS:()=>ne,G:()=>f,G5:()=>x,Hr:()=>oe,IS:()=>m,KQ:()=>ee,Qt:()=>ae,Ri:()=>R,UI:()=>z,Uo:()=>L,WG:()=>te,Wi:()=>Q,Y3:()=>Z,YO:()=>ie,YP:()=>l,aD:()=>H,ak:()=>se,bM:()=>T,dO:()=>U,fS:()=>J,g_:()=>V,hX:()=>F,ij:()=>X,pC:()=>B,pF:()=>W,pR:()=>G,tS:()=>A,uZ:()=>k,wp:()=>D,xu:()=>N});var r=n(828),i=n(862),o=n(735),s=n(341),a=n(384),u=n(17),c=n(870),l=(n(605),a.YP),f=a.G;function p(e){return function(t){return e(t)?f(t):l}}var m=function(e){return"Right"===e._tag?l:f(e.left)},d=function(e){return"Left"===e._tag?l:f(e.right)},v=function(e,t){return(0,o.zG)(e,z(t))},g=function(e,t){return(0,o.zG)(e,P(t))},_=function(e,t){return(0,o.zG)(e,A(t))},h=function(e,t){return(0,o.zG)(e,F(t))},y=function(e,t){return(0,o.zG)(e,j(t))},b=function(e,t){return(0,o.zG)(e,Y(t))},w=function(e,t){return(0,o.zG)(e,$(t))},I="Option",S=function(e){return{equals:function(t,n){return t===n||(Q(t)?Q(n):!Q(n)&&e.equals(t.value,n.value))}}},G=function(e){return{equals:S(e).equals,compare:function(t,n){return t===n?0:B(t)?B(n)?e.compare(t.value,n.value):1:-1}}},k=function(e){return{concat:function(t,n){return Q(t)?n:Q(n)?t:f(e.concat(t.value,n.value))},empty:l}},z=function(e){return function(t){return Q(t)?l:f(e(t.value))}},U={URI:I,map:v},E=f,P=function(e){return function(t){return Q(t)||Q(e)?l:f(t.value(e.value))}},x={URI:I,map:v,ap:g},A=function(e){return function(t){return Q(t)?l:e(t.value)}},O={URI:I,map:v,ap:g,chain:_},D=function(e){return function(t){return Q(t)?e():t}},T=function(){return l},C=A(o.yR),q=(0,c.s4)(l,l),M=function(e){return Q(e)?q:(0,c.s4)(m(e.value),d(e.value))},R={URI:I,compact:C,separate:M},F=function(e){return function(t){return Q(t)?l:e(t.value)?t:l}},j=function(e){return function(t){return Q(t)?l:e(t.value)}},Y=function(e){return function(t){return(0,c.s4)(h(t,(0,u.ff)(e)),h(t,e))}},$=function(e){return(0,o.ls)(z(e),M)},N={URI:I,map:v,compact:C,separate:M,filter:h,filterMap:y,partition:b,partitionMap:w},L=d,B=a.pC,Q=function(e){return"None"===e._tag},H=function(e,t){return function(n){return Q(n)?e():t(n.value)}},K=H,V=K,W=function(e){return function(t){return Q(t)?e():t.value}},J=W,X=function(e){return null==e?l:f(e)},Z=function(e){try{return f(e())}catch(e){return l}},ee=function(e){return(0,o.ls)(e,X)},te=K(o.gn,o.yR),ne=K(o.r5,o.yR);var re=E(a.F4),ie=(0,s.YO)(U),oe=(0,s.Hr)(U),se=(0,i.a)(O),ae=(0,r.Qt)(x);a.Xl},209:(e,t,n)=>{n.d(t,{Fp:()=>p,Uz:()=>a,VV:()=>f,Zt:()=>s,gf:()=>l,gt:()=>c,lt:()=>u});var r=n(268),i=n(735),o=function(e){return function(t,n){return t===n||0===e(t,n)}},s=function(e){return{equals:o(e),compare:function(t,n){return t===n?0:e(t,n)}}},a=function(e){return function(t){return s((function(n,r){return t.compare(e(n),e(r))}))}},u=(i.W8,function(e){return function(t,n){return-1===e.compare(t,n)}}),c=function(e){return function(t,n){return 1===e.compare(t,n)}},l=function(e){return function(t,n){return-1!==e.compare(t,n)}},f=function(e){return function(t,n){return t===n||e.compare(t,n)<1?t:n}},p=function(e){return function(t,n){return t===n||e.compare(t,n)>-1?t:n}};r.w4.equals},17:(e,t,n)=>{n.d(t,{ff:()=>r,xD:()=>i});n(735);var r=function(e){return function(t){return!e(t)}},i=function(e){return function(t){return function(n){return t(n)&&e(n)}}}},328:(e,t,n)=>{n.d(t,{Ce:()=>d,DZ:()=>V,EQ:()=>_,Eh:()=>fe,Eq:()=>j,Ew:()=>k,G:()=>ye,Hr:()=>we,JO:()=>E,Lx:()=>re,OE:()=>ie,Od:()=>m,P5:()=>y,R3:()=>v,Su:()=>Q,UI:()=>B,YM:()=>b,Yo:()=>g,Z$:()=>w,ZN:()=>ce,bM:()=>$,bj:()=>x,cS:()=>_e,cx:()=>G,dF:()=>U,e5:()=>q,f2:()=>z,hX:()=>H,iw:()=>se,j0:()=>be,jj:()=>O,kp:()=>F,nI:()=>ge,nq:()=>oe,oA:()=>W,oR:()=>ve,of:()=>Y,pJ:()=>de,pO:()=>D,pR:()=>pe,qr:()=>P,t9:()=>A,tS:()=>N,tV:()=>Z,u4:()=>ne,uK:()=>J,uZ:()=>le,vP:()=>ae,xH:()=>L,xP:()=>te,xb:()=>p,yW:()=>he,zT:()=>S,zo:()=>C});var r=n(268),i=n(735),o=n(341),s=n(384),a=n(11),u=n(209),c=n(241),l=n(870),f=(n(605),function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}),p=function(e){return 0===e.length},m=c.Od,d=c.Ce,v=(c.ws,c.R3);c.Im;var g=function(e){return s.Wi(e)?_e:[e.value]},_=function(e,t){return function(n){return m(n)?t(n):e()}},h=c.dC;function y(e,t){return void 0===t?function(t){return y(e,t)}:h(e,t)?s.YP:s.G(t[e])}var b=function(e){return m(e)?s.G(c.YM(e)):s.YP},w=function(e){return m(e)?s.G(c.Z$(e)):s.YP};var I=function(e,t){for(var n=e.length,r=0;r<n&&t(e[r]);r++);return r};function S(e){return function(t){var n=T(I(t,e))(t);return{init:n[0],rest:n[1]}}}var G=function(e){return function(t){for(var n=0;n<t.length;n++)if(e(t[n]))return s.G(n);return s.YP}};function k(e){return function(t){for(var n=0;n<t.length;n++)if(e(t[n]))return s.G(t[n]);return s.YP}}var z=function(e){return function(t){for(var n=0;n<t.length;n++){var r=e(t[n]);if(s.pC(r))return r}return s.YP}};function U(e){return function(t){for(var n=t.length-1;n>=0;n--)if(e(t[n]))return s.G(t[n]);return s.YP}}var E=function(e){return function(t){for(var n=t.length-1;n>=0;n--){var r=e(t[n]);if(s.pC(r))return r}return s.YP}},P=function(e){return function(t){for(var n=t.length-1;n>=0;n--)if(e(t[n]))return s.G(n);return s.YP}},x=function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];"Left"===r._tag&&t.push(r.left)}return t};function A(e){return function(t,n){if(void 0===n){var r=A(e);return function(e){return r(t,e)}}for(var i,o=0;o<n.length;o++)if(i=n[o],e.equals(i,t))return!0;return!1}}var O=function(e){var t=c.jj(e);return function(e){return m(e)?t(e):e}},D=function(e){var t=c.pO(e);return function(e){return m(e)?t(e):_e}},T=function(e){return function(t){return e>=1&&m(t)?c.lx(e)(t):p(t)?[t,_e]:[_e,t]}};var C=function(e){return function(t){return p(t)?e:p(e)?t:t.concat(e)}};function q(e){var t=A(e);return function(n,r){if(void 0===r){var i=q(e);return function(e){return i(e,n)}}return n.filter((function(e){return!t(e,r)}))}}var M=function(e,t){return(0,i.zG)(e,B(t))},R=function(e,t,n){return(0,i.zG)(e,ne(t,n))},F=function(e,t){return(0,i.zG)(e,de(t))},j=function(e,t){return(0,i.zG)(e,ve(t))},Y=c.of,$=function(){return _e},N=function(e){return function(t){return(0,i.zG)(t,function(e){return function(t){if(p(t))return _e;for(var n=[],r=0;r<t.length;r++)n.push.apply(n,e(r,t[r]));return n}}((function(t,n){return e(n)})))}},L=N(i.yR),B=function(e){return function(t){return t.map((function(t){return e(t)}))}},Q=function(e){return function(t){return t.map((function(t,n){return e(n,t)}))}},H=function(e){return function(t){return t.filter(e)}},K=function(e){return function(t){for(var n=[],r=0;r<t.length;r++){var i=e(r,t[r]);s.pC(i)&&n.push(i.value)}return n}},V=function(e){return K((function(t,n){return e(n)}))},W=V(i.yR),J=function(e){return X((function(t,n){return e(n)}))},X=function(e){return function(t){for(var n=[],r=[],i=0;i<t.length;i++){var o=t[i];e(i,o)?r.push(o):n.push(o)}return(0,l.s4)(n,r)}},Z=function(e){return ee((function(t,n){return e(n)}))},ee=function(e){return function(t){for(var n=[],r=[],i=0;i<t.length;i++){var o=e(i,t[i]);"Left"===o._tag?n.push(o.left):r.push(o.right)}return(0,l.s4)(n,r)}},te=function(e){return function(t){return function(n){return n.reduce((function(n,r,i){return e.concat(n,t(i,r))}),e.empty)}}},ne=function(e,t){return ie(e,(function(e,n,r){return t(n,r)}))},re=function(e){var t=te(e);return function(e){return t((function(t,n){return e(n)}))}},ie=function(e,t){return function(n){for(var r=n.length,i=e,o=0;o<r;o++)i=t(o,i,n[o]);return i}},oe=function(e,t){return se(e,(function(e,n,r){return t(n,r)}))},se=function(e,t){return function(n){return n.reduceRight((function(e,n,r){return t(r,n,e)}),e)}},ae=function(e){return function(t){return R(t,e.of($()),(function(t,n){return e.ap(e.map(t,(function(e){return function(t){return(0,i.zG)(e,v(t))}})),n)}))}},ue="ReadonlyArray",ce=function(e){return{show:function(t){return"[".concat(t.map(e.show).join(", "),"]")}}},le=function(){return{concat:function(e,t){return p(e)?t:p(t)?e:e.concat(t)},empty:_e}},fe=function(e){return(0,r.f7)((function(t,n){return t.length===n.length&&t.every((function(t,r){return e.equals(t,n[r])}))}))},pe=function(e){return(0,u.Zt)((function(t,n){for(var r=t.length,i=n.length,o=Math.min(r,i),s=0;s<o;s++){var u=e.compare(t[s],n[s]);if(0!==u)return u}return a.Df.compare(r,i)}))},me={URI:ue,map:M},de=function(e){return function(t){for(var n=f([],e(t),!0),r=[];n.length>0;){var i=n.shift();s.nM(i)?n.unshift.apply(n,e(i.left)):r.push(i.right)}return r}},ve=function(e){return function(t){var n=e(t),r=[],i=[];function o(t){s.nM(t)?e(t.left).forEach((function(e){return r.push(e)})):i.push(t.right)}for(var a=0,u=n;a<u.length;a++){o(u[a])}for(;r.length>0;)o(r.shift());return i}},ge=(c.oo,function(e){return p(e)?_e:e.slice()}),_e=c.cS;function he(e){return function(t){return t.every(e)}}var ye=function(e){return function(t){return t.some(e)}},be=function(e){var t=c.j0(e);return function(n){return _((function(){return e.empty}),t(n))}},we=(s.F4,(0,o.Hr)(me));c.w6,c.QI,c.Ss},241:(e,t,n)=>{n.d(t,{R3:()=>_,Im:()=>g,pO:()=>k,ur:()=>B,QI:()=>V,cS:()=>f,Lx:()=>A,xP:()=>T,c2:()=>b,Eh:()=>R,ZN:()=>M,YM:()=>F,j0:()=>K,Od:()=>p,dC:()=>m,Z$:()=>Y,UI:()=>E,aL:()=>Q,ut:()=>H,Fp:()=>L,VV:()=>N,of:()=>U,Ce:()=>v,ws:()=>d,w6:()=>I,u4:()=>x,nq:()=>O,iw:()=>C,OE:()=>D,Ss:()=>W,lx:()=>z,jj:()=>y,oo:()=>h});var r,i=n(268),o=n(735),s=(n(341),n(384)),a=n(209),u=function(e){return{concat:a.VV(e)}},c=function(e){return{concat:a.Fp(e)}};r=void 0;var l=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},f=s.Xl,p=s.Od,m=function(e,t){return e<0||e>=t.length},d=function(e){return function(t){return l([e],t,!0)}},v=d,g=function(e){return function(t){return l(l([],t,!0),[e],!1)}},_=g,h=function(e,t,n){if(p(n)){var r=s.r1(n);return r.splice(e,0,t),r}return[t]},y=function(e){return function(t){if(1===t.length)return t;for(var n=[F(t)],r=function(t){n.every((function(n){return!e.equals(n,t)}))&&n.push(t)},i=0,o=j(t);i<o.length;i++){r(o[i])}return n}},b=function(e){return p(e)?s.G(e):s.YP},w=function(e){return function(t){for(var n=Math.max(0,Math.floor(t)),r=[e(0)],i=1;i<n;i++)r.push(e(i));return r}},I=function(e,t){return e<=t?w((function(t){return e+t}))(t-e+1):[e]};function S(e,t){return t?e.concat(t):function(t){return t.concat(e)}}var G=function(e){return function(t){for(var n=[e,t[0]],r=1;r<t.length;r++)n.push(e,t[r]);return n}},k=function(e){return function(t){for(var n=e(t),r=[n[0]],i=n[1];p(i);){var o=e(i),s=o[0],a=o[1];r.push(s),i=a}return r}},z=function(e){return function(t){var n=Math.max(1,e);return n>=t.length?[t,f]:[(0,o.zG)(t.slice(1,n),v(F(t))),t.slice(n)]}},U=s.ri,E=function(e){return P((function(t,n){return e(n)}))},P=function(e){return function(t){for(var n=[e(0,F(t))],r=1;r<t.length;r++)n.push(e(r,t[r]));return n}},x=function(e,t){return D(e,(function(e,n,r){return t(n,r)}))},A=function(e){return function(t){return function(n){return n.slice(1).reduce((function(n,r){return e.concat(n,t(r))}),t(n[0]))}}},O=function(e,t){return C(e,(function(e,n,r){return t(n,r)}))},D=function(e,t){return function(n){return n.reduce((function(e,n,r){return t(r,e,n)}),e)}},T=function(e){return function(t){return function(n){return n.slice(1).reduce((function(n,r,i){return e.concat(n,t(i+1,r))}),t(0,n[0]))}}},C=function(e,t){return function(n){return n.reduceRight((function(e,n,r){return t(r,n,e)}),e)}},q=s.YM,M=function(e){return{show:function(t){return"[".concat(t.map(e.show).join(", "),"]")}}},R=function(e){return(0,i.f7)((function(t,n){return t.length===n.length&&t.every((function(t,r){return e.equals(t,n[r])}))}))},F=(s.F4,q),j=s.Gb,Y=function(e){return e[e.length-1]},$=function(e){return e.slice(0,-1)},N=function(e){var t=u(e);return function(e){return e.reduce(t.concat)}},L=function(e){var t=c(e);return function(e){return e.reduce(t.concat)}},B=function(e){return function(t){return t.reduce(e.concat)}},Q=function(e){return function(t){return e(F(t),j(t))}},H=function(e){return function(t){return e($(t),Y(t))}},K=function(e){var t=B(e);return function(e){return(0,o.ls)(function(e){return function(t){var n=j(t);return p(n)?(0,o.zG)(n,G(e),v(F(t))):t}}(e),t)}};function V(e,t){return void 0===t?v(e):(0,o.zG)(t,v(e))}var W=function(e,t){return(0,o.zG)(e,S([t]))}},923:(e,t,n)=>{n.d(t,{Bu:()=>g,CC:()=>R,DZ:()=>te,EW:()=>B,Eh:()=>le,G:()=>D,HA:()=>C,Hd:()=>U,I8:()=>j,P5:()=>_,RF:()=>F,RJ:()=>$,SW:()=>H,Su:()=>y,UI:()=>b,Ub:()=>V,V_:()=>L,XP:()=>f,Yz:()=>x,_Y:()=>N,_r:()=>z,dp:()=>u,dx:()=>d,e$:()=>v,hX:()=>ee,jt:()=>E,kp:()=>M,mK:()=>X,mS:()=>Y,nn:()=>q,nr:()=>pe,nu:()=>Q,oA:()=>ae,oh:()=>ue,qS:()=>J,ri:()=>G,sq:()=>A,t9:()=>T,tV:()=>re,uK:()=>ne,uZ:()=>fe,vA:()=>W,vP:()=>k,xb:()=>c,yW:()=>O,z7:()=>P,zV:()=>K});var r=n(268),i=n(735),o=n(384),s=n(870),a=n(751),u=(n(605),function(e){return Object.keys(e).length}),c=function(e){for(var t in e)if(o.e$.call(e,t))return!1;return!0},l=function(e){return function(t){return Object.keys(t).sort(e.compare)}},f=l(a.Df);function p(e){if("function"==typeof e)return p(a.Df)(e);var t=l(e);return function(e){return function(n){for(var r=[],i=0,o=t(n);i<o.length;i++){var s=o[i];r.push(e(s,n[s]))}return r}}}var m=p(a.Df)((function(e,t){return[e,t]}));var d=function(e,t){return function(n){if(o.e$.call(n,e)&&n[e]===t)return n;var r=Object.assign({},n);return r[e]=t,r}},v=function(e,t){return o.e$.call(t,e)};function g(e){return function(t,n){if(void 0===n){var r=g(e);return function(e){return r(e,t)}}for(var i in t)if(!o.e$.call(n,i)||!e.equals(t[i],n[i]))return!1;return!0}}function _(e,t){return void 0===t?function(t){return _(e,t)}:o.e$.call(t,e)?o.G(t[e]):o.YP}var h={};function y(e){return function(t){var n={};for(var r in t)o.e$.call(t,r)&&(n[r]=e(r,t[r]));return n}}function b(e){return y((function(t,n){return e(n)}))}function w(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(2===e.length)return w(a.Df).apply(void 0,e);var n=l(e[0]);return function(e,t){return function(r){for(var i=e,o=n(r),s=o.length,a=0;a<s;a++){var u=o[a];i=t(u,i,r[u])}return i}}}function I(e){if("compare"in e){var t=l(e);return function(e){return function(n){return function(r){for(var i=e.empty,o=t(r),s=o.length,a=0;a<s;a++){var u=o[a];i=e.concat(i,n(u,r[u]))}return i}}}}return I(a.Df)(e)}function S(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(2===e.length)return S(a.Df).apply(void 0,e);var n=l(e[0]);return function(e,t){return function(r){for(var i=e,o=n(r),s=o.length-1;s>=0;s--){var a=o[s];i=t(a,r[a],i)}return i}}}var G=function(e,t){var n;return(n={})[e]=t,n};function k(e){return X(a.Df)(e)}function z(e){return function(t){var n={},r={};for(var i in t)if(o.e$.call(t,i)){var a=e(i,t[i]);switch(a._tag){case"Left":n[i]=a.left;break;case"Right":r[i]=a.right}}return(0,s.s4)(n,r)}}function U(e){return function(t){var n={},r={};for(var i in t)if(o.e$.call(t,i)){var a=t[i];e(i,a)?r[i]=a:n[i]=a}return(0,s.s4)(n,r)}}function E(e){return function(t){var n={};for(var r in t)if(o.e$.call(t,r)){var i=e(r,t[r]);o.pC(i)&&(n[r]=i.value)}return n}}function P(e){return function(t){var n={},r=!1;for(var i in t)if(o.e$.call(t,i)){var s=t[i];e(i,s)?n[i]=s:r=!0}return r?n:t}}var x=m,A=function(e){for(var t={},n=0,r=e;n<r.length;n++){var i=r[n];t[i[0]]=i[1]}return t};function O(e){return function(t){for(var n in t)if(!e(t[n]))return!1;return!0}}function D(e){return function(t){for(var n in t)if(e(t[n]))return!0;return!1}}function T(e){return function(t,n){if(void 0===n){var r=T(e);return function(e){return r(t,e)}}for(var i in n)if(e.equals(n[i],t))return!0;return!1}}var C=function(e,t){return(0,i.zG)(e,b(t))},q=function(e,t){return(0,i.zG)(e,y(t))},M=function(e){var t=ie(e);return function(e,n,r){return(0,i.zG)(e,t(n,r))}},R=function(e){return function(t){var n=oe(e)(t);return function(e,t){return(0,i.zG)(e,n(t))}}},F=function(e){var t=se(e);return function(e,n,r){return(0,i.zG)(e,t(n,r))}},j=function(e,t){return(0,i.zG)(e,ee(t))},Y=function(e,t){return(0,i.zG)(e,te(t))},$=function(e,t){return(0,i.zG)(e,ne(t))},N=function(e,t){return(0,i.zG)(e,re(t))},L=function(e){var t=w(e);return function(e,n,r){return(0,i.zG)(e,t(n,r))}},B=function(e){var t=I(e);return function(e){var n=t(e);return function(e,t){return(0,i.zG)(e,n(t))}}},Q=function(e){var t=S(e);return function(e,n,r){return(0,i.zG)(e,t(n,r))}},H=function(e,t){return(0,i.zG)(e,z(t))},K=function(e,t){return(0,i.zG)(e,U(t))},V=function(e,t){return(0,i.zG)(e,E(t))},W=function(e,t){return(0,i.zG)(e,P(t))},J=function(e){var t=Z(e);return function(e){var n=t(e);return function(e,t){return n(e,(0,i.ls)(i.SK,t))}}},X=function(e){var t=J(e);return function(e){var n=t(e);return function(e){return n(e,i.yR)}}},Z=function(e){return function(t){var n=l(e);return function(e,r){var i=n(e);if(0===i.length)return t.of(h);for(var o=t.of({}),s=function(n){o=t.ap(t.map(o,(function(e){return function(t){var r;return Object.assign({},e,((r={})[n]=t,r))}})),r(n,e[n]))},a=0,u=i;a<u.length;a++){s(u[a])}return o}}},ee=function(e){return P((function(t,n){return e(n)}))},te=function(e){return E((function(t,n){return e(n)}))},ne=function(e){return U((function(t,n){return e(n)}))},re=function(e){return z((function(t,n){return e(n)}))};function ie(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(1===e.length){var n=w(e[0]);return function(e,t){return n(e,(function(e,n,r){return t(n,r)}))}}return ie(a.Df).apply(void 0,e)}function oe(e){if("compare"in e){var t=I(e);return function(e){var n=t(e);return function(e){return n((function(t,n){return e(n)}))}}}return oe(a.Df)(e)}function se(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(1===e.length){var n=S(e[0]);return function(e,t){return n(e,(function(e,n,r){return t(n,r)}))}}return se(a.Df).apply(void 0,e)}var ae=function(e){var t={};for(var n in e)if(o.e$.call(e,n)){var r=e[n];o.pC(r)&&(t[n]=r.value)}return t},ue=function(e){var t={},n={};for(var r in e)if(o.e$.call(e,r)){var i=e[r];o.nM(i)?t[r]=i.left:n[r]=i.right}return(0,s.s4)(t,n)},ce="ReadonlyRecord";function le(e){var t=g(e);return(0,r.f7)((function(e,n){return t(e)(n)&&t(n)(e)}))}function fe(e){return{concat:function(t,n){if(c(t))return n;if(c(n))return t;var r=Object.assign({},t);for(var i in n)o.e$.call(n,i)&&(r[i]=o.e$.call(t,i)?e.concat(t[i],n[i]):n[i]);return r},empty:h}}a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df;function pe(e,t){return o.e$.call(void 0===t?this:t,e)}a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df,a.Df},870:(e,t,n)=>{n.d(t,{F2:()=>s,Vn:()=>i,s4:()=>r});n(735);var r=function(e,t){return{left:e,right:t}},i=function(e){return function(t){return r(e(o(t)),s(t))}},o=function(e){return e.left},s=function(e){return e.right}},151:(e,t,n)=>{n.d(t,{At:()=>k,Do:()=>z,Hi:()=>y,Hr:()=>E,PM:()=>h,UA:()=>I,UI:()=>p,YO:()=>U,ak:()=>P,ap:()=>m,dO:()=>_,mU:()=>S,of:()=>d,pE:()=>T,qA:()=>b,qo:()=>w,tD:()=>u,tS:()=>v,uU:()=>D});var r=n(862),i=n(130),o=n(735),s=n(341),a=n(384),u=function(e){return function(){return Promise.resolve().then(e)}};var c=function(e,t){return(0,o.zG)(e,p(t))},l=function(e,t){return(0,o.zG)(e,m(t))},f=function(e,t){return(0,o.zG)(e,v(t))},p=function(e){return function(t){return function(){return Promise.resolve().then(t).then(e)}}},m=function(e){return function(t){return function(){return Promise.all([Promise.resolve().then(t),Promise.resolve().then(e)]).then((function(e){return(0,e[0])(e[1])}))}}},d=function(e){return function(){return Promise.resolve(e)}},v=function(e){return function(t){return function(){return Promise.resolve().then(t).then((function(t){return e(t)()}))}}},g="Task";var _={URI:g,map:c},h={URI:g,of:d},y={URI:g,map:c,ap:l},b={URI:g,map:c,ap:l,of:d},w={URI:g,map:c,ap:l,chain:f},I={URI:g,map:c,of:d,ap:l,chain:f},S=(o.yR,(0,r.m)(w)),G={URI:g,fromIO:u},k=(0,i.At)(G,w),z=d(a.F4),U=(0,s.YO)(_),E=(0,s.Hr)(_),P=(0,r.a)(w),x=d(a.Xl),A=function(e){var t=function(e){return function(t){return function(){return Promise.all(t.map((function(t,n){return Promise.resolve().then((function(){return e(n,t)()}))})))}}}(e);return function(e){return a.Od(e)?t(e):x}},O=function(e){var t=function(e){return function(t){return function(){return a.Gb(t).reduce((function(t,n,r){return t.then((function(t){return Promise.resolve().then(e(r+1,n)).then((function(e){return t.push(e),t}))}))}),Promise.resolve().then(e(0,a.YM(t))).then(a.ri))}}}(e);return function(e){return a.Od(e)?t(e):x}},D=function(e){return A((function(t,n){return e(n)}))},T=function(e){return O((function(t,n){return e(n)}))}},767:(e,t,n)=>{n.d(t,{At:()=>X,DT:()=>V,EQ:()=>S,Hi:()=>B,Hr:()=>ne,Ij:()=>oe,LV:()=>G,Qt:()=>ie,UI:()=>T,Vn:()=>q,Y3:()=>z,YO:()=>te,Zl:()=>F,ak:()=>re,fF:()=>w,fS:()=>k,fX:()=>K,it:()=>U,oU:()=>J,t$:()=>v,tD:()=>b,tS:()=>R,wE:()=>ee,wp:()=>j});var r=n(828),i=n(862),o=n(856),s=n(690),a=n(130),u=n(679),c=n(735),l=n(341),f=n(384),p=n(151),m=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},d=function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},v=o.t$(p.PM),g=o.F2(p.PM),_=o.m8(p.dO),h=o.pk(p.dO),y=(0,c.ls)(p.tD,_),b=(p.tD,y),w=_,I=p.of,S=(p.tD,o.EQ(p.dO)),G=o.LV(p.UA),k=o.fS(p.UA),z=function(e,t){return function(){return m(void 0,void 0,void 0,(function(){var n;return d(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,e().then(f.F2)];case 1:return[2,r.sent()];case 2:return n=r.sent(),[2,f.t$(t(n))];case 3:return[2]}}))}))}},U=function(e,t){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return z((function(){return e.apply(void 0,n)}),t)}},E=(p.dO,p.PM,p.PM,p.UA,p.UA,p.UA,p.UA,p.dO,function(e,t){return(0,c.zG)(e,T(t))}),P=function(e,t){return(0,c.zG)(e,M(t))},x=function(e,t){return(0,c.zG)(e,R(t))},A=function(e,t,n){return(0,c.zG)(e,C(t,n))},O=function(e,t){return(0,c.zG)(e,q(t))},D=function(e,t){return(0,c.zG)(e,j(t))},T=o.UI(p.dO),C=o.Pd(p.dO),q=o.Vn(p.dO),M=o.ap(p.Hi),R=o.tS(p.UA),F=R,j=o.wp(p.UA),Y=g,$=v,N="TaskEither";var L={URI:N,map:E},B={URI:N,map:E,ap:P},Q={URI:N,map:E,ap:P,chain:x},H={URI:N,fromEither:I},K=(0,s.fX)(H,Q),V=(0,s.DT)(H),W={URI:N,fromIO:b},J=(0,a.oU)(W,Q),X=(0,a.At)(W,Q),Z={URI:N,fromIO:b,fromTask:w},ee=(0,u.oU)(Z,Q);f.F4;var te=(0,l.YO)(L),ne=(0,l.Hr)(L),re=(0,i.a)(Q),ie=(0,r.Qt)(B),oe=(f.Xl,{URI:N,bimap:A,mapLeft:O,map:E,of:Y,ap:P,chain:x,alt:D,fromIO:b,fromTask:w,throwError:$})},605:(e,t,n)=>{function r(e,t){return function(n){var r=e.traverse(n);return function(e,i){return n.map(r(e,i),t.separate)}}}function i(e,t){return function(n){var r=e.traverse(n);return function(e,i){return n.map(r(e,i),t.compact)}}}n.d(t,{BL:()=>i,Fj:()=>r})},735:(e,t,n)=>{n.d(t,{MZ:()=>i,Q1:()=>c,SK:()=>m,W8:()=>s,a9:()=>o,bc:()=>f,gn:()=>a,ls:()=>l,r5:()=>u,yR:()=>r,zG:()=>p});function r(e){return e}var i=r;function o(e){return function(){return e}}var s=o(!0),a=o(null),u=o(void 0),c=u;function l(e,t,n,r,i,o,s,a,u){switch(arguments.length){case 1:return e;case 2:return function(){return t(e.apply(this,arguments))};case 3:return function(){return n(t(e.apply(this,arguments)))};case 4:return function(){return r(n(t(e.apply(this,arguments))))};case 5:return function(){return i(r(n(t(e.apply(this,arguments)))))};case 6:return function(){return o(i(r(n(t(e.apply(this,arguments))))))};case 7:return function(){return s(o(i(r(n(t(e.apply(this,arguments)))))))};case 8:return function(){return a(s(o(i(r(n(t(e.apply(this,arguments))))))))};case 9:return function(){return u(a(s(o(i(r(n(t(e.apply(this,arguments)))))))))}}}function f(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e}function p(e,t,n,r,i,o,s,a,u){switch(arguments.length){case 1:return e;case 2:return t(e);case 3:return n(t(e));case 4:return r(n(t(e)));case 5:return i(r(n(t(e))));case 6:return o(i(r(n(t(e)))));case 7:return s(o(i(r(n(t(e))))));case 8:return a(s(o(i(r(n(t(e)))))));case 9:return u(a(s(o(i(r(n(t(e))))))));default:for(var c=arguments[0],l=1;l<arguments.length;l++)c=arguments[l](c);return c}}var m=function(e,t){return t}},384:(e,t,n)=>{n.d(t,{F2:()=>f,F4:()=>_,G:()=>a,Gb:()=>v,Od:()=>m,Wi:()=>i,Xl:()=>g,YM:()=>d,YP:()=>s,e$:()=>h,nM:()=>u,pC:()=>o,r1:()=>y,ri:()=>p,t$:()=>l,tO:()=>c});var r=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},i=function(e){return"None"===e._tag},o=function(e){return"Some"===e._tag},s={_tag:"None"},a=function(e){return{_tag:"Some",value:e}},u=function(e){return"Left"===e._tag},c=function(e){return"Right"===e._tag},l=function(e){return{_tag:"Left",left:e}},f=function(e){return{_tag:"Right",right:e}},p=function(e){return[e]},m=function(e){return e.length>0},d=function(e){return e[0]},v=function(e){return e.slice(1)},g=[],_={},h=Object.prototype.hasOwnProperty,y=function(e){return r([e[0]],e.slice(1),!0)}},11:(e,t,n)=>{n.d(t,{Df:()=>i,Eq:()=>r,Pc:()=>s});var r={equals:function(e,t){return e===t}},i={equals:r.equals,compare:function(e,t){return e<t?-1:e>t?1:0}},o=(r.equals,i.compare,{concat:function(e,t){return e+t}}),s={concat:o.concat,empty:0}},751:(e,t,n)=>{n.d(t,{Df:()=>i,Eq:()=>r,xb:()=>o});var r={equals:function(e,t){return e===t}},i={equals:r.equals,compare:function(e,t){return e<t?-1:e>t?1:0}},o=function(e){return 0===e.length}}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,n),o.exports}n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e=n(992),t=n(851),r=n(735),i=n(116),o=n(567),s=n(328),a=n(652),u=n(767);function c(e,n){return(0,r.zG)(u.Y3((()=>e.get(n)),(e=>`Failed to read previous state from IndexedDB: ${e}.`)),u.UI((e=>e??void 0)),u.UI((i=>o=>(0,r.ls)((0,a.rO)({previousState:()=>i}),o,(o=>{let{value:s,state:u}=o;const[c,l]=t.Ue(!1),f=(0,r.zG)(u,t.Rp(-1,(e=>e+1)));return{value:(0,r.bc)(c,s),state:(0,r.zG)(t.vP(u,f),(0,a.bw)(t.YP((t=>{let[r,o]=t;if(0!==o||r!==i)switch(l(!1),typeof r){case"undefined":e.delete(n).then((()=>l(!0)));break;case"object":null===r?e.delete(n).then((()=>l(!0))):e.put(r,n).then((()=>l(!0)));break;default:e.put(r,n).then((()=>l(!0)))}}))))}})))))}function l(e){return n=>(0,r.ls)((0,a.rO)({previousState:t=>e.current?t:void 0}),n,(0,a.rO)({state:(0,r.ls)((n=>t.vP(e,n)),t.UI((e=>{let[t,n]=e;return t?n:void 0})))}))}var f=n(365);class p extends Error{static errorName="NetworkRequestFailedError";name=p.errorName;constructor(){super(p.defaultMessage)}static get defaultMessage(){return"Network request failed"}}class m extends Error{static errorName="NetworkRequestTimeoutError";name=m.errorName;constructor(){super(m.defaultMessage)}static get defaultMessage(){return"Network request timed out"}}var d=n(384),v=function(e){return"Left"===e._tag},g=function(e){return"Right"===e._tag};function _(e){return{_tag:"Left",left:e}}function h(e){return{_tag:"Right",right:e}}function y(e,t){return{_tag:"Both",left:e,right:t}}var b=function(e,t,n){return function(r){switch(r._tag){case"Left":return e(r.left);case"Right":return t(r.right);case"Both":return n(r.left,r.right)}}},w=b;w(h,_,(function(e,t){return y(t,e)}));var I=h,S="These";r.yR,r.yR,d.Xl;class G{metrics;constructor(e){this.metrics=e}req(e){return this.reqImpl(e).then((e=>(0,r.MZ)(e)))}reqWithBeacon(e){var t,n;let{url:r,payload:i}=e;const o=JSON.stringify(i),s=(null===(t=navigator)||void 0===t||null===(n=t.sendBeacon)||void 0===n?void 0:n.call(t,r,JSON.stringify(i)))??!1;return this.trackRequestMetrics({is_beacon:!0,is_error:!s,request:{method:"POST",url:r,content_length:o.length}}),s}reqImpl(t){const n="arraybuffer",{url:i,dataType:s,contentType:u,method:c,withCredentials:l,timeout:v}=t;return new Promise(((g,_)=>{const b=new XMLHttpRequest,w="POST"===t.method?"string"==typeof(I=t.payload)?I:JSON.stringify(I):null;var I;const S=e=>this.trackRequestMetrics({is_beacon:!1,request:{method:c,url:i,content_length:(null==w?void 0:w.length)??0},response:e});b.onload=(0,e.GL)((()=>{var e,t;return(0,r.zG)(b.status,f.DT((e=>e<400),(()=>{const e="text"===b.responseType||""===b.responseType?b.responseText:"Couldn\'t access response text";return`Failed ajax request. Status code was ${b.status}. ${e}`})),f.tS((()=>"json"===s?b.responseText?f.Y3((()=>JSON.parse(b.responseText)),(e=>`Failed to parse response as JSON. Response was ${JSON.stringify(b.responseText)}. Got ${e}`)):f.F2(null):"text"===s?f.F2(b.responseText):f.F2(b.response))),(0,a.bw)((0,r.ls)(o.IS,(t={content_length:"text"===b.responseType||""===b.responseType?(null===(e=b.responseText)||void 0===e?void 0:e.length)??0:b.responseType===n?b.response.byteLength:0,response_time_ms:self.performance.now()-G,status_code:b.status},function(e){return d.Wi(e)?h(t):y(e.value,t)}),S)),f.EQ(_,g))})),b.onerror=(0,e.GL)((()=>{S(f.t$("network error")),_(new p)})),b.ontimeout=(0,e.GL)((()=>{S(f.t$("timeout")),_(new m)})),b.open(c,i,!0),u&&b.setRequestHeader("content-type",u),b.timeout=v||b.timeout,b.withCredentials=l||b.withCredentials,b.responseType="binary"===s?n:b.responseType;const G=self.performance.now();b.send(w)}))}trackRequestMetrics(e){var t;if(null===(t=this.metrics)||void 0===t||!t.isEnabled())return;const n=new URL(e.request.url).pathname;if(n.includes("metrics"))return;const i=t=>this.metrics.track({name:"sdk_http_request_count_total",value:1,labels:{request_method:e.request.method,request_path:n,request_content_length:e.request.content_length,...t}});var s;!0===e.is_beacon?i({is_beacon:!0,is_error:e.is_error}):(0,r.zG)((s=e.response,v(s)?d.YP:(g(s),d.G(s.right))),o.aD((()=>({})),(e=>({response_content_length:e.content_length,response_status:e.status_code,response_time_ms:e.response_time_ms}))),(t=>({is_beacon:!1,is_error:!g(e.response),...t})),i)}}class k{config;PATH_JOINER_Q="?";PATH_JOINER_A="&";constructor(e){this.config=e}getBaseUrl(){return`${this.config.apiProtocol}://${this.config.apiHost}`}getEndpointUrl(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return this.getUrl("base",e,t,n)}getSdkErrorsUrl(e,t){return this.getUrl("sdk-errors",e,t,[])}getAdvertiserEndpointUrl(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return this.getUrl("adv",e,t,n)}getClassificationModelsEndpointUrl(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return this.getUrl("clm",e,t,n)}getAudienceMatchingEndpointUrl(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];const i=`${e}/${n}/audiences`;return this.getUrl("audience-matching",i,t,r)}getCCSCohortMembershipEndpointUrl(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return this.getUrl("ccs",e,t,n)}makeAuthenticatedUrl(e){return this.makeUrlWithQueryParams(e,[["k",this.config.apiKey]])}getUrlPrefix(e){switch(e){case"base":return"";case"adv":return"/adv";case"sdk-errors":return"/sdk-errors";case"clm":return"/clm";case"audience-matching":return"/audience-matching";case"ccs":return"/ccs"}}getUrl(e,t,n,r){const i=this.getUrlPrefix(e),s=(0,o.g_)((()=>""),(e=>`/${e}`))(n),a=`${this.getBaseUrl()}${i}${s}${t}`;return this.makeUrlWithQueryParams(a,r.concat([["k",this.config.apiKey]]))}makeUrlWithQueryParams(e,t){const n=t.map((e=>{let[t,n]=e;return`${t}=${n}`})).join(this.PATH_JOINER_A),r=e.includes(this.PATH_JOINER_Q)?this.PATH_JOINER_A:this.PATH_JOINER_Q;return`${e}${r}${n}`}}var z=n(869),U=n(828);class E{sdkInitTimestamp;timeOriginSdkInit;logger;prefix="[Metrics]";timeOriginForContext=A();pendingMetrics=[];pendingCounters={};pendingTimers={};constructor(e,t,n){this.sdkInitTimestamp=e,this.timeOriginSdkInit=t,this.logger=n}isEnabled(){return!0}consume(){const e=this.pendingMetrics.concat(Object.values(this.pendingCounters).flat());return this.pendingMetrics=[],this.pendingCounters={},e}track(e){this.logDebug(`Tracking ${e.name}`,{metric:e}),this.pendingMetrics.push(e)}trackCounter(e){if(this.logDebug(`Tracking ${e.name}`,{metric:e}),e.name in this.pendingCounters){const t=Object.keys(e.labels),n=this.pendingCounters[e.name].findIndex((n=>Object.keys(n.labels).length===t.length&&t.every((t=>n.labels[t]===e.labels[t]))));-1===n?this.pendingCounters[e.name].push(e):this.pendingCounters[e.name][n]=x(this.pendingCounters[e.name][n],e.value)}else this.pendingCounters[e.name]=[e]}synchroniseTimeBetweenContexts(e){return(0,r.zG)(U.gz(o.G5)(this.timeOriginForContext,this.timeOriginSdkInit),o.UI((t=>{let[n,r]=t;return e+n-r})))}trackTimeSinceInit(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:performance.now();(0,r.zG)(this.synchroniseTimeBetweenContexts(n),o.UI((e=>(e-this.sdkInitTimestamp)/1e3)),o.UI((n=>this.track({name:e,value:n,labels:t}))))}startTimer(e,t){const n=performance.now(),r=this.generateRandomKey(e);return this.pendingTimers[r]={startTime:n,labels:t},r}stopTimer(e,t){const n=this.pendingTimers[t];if(n){const r=(performance.now()-n.startTime)/1e3;this.logDebug("timer stopped",e,r),this.track({name:e,value:r,labels:n.labels}),delete this.pendingTimers[t]}}generateRandomKey(e){return`${e}-${[...Array(24)].map((()=>Math.random().toString(36)[2])).join("")}`}logDebug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.debug(this.prefix,...t)}}class P{isEnabled(){return!1}consume(){return[]}track(e){}trackCounter(e){}trackTimeSinceInit(e,t){}startTimer(e,t){return""}stopTimer(e,t){}}const x=(e,t)=>({...e,value:e.value+t}),A=()=>(0,r.zG)(o.Y3((()=>performance.timeOrigin)),o.hX((e=>"number"==typeof e&&!Number.isNaN(e))));class O{sdkInitTimestamp;prefix="[Permutive]"+(self.document?"[Main]":"[Worker]");debugStyle=["color: blue"].join(";");constructor(e){this.sdkInitTimestamp=e}get timeDeltaFromInit(){return`[${(new Date).getTime()-this.sdkInitTimestamp}ms]`}log(){return console.log.bind(self.console,this.timeDeltaFromInit,this.prefix)(...arguments)}debug(){return console.debug.bind(self.console,"%s%c%s",this.timeDeltaFromInit,this.debugStyle,this.prefix)(...arguments)}warn(){return console.warn.bind(self.console,this.timeDeltaFromInit,this.prefix)(...arguments)}error(){return console.error.bind(self.console,this.timeDeltaFromInit,this.prefix)(...arguments)}}class D{log(){}debug(){}warn(){}error(){}}class T{crypto=self.crypto||self.msCrypto;ALG_NAME="AES-GCM";isAvailable(){var e;return!(null===(e=this.crypto)||void 0===e||!e.subtle)}generateKey(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(0,e.t_)(this.crypto.subtle.generateKey({name:this.ALG_NAME,length:256},t,["encrypt","decrypt"]))}encrypt(e,t){const[n,r]=this._encrypt(e,this.str2bytes(t));return n.then((e=>{const t=new Uint8Array(16+e.byteLength);return t.set(r,0),t.set(new Uint8Array(Uint32Array.of(e.byteLength).buffer),12),t.set(new Uint8Array(e),16),t.buffer}))}decrypt(e,t){const n=new Uint8Array(t,0,12),r=new Uint32Array(t,12,1)[0],i=t.slice(16,16+r);return this._decrypt(e,n,i).then(this.bytes2str)}_encrypt(t,n){const r=this.crypto.getRandomValues(new Uint8Array(12));return[(0,e.t_)(this.crypto.subtle.encrypt({name:this.ALG_NAME,iv:r},t,n)),r]}_decrypt(t,n,r){return(0,e.t_)(this.crypto.subtle.decrypt({name:this.ALG_NAME,iv:n},t,r))}str2bytes(e){return(new TextEncoder).encode(e).buffer}bytes2str(e){return(new TextDecoder).decode(e)}}class C{config;constructor(e){this.config=e}getNamespacedStorageKey(e){return`${this.config.stateNamespace}${e}`}}var q=n(151),M=n(392),R=n(923),F=n(17),j=n(241);var Y=n(688),$=n(548);class N{timeoutDurationInMilliseconds;maxTimeOutDurationInMilliseconds;constructor(e,t){this.timeoutDurationInMilliseconds=e,this.maxTimeOutDurationInMilliseconds=t}schedule(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.timeoutDurationInMilliseconds,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.maxTimeOutDurationInMilliseconds;return this.debounce(e,t,n)}scheduleAccumulated(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.timeoutDurationInMilliseconds,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.maxTimeOutDurationInMilliseconds;return this.debounce(e,n,r,t)}scheduleForPageUnload(e){return(0,a.aT)(e)}debounce(t,n,r,i){let o,s,u,c=[];return l=>{i&&(u=i.concat(u??i.empty,l));const f=(0,a.b2)();c.push(f);var p;return null===(p=o)||void 0===p||p(),o=(0,e.HJ)((()=>{var e;null===(e=s)||void 0===e||e(),s=void 0;const n=t(u||l);c.forEach((e=>e.resolve(n))),u=null==i?void 0:i.empty,c=[]}),n),s||(s=(0,e.HJ)((()=>{var e;null===(e=o)||void 0===e||e(),s=void 0;const n=t(u||l);c.forEach((e=>e.resolve(n))),u=null==i?void 0:i.empty,c=[]}),r)),f.promise}}}class L extends Error{constructor(e){super(e),this.name="StoreClosingError"}}const B="permutive-events-cache",Q="permutive-events-for-page",H="[EVENTSCACHE]",K=e=>"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name;class V{config;logger;reportError;trace;metrics;userId;makeEventsStore;eventStore;eventsCache=this.makeEventsRepository(B);eventsForPage=this.makeEventsRepository(Q);eventsTTLInMilliseconds;readiness;debouncedReportError=(()=>new N(5e3,5e3).schedule((e=>this.reportError(e.errorMessage,{userId:e.userId}))))();static initialise(e,t,n,i,o,s,a){return(0,r.zG)(a(),u.UI((r=>new V(e,t,n,i,o,s,a,r))))}constructor(e,t,n,i,s,u,c,l){this.config=e,this.logger=t,this.reportError=n,this.trace=i,this.metrics=s,this.userId=u,this.makeEventsStore=c,this.eventStore=l,this.eventsTTLInMilliseconds=(0,r.zG)((0,o.ij)(this.config.eventsTTLInDays),(0,o.tS)((e=>"number"==typeof e&&e>0?(0,o.G)(24*e*3600):o.YP))),this.eventsCache.events=(0,a.HP)((()=>(0,a.PQ)((0,r.zG)(q.tD((()=>this.trace.startSpan("load_event_cache"))),q.tS((e=>(0,r.zG)(this.loadFromDisk(),q.At((t=>()=>{e.finish(),this.logDebug(`Event cache loaded, #e ${t.length}`)}))))))))),this.readiness=this.eventsCache.events().then((()=>this.migratePreviousPagesEvents())),u.onChange((()=>this.reset()))}async migratePreviousPagesEvents(){const e=this.trace.startSpan("migrate_previous_for_page_events"),t=(0,q.pE)((e=>(0,u.Y3)((()=>e.flush()),Y.w)));return(0,r.zG)([this.eventsForPage,this.eventsCache],t,(0,q.UI)((t=>{const n=s.bj(t);return n.length>0&&this.reportError(`Migrate previous events failed. Got:\\n${n.join("\\n ")}`,{userId:this.userId.current}),e.finish()})),(e=>e()))}all(){return Promise.all([this.eventsCache.events(),this.eventsForPage.events()]).then(s.xH)}async add(e,t){let{persistOnDisk:n}=t;return this.logDebug("Adding to cache",e),this.eventsForPage.events=(0,r.zG)(this.eventsForPage.events,q.UI((t=>[...t,e])),a.HP),n&&this.readiness.then((()=>this.eventsForPage.flush())),e}filterEventsByWorkspace(e){return e}pruneEventsToSizeLimit(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.config.eventsCacheLimitBytes;if(n<=0||t<=n)return this.logDebug(`Event size of ${t} less than limit of ${n}`),{events:e,sizeInBytes:t};this.logDebug("Events before pruning",{count:e.length,sizeInBytes:t,byteLimit:n});let r=1,i=[...e];for(;t>n;)i.splice(0,r),r*=2,t=2*JSON.stringify(i).length;return this.logDebug("Events after pruning",{count:i.length,sizeInBytes:t}),{events:i,sizeInBytes:t}}loadFromDisk(){const e=()=>[],t=(0,r.zG)(this.eventsTTLInMilliseconds,o.EQ((()=>r.yR),(e=>s.hX((t=>e>Date.now()-t.time.getTime())))));return(0,r.zG)(q.tD((()=>(this.logLog("Loading event cache..."),this.metrics.startTimer("sdk_load_events_cache_task_duration_seconds",{})))),q.YO("loadEventsCacheTask"),q.ak("eventsFromDisk",(()=>(0,r.zG)(s.nI([this.eventStore.get(B),this.eventStore.get(Q)]),s.UI(u.LV((0,a.lo)([[e=>e instanceof L,(0,r.ls)(e,q.of)],t=>(0,r.zG)(q.tD((()=>this.reportError(`Error fetching data from store. Got ${t}`,{userId:this.userId.current}))),q.tS((()=>()=>this.reset("historical"))),q.UI(e))]),(0,r.ls)(o.fS(e),q.of))),s.vP(q.qA)))),q.At((e=>{let{eventsFromDisk:t,loadEventsCacheTask:n}=e;return()=>{this.logDebug("Read events from store:",t),this.metrics.stopTimer("sdk_load_events_cache_task_duration_seconds",n)}})),q.UI((0,r.ls)((0,a.vg)("eventsFromDisk"),s.xH,this.filterEventsByWorkspace,(e=>this.pruneEventsToSizeLimit(e,2*JSON.stringify(e).length)),(e=>(this.eventsCache.sizeInBytes=e.sizeInBytes,this.eventsCache.sizeInBytesLastSuccessfulWrite=e.sizeInBytes,e.events.length>0&&(this.metrics.track({name:"sdk_events_cache_byte_total",value:e.sizeInBytes,labels:{}}),this.metrics.track({name:"sdk_events_cache_size_total",value:e.events.length,labels:{}})),e.events)),s.UI($.k),t)))}async reset(e){return(0,r.zG)(q.tD((()=>this.logDebug("Resetting Events Cache"))),q.tS((()=>this.eventStore.deleteStore())),u.tS((()=>this.makeEventsStore())),u.Zl((t=>(this.eventStore=t,"historical"===e?U.gz(u.Ij)(this.eventsCache.reset,this.eventsForPage.flush):U.gz(u.Ij)(this.eventsCache.reset,this.eventsForPage.reset)))),u.wE((()=>()=>this.all())),u.fS((()=>q.of(W()))),(e=>e()))}getStateSizeInBytes(){return this.eventsForPage.sizeInBytes+this.eventsCache.sizeInBytes}makeEventsRepository(e){const t=(()=>{let e=Promise.resolve(f.F2((0,r.Q1)()));return t=>e=e.then(t)})(),n=e=>(0,r.zG)(q.tD((()=>this.logDebug(`Writing ${e.length} events to ${d.key}`))),q.tS((()=>this.eventStore.put(e.map($.X),d.key))),u.UI(r.Q1)),i=(0,r.zG)(q.tD((()=>this.logDebug(`Deleting events for ${d.key}`))),q.tS((()=>this.eventStore.delete(d.key))),u.Vn(Y.w)),o=(0,r.ls)(q.of,q.At((e=>()=>this.logError(`Events cache failed to put ${d.key}. Got ${e}`))),q.tS((0,a.lo)([[e=>K(e)&&d.retryAttempts<9,()=>(0,r.zG)(q.tD((()=>{d.retryAttempts+=1,this.logDebug(`Attempt #${d.retryAttempts} to write ${d.key} to EventsStore`)})),q.tS((()=>m)),q.tS((()=>c)))],[e=>K(e),e=>(0,r.zG)(q.tD((()=>this.logDebug(`Attempted ${d.retryAttempts} rewrite attempts and reached limit of 9 max writes.`,"Reporting QuotaExceededError to API"))),q.tS((()=>()=>this.debouncedReportError({errorMessage:`Events cache failed to put ${d.key}. Got ${e}`,userId:this.userId.current}))),q.tS((()=>u.t$(e))))],u.t$]))),s=e=>u.tD((()=>{this.logDebug(`Successfully wrote events for ${d.key} after ${d.retryAttempts} attempts`),d.retryAttempts=0,d.sizeInBytes=2*JSON.stringify(e).length,d.sizeInBytesLastSuccessfulWrite=d.sizeInBytes})),c=(0,r.zG)((()=>d.events()),q.tS((e=>(0,r.zG)(n(e),q.mU(f.EQ(o,(()=>s(e)))))))),l=(e,t)=>(0,r.zG)(e.events,q.UI((n=>{const r=2*JSON.stringify(n).length,i=this.pruneEventsToSizeLimit(n,r,t);return e.events=q.of(i.events),e.sizeInBytes=i.sizeInBytes,t-e.sizeInBytes}))),p=(e,t)=>{let[n,...i]=e;return n&&0!==t?(0,r.zG)(l(n,t),q.tS((e=>(this.logDebug(`${e} left after pruning ${n.key}`),p(i,e))))):q.of((0,r.Q1)())},m=(0,r.zG)(u.tD((()=>this.eventsForPage.sizeInBytes-this.eventsForPage.sizeInBytesLastSuccessfulWrite)),u.fX(f.DT((e=>e>0),(e=>new Error(`${this.eventsForPage.key} failed to write the same or smaller events cache of size ${e}`)))),u.tS((e=>{const t=1.2*e,n=[this.eventsCache,this.eventsForPage];return this.logDebug(`Pruning ${t} bytes from`,n),(0,r.zG)(p(n,t),u.fF)}))),d={key:e,events:q.of([]),sizeInBytes:0,sizeInBytesLastSuccessfulWrite:0,retryAttempts:0,flush:()=>(0,r.zG)(q.tD((()=>this.trace.startSpan(`write_${d.key}`))),q.tS((e=>(0,r.zG)(c,q.At((()=>()=>e.finish()))))),t),reset:()=>(0,r.zG)(q.tD((()=>{d.events=q.of([]),d.sizeInBytes=0,d.sizeInBytesLastSuccessfulWrite=0})),q.tS((()=>i)),t)};return d}logDebug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.debug(H,...t)}logWarn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.warn(H,...t)}logError(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.error(H,...t)}logLog(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.log(H,...t)}}const W=()=>[],J=`permutive.${self.document?"main":"worker"}.`;class X{config;shouldUsePerformanceMark=!1;constructor(e){var t;this.config=e,this.shouldUsePerformanceMark=((null===(t=self.performance)||void 0===t?void 0:t.mark)&&this.config.tracingEnabled)??!1}startSpan(e){const t=this.generateSpan(e);return t.start(),{spanId:t.spanId,finish:t.finish}}measureSinceInit(t){const n=this.generateSpan(`${t}_since_init`);return n.start({startTime:e.NC}),{spanId:n.spanId,finish:n.finish}}traceTask(e){return t=>async()=>{const n=this.startSpan(e),r=await t();return n.finish(),r}}measureBetween(e,t,n){const r=this.generateSpan(e);r.start({startTime:t}),r.finish({startTime:n})}generateSpan(e){if(!this.shouldUsePerformanceMark)return{spanId:null,start:()=>{},finish:()=>{}};const{spanName:t,startMarkerName:n,endMarkerName:r}=X.generateUniqueMarkerNames(e);return{spanId:n,start:e=>{var t;return null===(t=self.performance)||void 0===t?void 0:t.mark(n,e)},finish:e=>{var i,o,s;null===(i=self.performance)||void 0===i||i.mark(r,{startTime:(null==e?void 0:e.startTime)??performance.now()}),null===(o=self.performance)||void 0===o||null===(s=o.measure)||void 0===s||s.call(o,t,n,r)}}}static generateUniqueMarkerNames(e){const t=`${J}${e}`,n=`${t}${X.generateId()}`;return{spanName:t,startMarkerName:`${n}_start`,endMarkerName:`${n}_end`}}static generateId(){return"_"+Math.random().toString(36).substr(2,9)}}class Z{db;static version=3;static connect(t,i,o,s,a,c,l,f,p,m){return(0,r.zG)(u.Y3((()=>Promise.resolve().then(n.bind(n,569))),String),e.N1,u.tS((e=>e.make(t,i,o,s,a,c,l,Z.version,f,p,m))),u.UI((e=>new Z(Promise.resolve(e)))))}constructor(e){this.db=e}shouldThrowStoreClosingError(e){return"NotFoundError"===e.name||"InvalidStateError"===e.name}makeStoreClosingDuringOpertationError(e){return new L(`Attempted ${e} when the current store is closing.`)}put(e,t){return(0,u.Y3)((()=>this.db.then((n=>n.put(e,t)))),(e=>{const t=(0,Y.w)(e);return this.shouldThrowStoreClosingError(t)?this.makeStoreClosingDuringOpertationError("put"):t}))}get(e){return(0,u.Y3)((()=>this.db.then((t=>t.get(e))).then(o.ij)),(e=>{const t=(0,Y.w)(e);return this.shouldThrowStoreClosingError(t)?this.makeStoreClosingDuringOpertationError("get"):t}))}delete(e){return(0,u.Y3)((()=>this.db.then((t=>t.delete(e)))),(e=>String(e)))}deleteStore(){return(0,u.Y3)((()=>this.db.then((e=>e.deleteStore()))),(e=>String(e)))}}const ee=e=>{if(!e)return"";return(0,r.zG)(e,(e=>{const t=e.length-1;return"/"===e[t]?e.slice(0,t):e}))};class te{urls;config;network;metricsCollector;logger;webClient;prefix="[API]";constructor(e,t,n,r,i){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:()=>o.YP;this.urls=e,this.config=t,this.network=n,this.metricsCollector=r,this.logger=i,this.webClient=s}async reportError(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Date;const i=(0,Y.w)(e);if(this.logError("Reporting error:\\n",i),!this.config.sendClientErrors)return void this.logDebug("Send errors not enabled. Skipping");const a=(0,r.zG)(this.webClient,M.UI(o.fS((()=>{var e,t,n,r;return{domain:(null===(e=self.location)||void 0===e?void 0:e.hostname)??"",referrer:"document"in self?null===(t=self.document)||void 0===t?void 0:t.referrer:"",url:(null===(n=self.location)||void 0===n?void 0:n.href)??"",user_agent:(null===(r=navigator)||void 0===r?void 0:r.userAgent)??""}}))),M.UI((e=>{var r,o;const s={error_message:(null==i||null===(r=i.message)||void 0===r?void 0:r.toString())??"",stack_trace:null==i||null===(o=i.stack)||void 0===o?void 0:o.split("\\n")},a=t?{user_id:t}:{};return{platform:"web",sdk_version:"v20.4.1",ql_runtime_version:"v10.0.2",timestamp:n,domain:e.domain,url:ee(e.url),referrer:ee(e.referrer),user_agent:e.user_agent,error_message:s.error_message??String(i),stack_trace:s.stack_trace,...a}}))),u=e=>this.network.req({url:this.urls.getSdkErrorsUrl("/errors",o.G(this.config.sdkErrorsApiVersion)),method:"POST",payload:[e],contentType:"text/plain",dataType:"text",withCredentials:!1}),c=e=>{this.metricsCollector.trackCounter({name:"sdk_http_generic_network_request_fail_count_total",value:1,labels:{network_error_type:e}})};await(0,r.zG)([p,m],s.Ew((e=>i.name===e.errorName||i.message.indexOf(e.errorName)>=0||i.message.indexOf(e.defaultMessage)>=0)),o.g_((()=>{const e=a();return u(e).catch((0,r.ls)(Y.w,(e=>this.logError(e))))}),(async e=>c(e.errorName))))}logDebug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.debug(this.prefix,...t)}logError(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.error(this.prefix,...t)}}const ne=function(e){let t=o.YP;const n=o.fS((()=>{const n=e();return t=o.G(n),n}));return()=>n(t)}((()=>{var e;(()=>{var t={234:function(e,t,u){var c=this&&this.__assign||function(){return c=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},c.apply(this,arguments)},l=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},f=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s},p=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},m=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.env=void 0;var d=m(u(783)),v=m(u(269));t.env=function(){function e(e){return"number"==typeof e?n[e]:e}function t(e){return"number"==typeof e?r[e]:e}function u(e){return"number"==typeof e?i[e]:e}function m(e){switch(e.length){case 0:return null;case 1:return e[0];default:return e}}function g(e,t,n){void 0===n&&(n=y);var r=u(t).reduce((function(e,t){return e&&null!=e[t]?e[t]:null}),e);return null===r?null:n(r)}function _(e,t){var n=u(t).slice();return n.unshift(e),n}function h(e,t,n){return void 0===n&&(n=y),g(e,_("properties",t),n)}var y=function(e){return e},b=function(e){return!0};function w(e,t){return function(n){for(var r=0;r<e.length;r++){if((e[r](n)||!1)===t)return t}return!t}}function I(e){return w(e,!0)}function S(e){return w(e,!1)}var G=function(e){return function(t){return!e(t)}},k=function(e,t){return function(n){return n>=e&&n<=t}},z=function(e){return new Date(e).getTime()},U=function(e){return g(e,["time"],z)},E=function(e,t){return g(t,e,z)},P=function(e,t,n,r,i,o){return function(s){var a=g(s,e,(function(e){return e.filter(r).map((function(e){return g(e,t)})).reduce(i,o)}));return n(null===a?o:a)}};function x(e,t,n,r){var i,o;try{for(var s=l(e),a=s.next();!a.done;a=s.next()){var u=a.value;if(n(u)&&t(u)===r)return r}}catch(e){i={error:e}}finally{try{a&&!a.done&&(o=s.return)&&o.call(s)}finally{if(i)throw i.error}}return!r}var A=function(e){return function(n){return("string"==typeof e||"number"==typeof e)&&"string"==typeof n&&n.toLowerCase().indexOf(t(e).toLowerCase())>-1}},O=function(e){return function(t){return null!=t&&Array.isArray(t)&&t.indexOf(e)>=0}};function D(e,t,n,r,i){var o=g(e.getSegments(),[t,n])||!1;return i&&(r||o)&&e.setSegmentActivation(t,n,i),o}function T(e,t,n){return g(e.getSegments(),[t,n])||!1}function C(e,t,n){return void 0===n&&(n=18e5),function(r){return{a:{m:function(e,t){return[t[0],r.a.m(null!=e[0]&&e[0][0]===t[0][0]?e[1]:r.a.z,t[1])]},z:[[],r.a.z]},p:function(n,i){return[[e(n)],g(i,t)===e(n)?r.p(n,i):r.a.z]},r:function(t,n){return r.r(t,0!==n[0].length&&n[0][0]===e(t)?n[1]:r.a.z)},d:r.d.sq||{l:function(i,o){var s=g(i,t),a=e(o);if(s!==a)return null;var u=r.d.l(i,o);if(!(Array.isArray(u)&&u.length>1))return null;var c=f(u),l=c[0],p=c.slice(1),m=+(U(i)||o.getCurrentTime()),d=Math.floor(m/n),v={};return v[d]={},v[d][a]=1===p.length?p[0]:p,[l,"u",null,v]},i:function(t,n){if(!Array.isArray(t)||"object"!=typeof t[3])return[[],r.a.z];var i=e(n),o=t[3];return[[i],Object.keys(o).map((function(e){return o[e][i]})).filter((function(e){return e})).map((function(e){return r.d.i([t[0]].concat(e))})).reduce(r.a.m,r.a.z)]}}}}}var q=C((function(e){return e.getCurrentSession()}),["session_id"],18e5),M=C((function(e){return e.getCurrentView()}),["view_id"],3e5);function R(t,n,r,i){return void 0===i&&(i=1),{a:{m:function(e,t){return e.concat(t).slice(-r)},z:[]},p:function(r,i){return g(i,["name"])===e(n)?[t.p(r,i)]:[]},r:function(e,n){return t.r(e,n.reduce((function(e,n){return t.a.m(e,n)}),t.a.z))},d:t.d.ftn||{l:function(e,n){var o,s=t.d.l(e,n),a=g(e,["time"],z)*i;return s&&[s[0],"x"+r,null,(o={},o[a]=2==s.length?s[1]:s.slice(1),o)]},i:function(e,n){return e?Object.keys(e[3]||{}).sort().reverse().map((function(t){return Array.isArray(t)?p([e[0]],f(e[3][t]),!1):[e[0],e[3][t]]})).map((function(e){return t.d.i(e,n)})):[]}}}}var F=function(e,t){return null===e?null==t?null:{b:t}:null==t?{a:e}:{a:e,b:t}},j=function(e,t){return e&&t?e(t):null},Y=function(e,t,n){if(n&&n.result&&Array.isArray(n.result)){var r=j(e.d&&e.d.m,{result:n.result[0]}),i=j(t.d&&t.d.m,{result:n.result[1]});return F(r,i)}return null};var $=function(e){return function(t){function n(e){for(var t=e[0],n=1;n<e.length;n++)t=[t,e[n]];return t}function r(e){for(var n=e,r=Array(t.length),i=t.length-1;i>0;i--)r[i]=n[1],n=n[0];return r[0]=n,r}return{p:function(e,r){return n(t.map((function(t){return t.p(e,r)})))},r:function(n,i){var o=r(i);return e(t.map((function(e,t){return function(){return e.r(n,o[t])}})))({})},a:{z:n(t.map((function(e){return e.a.z}))),m:function(e,i){var o=r(e),s=r(i);return n(t.map((function(e,t){return function(e,t,n){return null===t?n:null===n?t:e.a.m(t,n)}(e,o[t],s[t])})))}},d:{l:function(e,n){return function(e){for(var t=e[0],n=1;n<e.length;n++){var r=e[n],i=t;t={},null!==i&&(t.a=i),null!==r&&(t.b=r)}return t}(t.map((function(t){return t.d.l(e,n)})))},i:function(e,r){return function(e,r){for(var i=e,o=t.map((function(e){return e.a.z})),s=function(e,n){return t[e].d.i(n,r)},a=t.length-1;a>0&&i;a--)i.b&&(o[a]=s(a,i.b)),i.a&&1===a&&(o[0]=s(0,i.a)),i=i.a;return n(o)}(e,r)}}}}},N=$(I),L=$(S);function B(e,t){var n=o[e];if(!t||!n)return!1;if(!n.length)return!0;for(var r=0,i=!1,s=function(e){for(var t=[],n=0;n<e.length;++n){var r=e.charCodeAt(n);if(r>=55296&&r<=56319){var i=e.charCodeAt(n+1);if(i>=56320&&i<=57343){t.push(e.slice(n,n+2)),++n;continue}}t.push(e.charAt(n))}return t}(t.toLowerCase()),a=0;a<s.length;a++){for(var u=s[a];r>0&&!n[r][u];)r=n[r].su?n[r].su:0;if(n[r][u]&&(i=!!n[r=n[r][u]].te))break}return i}var Q=function(e){return(0,d.default)(e).toString(v.default).slice(0,8)},H=function(e,t){var n,r,i=Q(e);if(0===t.length)return!1;if(t[0]===i)return!0;for(var o=0,s=t.length,a=!1;(a=(n=t[r=o+(s-o>>1)])!==i)&&(n<i?o=r:s=r,!(o>=s-1)););return!a},K=function(e,t){return function(n){return H(g(n,e),t)}},V=function(e,t){return function(n){return H(h(n,e),t)}};return{q:function(e){return{lift:function(t,n){return e.d.l(t,n)},interpret:function(t,n){return function(t,n){return{result:e.r(t,n)}}(n,e.d.i(t,n))},migrate:function(t){return t&&e.d.m?e.d.m(t):null},m:e.a.m,z:e.a.z,p:e.p,r:e.r,i:e.d.i}},a:S,acq:function(e,t){return{p:function(n,r){return[e.p(n,r),t.p(n,r)]},r:function(n,r){return e.r(n,r[0])&&t.r(n,r[1])},a:{z:[e.a.z,t.a.z],m:function(n,r){return[e.a.m(n[0],r[0]),t.a.m(n[1],r[1])]}},d:{l:function(n,r){return F(e.d.l(n,r),t.d.l(n,r))},i:function(n,r){return n?[e.d.i(n.a||null,r),t.d.i(n.b||null,r)]:[e.a.z,t.a.z]},m:function(n){return Y(e,t,n)}}}},acqs:L,acs:B,acs_:function(e,t){return function(n){return B(t,g(n,e))}},af_i:function(e,t,n){return void 0===n&&(n=b),function(r){return g(r,e,(function(e){return x(e,t,n,!1)}))&&!0}},af_l:function(e,t,n){return void 0===n&&(n=b),function(r){var i=g(r,e,(function(e){return e.filter(n).length}));return t(null===i?0:i)}},af_m:function(e,t,n,r){return void 0===r&&(r=b),function(i){var o=g(i,e,(function(e){return e.filter(r)}));return null===o||0===o.length?n(0):n(o.map((function(e){return g(e,t)})).reduce((function(e,t){return e+t}),0)/o.length)}},af_n:function(e,t,n,r){return void 0===r&&(r=b),P(e,t,n,r,(function(e,t){return Math.min(e,t)}),Number.POSITIVE_INFINITY)},af_p:function(e,t,n,r){return void 0===r&&(r=b),P(e,t,n,r,(function(e,t){return e*t}),1)},af_s:function(e,t,n,r){return void 0===r&&(r=b),P(e,t,n,r,(function(e,t){return e+t}),0)},af_u:function(e,t,n){return void 0===n&&(n=b),function(r){return g(r,e,(function(e){return x(e,t,n,!0)}))||!1}},af_x:function(e,t,n,r){return void 0===r&&(r=b),P(e,t,n,r,(function(e,t){return Math.max(e,t)}),Number.NEGATIVE_INFINITY)},as:function(e,t,n){var r=_("properties",t);return function(t){for(var i=g(t,r),o=n.length,s=!0,a=0;a<o;a++){var u=n[a];if(!(s=e(u)(i)))break}return s}},c:O,c_:function(e,t){return function(n){return O(t)(g(n,e))}},cl_:function(e,n){return function(r){return O(t(n))(g(r,e))}},cx:function(e){return function(n){return O(t(e))(n)}},ctu:function(t,n,r,i){return{a:i?{m:function(e,t){return e.filter((function(e){return-1===t.indexOf(e)})).concat(t).slice(-i)},z:[]}:{m:function(e,t){return e.filter((function(e){return-1===t.indexOf(e)})).concat(t)},z:[]},p:function(i,o){return g(o,["name"])===e(t)&&n(o)?g(o,r):[]},r:function(e,t){return t},d:{l:function(){return null},i:function(){return[]}}}},ctv:function(t,n,r,i){function o(e,t){var n,r=function(e){return{k:e.k,c:1+e.c}},i={arr:[],add:{k:t,c:1}};return t?(n=e.reduce((function(e,t){return e.add.k===t.k?{arr:e.arr,add:r(t)}:{arr:e.arr.concat(t),add:e.add}}),i)).arr.concat(n.add):e}return{a:i?{m:function(e,t){return o(e,t).slice(-i)},z:[]}:{m:function(e,t){return o(e,t)},z:[]},p:function(i,o){return g(o,["name"])===e(t)&&n(o)?g(o,r):null},r:function(e,t){return t.reduce((function(e,t){var n;return c(c({},e),((n={})[t.k]=t.c,n))}),{})},d:{l:function(e){return null},i:function(e){return[]}}}},ctw:function(t,n,r,i){return{a:i?{m:function(e,t){return e.concat(t).slice(-i)},z:[]}:{m:function(e,t){return e.concat(t)},z:[]},p:function(i,o){return g(o,["name"])===e(t)&&n(o)?g(o,r):[]},r:function(e,t){return t},d:{l:function(){return null},i:function(){return[]}}}},cw:function(t,n,r){return void 0===r&&(r=y),{a:{m:function(e,t){return e+t},z:0},p:function(r,i){return g(i,["name"])===e(t)&&n(i)?1:0},r:function(e,t){return r(t)},d:{l:function(r){return g(r,["name"])===e(t)&&n(r)?["p",1]:null},i:function(e){return e?Array.isArray(e)?e.slice(-1)[0]:e:0},m:function(e){return e&&e.result?["p",e.result]:null}}}},cb:function(t,n,r,i){return{a:{m:function(e,t){return Math.min(e+t,i)},z:0},p:function(r,i){return g(i,["name"])===e(t)&&n(i)?1:0},r:function(e,t){return r(t)},d:{l:function(r){return g(r,["name"])===e(t)&&n(r)?["b".concat(i,"p"),1]:null},i:function(e){return e?Array.isArray(e)?e.slice(-1)[0]:e:0},m:function(e){return e&&e.result?["b".concat(i,"p"),Math.min(i,e.result)]:null}}}},e:function(e){return function(t){return t===e}},e_:function(e,t){return function(n){return g(n,e)===t}},fm:function(e,t){return{p:t.p,r:function(n,r){return e(t.r(n,r))},a:t.a,d:t.d}},frontDecode:function(e){var t=e.split("\\t");if(0===t.length)return[];var n=t[0],r=new Array(Math.ceil(t.length/2));r[0]=t[0];for(var i=1;i<t.length/2;i+=1){var o=t[2*i-1],s=t[2*i];if(""===o)n=s;else{var a=parseInt(o);n=n.slice(0,a)+s}r[i]=n}return r},ftn:function(t,n,r){return{a:{m:function(e,t){return e.concat(t.slice(0,r-e.length))},z:[]},p:function(r,i){return g(i,["name"])===e(n)?[t.p(r,i)]:[]},r:function(e,n){return t.r(e,n.reduce((function(e,n){return t.a.m(e,n)}),t.a.z))},d:R(t,n,r,-1).d}},fw:function(t,n,r,i){return void 0===i&&(i=y),{a:{m:function(e,t){return null===e?t:e},z:null},p:function(i,o){return g(o,["name"])===e(t)&&n(o)?g(o,r):null},r:function(e,t){return t},d:{l:function(r){return g(r,["name"])===e(t)&&n(r)?["p",1]:null},i:function(e){return e?Array.isArray(e)?e.slice(-1)[0]:e:0},m:function(e){return e&&e.result?["p",e.result]:null}}}},g:function(e){return function(t){return t>e}},g_:function(e,t){return function(n){return g(n,e)>t}},gb:function(e,t,n){return{a:{m:function(n,r){return Object.keys(n).concat(Object.keys(r)).filter((function(e,t,n){return n.indexOf(e)===t})).sort((function(e,t){return Math.max(g(n,[t,1]),g(r,[t,1]))-Math.max(g(n,[e,1]),g(r,[e,1]))})).slice(0,t).reduce((function(t,i){var o=e.a.m(g(n,[i,0])||e.a.z,g(r,[i,0])||e.a.z);return t[i]=[o,Math.max(g(n,[i,1]),g(r,[i,1]))],t}),{})},z:{}},p:function(t,r){var i,o,s=g(r,_("properties",n)),a=e.p(t,r);return null==s||(null==(o=a)||"object"==typeof o&&0===Object.keys(o).length||o===e.a.z)?{}:((i={})[s]=[a,g(r,["time"],z)],i)},r:function(t,n){var r={};return Object.keys(n).forEach((function(i){return r[i]=e.r(t,n[i][0])})),r},d:{l:function(){return null},i:function(){return{}}}}},ge:function(e){return function(t){return t>=e}},ge_:function(e,t){return function(n){return g(n,e)>=t}},bse:function(e,t){return function(n){var r=g(n,e);return Q(r)===t}},bsne:function(e,t){return function(n){var r=g(n,e);return Q(r)!==t}},bsc:K,bsnc:function(e,t){return G(K(e,t))},bsc_:V,bsnc_:function(e,t){return G(V(e,t))},i_:y,ifp:function(e){return{a:{m:function(e,t){return t},z:null},p:function(e){return null},r:function(t,n){return function(t){return T(t,"1p",e)}(t)},d:{l:function(e,t){return null},i:function(e){return null}}}},isp:function(e,t,n,r){return{a:{m:function(e,t){return t},z:!1},p:function(n,r){return T(n,e,t)},r:function(i,o){return D(i,e,t,n,r)},d:{l:function(e,t){return null},i:function(e){return Array.isArray(e)&&(!!+e[2]||!1)}}}},itp:function(e,t,n,r){return{a:{m:function(e,t){return t},z:!1},p:function(n,r){return T(n,e,t)},r:function(i,o){return D(i,e,t,n,r)},d:{l:function(e,t){return null},i:function(e){return Array.isArray(e)&&(!!+e[2]||!1)}}}},k:g,l:function(e){return function(t){return t<e}},l_:function(e,t){return function(n){var r=g(n,e);return null!==r&&r<t}},le:function(e){return function(t){return t<=e}},le_:function(e,t){return function(n){var r=g(n,e);return null!==r&&r<=t}},lm:function(e,t){var n=function(t){return function(e,t,n){if(void 0===t[n])return NaN;var r=e||{};if(0==(r["1p"]||[]).length)return NaN;var i,o=t[n]||{},s=(o["1p"]||{}).const||0;return Object.keys(r).forEach((function(e){r[e].forEach((function(t){var n=(o[e]||{})[t]||0;s+=n}))})),i=s,1/(1+Math.pow(Math.E,-i))}(t.getSegmentsArray(),t.getLookalikeModels(),e)};return{a:{m:function(e,t){return t},z:null},p:function(e){return null},r:function(e,r){return t(n(e))},d:{l:function(e,t){return null},i:function(e){return null}}}},ltn:R,mnw:function(t,n,r,i){void 0===i&&(i=y);var o=Number.POSITIVE_INFINITY;return{a:{m:function(e,t){return e<t?e:t},z:o},p:function(i,s){return g(s,["name"])===e(t)&&n(s)?g(s,r):o},r:function(e,t){return i(t)},d:{l:function(i){return g(i,["name"])===e(t)&&n(i)?["n",g(i,r)]:null},i:function(e){return e?Array.isArray(e)?e.slice(-1)[0]:e:o}}}},mxw:function(t,n,r,i){void 0===i&&(i=y);var o=Number.NEGATIVE_INFINITY;return{a:{m:function(e,t){return e>t?e:t},z:o},p:function(i,s){return g(s,["name"])===e(t)&&n(s)?g(s,r):o},r:function(e,t){return i(t)},d:{l:function(i){return g(i,["name"])===e(t)&&n(i)?["v",g(i,r)]:null},i:function(e){return e?Array.isArray(e)?e.slice(-1)[0]:e:o}}}},n0:G(y),n:function(e){return function(t){return t!==e}},nt:G,n_:function(e,t){return function(n){return g(n,e)!==t}},o:I,ocq:function(e,t){return{p:function(n,r){return[e.p(n,r),t.p(n,r)]},r:function(n,r){return e.r(n,r[0])||t.r(n,r[1])},a:{z:[e.a.z,t.a.z],m:function(n,r){return[e.a.m(n[0],r[0]),t.a.m(n[1],r[1])]}},d:{l:function(n,r){return F(e.d.l(n,r),t.d.l(n,r))},i:function(n,r){return n?[e.d.i(n.a||null,r),t.d.i(n.b||null,r)]:[e.a.z,t.a.z]},m:function(n){return Y(e,t,n)}}}},ocqs:N,oe:function(e){for(var t=Object.keys(e),n=t.length,r=new Array(n);n--;)r[n]=[t[n],e[t[n]]];return r},os:function(e,t,n){var r=_("properties",t);return function(t){for(var i=g(t,r),o=n.length,s=!1,a=0;a<o;a++){var u=n[a];if(s=e(u)(i))break}return s}},pacs:function(e,t){return function(n){return B(t,h(n,e))}},pb:function(e,t,n){return function(r){return k(t,n)(h(r,e))}},pc:function(e,t){return function(n){var r=h(n,e);return null!=r&&Array.isArray(r)&&r.indexOf(t)>=0}},pc_:function(e,n){return function(r){var i=h(r,e),o=t(n);return null!=i&&Array.isArray(i)&&i.indexOf(o)>=0}},pe:function(e,t){return function(n){return h(n,e)===t}},pg:function(e,t){return function(n){return h(n,e)>t}},pge:function(e,t){return function(n){return h(n,e)>=t}},pl:function(e,t){return function(n){var r=h(n,e);return null!==r&&r<t}},ple:function(e,t){return function(n){var r=h(n,e);return null!==r&&r<=t}},pn:function(e,t){return function(n){return h(n,e)!==t}},ps:function(e,t){return function(n){return A(t)(h(n,e))}},pw:function(t,n,r,i){return void 0===i&&(i=y),{a:{m:function(e,t){return e*t},z:1},p:function(i,o){return g(o,["name"])===e(t)&&n(o)?g(o,r):1},r:function(e,t){return i(t)},d:{l:function(i){return g(i,["name"])===e(t)&&n(i)?(o=g(i,r))>=1?["m2p",o]:o>0?["m2p",null,1/o]:0==o?["m2p",0]:o>-1?["m2p",null,1/o,1]:["m2p",o,null,1]:null;var o},i:function(e){return e?Array.isArray(e)?0===(t=e.slice(1))[0]?0:Math.pow(-1,t[2]||0)*(t[0]||1)/(t[1]||1):e:1;var t}}}},r:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return a[e].apply(a,p([],f(t),!1))},ref:function(e){return function(t){return s[e](t)}},s:A,s_:function(e,t){return function(n){return A(t)(g(n,e))}},scq:function(e,t,n){return void 0===n&&(n=y),{p:function(n,r){return[e.p(n,r),t.p(n,r)]},r:function(r,i){return n(e.r(r,i[0])+t.r(r,i[1]))},a:{z:[e.a.z,t.a.z],m:function(n,r){return[e.a.m(n[0],r[0]),t.a.m(n[1],r[1])]}},d:{l:function(n,r){return F(e.d.l(n,r),t.d.l(n,r))},i:function(n,r){return n?[e.d.i(n.a||null,r),t.d.i(n.b||null,r)]:[e.a.z,t.a.z]},m:function(n){return Y(e,t,n)}}}},sq:q,dscq:function(t,n,r,i){var o="x".concat(i),s=function(e){return e?2===e.length?["p",o,"",e[1]]:e:null},a=function(r){var i,s=function(e){return g(e,["session_id"])}(r);return s&&g(r,["name"])===e(t)&&n(r)?["p",o,"",(i={},i[s]=1,i)]:null};return{a:{m:function(e,t){var n=s(e),r=s(t);return n?r?["p",o,"",c(c({},n[3]),r[3])]:n:r},z:null},p:function(e,t){return a(t)},r:function(e,t){var n=t&&t[3]&&"object"==typeof t[3]?Object.keys(t[3]).length:0;return r(n)},d:{l:function(e,t){return a(e)},i:function(e,t){return s(e)}}}},sw:function(t,n,r,i){return void 0===i&&(i=y),{a:{m:function(e,t){return e+t},z:0},p:function(i,o){return g(o,["name"])===e(t)&&n(o)?g(o,r):0},r:function(e,t){return i(t)},d:{l:function(i){return function(r){return g(r,["name"])===e(t)&&n(r)}(i)?(o=g(i,r))<0?["p2",null,-o]:["p2",o]:null;var o},i:function(e){return e?Array.isArray(e)?((t="p2"===e[0]?e.slice(1):e)[0]||0)-(t[1]||0):e:0;var t}}}},t:b,tb:function(e,t){return function(n){return k(e,t)(U(n))}},te:function(e){return function(t){return U(t)===e}},te_:function(e,t){return function(n){return E(e,n)===t}},tg:function(e){return function(t){return U(t)>e}},tg_:function(e,t){return function(n){return E(e,n)>t}},tge:function(e){return function(t){return U(t)>=e}},tge_:function(e,t){return function(n){return E(e,n)>=t}},ti:z,tl:function(e){return function(t){return U(t)<e}},tl_:function(e,t){return function(n){return E(e,n)<t}},tle:function(e){return function(t){return U(t)<e}},tle_:function(e,t){return function(n){return E(e,n)<t}},tn:function(e){return function(t){return U(t)!==e}},tn_:function(e,t){return function(n){return E(e,n)!==t}},tw:function(e,t,n){var r=n||100,i=Math.ceil(t/r),o=function(e){return Math.floor(e/i)},s=function(e,n,r){var i;return[o(e.getTime()-t),(i={},i[o(n)]=r,i)]},a=function(t,n){var r=Math.max(t[0],n[0]),i=Object.keys(t[1]).filter((function(e){return e>=r})).concat(Object.keys(n[1]).filter((function(e){return e>=r}))).filter((function(e,t,n){return n.indexOf(e)===t})).reduce((function(r,i){var o=e.a.m(t[1][i]||e.a.z,n[1][i]||e.a.z);return o!==e.a.z&&(r[i]=o),r}),{});return[r,i]},u=[Number.NEGATIVE_INFINITY,{}],c=function(e){var t=function(t){return t.map((function(t){var n=f(t,3),r=n[0],i=(n[1],n[2]);return s(e.t,i,r)})).reduce(a,u)};return a(t(e.in),t(e.out))},l=function(t){if(void 0!==t.result)return l(t.result);if(void 0!==t.w)return l(c(t));var n=f(t,2),r=(n[0],n[1]),i=null,o={};for(var s in r){var a=e.d.m({result:r[s]});a&&Array.isArray(a)&&(i=a[0],o[s]=m(a.slice(1)))}return i&&[i,"w",t[0],o]};return{a:{m:function(e,t){var n=e.w?c(e):e;return a(n,t)},z:u},p:function(t,n){return s(t.getCurrentTime(),g(n,["time"],z),e.p(t,n))},r:function(t,n){var r=(n.w?c(n):n)[1];return e.r(t,Object.keys(r).reduce((function(t,n){return e.a.m(t,r[n])}),e.a.z))},d:e.d.tw||{l:function(t,n){var r=e.d.l(t,n),i=e.d.i(r,n);return r&&p([r[0],"w"],f(s(n.getCurrentTime(),g(t,["time"],z),i)),!1)},i:function(e,n){var r=Array.isArray(e)?e:[],i=n.getCurrentTime(),s=o(i.getTime()-t);return[r[2]||null,Object.keys(r[3]||{}).map((function(e){var t;return(t={})[e]=r[3][e],t})).reduce((function(e,t){return Object.keys(t).filter((function(e){return parseInt(e)>=s})).forEach((function(n){return e[n]=t[n]})),e}),{})]},m:e.d.m&&l}}},vgw:function(t,n,r,i){void 0===i&&(i=y);var o={v:0,k:0};return{a:{m:function(e,t){var n=e.k+t.k;return{v:n?e.v+t.k*(t.v-e.v)/n:0,k:n}},z:o},p:function(i,s){return g(s,["name"])===e(t)&&n(s)?{v:g(s,r),k:1}:o},r:function(e,t){return i(t.v)},d:{l:function(i){return g(i,["name"])===e(t)&&n(i)?0==(o=g(i,r))?["p3",1]:o<0?["p3",1,null,-o]:["p3",1,o]:null;var o},i:function(e){return e?Array.isArray(e)?{v:(((t=e.slice(1))[1]||0)-(t[2]||0))/(t[0]||1),k:t[0]||0}:void 0:o;var t}}}},vq:M,w:function(e){return function(n){return n===t(e)}},x:function(e){return function(n){return n!==t(e)}},y:function(e,t){return function(n){return h(n,e)===r[t]}},y_:function(e,t){return function(n){return g(n,e)===r[t]}},z:function(e,t){return function(n){return h(n,e)!==r[t]}},z_:function(e,t){return function(n){return g(n,e)!==r[t]}}}}()},249:function(e,t,n){var r;e.exports=(r=r||function(e,t){var r;if("undefined"!=typeof window&&window.crypto&&(r=window.crypto),"undefined"!=typeof self&&self.crypto&&(r=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(r=globalThis.crypto),!r&&"undefined"!=typeof window&&window.msCrypto&&(r=window.msCrypto),!r&&void 0!==n.g&&n.g.crypto&&(r=n.g.crypto),!r)try{r=n(480)}catch(e){}var i=function(){if(r){if("function"==typeof r.getRandomValues)try{return r.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof r.randomBytes)try{return r.randomBytes(4).readInt32LE()}catch(e){}}throw new Error("Native crypto module could not be used to get secure random number.")},o=Object.create||function(){function e(){}return function(t){var n;return e.prototype=t,n=new e,e.prototype=null,n}}(),s={},a=s.lib={},u=a.Base={extend:function(e){var t=o(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},c=a.WordArray=u.extend({init:function(e,n){e=this.words=e||[],this.sigBytes=n!=t?n:4*e.length},toString:function(e){return(e||f).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes,i=e.sigBytes;if(this.clamp(),r%4)for(var o=0;o<i;o++){var s=n[o>>>2]>>>24-o%4*8&255;t[r+o>>>2]|=s<<24-(r+o)%4*8}else for(var a=0;a<i;a+=4)t[r+a>>>2]=n[a>>>2];return this.sigBytes+=i,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=u.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],n=0;n<e;n+=4)t.push(i());return new c.init(t,e)}}),l=s.enc={},f=l.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],i=0;i<n;i++){var o=t[i>>>2]>>>24-i%4*8&255;r.push((o>>>4).toString(16)),r.push((15&o).toString(16))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new c.init(n,t/2)}},p=l.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],i=0;i<n;i++){var o=t[i>>>2]>>>24-i%4*8&255;r.push(String.fromCharCode(o))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new c.init(n,t)}},m=l.Utf8={stringify:function(e){try{return decodeURIComponent(escape(p.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return p.parse(unescape(encodeURIComponent(e)))}},d=a.BufferedBlockAlgorithm=u.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=m.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n,r=this._data,i=r.words,o=r.sigBytes,s=this.blockSize,a=o/(4*s),u=(a=t?e.ceil(a):e.max((0|a)-this._minBufferSize,0))*s,l=e.min(4*u,o);if(u){for(var f=0;f<u;f+=s)this._doProcessBlock(i,f);n=i.splice(0,u),r.sigBytes-=l}return new c.init(n,l)},clone:function(){var e=u.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),v=(a.Hasher=d.extend({cfg:u.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){d.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new v.HMAC.init(e,n).finalize(t)}}}),s.algo={});return s}(Math),r)},269:function(e,t,n){var r;e.exports=(r=n(249),function(){var e=r,t=e.lib.WordArray;function n(e,n,r){for(var i=[],o=0,s=0;s<n;s++)if(s%4){var a=r[e.charCodeAt(s-1)]<<s%4*2|r[e.charCodeAt(s)]>>>6-s%4*2;i[o>>>2]|=a<<24-o%4*8,o++}return t.create(i,o)}e.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,r=this._map;e.clamp();for(var i=[],o=0;o<n;o+=3)for(var s=(t[o>>>2]>>>24-o%4*8&255)<<16|(t[o+1>>>2]>>>24-(o+1)%4*8&255)<<8|t[o+2>>>2]>>>24-(o+2)%4*8&255,a=0;a<4&&o+.75*a<n;a++)i.push(r.charAt(s>>>6*(3-a)&63));var u=r.charAt(64);if(u)for(;i.length%4;)i.push(u);return i.join("")},parse:function(e){var t=e.length,r=this._map,i=this._reverseMap;if(!i){i=this._reverseMap=[];for(var o=0;o<r.length;o++)i[r.charCodeAt(o)]=o}var s=r.charAt(64);if(s){var a=e.indexOf(s);-1!==a&&(t=a)}return n(e,t,i)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),r.enc.Base64)},783:function(e,t,n){var r,i,o,s,a,u,c,l;e.exports=(l=n(249),i=(r=l).lib,o=i.WordArray,s=i.Hasher,a=r.algo,u=[],c=a.SHA1=s.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],i=n[1],o=n[2],s=n[3],a=n[4],c=0;c<80;c++){if(c<16)u[c]=0|e[t+c];else{var l=u[c-3]^u[c-8]^u[c-14]^u[c-16];u[c]=l<<1|l>>>31}var f=(r<<5|r>>>27)+a+u[c];f+=c<20?1518500249+(i&o|~i&s):c<40?1859775393+(i^o^s):c<60?(i&o|i&s|o&s)-1894007588:(i^o^s)-899497514,a=s,s=o,o=i<<30|i>>>2,i=r,r=f}n[0]=n[0]+r|0,n[1]=n[1]+i|0,n[2]=n[2]+o|0,n[3]=n[3]+s|0,n[4]=n[4]+a|0},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;return t[r>>>5]|=128<<24-r%32,t[14+(r+64>>>9<<4)]=Math.floor(n/4294967296),t[15+(r+64>>>9<<4)]=n,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e}}),r.SHA1=s._createHelper(c),r.HmacSHA1=s._createHmacHelper(c),l.SHA1)},480:()=>{}},u={};function c(e){var n=u[e];if(void 0!==n)return n.exports;var r=u[e]={exports:{}};return t[e].call(r.exports,r,r.exports,c),r.exports}c.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}();var l=c(234);e=l.env})();var t={"!UpdateLookalikeModels":["193216"],"!UpdateSecondPartyData":["180677","180678","180679","180680","180681","180682","180683","180684","180686","183817","183818","183819","183821","183822","183823","183824","183825","183826"],"!UpdateThirdPartyData":["188110","188140","188143","188158","188534","188536","188537","188538","188539","188540","188547","188548","188549","188648","189324","189325","189326","189327","189328"],Pageview:["184529","184559","184581","184848","186781","188110","188140","188143","188158","188534","188536","188537","188538","188539","188540","188547","188548","188549","188648","189291","189324","189325","189326","189327","189328","192639","192642","192643","192644","192651","192658","88584"],SegmentEntry:[],SegmentExit:[],SlotViewable:["184515"],StreamComplete:["184530","188745","190626"],StreamStart:["184283","188658","188737","188738","188740","188741","188743","188744","188745","188747","188748","188750","188751","188755","188758","189145","189147","189157","189158","189162","189164","189168","189200","189215","189217","189218","189219","189220","189222","189223","189225","189227","189228","190494","190496","190608","190612","190626","190635"]},n=["StreamStart","Pageview","StreamComplete"],r=e.frontDecode("Based on a Video Game\\t\\taction\\t1\\tdrenaline rush\\t10\\t-rush\\t2\\tventure\\t1\\tnimal behavior\\t8\\treeding\\t7\\theroes\\t7\\trescue\\t7\\ttraining\\t6\\t-heroes\\t7\\trescue\\t6\\ts\\t1\\tpocalyptic\\t1\\trt\\t3\\tificial intelligence & robots\\t10\\t-intelligence-robots\\t1\\tustralian open\\t10\\t-open\\t2\\ttomotive\\t\\tbafta nominated\\t5\\t-nominated\\t2\\tking\\t6\\t shows\\t2\\tseball\\t4\\td on a book\\t11\\tcomic book\\t11\\tplay\\t5\\t-on-a-book\\t11\\tcomic-book\\t11\\tplay\\t11\\tvideo-game\\t3\\tketball\\t1\\tlockbuster\\t1\\tmw\\t1\\tooks\\t1\\tuilding & renovation\\t2\\tsiness technology\\t8\\t-technology\\t2\\tying & selling\\t\\tcar\\t2\\tts\\t1\\thef\\t1\\tlassic warner bros.\\t7\\ts\\t2\\tothing\\t1\\tomedian\\t5\\ty\\t6\\t-drama\\t2\\tok-off\\t4\\ting\\t7\\t shows\\t1\\tricket\\t3\\tme\\t5\\t documentary\\t4\\tinals\\t3\\ttically acclaimed\\t10\\t-acclaimed\\t1\\tulinary travel\\t8\\t-travel\\t3\\tture\\t2\\tstom build\\t6\\t-build\\t1\\tyber tech\\t2\\tcling\\t7\\t *\\t8\\tshow\\t8\\ttrack\\t\\tdark & edgy\\t4\\t-comedy\\t5\\tedgy\\t1\\tiverse cast\\t7\\t-cast\\t2\\ty\\t1\\to-it-yourself\\t2\\tcumentaries\\t10\\ty\\t2\\tgs\\t1\\trama\\t1\\tystopian-drama\\t\\tengineering\\t2\\tsemble cast\\t8\\t-cast\\t1\\txtinct animal\\t8\\tspecies\\t7\\t-animal\\t3\\treme jobs\\t7\\t-jobs\\t\\tfamily\\t6\\t content\\t6\\t-content\\t2\\tntasy\\t2\\tshion & style\\t8\\taccessory\\t8\\tdesigner\\t8\\tindustry\\t8\\tmodeling\\t7\\t-accessory\\t8\\tdesigner\\t8\\tindustry\\t8\\tmodeling\\t8\\tstyle\\t1\\terrari\\t1\\titness\\t1\\tood\\t3\\ttball\\t8\\t (soccer)\\t9\\t*\\t2\\trmula e\\t7\\t-e\\t\\tgardening\\t1\\thost\\t1\\tolden globe nominated\\t13\\twinning\\t6\\t-globe-nominated\\t13\\twin\\t3\\tf\\t1\\trand slam\\t\\thaunted\\t1\\tealth\\t1\\tome\\t2\\trror\\t\\ticonic villain\\t6\\t-villain\\t1\\tsland\\t\\tjourneys & transformations\\t8\\t-transformations\\t\\tkids\\t\\tlife off the grid\\t4\\t-off-the-grid\\t4\\tstyle\\t\\tmagic\\t1\\tedical marvels\\t2\\trcedes-benz\\t1\\tlb\\t1\\tockumentary\\t2\\tto gp\\t4\\t-gp\\t4\\tcross\\t4\\trcycle\\t10\\ts\\t5\\tsports\\t2\\tuntain climbing\\t8\\t-climbing\\t2\\tvie\\t1\\tuseum\\t3\\tic\\t1\\tysteries\\t\\tnature\\t6\\t documentaries\\t6\\t-documentaries\\t1\\tba\\t1\\tews\\t\\torigin story\\t6\\t-story\\t1\\tscar nominated\\t5\\t-nominated\\t1\\tuter space\\t\\tparanormal\\t10\\t & unexplained\\t1\\teriod-drama\\t2\\tt-care\\t4\\tfood\\t3\\ts\\t1\\tga tour\\t3\\t-tour\\t1\\tlot twist\\t4\\t-twist\\t1\\torsche\\t1\\tremier league\\t7\\t-league\\t7\\tship\\t2\\tison\\t\\treality\\t2\\tstaurant\\t10\\ts\\t4\\toration & repair\\t11\\t-repair\\t1\\tock climbing\\t4\\t-climbing\\t2\\tland garros\\t6\\t-garros\\t2\\tmance\\t1\\tugby\\t\\tsatires & parodies\\t7\\t-parodies\\t1\\tcandals & lies\\t8\\t-lies\\t2\\ti-fi\\t3\\tence\\t7\\t fiction\\t7\\t-fiction\\t2\\tulpture\\t1\\tpace\\t5\\t & beyond\\t6\\texploration\\t6\\ttravel\\t2\\ties & agents\\t5\\t-agents\\t3\\tnoffs\\t2\\tort\\t5\\ts\\t1\\ttation wagon\\t7\\t-wagon\\t2\\trong female lead\\t6\\t-female-lead\\t1\\tuperbike\\t5\\theroes\\t5\\tnatural\\t2\\trvival\\t6\\te this\\t2\\tspense\\t\\ttechnology & inventions\\t10\\t-inventions\\t2\\ten-drama\\t2\\tnnis\\t6\\t *\\t7\\tgrand slam\\t1\\theme restaurant\\t5\\t-restaurant\\t2\\triller\\t8\\ts\\t1\\tour de france\\t4\\t-de-france\\t1\\transportation\\t3\\tvel\\t2\\teasure hunting\\t8\\t-hunting\\t\\tuefa europa conference league\\t1\\tnexplained-phenomena\\t1\\ts open\\t2\\t-open\\t\\tvehicle customization\\t8\\tparts and accessories\\t8\\trestoration\\t7\\t-restoration\\t\\twatch as a family\\t5\\t-as-a-family\\t1\\timbledon\\t\\tyoung adult lead\\t5\\t-adult-lead"),i=[["alternateId"],["isTestData"],["kind"],["client","domain"],["page","type"]],o=[],s=[e.o([e.s_(["name"],17),e.s_(["name"],180),e.s_(["name"],216),e.s_(["name"],217),e.s_(["name"],230),e.s_(["name"],238)]),e.o([e.s_(0,47),e.s_(0,185)]),e.o([e.s_(0,28),e.s_(0,29),e.s_(0,30),e.s_(0,35)]),e.o([e.s_(0,45),e.s_(0,97),e.s_(0,98),e.s_(0,99),e.s_(0,100),e.s_(0,101)]),e.o([e.s_(["name"],24),e.s_(["name"],134)]),e.o([e.s_(0,146)]),e.af_u(["properties","video","genres"],e.ref(24)),e.o([e.s_(0,18),e.s_(0,181),e.s_(0,215),e.s_(0,231),e.s_(0,238)]),e.o([e.s_(0,103),e.s_(0,119)]),e.o([e.s_(["name"],116),e.s_(["name"],164)]),e.o([e.s_(0,64),e.s_(0,223)]),e.o([e.s_(["name"],14),e.s_(["name"],60),e.s_(["name"],145),e.s_(["name"],192)]),e.o([e.s_(["name"],2),e.s_(["name"],4),e.s_(["name"],86),e.s_(["name"],125),e.s_(["name"],128),e.s_(["name"],142),e.s_(["name"],178),e.s_(["name"],226)]),e.o([e.s_(0,78)]),e.o([e.s_(["name"],103),e.s_(["name"],119)]),e.o([e.s_(["name"],47),e.s_(["name"],184)]),e.o([e.s_(0,116),e.s_(0,165)]),e.o([e.s_(["name"],146)]),e.o([e.s_(["name"],2),e.s_(["name"],4),e.s_(["name"],124),e.s_(["name"],125),e.s_(["name"],128),e.s_(["name"],142),e.s_(["name"],148),e.s_(["name"],178),e.s_(["name"],209),e.s_(["name"],210)]),e.o([e.s_(["name"],25),e.s_(["name"],26),e.s_(["name"],27),e.s_(["name"],35)]),e.o([e.s_(["name"],1)]),e.o([e.s_(0,14),e.s_(0,60),e.s_(0,145),e.s_(0,192)]),e.o([e.s_(0,32),e.s_(0,151)]),e.o([e.s_(["name"],149),e.s_(["name"],225)]),e.o([e.s_(["name"],78)]),e.o([e.s_(0,150),e.s_(0,225)]),e.o([e.s_(0,105),e.s_(0,170),e.s_(0,171)]),e.o([e.s_(["name"],45),e.s_(["name"],92),e.s_(["name"],93),e.s_(["name"],94),e.s_(["name"],95),e.s_(["name"],96)])],a=[t=>e.q(e.cb(t,e.pe(1,!0),e.ge(1),1)),t=>e.q(e.cb(t,e.t,e.ge(1),1)),t=>e.q(e.ocqs(t)),(t,n,r,i)=>e.q(e.ocqs([e.cb(0,e.af_u(["properties","video","taxonomies"],e.ref(t)),e.ge(1),1),e.cb(0,e.af_u(["properties","video","taxonomies"],e.ref(n)),e.ge(1),1),e.cb(0,e.af_u(["properties","video","genres"],e.ref(r)),e.ge(1),1),e.cb(0,e.af_u(["properties","video","genres"],e.ref(i)),e.ge(1),1)])),(t,n,r,i,o)=>e.q(e.ocqs([e.cb(0,e.af_u(["properties","video","taxonomies"],e.o(n)),e.ge(1),1),e.cb(t,e.af_u(["properties","video","taxonomies"],e.o(r)),e.ge(1),1),e.cb(0,e.af_u(["properties","video","genres"],e.o(i)),e.ge(1),1),e.cb(0,e.af_u(["properties","video","genres"],e.o(o)),e.ge(1),1)])),(t,n,r,i,o,s,a,u,c,l,f,p,m,d,v,g,_,h,y,b,w,I,S,G,k,z,U,E,P,x,A,O,D,T,C,q,M,R,F,j,Y,$,N,L,B,Q,H,K,V,W,J,X,Z,ee,te,ne,re,ie,oe,se,ae,ue,ce,le,fe,pe)=>e.q(e.ocqs([e.cb(1,e.pe(le,fe),e.ge(pe),1),e.itp(t,n,!1,r),e.itp(i,o,s,a),e.itp(u,c,l,f),e.itp(p,m,d,v),e.itp(g,_,h,y),e.itp(b,w,I,S),e.itp(G,k,z,U),e.itp(E,P,x,A),e.itp(O,D,T,C),e.itp(q,M,R,F),e.itp(j,Y,$,N),e.itp(L,B,Q,H),e.itp(K,V,W,J),e.itp(X,Z,ee,te),e.itp(ne,re,ie,oe),e.itp(se,ae,ue,ce)])),(t,n,r,i,o,s,a,u,c,l,f,p,m,d,v,g,_,h,y,b,w,I,S,G,k,z,U,E,P,x,A,O,D,T,C,q,M,R,F,j,Y,$,N,L,B,Q,H,K,V,W,J,X,Z,ee,te,ne,re,ie,oe,se,ae,ue,ce,le,fe,pe,me,de,ve,ge,_e,he,ye,be,we,Ie,Se,Ge,ke,ze,Ue,Ee,Pe,xe,Ae)=>e.q(e.ocqs([e.cb(1,e.pe(Pe,xe),e.ge(Ae),1),e.itp(t,n,!1,r),e.itp(i,o,!1,s),e.itp(a,u,c,l),e.itp(f,p,m,d),e.itp(v,g,_,h),e.itp(y,b,w,I),e.itp(S,G,k,z),e.itp(U,E,P,x),e.itp(A,O,D,T),e.itp(C,q,M,R),e.itp(F,j,Y,$),e.itp(N,L,B,Q),e.itp(H,K,V,W),e.itp(J,X,Z,ee),e.itp(te,ne,re,ie),e.itp(oe,se,ae,ue),e.itp(ce,le,fe,pe),e.itp(me,de,ve,ge),e.itp(_e,he,ye,be),e.itp(we,Ie,Se,Ge),e.itp(ke,ze,Ue,Ee)])),(t,n,r,i,o,s,a,u,c,l,f,p,m,d,v,g,_,h,y,b,w,I,S,G,k,z,U,E,P,x,A,O,D,T,C,q,M,R,F,j,Y,$,N,L,B,Q,H,K,V,W,J,X,Z,ee,te,ne,re,ie,oe,se,ae,ue,ce,le,fe,pe,me,de,ve,ge,_e,he,ye,be,we,Ie,Se,Ge)=>e.q(e.ocqs([e.cb(1,e.pe(1,!1),e.ge(1),1),e.itp(t,n,!1,r),e.itp(i,o,!1,s),e.itp(a,u,!1,c),e.itp(l,f,!1,p),e.itp(m,d,!1,v),e.itp(g,_,!1,h),e.itp(y,b,!1,w),e.itp(I,S,!1,G),e.itp("eyeota_experian",k,!1,z),e.itp(U,E,!1,P),e.itp("eyeota_bombora",x,!1,A),e.itp("eyeota_experian",O,!1,D),e.itp(T,C,!1,q),e.itp(M,R,!1,F),e.itp(j,Y,!1,$),e.itp(N,L,!1,B),e.itp(Q,H,!1,K),e.itp(V,W,!1,J),e.itp(X,Z,!1,ee),e.itp(te,ne,!1,re),e.itp(ie,oe,!1,se),e.itp(ae,ue,!1,ce),e.itp(le,fe,!1,pe),e.itp(me,de,!1,ve),e.itp(ge,_e,!1,he),e.itp(ye,be,!1,we),e.itp(Ie,Se,!1,Ge)])),(t,n,r,i,o,s,a,u,c,l,f,p,m,d,v,g,_,h,y,b,w,I,S,G,k,z,U,E,P,x,A,O,D,T,C,q,M,R,F,j,Y)=>e.q(e.ocqs([e.cb(1,e.pe(1,!1),e.ge(1),1),e.itp(t,n,!1,r),e.itp(i,o,!1,s),e.itp(a,u,!1,c),e.itp(l,f,!1,p),e.itp(m,d,!1,v),e.itp(g,_,!1,h),e.itp(y,b,!1,w),e.itp("eyeota",I,!1,S),e.itp(G,k,!1,z),e.itp(U,E,!1,P),e.itp(x,A,!1,O),e.itp(D,T,!1,C),e.itp(q,M,!1,R),e.itp(F,j,!1,Y)])),(t,n,r,i,o,s,a,u,c,l,f,p,m,d,v,g,_,h,y,b,w,I,S,G,k,z,U,E,P,x,A,O,D,T,C,q,M,R,F,j,Y,$,N,L,B,Q,H,K,V,W,J,X,Z,ee,te,ne,re,ie,oe,se)=>e.q(e.ocqs([e.cb(1,e.pe(1,!1),e.ge(1),1),e.itp(t,n,!1,r),e.itp(i,o,!1,s),e.itp("eyeota",a,!1,u),e.itp(c,l,!1,f),e.itp(p,m,!1,d),e.itp(v,g,!1,_),e.itp(h,y,!1,b),e.itp(w,I,!1,S),e.itp(G,k,!1,z),e.itp(U,E,!1,P),e.itp(x,A,!1,O),e.itp(D,T,!1,C),e.itp(q,M,!1,R),e.itp(F,j,!1,Y),e.itp($,N,!1,L),e.itp(B,Q,!1,H),e.itp(K,V,!1,W),e.itp(J,X,!1,Z),e.itp(ee,te,!1,ne),e.itp("liveramp_AudienceElements","1001850346",!1,re),e.itp(ie,oe,!1,se)])),(t,n,r,i,o,s,a,u,c,l,f,p,m,d,v,g,_,h,y,b,w,I,S,G,k,z,U,E,P,x,A,O,D,T,C,q,M,R,F,j,Y,$)=>e.q(e.ocqs([e.cb(1,e.pe(1,!1),e.ge(1),1),e.itp(t,n,!1,r),e.itp("eyeota_experian",i,!1,o),e.itp("eyeota",s,!1,a),e.itp(u,c,!1,l),e.itp("eyeota",f,!1,p),e.itp(m,d,!1,v),e.itp("eyeota","35290",!1,g),e.itp(_,h,!1,y),e.itp(b,w,!1,I),e.itp(S,G,!1,k),e.itp(z,U,!1,E),e.itp(P,x,!1,A),e.itp(O,D,!1,T),e.itp(C,q,!1,M),e.itp("liveramp_Acxiom",R,!1,F),e.itp(j,Y,!1,$)])),(t,n,r,i,o,s,a)=>e.q(e.ocqs([e.tw(e.cb(0,e.af_u(n,r),e.ge(1),1),24192e5),e.tw(e.cb(0,e.af_u(i,e.o(a)),e.ge(1),1),24192e5),e.tw(e.cb(t,e.af_u(o,s),e.ge(1),1),24192e5)])),(t,n,r,i,o,s,a,u,c,l,f,p)=>e.q(e.ocqs([e.tw(e.cb(0,e.af_u(["properties","video","genres"],e.o(t)),e.ge(1),1),24192e5),e.tw(e.cb(0,e.af_u(["properties","video","taxonomies"],e.o([e.s_(0,n),e.s_(0,r),e.s_(0,i),e.s_(0,o),e.s_(0,s)])),e.ge(1),1),24192e5),e.tw(e.cb(0,e.af_u(["properties","video","taxonomies"],e.o([e.s_(["name"],a),e.s_(["name"],u),e.s_(["name"],c),e.s_(["name"],l),e.s_(["name"],f),e.s_(["name"],p)])),e.ge(1),1),24192e5)])),(t,n,r,i,o,s,a,u,c,l,f,p,m,d,v,g,_,h)=>e.q(e.ocqs([e.tw(e.cb(0,e.af_u(["properties","video","genres"],e.o(c)),e.ge(o),t),24192e5),e.tw(e.cb(0,e.af_u(["properties","video","genres"],e.o([e.s_(["name"],p),e.s_(["name"],m),e.s_(["name"],d),e.s_(["name"],v),e.s_(["name"],g),e.s_(["name"],_),e.s_(["name"],h)])),e.ge(s),n),24192e5),e.tw(e.cb(0,e.af_u(["properties","video","taxonomies"],e.o(l)),e.ge(a),r),24192e5),e.tw(e.cb(0,e.af_u(["properties","video","taxonomies"],e.o(f)),e.ge(u),i),24192e5)])),(t,n,r,i)=>e.q(e.ocqs([e.tw(e.cb(0,e.af_u(["properties","video","taxonomies"],e.ref(t)),e.ge(3),3),24192e5),e.tw(e.cb(0,e.af_u(["properties","video","genres"],e.o(r)),e.ge(3),3),24192e5),e.tw(e.cb(0,e.af_u(["properties","video","taxonomies"],e.o(i)),e.ge(3),3),24192e5),e.tw(e.cb(0,e.af_u(["properties","video","genres"],e.ref(n)),e.ge(3),3),24192e5)])),(t,n,r,i)=>e.q(e.ocqs([e.tw(e.cb(0,e.af_u(["properties","video","taxonomies"],e.ref(t)),e.ge(3),3),24192e5),e.tw(e.cb(0,e.af_u(["properties","video","taxonomies"],e.ref(n)),e.ge(3),3),24192e5),e.tw(e.cb(0,e.af_u(["properties","video","genres"],e.ref(r)),e.ge(3),3),24192e5),e.tw(e.cb(0,e.af_u(["properties","video","genres"],e.ref(i)),e.ge(3),3),24192e5)])),(t,n,r,i,o,s,a,u,c,l,f,p)=>e.q(e.ocqs([e.tw(e.cb(0,e.af_u(["properties","video","taxonomies"],e.ref(c)),e.ge(o),t),24192e5),e.tw(e.cb(0,e.af_u(["properties","video","genres"],e.ref(f)),e.ge(s),n),24192e5),e.tw(e.cb(0,e.af_u(["properties","video","taxonomies"],e.ref(p)),e.ge(a),r),24192e5),e.tw(e.cb(0,e.af_u(["properties","video","genres"],e.ref(l)),e.ge(u),i),24192e5)])),(t,n,r,i)=>e.q(e.ocqs([e.tw(e.cb(0,e.af_u(["properties","video","taxonomies"],e.o(t)),e.ge(3),3),24192e5),e.tw(e.cb(0,e.af_u(["properties","video","taxonomies"],e.o(n)),e.ge(3),3),24192e5),e.tw(e.cb(0,e.af_u(["properties","video","genres"],e.o(r)),e.ge(3),3),24192e5),e.tw(e.cb(0,e.af_u(["properties","video","genres"],e.o(i)),e.ge(3),3),24192e5)])),(t,n,r,i,o,s,a,u,c,l,f,p)=>e.q(e.ocqs([e.tw(e.cb(0,e.af_u(["properties","video","taxonomies"],e.o(t)),e.ge(3),3),24192e5),e.tw(e.cb(0,e.af_u(["properties","video","taxonomies"],e.o(n)),e.ge(3),3),24192e5),e.tw(e.cb(0,e.af_u(["properties","video","genres"],e.o([e.s_(["name"],i),e.s_(["name"],o),e.s_(["name"],s),e.s_(["name"],a),e.s_(["name"],u),e.s_(["name"],c),e.s_(["name"],l),e.s_(["name"],f),e.s_(["name"],p)])),e.ge(3),3),24192e5),e.tw(e.cb(0,e.af_u(["properties","video","genres"],e.o(r)),e.ge(3),3),24192e5)])),(t,n,r,i,o,s,a,u,c,l,f,p)=>e.q(e.ocqs([e.tw(e.cb(0,e.af_u(["properties","video","taxonomies"],e.s_(0,f)),e.ge(o),t),24192e5),e.tw(e.cb(0,e.af_u(["properties","video","genres"],s),e.ge(a),n),24192e5),e.tw(e.cb(0,e.af_u(["properties","video","taxonomies"],u),e.ge(c),r),24192e5),e.tw(e.cb(0,e.af_u(["properties","video","genres"],e.s_(0,p)),e.ge(l),i),24192e5)])),(t,n)=>e.q(e.isp("discovery_dplusemea",t,!1,n)),(t,n)=>e.q(e.isp("discovery_dplusemeatest",t,!1,n)),(t,n,r,i,o)=>e.q(e.tw(e.cb(n,r,i,o),t)),(t,n,r,i)=>e.q(e.tw(e.cb(1,e.a(i),n,r),t)),t=>e.q(e.tw(e.cb(1,e.a([e.pe(1,!1),e.af_u(["properties","page","taxonomies"],e.o(t))]),e.ge(3),3),7776e6)),t=>e.q(e.tw(e.cb(1,e.a([e.pe(1,!1),e.af_u(["properties","page","taxonomies"],e.e_(["name"],t))]),e.ge(3),3),7776e6)),()=>e.q(e.tw(e.cb(1,e.a([e.pe(1,!1),e.af_u(["properties","page","taxonomies"],e.e_(["name"],"tennis"))]),e.ge(3),3),7776e6))];return{rawQueries:{180677:e.r(21,"A100","180677"),180678:e.r(21,"A101","180678"),180679:e.r(21,"A102","180679"),180680:e.r(21,"A103","180680"),180681:e.r(21,"A104","180681"),180682:e.r(21,"A105","180682"),180683:e.r(21,"M100","180683"),180684:e.r(21,"F200","180684"),180686:e.r(21,"O300","180686"),183817:e.r(20,"F200","183817"),183818:e.r(20,"M100","183818"),183819:e.r(20,"A105","183819"),183821:e.r(20,"A104","183821"),183822:e.r(20,"A103","183822"),183823:e.r(20,"A102","183823"),183824:e.r(20,"A101","183824"),183825:e.r(20,"A100","183825"),183826:e.r(20,"O300","183826"),184283:e.r(1,0),184515:e.r(22,36e5,"SlotViewable",e.t,e.ge(2),2),184529:e.r(0,1),184530:e.r(0,2),184559:e.q(e.cb(1,e.pe(1,!1),e.ge(2),2)),184581:e.r(23,18e5,e.ge(3),3,[e.pe(1,!1),e.pe(4,"story"),e.af_i(["properties","page","taxonomies"],e.e_(["name"],"football"),e.y_(2,200))]),184848:e.r(26),186781:e.r(23,2592e6,e.ge(3),3,[e.pe(1,!1),e.af_u(["properties","page","taxonomies"],e.e_(["name"],"football"))]),188110:e.r(2,[e.cb(1,e.pe(1,!1),e.ge(1),1),e.itp("eyeota_bombora","13904",!1,"188110"),e.itp("eyeota_dunbradstreet","20705",!1,"188110"),e.itp("eyeota","6541",!1,"188110"),e.itp("eyeota","6555",!1,"188110"),e.itp("eyeota","6564",!1,"188110"),e.itp("eyeota_dunbradstreet","20907",!1,"188110")]),188140:e.r(2,[e.cb(1,e.pe(1,!1),e.ge(1),1),e.itp("eyeota","6555",!1,"188140"),e.itp("eyeota","6564",!1,"188140"),e.itp("eyeota_dunbradstreet","20907",!1,"188140"),e.itp("eyeota_dunbradstreet","20879",!1,"188140"),e.itp("eyeota","34899",!1,"188140"),e.itp("eyeota_dunbradstreet","20880",!1,"188140"),e.itp("eyeota_dunbradstreet","20889",!1,"188140"),e.itp("eyeota_dunbradstreet","20881",!1,"188140"),e.itp("eyeota_dunbradstreet","20883",!1,"188140"),e.itp("eyeota_dunbradstreet","20942",!1,"188140"),e.itp("eyeota","34896",!1,"188140"),e.itp("eyeota_dunbradstreet","21007",!1,"188140")]),188143:e.r(10,"eyeota_bombora","13911","188143","27992","188143","6630","188143","liveramp_Acxiom","1005523869","188143","13119","188143","eyeota_dunbradstreet","27974","188143","188143","eyeota","35050","188143","eyeota_dunbradstreet","20743","188143","eyeota","35855","188143","liveramp_Acxiom","300068499","188143","eyeota","258","188143","eyeota_experian","21659","188143","eyeota","35550","188143","1005523869","188143","eyeota_experian","8795","188143"),188158:e.r(10,"liveramp_Acxiom","1005523739","188158","27629","188158","276","188158","liveramp_Epsilon","1000996619","188158","6642","188158","eyeota","35162","188158","188158","liveramp_Epsilon","1005045809","188158","eyeota_bombora","14110","188158","liveramp_Epsilon","1000997659","188158","liveramp_Epsilon","1000993599","188158","eyeota_dunbradstreet","20827","188158","liveramp_Acxiom","300397999","188158","liveramp_Acxiom","300304599","188158","300338499","188158","eyeota","35842","188158"),188534:e.r(5,"eyeota","6533","188534","eyeota_dunbradstreet","20701",!1,"188534","eyeota_bombora","13899",!1,"188534","eyeota_bombora","13899",!1,"188534","eyeota_dunbradstreet","20889",!1,"188534","eyeota","6565",!1,"188534","eyeota_dunbradstreet","20878",!1,"188534","eyeota_dunbradstreet","20757",!1,"188534","eyeota","34867",!1,"188534","eyeota","6565",!1,"188534","eyeota","34902",!1,"188534","eyeota","6563",!1,"188534","eyeota_dunbradstreet","20903",!1,"188534","eyeota","6565",!1,"188534","eyeota_dunbradstreet","20896",!1,"188534","eyeota_dunbradstreet","20890",!1,"188534",1,!1,1),188536:e.r(7,"eyeota","1603","188536","liveramp_Acxiom","300144699","188536","liveramp_Epsilon","1000993549","188536","liveramp_Epsilon","1000993159","188536","liveramp_Acxiom","300060599","188536","eyeota","35022","188536","liveramp_Acxiom","300066499","188536","eyeota_dunbradstreet","27946","188536","27989","188536","eyeota_experian","42050","188536","14204","188536","41464","188536","eyeota_roymorgan","40738","188536","liveramp_Epsilon","1001002659","188536","liveramp_Epsilon","1001001219","188536","liveramp_Epsilon","1001002619","188536","eyeota_experian","41329","188536","eyeota_experian","41475","188536","liveramp_Epsilon","1001004019","188536","eyeota_experian","41484","188536","eyeota_bombora","14077","188536","eyeota_experian","30076","188536","eyeota_experian","39492","188536","eyeota_experian","27424","188536","eyeota_experian","27426","188536","eyeota_experian","27427","188536","liveramp_Epsilon","1000463986","188536"),188537:e.r(7,"liveramp_Acxiom","1003643819","188537","eyeota_stirista","32926","188537","liveramp_Acxiom","1005523959","188537","eyeota","35714","188537","eyeota","13226","188537","eyeota_dunbradstreet","39095","188537","eyeota_dunbradstreet","39089","188537","eyeota_stirista","32927","188537","28024","188537","liveramp_Epsilon","1000992939","188537","13829","188537","27449","188537","liveramp_Acxiom","300398499","188537","eyeota_dunbradstreet","27976","188537","liveramp_Acxiom","300543499","188537","eyeota","35281","188537","eyeota","35308","188537","eyeota_bombora","14192","188537","eyeota","35253","188537","eyeota_dunbradstreet","21068","188537","eyeota_dunbradstreet","21067","188537","eyeota_dunbradstreet","21062","188537","eyeota_dunbradstreet","21061","188537","eyeota_bombora","14145","188537","eyeota","35248","188537","eyeota_bombora","14148","188537","eyeota_bombora","14160","188537"),188538:e.r(2,[e.cb(1,e.pe(1,!1),e.ge(1),1),e.itp("liveramp_Acxiom","1005525609",!1,"188538"),e.itp("eyeota_roymorgan","40918",!1,"188538"),e.itp("eyeota_roymorgan","40912",!1,"188538"),e.itp("eyeota_roymorgan","40920",!1,"188538"),e.itp("eyeota_roymorgan","40919",!1,"188538"),e.itp("eyeota","13439",!1,"188538"),e.itp("eyeota_experian","22961",!1,"188538"),e.itp("liveramp_Epsilon","1000467376",!1,"188538"),e.itp("liveramp_Epsilon","1000467386",!1,"188538"),e.itp("eyeota","6739",!1,"188538"),e.itp("liveramp_Acxiom","1005525609",!1,"188538")]),188539:e.r(2,[e.cb(1,e.pe(1,!1),e.ge(1),1),e.itp("eyeota","13139",!1,"188539"),e.itp("liveramp_Epsilon","1000455756",!1,"188539"),e.itp("liveramp_Epsilon","1000998179",!1,"188539"),e.itp("eyeota","1516",!1,"188539"),e.itp("eyeota","1613",!1,"188539"),e.itp("eyeota_experian","21667",!1,"188539"),e.itp("eyeota","35629",!1,"188539"),e.itp("liveramp_Acxiom","300158999",!1,"188539"),e.itp("liveramp_Acxiom","300158799",!1,"188539"),e.itp("liveramp_Epsilon","1000983789",!1,"188539"),e.itp("liveramp_Acxiom","300479399",!1,"188539"),e.itp("liveramp_Acxiom","300149799",!1,"188539"),e.itp("liveramp_Acxiom","300170699",!1,"188539"),e.itp("eyeota","35614",!1,"188539"),e.itp("eyeota","1620",!1,"188539"),e.itp("liveramp_Acxiom","300618399",!1,"188539"),e.itp("liveramp_Epsilon","1005044779",!1,"188539"),e.itp("liveramp_Acxiom","300618799",!1,"188539"),e.itp("liveramp_Epsilon","1000993209",!1,"188539"),e.itp("eyeota","35325",!1,"188539"),e.itp("liveramp_Acxiom","300171399",!1,"188539"),e.itp("liveramp_Acxiom","300171399",!1,"188539"),e.itp("liveramp_Acxiom","300339999",!1,"188539"),e.itp("eyeota","13154",!1,"188539"),e.itp("eyeota","35327",!1,"188539"),e.itp("liveramp_Epsilon","1000994209",!1,"188539"),e.itp("eyeota_experian","27982",!1,"188539"),e.itp("liveramp_Acxiom","300635599",!1,"188539"),e.itp("eyeota","1624",!1,"188539"),e.itp("eyeota","1615",!1,"188539"),e.itp("eyeota","6779",!1,"188539"),e.itp("eyeota","1614",!1,"188539"),e.itp("eyeota_bombora","14377",!1,"188539"),e.itp("eyeota","35627",!1,"188539"),e.itp("liveramp_AudienceElements","1001851826",!1,"188539")]),188540:e.r(6,"liveramp_Acxiom","300729199","188540","liveramp_Acxiom","300729199","188540","liveramp_Acxiom","300146199",!1,"188540","eyeota_experian","8813",!1,"188540","eyeota","1634",!1,"188540","eyeota_bombora","14379",!1,"188540","liveramp_Epsilon","1000455766",!1,"188540","liveramp_Acxiom","300347699",!1,"188540","eyeota","1632",!1,"188540","liveramp_Acxiom","1251",!1,"188540","liveramp_Acxiom","300729199",!1,"188540","eyeota_experian","30485",!1,"188540","eyeota_roymorgan","40814",!1,"188540","liveramp_AudienceElements","1001851636",!1,"188540","liveramp_Acxiom","1003645799",!1,"188540","liveramp_Epsilon","1000466666",!1,"188540","liveramp_Acxiom","4111",!1,"188540","eyeota","1659",!1,"188540","eyeota_experian","27551",!1,"188540","liveramp_Acxiom","480320087",!1,"188540","liveramp_Acxiom","1005524389",!1,"188540",1,!1,1),188547:e.r(2,[e.cb(1,e.pe(1,!1),e.ge(1),1),e.itp("eyeota_bombora","14059",!1,"188547"),e.itp("eyeota","6633",!1,"188547"),e.itp("eyeota_bombora","14059",!1,"188547"),e.itp("eyeota","6586",!1,"188547"),e.itp("eyeota_bombora","13927",!1,"188547"),e.itp("eyeota_dunbradstreet","20765",!1,"188547"),e.itp("eyeota_experian","27450",!1,"188547"),e.itp("eyeota","35080",!1,"188547"),e.itp("eyeota","6534",!1,"188547"),e.itp("eyeota","34869",!1,"188547"),e.itp("liveramp_Epsilon","1005785991",!1,"188547"),e.itp("eyeota","34869",!1,"188547"),e.itp("eyeota_dunbradstreet","39083",!1,"188547"),e.itp("eyeota_dunbradstreet","39084",!1,"188547"),e.itp("liveramp_Acxiom","300130899",!1,"188547"),e.itp("eyeota_experian","21313",!1,"188547"),e.itp("liveramp_Acxiom","300130899",!1,"188547")]),188548:e.r(2,[e.cb(1,e.pe(1,!1),e.ge(1),1),e.itp("eyeota_dunbradstreet","20773",!1,"188548"),e.itp("eyeota_bombora","13832",!1,"188548"),e.itp("eyeota","6634",!1,"188548"),e.itp("eyeota","35086",!1,"188548"),e.itp("eyeota_bombora","14064",!1,"188548"),e.itp("eyeota_dunbradstreet","27975",!1,"188548"),e.itp("eyeota_experian","27624",!1,"188548"),e.itp("eyeota_bombora","14266",!1,"188548"),e.itp("liveramp_Acxiom","300122999",!1,"188548"),e.itp("eyeota","34881",!1,"188548"),e.itp("liveramp_Acxiom","300148999",!1,"188548"),e.itp("liveramp_Acxiom","1519020910",!1,"188548"),e.itp("eyeota","6715",!1,"188548"),e.itp("liveramp_Acxiom","300509799",!1,"188548"),e.itp("liveramp_Acxiom","1003801429",!1,"188548"),e.itp("eyeota_experian","21321",!1,"188548"),e.itp("eyeota_bombora","13836",!1,"188548"),e.itp("liveramp_Acxiom","300122099",!1,"188548")]),188549:e.r(8,"eyeota_bombora","14266","188549","eyeota_dunbradstreet","27975","188549","eyeota_bombora","13970","188549","eyeota","35087","188549","liveramp_Acxiom","802360285","188549","liveramp_Acxiom","121801014","188549","eyeota","6510","188549","6600","188549","liveramp_Acxiom","300068199","188549","eyeota","35089","188549","eyeota_bombora","14066","188549","eyeota_bombora","13962","188549","eyeota","35088","188549","eyeota_dunbradstreet","20918","188549"),188648:e.r(2,[e.cb(1,e.pe(1,!1),e.ge(1),1),e.itp("eyeota_roymorgan","40872",!1,"188648"),e.itp("eyeota_experian","22594",!1,"188648"),e.itp("eyeota_bombora","14276",!1,"188648"),e.itp("eyeota_roymorgan","17263",!1,"188648"),e.itp("eyeota_experian","22596",!1,"188648"),e.itp("eyeota_experian","28024",!1,"188648"),e.itp("eyeota_experian","22597",!1,"188648"),e.itp("liveramp_Acxiom","300171099",!1,"188648"),e.itp("eyeota","6591",!1,"188648"),e.itp("eyeota","35282",!1,"188648"),e.itp("liveramp_Acxiom","300324899",!1,"188648"),e.itp("eyeota_bombora","14174",!1,"188648"),e.itp("eyeota_roymorgan","40864",!1,"188648"),e.itp("eyeota","1504",!1,"188648"),e.itp("liveramp_Epsilon","1000466996",!1,"188648")]),188658:e.r(22,24192e5,0,e.af_u(["properties","video","genres"],e.s_(2,"true-crime"),e.o([e.s_(["name"],"british crime"),e.s_(["name"],"celebrity crime"),e.s_(["name"],54),e.s_(["name"],"crimes & misdemeanors"),e.s_(["name"],"family crime"),e.s_(["name"],"notorious crimes"),e.s_(["name"],"true crime"),e.s_(["name"],"unsolved crime")])),e.ge(1),1),188737:e.q(e.ocqs([e.tw(e.cb(0,e.af_u(["properties","video","genres"],e.s_(2,47)),e.ge(1),1),24192e5),e.tw(e.cb(0,e.af_u(["properties","video","genres"],e.o([e.s_(["name"],46),e.s_(["name"],47),e.s_(["name"],184)])),e.ge(1),1),24192e5),e.tw(e.cb(0,e.af_u(["properties","video","genres"],e.o([e.y_(0,185),e.e_(0,"stand-up-comedy"),e.e_(0,"romantic-comedy"),e.e_(0,"musical-comedy"),e.e_(0,"action-comedy"),e.y_(0,69),e.e_(0,"teen-comedy"),e.y_(0,48),e.y_(0,46),e.y_(0,47)])),e.ge(1),1),24192e5),e.tw(e.cb(0,e.af_u(["properties","video","taxonomies"],e.o([e.s_(0,46),e.s_(0,47),e.s_(0,185)])),e.ge(1),1),24192e5)])),188738:e.r(11,0,["properties","video","genres"],e.ref(20),["properties","video","taxonomies"],["properties","video","taxonomies"],e.ref(20),[e.s_(0,1)]),188740:e.r(11,0,["properties","video","genres"],e.ref(18),["properties","video","taxonomies"],["properties","video","taxonomies"],e.ref(18),[e.s_(0,3),e.s_(0,4),e.s_(0,124),e.s_(0,126),e.s_(0,129),e.s_(0,"man-vs-nature"),e.s_(0,143),e.s_(0,"natural"),e.s_(0,150),e.s_(0,179),e.s_(0,209),e.s_(0,"survive-this")]),188741:e.r(12,[e.s_(["name"],53),e.s_(["name"],55),e.s_(["name"],172),e.s_(["name"],186),e.s_(["name"],211)],53,55,172,187,211,53,55,"murder",172,186,211),188743:e.r(12,[e.s_(["name"],75),e.s_(["name"],76),e.s_(["name"],135),e.s_(["name"],152)],"documentari-crime",75,76,135,152,54,"documentari crime",75,"documentary series",135,152),188744:e.r(11,0,["properties","video","genres"],e.o([e.s_(["name"],15),e.s_(["name"],37),e.s_(["name"],80),e.s_(["name"],132),e.s_(["name"],148),e.s_(["name"],157),e.s_(["name"],189),e.s_(["name"],194),e.s_(["name"],195),e.s_(["name"],196),e.s_(["name"],212)]),["properties","video","taxonomies"],["properties","video","taxonomies"],e.o([e.s_(["name"],15),e.s_(["name"],37),e.s_(["name"],132),e.s_(["name"],148),e.s_(["name"],189),e.s_(["name"],193),e.s_(["name"],212)]),[e.s_(0,16),e.s_(0,38),e.s_(0,"medical-marvels"),e.s_(0,148),e.s_(0,189),e.s_(0,193),e.s_(0,213)]),188745:e.r(11,2,["properties","video","taxonomies"],e.o([e.s_(["name"],24),e.s_(["name"],32),e.s_(["name"],52),e.s_(["name"],106),e.s_(["name"],107),e.s_(["name"],117),e.s_(["name"],151),e.s_(["name"],180),e.s_(["name"],201),e.s_(["name"],216)]),["properties","video","genres"],["properties","video","taxonomies"],e.o([e.s_(0,24),e.s_(0,32),e.s_(0,52),e.s_(0,105),e.s_(0,109),e.s_(0,"grand-slam"),e.s_(0,137),e.s_(0,151),e.s_(0,181),e.s_(0,201),e.s_(0,215)]),[e.s_(["name"],24),e.s_(["name"],32),e.s_(["name"],52),e.s_(["name"],64),e.s_(["name"],105),e.s_(["name"],108),e.s_(["name"],117),e.s_(["name"],136),e.s_(["name"],138),e.s_(["name"],151),e.s_(["name"],169),e.s_(["name"],180),e.s_(["name"],183),e.s_(["name"],200),e.s_(["name"],216)]),188747:e.r(13,1,1,1,1,1,1,1,1,[e.s_(2,"fiction"),e.s_(2,188)],[e.s_(0,16),e.s_(0,91),e.s_(0,131),e.s_(0,147),e.s_(0,"paranormal-unexplained"),e.s_(0,188),e.s_(0,191)],[e.s_(["name"],15),e.s_(["name"],131),e.s_(["name"],159),e.s_(["name"],188),e.s_(["name"],190)],15,91,131,147,159,188,190),188748:e.q(e.ocqs([e.tw(e.cb(0,e.af_u(["properties","video","taxonomies"],e.o([e.s_(0,42),e.s_(0,50),e.s_(0,59),e.s_(0,104),e.s_(0,120),e.s_(0,"kitchen"),e.s_(0,174)])),e.ge(1),1),24192e5),e.tw(e.cb(0,e.af_u(["properties","video","taxonomies"],e.o([e.s_(["name"],42),e.s_(["name"],50),e.s_(["name"],58),e.s_(["name"],104),e.s_(["name"],174)])),e.ge(1),1),24192e5),e.tw(e.cb(0,e.af_u(["properties","video","genres"],e.o([e.s_(["name"],42),e.s_(["name"],50),e.s_(["name"],"fast food"),e.s_(["name"],"food & home"),e.s_(["name"],"food competitions"),e.s_(["name"],"food court"),e.s_(["name"],"food truck"),e.s_(["name"],174),e.s_(["name"],"seafood")])),e.ge(1),1),24192e5)])),188750:e.q(e.ocqs([e.tw(e.cb(0,e.af_u(["properties","video","taxonomies"],e.ref(13)),e.ge(1),1),24192e5),e.tw(e.cb(0,e.af_u(["properties","video","taxonomies"],e.ref(24)),e.ge(1),1),24192e5),e.tw(e.cb(0,e.ref(6),e.ge(1),1),24192e5)])),188751:e.q(e.ocqs([e.tw(e.cb(0,e.af_u(["properties","video","taxonomies"],e.o([e.s_(0,111),e.s_(0,118),e.s_(0,158),e.s_(0,229)])),e.ge(1),1),24192e5),e.tw(e.cb(0,e.af_u(["properties","video","genres"],e.o([e.s_(["name"],111),e.s_(["name"],118),e.s_(["name"],121),e.s_(["name"],158),e.s_(["name"],"unexplained phenomena")])),e.ge(1),1),24192e5),e.tw(e.cb(0,e.af_u(["properties","video","genres"],e.o([e.s_(0,111),e.s_(0,118),e.s_(0,121),e.s_(0,158),e.s_(0,229)])),e.ge(1),1),24192e5)])),188755:e.r(11,0,["properties","video","taxonomies"],e.o([e.s_(0,"co-viewing-parents"),e.s_(0,88),e.s_(0,127)]),["properties","video","genres"],["properties","video","genres"],e.o([e.s_(0,88),e.s_(0,127)]),[e.s_(["name"],88),e.s_(["name"],127)]),188758:e.r(11,0,["properties","video","genres"],e.o([e.s_(2,130),e.s_(2,173)]),["properties","video","genres"],["properties","video","genres"],e.y_(0,173),[e.s_(["name"],23),e.s_(["name"],51),e.s_(["name"],"game show"),e.s_(["name"],173),e.s_(["name"],"talent show"),e.s_(["name"],"talk show")]),189145:e.q(e.ocqs([e.tw(e.cb(0,e.af_u(["properties","video","taxonomies"],e.o([e.s_(0,3),e.s_(0,4),e.s_(0,87),e.s_(0,126),e.s_(0,129),e.s_(0,143),e.s_(0,179),e.s_(0,227)])),e.ge(3),3),24192e5),e.tw(e.cb(0,e.af_u(["properties","video","taxonomies"],e.ref(12)),e.ge(3),3),24192e5),e.tw(e.cb(0,e.af_u(["properties","video","genres"],e.ref(12)),e.ge(3),3),24192e5),e.tw(e.cb(0,e.af_u(["properties","video","genres"],e.o([e.s_(0,3),e.s_(0,4),e.s_(0,87),e.s_(0,129),e.s_(0,143),e.s_(0,179),e.s_(0,227)])),e.ge(3),3),24192e5)])),189147:e.r(16,1,1,1,1,1,1,1,1,21,21,11,11),189157:e.r(15,1,15,15,1),189158:e.r(17,[e.s_(0,53),e.s_(0,70),e.s_(0,172),e.s_(0,187),e.s_(0,"sopranos"),e.s_(0,211),e.s_(0,220)],[e.s_(["name"],53),e.s_(["name"],172),e.s_(["name"],186),e.s_(["name"],211),e.s_(["name"],220)],[e.s_(["name"],53),e.s_(["name"],172),e.s_(["name"],186),e.s_(["name"],211),e.s_(["name"],221)],[e.s_(0,53),e.s_(0,172),e.s_(0,187),e.s_(0,211),e.s_(0,220)]),189162:e.r(13,3,3,3,3,3,3,3,3,[e.s_(2,73),e.s_(2,120),e.s_(2,130)],[e.s_(0,"building-renovation"),e.s_(0,"buying-selling"),e.s_(0,74),e.s_(0,110),e.s_(0,120),e.s_(0,130)],[e.s_(["name"],36),e.s_(["name"],39),e.s_(["name"],74),e.s_(["name"],"dream homes"),e.s_(["name"],110),e.s_(["name"],"home improvement"),e.s_(["name"],"home selling"),e.s_(["name"],"homesteading"),e.s_(["name"],130)],36,39,73,74,110,120,130),189164:e.q(e.ocqs([e.tw(e.cb(0,e.af_u(["properties","video","taxonomies"],e.o([e.s_(0,48),e.s_(0,79),e.s_(0,90),e.s_(0,160),e.s_(0,"romantic-drama"),e.s_(0,214)])),e.ge(3),3),24192e5),e.tw(e.cb(0,e.af_u(["properties","video","taxonomies"],e.o([e.s_(["name"],78),e.s_(["name"],89)])),e.ge(3),3),24192e5),e.tw(e.cb(0,e.ref(6),e.ge(3),3),24192e5),e.tw(e.cb(0,e.af_u(["properties","video","genres"],e.ref(13)),e.ge(3),3),24192e5)])),189168:e.r(18,[e.s_(0,201)],[e.s_(["name"],24),e.s_(["name"],32),e.s_(["name"],52),e.s_(["name"],65),e.s_(["name"],105),e.s_(["name"],108),e.s_(["name"],116),e.s_(["name"],164),e.s_(["name"],169),e.s_(["name"],171),e.s_(["name"],183),e.s_(["name"],200),e.s_(["name"],228)],[e.s_(0,24),e.s_(0,32),e.s_(0,52),e.s_(0,"europa-league"),e.s_(0,105),e.s_(0,109),e.s_(0,116),e.s_(0,137),e.s_(0,170),e.s_(0,171),e.s_(0,201)],"all sports",24,32,52,106,108,136,141,"sports documentaries"),189200:e.r(19,3,3,3,3,3,e.ref(4),3,e.ref(4),3,3,24,24),189215:e.r(14,22,22,[e.s_(["name"],32),e.s_(["name"],151)],[e.s_(["name"],"basketball entertainment"),e.s_(["name"],151)]),189217:e.r(14,26,26,[e.s_(["name"],"fa trophy"),e.s_(["name"],105),e.s_(["name"],169),e.s_(["name"],171),e.s_(["name"],"uefa champions league"),e.s_(["name"],228),e.s_(["name"],"uefa europa league highlights show")],[e.s_(["name"],106),e.s_(["name"],107),e.s_(["name"],"football champions league"),e.s_(["name"],"football europa conference league"),e.s_(["name"],"football europa league"),e.s_(["name"],"football national english championship"),e.s_(["name"],"football national french championship"),e.s_(["name"],"football national italian championship")]),189218:e.r(16,1,1,1,1,1,1,1,1,16,16,9,9),189219:e.q(e.ocqs([e.tw(e.cb(0,e.af_u(["properties","video","taxonomies"],e.o([e.s_(0,38),e.s_(0,80),e.s_(0,140),e.s_(0,189),e.s_(0,193),e.s_(0,213)])),e.ge(3),3),24192e5),e.tw(e.cb(0,e.af_u(["properties","video","genres"],e.o([e.s_(["name"],"cars & trucks"),e.s_(["name"],63),e.s_(["name"],80),e.s_(["name"],"man & medicine"),e.s_(["name"],140),e.s_(["name"],147),e.s_(["name"],157),e.s_(["name"],189),e.s_(["name"],195),e.s_(["name"],196),e.s_(["name"],"technology")])),e.ge(3),3),24192e5),e.tw(e.cb(0,e.af_u(["properties","video","taxonomies"],e.o([e.s_(["name"],37),e.s_(["name"],63),e.s_(["name"],80),e.s_(["name"],189),e.s_(["name"],194),e.s_(["name"],195),e.s_(["name"],196),e.s_(["name"],212)])),e.ge(3),3),24192e5),e.tw(e.cb(0,e.af_u(["properties","video","genres"],e.o([e.s_(0,"cyber-tech"),e.s_(0,80),e.s_(0,189),e.s_(0,"space-beyond"),e.s_(0,"space-exploration"),e.s_(0,"space-travel"),e.s_(0,213)])),e.ge(3),3),24192e5)])),189220:e.r(16,3,3,3,3,3,3,3,3,25,25,23,23),189222:e.r(19,1,1,1,1,1,e.s_(["name"],0),1,e.s_(["name"],0),1,1,31,31),189223:e.r(15,3,27,27,3),189225:e.r(18,[e.s_(0,42),e.s_(0,50),e.s_(0,59),e.s_(0,104),e.s_(0,175),e.s_(0,219)],[e.s_(["name"],"baking competitions"),e.s_(["name"],23),e.s_(["name"],42),e.s_(["name"],50),e.s_(["name"],58),e.s_(["name"],104),e.s_(["name"],175),e.s_(["name"],218)],[e.s_(0,22),e.s_(0,42),e.s_(0,49),e.s_(0,50),e.s_(0,59),e.s_(0,104),e.s_(0,175),e.s_(0,219)],22,42,49,"cooking competitions",51,58,104,175,218),189227:e.r(16,1,1,1,1,1,1,1,1,8,8,14,14),189228:e.r(17,[e.s_(0,1),e.s_(0,"anti-heroes"),e.s_(0,13),e.s_(0,21),e.s_(0,28),e.s_(0,33),e.s_(0,44),e.s_(0,48),e.s_(0,57),e.s_(0,69),e.s_(0,70),e.s_(0,72),e.s_(0,79),e.s_(0,82),e.s_(0,90),e.s_(0,"family-crime"),e.s_(0,114),e.s_(0,115),e.s_(0,"high-school"),e.s_(0,121),e.s_(0,123),e.s_(0,144),e.s_(0,147),e.s_(0,154),e.s_(0,"original"),e.s_(0,156),e.s_(0,160),e.s_(0,167),e.s_(0,188),e.s_(0,198),e.s_(0,199),e.s_(0,205),e.s_(0,207),e.s_(0,211),e.s_(0,214),e.s_(0,237),e.s_(0,240)],[e.s_(["name"],1),e.s_(["name"],13),e.s_(["name"],20),e.s_(["name"],25),e.s_(["name"],33),e.s_(["name"],43),e.s_(["name"],44),e.s_(["name"],48),e.s_(["name"],56),e.s_(["name"],68),e.s_(["name"],"dark comedy"),e.s_(["name"],71),e.s_(["name"],"dystopian drama"),e.s_(["name"],81),e.s_(["name"],91),e.s_(["name"],112),e.s_(["name"],113),e.s_(["name"],"high school"),e.s_(["name"],121),e.s_(["name"],122),e.s_(["name"],144),e.s_(["name"],147),e.s_(["name"],153),e.s_(["name"],155),e.s_(["name"],166),e.s_(["name"],"revenge"),e.s_(["name"],182),e.s_(["name"],"romantic comedy"),e.s_(["name"],188),e.s_(["name"],197),e.s_(["name"],199),e.s_(["name"],204),e.s_(["name"],207),e.s_(["name"],208),e.s_(["name"],211),e.s_(["name"],"teen dramas"),e.s_(["name"],236),e.s_(["name"],239)],[e.s_(["name"],13),e.s_(["name"],20),e.s_(["name"],25),e.s_(["name"],33),e.s_(["name"],"classic criminals"),e.s_(["name"],43),e.s_(["name"],47),e.s_(["name"],56),e.s_(["name"],68),e.s_(["name"],71),e.s_(["name"],78),e.s_(["name"],"emmy winning"),e.s_(["name"],81),e.s_(["name"],89),e.s_(["name"],91),e.s_(["name"],112),e.s_(["name"],113),e.s_(["name"],"hbo classics"),e.s_(["name"],121),e.s_(["name"],122),e.s_(["name"],144),e.s_(["name"],153),e.s_(["name"],155),e.s_(["name"],166),e.s_(["name"],182),e.s_(["name"],188),e.s_(["name"],190),e.s_(["name"],197),e.s_(["name"],199),e.s_(["name"],204),e.s_(["name"],207),e.s_(["name"],208),e.s_(["name"],221),e.s_(["name"],236),e.s_(["name"],239)],[e.s_(0,13),e.s_(0,21),e.s_(0,28),e.s_(0,33),e.s_(0,"classic-criminals"),e.s_(0,"classic-warner-bros"),e.s_(0,47),e.s_(0,57),e.s_(0,70),e.s_(0,72),e.s_(0,78),e.s_(0,"emmy-winning"),e.s_(0,82),e.s_(0,90),e.s_(0,91),e.s_(0,"female-superhero"),e.s_(0,114),e.s_(0,115),e.s_(0,"hbo-classics"),e.s_(0,121),e.s_(0,123),e.s_(0,144),e.s_(0,154),e.s_(0,156),e.s_(0,167),e.s_(0,182),e.s_(0,188),e.s_(0,191),e.s_(0,198),e.s_(0,199),e.s_(0,205),e.s_(0,207),e.s_(0,220),e.s_(0,237),e.s_(0,240)]),189291:e.q(e.tw(e.cb(1,e.pe(3,"www.tntsports.co.uk"),e.ge(1),1),2592e6)),189324:e.r(9,"eyeota_experian","18495","189324","eyeota_experian","16338","189324","35578","189324","eyeota_roymorgan","40790","189324","liveramp_IXIDigital","1000089854","189324","eyeota","318","189324","liveramp_Mastercard","1005909081","189324","eyeota_experian","18572","189324","liveramp_AudienceElements","1001851276","189324","liveramp_AudienceElements","1001851266","189324","liveramp_Mastercard","1005906971","189324","liveramp_CoreLogic","1000868746","189324","liveramp_CoreLogic","1000868736","189324","eyeota_experian","16808","189324","liveramp_CACI","1004178939","189324","liveramp_CACI","1004178749","189324","eyeota_experian","30383","189324","liveramp_Acxiom","1004909469","189324","liveramp_CACI","1004177729","189324","189324","liveramp_CoreLogic","1000868726","189324"),189325:e.r(8,"eyeota","12967","189325","eyeota_experian","10252","189325","liveramp_Yougov","1006302721","189325","liveramp_Yougov","1006302741","189325","liveramp_Yougov","1006302791","189325","liveramp_Yougov","1006302691","189325","liveramp_Yougov","1006302781","189325","1649","189325","liveramp_Bombora","1005388449","189325","liveramp_Acxiom","10892","189325","liveramp_ShareThis","1003630509","189325","eyeota","12967","189325","liveramp_ShareThis","1001014439","189325","eyeota_experian","16810","189325"),189326:e.r(9,"liveramp_Epsilon","1003024226","189326","liveramp_AudienceElements","1001850346","189326","34662","189326","eyeota","35944","189326","liveramp_Zeotap","1004559769","189326","liveramp_Experian","1007227851","189326","liveramp_AudienceElements","1001851996","189326","liveramp_Zeotap","1004465129","189326","liveramp_Experian","1007227331","189326","liveramp_ShareThis","1005134329","189326","liveramp_Acxiom","277784682","189326","liveramp_AnalyticsIQ","1001373079","189326","liveramp_Alliant","1000847816","189326","liveramp_Stirista","1003669629","189326","eyeota_experian","30099","189326","liveramp_Experian","1004267799","189326","liveramp_RoyMorgan","1002213986","189326","liveramp_Experian","1007227851","189326","liveramp_Mastercard","1005907581","189326","189326","liveramp_Zeotap","1004467149","189326"),189327:e.r(5,"liveramp_Zeotap","1004652229","189327","liveramp_AudienceElements","1001851996",!1,"189327","liveramp_IXIDigital","1000091954",!1,"189327","liveramp_killi","1006991771",!1,"189327","liveramp_AnalyticsIQ","1004391769",!1,"189327","liveramp_killi","1006991741",!1,"189327","liveramp_StartApp","1004431229",!1,"189327","eyeota","1728",!1,"189327","liveramp_Mastercard","1005911421",!1,"189327","liveramp_Zeotap","1004652229",!1,"189327","liveramp_Epsilon","1000998159",!1,"189327","liveramp_IXIDigital","1000091994",!1,"189327","liveramp_PlaceIQ","1002445206",!1,"189327","liveramp_Mastercard","1005907581",!1,"189327","liveramp_CACI","1004178939",!1,"189327","liveramp_Epsilon","1000998159",!1,"189327",1,!1,1),189328:e.r(6,"liveramp_OnAudience","1002862746","189328","liveramp_ShareThis","1003629219","189328","liveramp_Zeotap","1004572989",!1,"189328","liveramp_OnAudience","1002862816",!1,"189328","liveramp_OnAudience","1002862736",!1,"189328","liveramp_OnAudience","1002860406",!1,"189328","liveramp_OnAudience","1002862846",!1,"189328","liveramp_OnAudience","1002862766",!1,"189328","liveramp_OnAudience","1002862786",!1,"189328","liveramp_OnAudience","1002862856",!1,"189328","liveramp_OnAudience","1002860416",!1,"189328","liveramp_OnAudience","1002862726",!1,"189328","liveramp_OnAudience","1002862826",!1,"189328","liveramp_OnAudience","1002860396",!1,"189328","liveramp_OnAudience","1002862806",!1,"189328","liveramp_OnAudience","1002862796",!1,"189328","liveramp_Zeotap","1004249559",!1,"189328","liveramp_ShareThis","1001010929",!1,"189328","liveramp_ShareThis","1001013369",!1,"189328","liveramp_ShareThis","1001013239",!1,"189328","liveramp_ShareThis","1006582121",!1,"189328",1,!1,1),190494:e.r(3,7,0,7,0),190496:e.r(4,0,[e.s_(0,19),e.s_(0,34),e.s_(0,40),e.s_(0,62),e.s_(0,102),e.s_(0,109),e.s_(0,133),e.s_(0,137),e.s_(0,138),e.s_(0,139),e.s_(0,168),e.s_(0,177),e.s_(0,203),e.s_(0,206),e.s_(0,224),e.s_(0,235)],[e.s_(["name"],19),e.s_(["name"],34),e.s_(["name"],40),e.s_(["name"],61),e.s_(["name"],102),e.s_(["name"],108),e.s_(["name"],133),e.s_(["name"],136),e.s_(["name"],138),e.s_(["name"],139),e.s_(["name"],168),e.s_(["name"],176),e.s_(["name"],202),e.s_(["name"],206),e.s_(["name"],224),e.s_(["name"],232),e.s_(["name"],233),e.s_(["name"],234),e.s_(["name"],"vehicle sales")],[e.s_(0,19),e.s_(0,34),e.s_(0,40),e.s_(0,62),e.s_(0,102),e.s_(0,109),e.s_(0,133),e.s_(0,137),e.s_(0,138),e.s_(0,139),e.s_(0,168),e.s_(0,177),e.s_(0,203),e.s_(0,206),e.s_(0,224),e.s_(0,"vehicle-customization"),e.s_(0,"vehicle-parts-and-accessories"),e.s_(0,235),e.s_(0,"vehicle-sales")],[e.s_(["name"],"auto racing"),e.s_(["name"],19),e.s_(["name"],34),e.s_(["name"],40),e.s_(["name"],61),e.s_(["name"],"drag racing"),e.s_(["name"],102),e.s_(["name"],108),e.s_(["name"],133),e.s_(["name"],"moto gp *"),e.s_(["name"],138),e.s_(["name"],139),e.s_(["name"],"rally racing"),e.s_(["name"],176),e.s_(["name"],202),e.s_(["name"],206),e.s_(["name"],224),e.s_(["name"],232),e.s_(["name"],233),e.s_(["name"],234)]),190608:e.r(3,2,19,19,2),190612:e.r(3,5,17,5,17),190626:e.r(4,2,[e.s_(0,10),e.s_(0,11),e.s_(0,12),e.s_(0,41),e.s_(0,77),e.s_(0,85),e.s_(0,161),e.s_(0,162),e.s_(0,163)],[e.s_(["name"],"animal adoption"),e.s_(["name"],5),e.s_(["name"],6),e.s_(["name"],7),e.s_(["name"],8),e.s_(["name"],9),e.s_(["name"],12),e.s_(["name"],41),e.s_(["name"],77),e.s_(["name"],83),e.s_(["name"],84),e.s_(["name"],"pet")],[e.s_(0,"animal-adoption"),e.s_(0,"animal-behavior"),e.s_(0,"animal-breeding"),e.s_(0,10),e.s_(0,11),e.s_(0,"animal-training"),e.s_(0,12),e.s_(0,41),e.s_(0,77),e.s_(0,85),e.s_(0,"extinct-species"),e.s_(0,161),e.s_(0,162),e.s_(0,163)],[e.s_(["name"],5),e.s_(["name"],6),e.s_(["name"],7),e.s_(["name"],8),e.s_(["name"],9),e.s_(["name"],12),e.s_(["name"],41),e.s_(["name"],77),e.s_(["name"],83),e.s_(["name"],84),e.s_(["name"],"pet food"),e.s_(["name"],163)]),190635:e.q(e.ocqs([e.cb(0,e.af_u(["properties","video","taxonomies"],e.ref(10)),e.ge(1),1),e.cb(0,e.af_u(["properties","video","taxonomies"],e.o([e.s_(["name"],65),e.s_(["name"],66),e.s_(["name"],67),e.s_(["name"],"indoor cycling"),e.s_(["name"],222)])),e.ge(1),1),e.cb(0,e.af_u(["properties","video","genres"],e.ref(10)),e.ge(1),1),e.cb(0,e.af_u(["properties","video","genres"],e.o([e.s_(["name"],65),e.s_(["name"],66),e.s_(["name"],67),e.s_(["name"],222)])),e.ge(1),1)])),192639:e.r(26),192642:e.r(25,"football"),192643:e.r(25,"cycling"),192644:e.r(25,"golf"),192651:e.r(24,[e.e_(["name"],"nascar"),e.e_(["name"],"drag-racing"),e.e_(["name"],"formula-1"),e.e_(["name"],"supermoto"),e.y_(["name"],138),e.e_(["name"],"us-motorsport"),e.y_(["name"],141)]),192658:e.r(24,[e.e_(["name"],"snowboard"),e.e_(["name"],"snowcross"),e.e_(["name"],"ice-sledge-hockey"),e.e_(["name"],"ice-climbing"),e.e_(["name"],"nordic-combined"),e.e_(["name"],"nordic-skiing"),e.e_(["name"],"nordic-open"),e.e_(["name"],"luge"),e.e_(["name"],"skeleton"),e.e_(["name"],"bobsleigh"),e.e_(["name"],"ski-jumping"),e.e_(["name"],"biathlon"),e.e_(["name"],"speed-skating"),e.e_(["name"],"speed-skiing"),e.e_(["name"],"skiing"),e.e_(["name"],"cross-country-skiing"),e.e_(["name"],"alpine-skiing"),e.e_(["name"],"figure-skating"),e.e_(["name"],"ice-hockey"),e.e_(["name"],"winter-sports")]),193216:e.r(2,[e.lm("37b55166-f671-4ecb-8e8f-9c6edbb512d2",e.ge(.54906875)),e.ifp("190496")]),88584:e.r(1,1)}||{},queriesByEvent:t||{},metadata:{88584:"0c8b70cdb7",180677:"ad3c0ea153",180678:"314cb999f2",180679:"e66336f750",180680:"5a77b15950",180681:"f254908fcc",180682:"9448fdabd4",180683:"cf2c7ea4ed",180684:"bf76e97110",180686:"33be2c27b1",183817:"1187d4bf7e",183818:"0ece4bf813",183819:"2565a8614f",183821:"5dec3a033b",183822:"6acb69f19c",183823:"4ae734a778",183824:"1fd28e9850",183825:"104158add4",183826:"4f8ad8a4d3",184283:"8e0ae21f90",184515:"291ce15cbd",184529:"a06c273b8a",184530:"1f78859a7b",184559:"40e367b954",184581:"50c0412a54",184848:"19e973d55b",186781:"efc1bc86f0",188110:"841cbcdf53",188140:"826e9dbf82",188143:"f425ab89b3",188158:"dc82fcbbca",188534:"c4e8ce2f0d",188536:"100c4d523a",188537:"47ae1d653c",188538:"8c60955f95",188539:"b495078767",188540:"12218d5ace",188547:"c6573e057c",188548:"a4dd3217db",188549:"ac9754b5d9",188648:"ac567be830",188658:"0251fb8b33",188737:"6a58aab4db",188738:"a808b288c0",188740:"418dfb5887",188741:"20a3bd633b",188743:"832d22c109",188744:"ef50df093a",188745:"a6a3d098c3",188747:"aa0caab0a7",188748:"be39f8e427",188750:"dc36709dd8",188751:"08b9fa876a",188755:"87022b37b6",188758:"97bc8503a1",189145:"d034c63ff7",189147:"7f5eedf4c9",189157:"3232ce5784",189158:"1f9bbc2f53",189162:"a3d3433e10",189164:"e1dabe907a",189168:"fe309053c8",189200:"f7d802f7bc",189215:"cd60bd1f3a",189217:"1b778b65eb",189218:"6a407c2a1f",189219:"2589e35e00",189220:"71c0a1f8ce",189222:"bae1b27fc8",189223:"82e6286478",189225:"c9aefc9429",189227:"27c568f036",189228:"51ab46d3a2",189291:"ef90114158",189324:"715197b90e",189325:"e189f2cdb8",189326:"c54e396571",189327:"9094d2171f",189328:"3b531db418",190494:"15f7123324",190496:"79e79bef86",190608:"a99803d7f7",190612:"b0cf174883",190626:"e712dc23c1",190635:"7d486a7cc9",192639:"19e973d55b",192642:"2b51c8720c",192643:"c5b02c3301",192644:"1090988226",192651:"bbe6b2007d",192658:"51e611f52b",193216:"0164215a9f"}}}));var re=n(656);async function ie(p){let{contextsInitTimestampPerformance:m,master:d}=p;const v=await d.next(),g=performance.now(),_=new X(v.permutiveConfig);_.measureBetween("waiting_worker_config",m,g),Object.entries(v.globals??{}).forEach((e=>{let[t,n]=e;Object.defineProperty(self,t,{value:n})}));const h=function(n){const r=()=>Math.floor(Date.now()/1e3)+n,[i,o]=t.Ue(r());return(0,e.UM)((()=>o(r())),1e3),i}((0,r.zG)(v.initialTimestampSecs,o.EQ((()=>0),(e=>e-Date.now()/1e3)))),y=await(0,r.zG)(d.next,_.traceTask("waiting_worker_input"))(),b=performance.now(),w=function(t){var n;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.RP;return t.loggingEnabled&&void 0!==(null===(n=self.console)||void 0===n?void 0:n.log)?new O(r):new D}(v.permutiveConfig,v.sdkInitTimestampDate);w.debug("Worker started");const I=v.metricsEnabled?new E(v.sdkInitTimestampPerformance,v.timeOriginMainContext,w):new P;I.trackTimeSinceInit("sdk_lifecycle_timestamps",{timestamp_name:"worker_evaluated",time_origin:"sdk_init"},m),I.trackTimeSinceInit("sdk_lifecycle_timestamps",{timestamp_name:"worker_received_config",time_origin:"sdk_init"},g),I.trackTimeSinceInit("sdk_lifecycle_timestamps",{timestamp_name:"worker_received_input",time_origin:"sdk_init"},b);const S=(0,r.zG)((()=>d.read()),function(e,n){const i=e=>(0,r.zG)(e,R.Hd((e=>e in n)),(e=>{let{left:t,right:n}=e;return{buffers:n,nonBuffers:t}}));return o=>{const{buffers:s,nonBuffers:a}=i(e),[u,c]=t.Ue({...a,...(0,r.zG)(s,R.Su((e=>()=>{const t=s[e];return s[e]=n[e].empty,t})))});return(async()=>{for(;;){const e=(0,r.zG)(await o(),j.UI(i),j.ur({concat:(e,t)=>({nonBuffers:{...e.nonBuffers,...t.nonBuffers},buffers:(()=>{const r={...e.buffers};for(const e in t.buffers)r[e]=e in r?n[e].concat(r[e],t.buffers[e]):t.buffers[e];return r})()})})),t=(0,r.zG)(e.buffers,R.Su(((e,t)=>(s[e]=n[e].concat(s[e],t),()=>{const t=s[e];return s[e]=n[e].empty,t}))));c({...u.current,...e.nonBuffers,...t})}})(),(0,r.zG)(e,R.Su((e=>(0,r.zG)(u,t.UI((t=>t[e]))))))}}(y,{newEvents:s.uZ(),priorCachedEventsResponses:s.uZ()}),(0,a.rO)({newEvents:(0,re.F)(I,"pageview_received_by_worker")}),(e=>{let{...t}=e;return{...t,currentTimestampSecs:h}}),function(p,m,d,v){return g=>{m.debug("SDK core started",p);const _=500,h=new G(d),y=new k(p.permutiveConfig),b=new te(y,p.permutiveConfig,h,d,m,(()=>g.webClient.current));v.measureSinceInit("sdk_core_started").finish();const w={config:p.permutiveConfig,customQueries:ne(),logger:m,metrics:d,optimisedActivationsConfig:p.optimisedActivationsConfig,permutiveApi:h,permutiveUrls:y,reportError:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};b.reportError(e,null==t?void 0:t.userId,null==t?void 0:t.timestamp)},trackPageviewComplete:p.trackPageviewComplete,migratedStateMaps:()=>p.migratedStateMaps,trace:v},I=(0,r.zG)(V.initialise(p.permutiveConfig,w.logger,w.reportError,v,w.metrics,g.userId,(()=>(0,r.zG)(Z.connect(new C(p.permutiveConfig),w.metrics,new T,p.organizationId,`events_${g.userId.current}`,`keys_${g.userId.current}`,"events",w.logger,g.consent,p.isSecureContext),v.traceTask("connect_idb_events_cache")))),v.traceTask("initialise_events_cache"),u.At((()=>()=>d.trackTimeSinceInit("sdk_lifecycle_timestamps",{timestamp_name:"events_cache_initialised",time_origin:"sdk_init"},performance.now()))),u.EQ((e=>{m.error(`Worker failed to initialise IndexedDB event cache: ${e}`);const n={},[i,o]=t.gS(s.uZ()),a=()=>new Promise((e=>{const t=String(Math.random());n[t]=r=>{delete n[t],e(r)},o([[t,void 0]])}));return(0,r.zG)(g.priorCachedEventsResponses,t.UI((e=>(0,r.zG)(e(),s.UI((e=>{var t;let[r,i]=e;return null===(t=n[r])||void 0===t?void 0:t.call(n,i)})))))),{coreOutput:{eventsCachedInWorker:!1,priorCachedEventsRequests:i},coreConfig:{eventsCache:f.t$(a)}}}),(e=>({coreOutput:{eventsCachedInWorker:!0,priorCachedEventsRequests:t.a9(M.of(s.bM()))},coreConfig:{eventsCache:f.F2(e)}}))));return(0,r.zG)(u.Y3((()=>Promise.resolve().then(n.bind(n,296)).then((e=>e.service))),(()=>"Failed to import core service.")),v.traceTask("import-core-service"),u.YO("startCore"),u.Qt("eventsCache",u.fF(I)),u.Qt("lookalikeModelsService",u.Y3((()=>Promise.resolve().then(n.bind(n,963)).then((e=>e.lookalikeModelsService))),(()=>"Failed to import lookalike models."))),u.wE((n=>{let{startCore:s,eventsCache:f,lookalikeModelsService:d}=n;return(0,r.zG)(!0,u.DT(r.yR,(()=>"IndexedDB disabled.")),u.tS((()=>(0,r.zG)(z.K.initialise(new C(p.permutiveConfig),w.metrics,w.logger,new T,`worker_${p.organizationId}`,"core_service_state","keys","core_service_state",4,p.isSecureContext),v.traceTask("initialise-core-idb")))),u.tS((e=>(0,U.Yt)(u.Hi)({persistCoreState:c(e,"core"),persistLalState:c(e,"lal")}))),u.UI((n=>{let{persistCoreState:u,persistLalState:c}=n;return(0,r.zG)(d({...w,...g}),c,i.VS((n=>{let[a,c]=n;return(0,r.zG)(g,s({...w,...f.coreConfig,lookalikeModels:o.G(c)}),(p=_,m=t.a9(!1),n=>i=>{const{value:o,state:s}=n(i),[a,u]=t.Ue(s.current),c=(0,e.UM)((()=>u(s.current)),p),l=(0,r.zG)(t.vP(s,a),t.UI((e=>{let[t,n]=e;return t===n})));return(0,r.zG)(m,t.bw((e=>e&&c()))),{value:(0,r.bc)(l,o),state:(0,r.zG)(t.vP(m,s,a),t.UI((e=>{let[t,n,r]=e;return t?n:r})))}}),l(g.consent),u,i.UI((e=>{let[n,[i,o]]=e;return{...o,stateFlushed:(0,r.zG)(t.vP(a,n,i),t.UI((e=>{let[t,n,r]=e;return t&&n&&r})))}})));var p,m})),(e=>(0,r.ls)(e,(0,a.rO)({state:()=>t.a9(void 0)}))))})),u.fS((e=>(m.warn("Worker running in non-persistent mode.",e),q.of((0,r.zG)(g,s({...w,...f.coreConfig,lookalikeModels:o.YP}),i.Hr("stateFlushed",(()=>t.a9(!0))),l(g.consent)))))),q.UI(i.UI((e=>({...e,...f.coreOutput})))))})))}}(v,w,I,_),u.wE((e=>async()=>e({stopped:t.a9(!1),previousState:v.previousState})))),x=await S();if(f.nM(x))return w.error(`Failed to start worker: ${x.left}`),void self.close();const A=x.right;d.send({eventsCachedInWorker:A.value.eventsCachedInWorker}),function(e,n,i){const s=(0,r.zG)(t.vP(n),t.UI((0,r.ls)(R.UI((e=>"function"==typeof e?e:M.of(e))),(0,U.Yt)(M.G5))));let a=s.current();e(a),(0,r.zG)(s,t.YP((t=>{const n=t(),s=(0,r.zG)(n,R.z7(((e,t)=>{var n;return t!==a[e]&&(null===(n=i[e])||void 0===n||!n.isEmpty(t))})),o.DT((0,F.ff)(R.xb)));o.pC(s)&&(a={...a,...s.value},e(s.value))})))}(d.send,{activations:t.vP(A.value.activations),cohorts:t.vP(A.value.cohorts),context:A.value.context,eventsToPublish:A.value.eventsToPublish,eventsToPublishOnPageUnload:A.value.eventsToPublishOnPageUnload,externalData:A.value.externalData,geoIP:A.value.geoIP,metrics:t.a9((()=>I.consume())),priorCachedEventsRequests:A.value.priorCachedEventsRequests,realtime:A.value.realtime,state:A.state,transitionsSinceInit:A.value.transitionsSinceInit,workerStateFlushed:A.value.stateFlushed,stateMigratedThisInitialisation:A.value.stateMigratedThisInitialisation},{eventsToPublish:{isEmpty:s.xb},metrics:{isEmpty:s.xb}})}const oe=t=>{const n=[],r=[],i=()=>{for(;n.length>0&&r.length>0;)r.shift()()},o=t=>new Promise((n=>{r.push((()=>n(t()))),(0,e.HJ)(i)}));return t.addEventListener("message",(0,e.GL)((t=>{null!==t.data&&(n.push(t.data),(0,e.HJ)(i))}))),{next:()=>o((()=>n.shift())),read:()=>o((()=>n.splice(0)))}};!async function(){const t=self;ie({contextsInitTimestampPerformance:e.NC,master:{...oe(t),send:e=>t.postMessage(e)}})}()})()})();',"Worker",void 0,void 0)}},477:e=>{e.exports=function(e,t,n,r){var i=self||window;try{try{var o;try{o=new i.Blob([e])}catch(t){(o=new(i.BlobBuilder||i.WebKitBlobBuilder||i.MozBlobBuilder||i.MSBlobBuilder)).append(e),o=o.getBlob()}var s=i.URL||i.webkitURL,a=s.createObjectURL(o),u=new i[t](a,n);return s.revokeObjectURL(a),u}catch(r){return new i[t]("data:application/javascript,".concat(encodeURIComponent(e)),n)}}catch(e){if(!r)throw Error("Inline worker is not supported");return new i[t](r,n)}}}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var n=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](n,n.exports,__webpack_require__),n.exports}__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},__webpack_require__.d=(e,t)=>{for(var n in t)__webpack_require__.o(t,n)&&!__webpack_require__.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var __webpack_exports__={};(()=>{var e,t,n=__webpack_require__(3992);(0,n.ho)(!0);const r="permutive.main.import_web_core_master",i=`${r}_start`;null===(e=performance)||void 0===e||null===(t=e.mark)||void 0===t||t.call(e,i),(0,n.SF)((()=>Promise.resolve().then(__webpack_require__.bind(__webpack_require__,108))))().then((e=>{var t,n;return null===(t=performance)||void 0===t||null===(n=t.measure)||void 0===n||n.call(t,r,i),e.runCoreInWebWorker()})).then((e=>{var t,i;const o=`${r}_start`;null===(t=performance)||void 0===t||null===(i=t.mark)||void 0===i||i.call(t,o),(0,n.SF)((()=>Promise.resolve().then(__webpack_require__.bind(__webpack_require__,7029))))().then((t=>{var r,i;return null===(r=performance)||void 0===r||null===(i=r.measure)||void 0===i||i.call(r,"permutive.main.import_runWebSdk",o),t.runSdk({coreWorker:e,contextsInitTimestampPerformance:n.NC,contextsInitTimestamp:n.RP})}))})).catch(console.error)})()})();